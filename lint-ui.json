[{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\eslint.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\actions\\portal.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\common.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\auth\\AccountTypeSelector.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\auth\\AuthPopup.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\badges\\AdminBadge.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\badges\\Badge.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\badges\\BrandBadge.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\badges\\ConditionBadge.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\badges\\NewSellerBadge.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\badges\\PremiumBadge.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\badges\\ProBadge.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\badges\\UserBadge.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\banners\\Banner.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\banners\\EngagementBanner.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\banners\\LocaleDetectionBanner.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\banners\\PartnerBanner.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\banners\\SectionBanner.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\banners\\home\\FeaturedSellersBanner.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\banners\\home\\NewestListingsBanner.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\banners\\home\\PromotedListingsBanner.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\BoostManagement.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\BundleBuilder.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":130,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":130,"endColumn":22}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3616,3619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3616,3619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3904,3907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3904,3907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3912,3915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3912,3915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":115,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":118,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3973,3976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3973,3976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  // No lifecycle imports needed - using $effect\n  import type { Product } from '../../types/product';\n  import Button from '../ui/Button.svelte';\n  import Dialog from '../../primitives/dialog/Dialog.svelte';\n  import LoadingSpinner from '../utilities/LoadingSpinner.svelte';\n  // Using Svelte enhanced images\n  import Avatar from '../ui/Avatar.svelte';\n  // Cache to prevent repeated fetches\n  const sellerProductsCache = new Map<string, { products: Product[], timestamp: number }>();\n  const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes\n  \n  interface Props {\n    sellerId: string;\n    sellerUsername: string;\n    sellerAvatar?: string;\n    sellerRating?: number;\n    initialItem: Product;\n    onConfirm: (items: Product[]) => void;\n    onCancel: () => void;\n    open?: boolean;\n    onOpenChange?: (open: boolean) => void;\n    onFetchSellerProducts?: (sellerId: string) => Promise<Product[]>;\n    translations: {\n      bundle_title: () => string;\n      bundle_subtitle: () => string;\n      bundle_shipTogether: () => string;\n      bundle_savePerItem: () => string;\n      bundle_yourBundle: () => string;\n      bundle_item: () => string;\n      bundle_items: () => string;\n      bundle_justThisItem: () => string;\n      bundle_addTwoItems: () => string;\n      bundle_addThreeItems: () => string;\n      bundle_addFiveItems: () => string;\n      bundle_saveAmount: () => string;\n      bundle_addMoreFrom: () => string;\n      bundle_noOtherItems: () => string;\n      bundle_showAll: () => string;\n      bundle_itemsTotal: () => string;\n      bundle_shipping: () => string;\n      bundle_serviceFee: () => string;\n      bundle_youSave: () => string;\n      bundle_total: () => string;\n      bundle_continueToCheckout: () => string;\n      bundle_checkoutItems: () => string;\n      bundle_quickOptions: () => string;\n      bundle_loading: () => string;\n      bundle_saveOnShipping: () => string;\n    };\n  }\n  \n  let { \n    sellerId, \n    sellerUsername,\n    sellerAvatar,\n    sellerRating = 0,\n    initialItem, \n    onConfirm, \n    onCancel,\n    open = true,\n    onOpenChange,\n    onFetchSellerProducts,\n    translations \n  }: Props = $props();\n  \n  let selectedItems = $state<Product[]>([initialItem]);\n  let sellerProducts = $state<Product[]>([]);\n  let loading = $state(true);\n  let error = $state('');\n  \n  // Calculate totals (all prices in BGN) - NO SHIPPING (paid on delivery)\n  const itemsTotal = $derived(\n    selectedItems.reduce((sum, item) => sum + item.price, 0)\n  );\n  \n  const serviceFee = $derived(Math.round(itemsTotal * 0.05 * 100) / 100 + 1.40); // 5% + 1.40 BGN\n  const totalAmount = $derived(itemsTotal + serviceFee);\n  \n  // Bundle benefit - save time by receiving all items in one delivery\n  const bundleBenefit = $derived(selectedItems.length > 1);\n  \n  \n  $effect(() => {\n    (async () => {\n      // Check cache first\n      const cacheKey = sellerId;\n      const cached = sellerProductsCache.get(cacheKey);\n\n      if (cached && Date.now() - cached.timestamp < CACHE_DURATION) {\n        // Use cached data\n        sellerProducts = cached.products.filter((p: Product) => p.id !== initialItem.id);\n        loading = false;\n        return;\n      }\n\n      try {\n        // Fetch products via callback prop\n        if (!onFetchSellerProducts) {\n          throw new Error('onFetchSellerProducts callback is required');\n        }\n\n        const rawProducts = await onFetchSellerProducts(sellerId);\n\n        // Map real data to Product type with necessary fields\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const products: Product[] = rawProducts.map((p: any) => ({\n          // Spread all existing database fields from the raw product\n          ...p,\n\n          // Override/add specific UI fields\n          currency: 'BGN',\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          images: p.product_images?.sort((a: any, b: any) => (a.sort_order || 0) - (b.sort_order || 0)).map((img: any) => img.image_url) || ['/placeholder-product.svg'],\n          seller_id: sellerId,\n          sellerName: '',\n          sellerRating: 0,\n          sellerId: sellerId,\n          createdAt: p.created_at || new Date().toISOString()\n        } as Product));\n\n        // Update cache\n        sellerProductsCache.set(cacheKey, {\n          products,\n          timestamp: Date.now()\n        });\n\n        // Set the products\n        sellerProducts = products;\n      } catch (_error) {\n        error = translations.bundle_noOtherItems();\n      } finally {\n        loading = false;\n      }\n    })();\n  });\n  \n  function addItem(product: Product) {\n    if (!selectedItems.find(item => item.id === product.id)) {\n      selectedItems = [...selectedItems, product];\n    }\n  }\n  \n  function removeItem(productId: string) {\n    selectedItems = selectedItems.filter(item => item.id !== productId);\n  }\n  \n  function toggleItem(product: Product) {\n    if (selectedItems.find(item => item.id === product.id)) {\n      removeItem(product.id);\n    } else {\n      addItem(product);\n    }\n  }\n  \n  function handleConfirm() {\n    onConfirm(selectedItems);\n  }\n\n  function handleOpenChange(isOpen: boolean) {\n    if (!isOpen) {\n      onCancel();\n    }\n    onOpenChange?.(isOpen);\n  }\n</script>\n\n<Dialog \n  {open} \n  onOpenChange={handleOpenChange} \n  class=\"!max-w-2xl w-full max-h-[90vh] h-full bundle-builder-dialog\"\n>\n  {#snippet title()}\n    <div class=\"flex items-center gap-3\">\n      <Avatar \n        src={sellerAvatar} \n        alt={sellerUsername}\n        size=\"md\"\n        class=\"ring-2 ring-white shadow-sm\"\n      />\n      <div class=\"flex-1\">\n        <div class=\"flex items-center gap-2\">\n          <span class=\"font-semibold text-[oklch(10%_0.02_250)]\">@{sellerUsername}</span>\n          {#if sellerRating > 0}\n            <div class=\"flex items-center gap-1 text-sm\">\n              <svg class=\"w-4 h-4 text-yellow-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/>\n              </svg>\n              <span class=\"text-[oklch(40%_0.02_250)]\">{sellerRating.toFixed(1)}</span>\n            </div>\n          {/if}\n        </div>\n        <p class=\"text-xs text-[oklch(40%_0.02_250)]\">Купете повече артикули в една доставка</p>\n      </div>\n    </div>\n    \n    {#if bundleBenefit}\n      <div class=\"bg-[oklch(45%_0.15_145)]/10 border border-[oklch(45%_0.15_145)]/20 rounded-lg p-2 flex items-center justify-center mt-3\">\n        <span class=\"text-sm font-medium text-[oklch(45%_0.15_145)]\">\n          📦 Получете всички артикули в една доставка\n        </span>\n      </div>\n    {/if}\n  {/snippet}\n\n  {#snippet children()}\n    <div class=\"bundle-builder-content flex-1 overflow-y-auto space-y-4 max-h-[50vh]\">\n      \n      <!-- Selected Items -->\n      <div class=\"bg-[oklch(98%_0.01_250)] rounded-lg p-4\">\n        <div class=\"flex items-center justify-between mb-3\">\n          <h3 class=\"text-base font-semibold text-[oklch(10%_0.02_250)]\">\n            {translations.bundle_yourBundle()} ({selectedItems.length} {selectedItems.length === 1 ? translations.bundle_item() : translations.bundle_items()})\n          </h3>\n        </div>\n        \n        <div class=\"space-y-2\">\n          {#each selectedItems as item (item.id)}\n            <div class=\"flex items-center gap-3 p-2 bg-white rounded-lg border border-[oklch(90%_0.02_250)]\" \n                 class:border-[oklch(60%_0.2_250)]={item.id === initialItem.id}\n                 >\n              <img\n                src={item.images?.[0] || item.product_images?.[0]?.image_url || '/placeholder-product.svg'}\n                alt={item.title}\n                class=\"w-12 h-12 object-cover rounded-md flex-shrink-0\"\n                loading=\"lazy\"\n              />\n              <div class=\"flex-1 min-w-0\">\n                <h4 class=\"text-sm font-medium text-[oklch(10%_0.02_250)] truncate\">{item.title}</h4>\n                <p class=\"text-sm font-bold text-[oklch(60%_0.2_250)]\">лв.{item.price}</p>\n              </div>\n              {#if item.id !== initialItem.id}\n                <button \n                  onclick={() => removeItem(item.id)}\n                  class=\"w-8 h-8 rounded-full bg-[oklch(98%_0.01_250)] border border-[oklch(90%_0.02_250)] \n                         flex items-center justify-center text-[oklch(40%_0.02_250)] \n                         hover:bg-[oklch(10%_0.02_250)] hover:text-white hover:border-[oklch(10%_0.02_250)] transition-colors\"\n                  aria-label=\"Remove {item.title}\"\n                >\n                  <svg class=\"w-4 h-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                    <path d=\"M18 6L6 18M6 6l12 12\" />\n                  </svg>\n                </button>\n              {/if}\n            </div>\n          {/each}\n        </div>\n      </div>\n    \n      <!-- Available Items -->\n      {#if loading}\n        <div class=\"flex flex-col items-center justify-center py-12\">\n          <LoadingSpinner size=\"md\" />\n          <p class=\"mt-2 text-sm text-[oklch(40%_0.02_250)]\">{translations.bundle_loading()}</p>\n        </div>\n      {:else if error}\n        <div class=\"text-center py-8 text-[oklch(45%_0.15_25)]\">{error}</div>\n      {:else if sellerProducts.length > 0}\n        <div>\n          <h3 class=\"text-base font-semibold text-[oklch(10%_0.02_250)] mb-3 px-1\">\n            Още от {sellerUsername}\n          </h3>\n          \n          <!-- Horizontal scrollable products -->\n          <div class=\"flex gap-3 overflow-x-auto scroll-snap-type-x scroll-snap-type-mandatory pb-2 scrollbarhide -mx-4 px-4\">\n            {#each sellerProducts as product (product.id)}\n              {@const isSelected = selectedItems.some(item => item.id === product.id)}\n              <button\n                onclick={() => toggleItem(product)}\n                class=\"relative bg-white rounded-lg border-2 transition-colors overflow-hidden flex-shrink-0 w-32 scroll-snap-align-start\"\n                class:border-[oklch(60%_0.2_250)]={isSelected}\n                class:border-[oklch(90%_0.02_250)]={!isSelected}\n                \n              >\n                {#if isSelected}\n                  <div class=\"absolute top-2 right-2 z-10 w-6 h-6 bg-[oklch(60%_0.2_250)] rounded-full flex items-center justify-center\">\n                    <svg class=\"w-4 h-4 text-white\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\">\n                      <path d=\"M5 13l4 4L19 7\" />\n                    </svg>\n                  </div>\n                {/if}\n                \n                <img\n                  src={product.images?.[0] || product.product_images?.[0]?.image_url || '/placeholder-product.svg'}\n                  alt={product.title}\n                  class=\"w-full aspect-square object-cover\"\n                  loading=\"lazy\"\n                />\n                <div class=\"p-2\">\n                  <h4 class=\"text-xs font-medium text-[oklch(10%_0.02_250)] truncate\">{product.title}</h4>\n                  <p class=\"text-sm font-bold text-[oklch(60%_0.2_250)] mt-1\">лв.{product.price}</p>\n                </div>\n              </button>\n            {/each}\n          </div>\n        </div>\n      {:else}\n        <div class=\"text-center py-8 text-[oklch(40%_0.02_250)]\">\n          {translations.bundle_noOtherItems()}\n        </div>\n      {/if}\n    </div>\n  {/snippet}\n\n  {#snippet actions()}\n    <!-- Summary -->\n    <div class=\"w-full space-y-3 mb-4\">\n      <div class=\"space-y-1.5\">\n        <div class=\"flex justify-between text-sm text-[oklch(40%_0.02_250)]\">\n          <span>Продукти ({selectedItems.length})</span>\n          <span>лв.{itemsTotal.toFixed(2)}</span>\n        </div>\n        <div class=\"flex justify-between text-sm text-[oklch(40%_0.02_250)]\">\n          <span>Такса услуга</span>\n          <span>лв.{serviceFee.toFixed(2)}</span>\n        </div>\n        <div class=\"text-xs text-[oklch(60%_0.02_250)] italic\">\n          * Доставката се плаща при получаване\n        </div>\n        <div class=\"flex justify-between text-base font-bold text-[oklch(10%_0.02_250)] pt-2 border-t border-[oklch(90%_0.02_250)]\">\n          <span>Общо</span>\n          <span>лв.{totalAmount.toFixed(2)}</span>\n        </div>\n      </div>\n      \n      <Button\n        onclick={handleConfirm}\n        variant=\"primary\"\n        size=\"lg\"\n        class=\"w-full min-h-[44px]\"\n        disabled={selectedItems.length === 0}\n      >\n        {#if selectedItems.length === 1}\n          Продължи към плащане\n        {:else}\n          Плащане за {selectedItems.length} артикула\n        {/if}\n      </Button>\n    </div>\n  {/snippet}\n</Dialog>\n\n<style>\n  /* Custom styles for bundle builder dialog - override Dialog defaults */\n  :global(.bundle-builder-dialog) {\n    max-width: 672px !important; /* 2xl equivalent */\n    width: 100% !important;\n  }\n  \n  /* Ensure proper scrolling in content area */\n  .bundle-builder-content {\n    max-height: 50vh;\n    overflow-y: auto;\n  }\n  \n  \n  /* Mobile-first responsive design */\n  @media (max-width: 640px) {\n    :global(.bundle-builder-dialog) {\n      width: calc(100vw - 1rem) !important;\n      max-width: calc(100vw - 1rem) !important;\n    }\n    \n    .bundle-builder-content {\n      max-height: 60vh;\n    }\n  }\n  \n  /* Ensure touch targets are properly sized on mobile */\n  @media (max-width: 640px) {\n    :global(.bundle-builder-dialog .btn) {\n      min-height: 44px;\n    }\n  }\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\BuyBox.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\CheckoutSummary.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\ConditionReport.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\FeaturedSellers.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\HighlightQuickView.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\OrderActions.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\OrderStatus.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\OrderTimeline.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\PartnerShowcase.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\PromotedHighlights.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\QuickActions.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'shareCount' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toggleExpanded' is defined but never used. Allowed unused vars must match /^_/u.","line":49,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import { scale, fly, fade } from 'svelte/transition';\r\n  import { quintOut, elasticOut } from 'svelte/easing';\r\n\r\n  interface Props {\r\n    isFavorited?: boolean;\r\n    isInCart?: boolean;\r\n    shareCount?: number;\r\n    favoriteCount?: number;\r\n    onFavorite?: () => void;\r\n    onShare?: () => void;\r\n    onAddToCart?: () => void;\r\n    onMessage?: () => void;\r\n    position?: 'right' | 'left';\r\n    showLabels?: boolean;\r\n    class?: string;\r\n  }\r\n\r\n  let { \r\n    isFavorited = false,\r\n    isInCart = false,\r\n    shareCount = 0,\r\n    favoriteCount = 0,\r\n    onFavorite,\r\n    onShare,\r\n    onAddToCart,\r\n    onMessage,\r\n    position = 'right',\r\n    showLabels = false,\r\n    class: className = '' \r\n  }: Props = $props();\r\n\r\n  let isExpanded = $state(false);\r\n  let justFavorited = $state(false);\r\n  let justShared = $state(false);\r\n\r\n  function handleFavorite() {\r\n    onFavorite?.();\r\n    justFavorited = true;\r\n    setTimeout(() => justFavorited = false, 1000);\r\n  }\r\n\r\n  function handleShare() {\r\n    onShare?.();\r\n    justShared = true;\r\n    setTimeout(() => justShared = false, 1000);\r\n  }\r\n\r\n  function toggleExpanded() {\r\n    isExpanded = !isExpanded;\r\n  }\r\n\r\n  const positionClasses = $derived(() => {\r\n    return position === 'right' \r\n      ? 'right-4 items-end' \r\n      : 'left-4 items-start';\r\n  });\r\n</script>\r\n\r\n<!-- Mobile Quick Actions (only visible on mobile) -->\r\n<div class=\"lg:hidden fixed top-1/2 -translate-y-1/2 z-30 {positionClasses} {className}\">\r\n  <div class=\"flex flex-col gap-3\">\r\n    \r\n    <!-- Main Action Button (Favorite) -->\r\n    <button\r\n      onclick={handleFavorite}\r\n      class=\"relative w-14 h-14 bg-[color:var(--surface-base)] rounded-full shadow-sm md:shadow-lg flex items-center justify-center transition-colors duration-200 hover:scale-110 active:scale-95\r\n             {isFavorited ? 'bg-[color:var(--status-error-bg)] shadow-[color:var(--status-error-border)]' : 'hover:shadow-sm md:hover:shadow-xl'}\"\r\n      in:scale={{ duration: 300, easing: elasticOut }}\r\n    >\r\n      <!-- Heart Icon -->\r\n      <svg \r\n        class=\"w-6 h-6 transition-colors duration-200 {isFavorited ? 'text-[color:var(--status-error-solid)] scale-110' : 'text-[color:var(--text-primary)]'}\" \r\n        fill={isFavorited ? 'currentColor' : 'none'}\r\n        stroke=\"currentColor\" \r\n        viewBox=\"0 0 24 24\"\r\n      >\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"/>\r\n      </svg>\r\n\r\n      <!-- Favorite Count Badge -->\r\n      {#if favoriteCount > 0}\r\n        <div \r\n          class=\"absolute -top-2 -right-2 bg-[color:var(--status-error-solid)] text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center\"\r\n          in:scale={{ duration: 200, easing: quintOut }}\r\n        >\r\n          {favoriteCount > 99 ? '99+' : favoriteCount}\r\n        </div>\r\n      {/if}\r\n\r\n      <!-- Animation on favorite -->\r\n      {#if justFavorited}\r\n        <div \r\n          class=\"absolute inset-0 bg-[color:var(--status-error-solid)] rounded-full opacity-30\"\r\n          in:scale={{ duration: 300, easing: quintOut }}\r\n          out:fade={{ duration: 200 }}\r\n        ></div>\r\n      {/if}\r\n    </button>\r\n\r\n    <!-- Share Button -->\r\n    <button\r\n      onclick={handleShare}\r\n      class=\"relative w-12 h-12 bg-[color:var(--surface-base)] rounded-full shadow-sm md:shadow-lg flex items-center justify-center transition-colors duration-200 hover:scale-110 active:scale-95 hover:shadow-sm md:hover:shadow-xl\"\r\n      in:fly={{ x: position === 'right' ? 20 : -20, duration: 300, delay: 100, easing: quintOut }}\r\n    >\r\n      <svg class=\"w-5 h-5 text-[color:var(--text-primary)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m9.032 4.026a9.001 9.001 0 01-7.432 0m9.032-4.026A9.001 9.001 0 0112 3c-4.474 0-8.268 3.12-9.032 7.326m0 0A9.001 9.001 0 0012 21c4.474 0 8.268-3.12 9.032-7.326\"/>\r\n      </svg>\r\n\r\n      <!-- Share animation -->\r\n      {#if justShared}\r\n        <div \r\n          class=\"absolute inset-0 bg-primary rounded-full opacity-30\"\r\n          in:scale={{ duration: 300, easing: quintOut }}\r\n          out:fade={{ duration: 200 }}\r\n        ></div>\r\n      {/if}\r\n    </button>\r\n\r\n    <!-- Add to Cart Button -->\r\n    {#if onAddToCart}\r\n      <button\r\n        onclick={onAddToCart}\r\n        class=\"relative w-12 h-12 bg-[color:var(--surface-base)] rounded-full shadow-sm md:shadow-lg flex items-center justify-center transition-colors duration-200 hover:scale-110 active:scale-95 hover:shadow-sm md:hover:shadow-xl\r\n               {isInCart ? 'bg-[color:var(--status-success-bg)] shadow-[color:var(--status-success-border)]' : ''}\"\r\n        in:fly={{ x: position === 'right' ? 20 : -20, duration: 300, delay: 200, easing: quintOut }}\r\n      >\r\n        {#if isInCart}\r\n          <svg class=\"w-5 h-5 text-[color:var(--status-success-solid)]\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n            <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\"/>\r\n          </svg>\r\n        {:else}\r\n          <svg class=\"w-5 h-5 text-[color:var(--text-primary)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 6M7 13l1.5-6m4.5 8a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm9 0a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z\"/>\r\n          </svg>\r\n        {/if}\r\n      </button>\r\n    {/if}\r\n\r\n    <!-- Message Seller Button -->\r\n    {#if onMessage}\r\n      <button\r\n        onclick={onMessage}\r\n        class=\"w-12 h-12 bg-[color:var(--surface-base)] rounded-full shadow-sm md:shadow-lg flex items-center justify-center transition-colors duration-200 hover:scale-110 active:scale-95 hover:shadow-sm md:hover:shadow-xl\"\r\n        in:fly={{ x: position === 'right' ? 20 : -20, duration: 300, delay: 300, easing: quintOut }}\r\n        aria-label=\"Message seller\"\r\n      >\r\n        <svg class=\"w-5 h-5 text-[color:var(--text-primary)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\"/>\r\n        </svg>\r\n      </button>\r\n    {/if}\r\n\r\n    <!-- Labels (if enabled) -->\r\n    {#if showLabels}\r\n      <div \r\n        class=\"space-y-2 text-xs font-medium text-[color:var(--text-muted)] {position === 'right' ? 'text-right mr-16' : 'text-left ml-16'}\"\r\n        in:fade={{ duration: 200, delay: 400 }}\r\n      >\r\n        <div>Favorite</div>\r\n        <div>Share</div>\r\n        {#if onAddToCart}<div>Add to cart</div>{/if}\r\n        {#if onMessage}<div>Message</div>{/if}\r\n      </div>\r\n    {/if}\r\n  </div>\r\n</div>\r\n\r\n<!-- Desktop Quick Actions Bar (subtle, top-right corner) -->\r\n<div class=\"hidden lg:block fixed top-20 right-4 z-30\">\r\n  <div class=\"flex items-center gap-2 bg-[color:var(--surface-base)]/90 md:backdrop-blur-xs rounded-full px-4 py-2 shadow-sm md:shadow-lg\">\r\n    <!-- Favorite -->\r\n    <button\r\n      onclick={handleFavorite}\r\n      class=\"relative p-2 rounded-full transition-colors duration-200 hover:bg-[color:var(--surface-muted)] active:scale-95\r\n             {isFavorited ? 'bg-[color:var(--status-error-bg)] text-[color:var(--status-error-solid)]' : 'text-[color:var(--text-secondary)]'}\"\r\n      title=\"Add to favorites\"\r\n    >\r\n      <svg \r\n        class=\"w-5 h-5\" \r\n        fill={isFavorited ? 'currentColor' : 'none'}\r\n        stroke=\"currentColor\" \r\n        viewBox=\"0 0 24 24\"\r\n      >\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"/>\r\n      </svg>\r\n      \r\n      {#if favoriteCount > 0}\r\n        <span class=\"absolute -top-1 -right-1 bg-[color:var(--status-error-solid)] text-white text-xs rounded-full w-5 h-5 flex items-center justify-center\">\r\n          {favoriteCount}\r\n        </span>\r\n      {/if}\r\n    </button>\r\n\r\n    <!-- Share -->\r\n    <button\r\n      onclick={handleShare}\r\n      class=\"p-2 rounded-full text-[color:var(--text-secondary)] hover:bg-[color:var(--surface-muted)] transition-colors duration-200 active:scale-95\"\r\n      title=\"Share product\"\r\n      aria-label=\"Share product\"\r\n    >\r\n      <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m9.032 4.026a9.001 9.001 0 01-7.432 0m9.032-4.026A9.001 9.001 0 0112 3c-4.474 0-8.268 3.12-9.032 7.326m0 0A9.001 9.001 0 0012 21c4.474 0 8.268-3.12 9.032-7.326\"/>\r\n      </svg>\r\n    </button>\r\n\r\n    <!-- Divider -->\r\n    <div class=\"w-px h-6 bg-[color:var(--border-default)]\"></div>\r\n\r\n    <!-- Add to Cart -->\r\n    {#if onAddToCart}\r\n      <button\r\n        onclick={onAddToCart}\r\n        class=\"p-2 rounded-full transition-colors duration-200 active:scale-95\r\n               {isInCart ? 'bg-[color:var(--status-success-bg)] text-[color:var(--status-success-solid)]' : 'text-[color:var(--text-secondary)] hover:bg-[color:var(--surface-muted)]'}\"\r\n        title={isInCart ? 'In cart' : 'Add to cart'}\r\n      >\r\n        {#if isInCart}\r\n          <svg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n            <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\"/>\r\n          </svg>\r\n        {:else}\r\n          <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 6M7 13l1.5-6m4.5 8a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm9 0a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z\"/>\r\n          </svg>\r\n        {/if}\r\n      </button>\r\n    {/if}\r\n\r\n    <!-- Message -->\r\n    {#if onMessage}\r\n      <button\r\n        onclick={onMessage}\r\n        class=\"p-2 rounded-full text-[color:var(--text-secondary)] hover:bg-[color:var(--surface-muted)] transition-colors duration-200 active:scale-95\"\r\n        title=\"Message seller\"\r\n        aria-label=\"Message seller\"\r\n      >\r\n        <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\"/>\r\n        </svg>\r\n      </button>\r\n    {/if}\r\n  </div>\r\n</div>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\RatingSummary.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\ReviewDisplay.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\ReviewPrompt.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\SellerProfile.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\SellerQuickView.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\ShippingEstimator.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\business\\SocialLinksEditor.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\cards\\Card.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\cards\\PricingCard.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\cards\\ProductCard.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserBadge' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":50,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalCount' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":51,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3216,3219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3216,3219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3464,3467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3464,3467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import type { Product } from '../../types/product';\r\n  import ProductImage from '../product/ProductImage.svelte';\r\n  import ConditionBadge from '../badges/ConditionBadge.svelte';\r\n  import ProductPrice from '../product/ProductPrice.svelte';\r\n  import FavoriteButton from '../ui/FavoriteButton.svelte';\r\n  import UserBadge from '../badges/UserBadge.svelte';\r\n  import ProBadge from '../badges/ProBadge.svelte';\r\n  import BrandBadge from '../badges/BrandBadge.svelte';\r\n  import { Tooltip } from '../../primitives/tooltip';\r\n  \r\n  interface Props {\r\n    product: Product;\r\n    onFavorite?: (productId: string) => void | Promise<void>;\r\n    onclick?: (product: Product) => void;\r\n    favorited?: boolean;\r\n    highlighted?: boolean;\r\n    class?: string;\r\n    priority?: boolean;\r\n    index?: number;\r\n    totalCount?: number;\r\n    favoritesState?: { favoriteCounts: Record<string, number> };\r\n    showBoostBadge?: boolean;\r\n    showSellerBadges?: boolean;\r\n    translations?: {\r\n      size?: string;\r\n      currency?: string;\r\n      addToFavorites?: string;\r\n      removeFromFavorites?: string;\r\n      brandNewWithTags?: string;\r\n      newWithoutTags?: string;\r\n      likeNew?: string;\r\n      good?: string;\r\n      worn?: string;\r\n      fair?: string;\r\n      new?: string;\r\n      formatPrice?: (price: number) => string;\r\n      categoryTranslation?: (category: string) => string;\r\n    };\r\n  }\r\n\r\n  let { \r\n    product, \r\n    onFavorite, \r\n    onclick,\r\n    favorited = false,\r\n    highlighted = false,\r\n    class: className = '',\r\n    priority = false,\r\n    index = 0,\r\n    totalCount = 1,\r\n    favoritesState,\r\n    showBoostBadge = true,\r\n    showSellerBadges = true,\r\n    translations = {\r\n      size: 'Size',\r\n      currency: '$',\r\n      addToFavorites: 'Add to favorites',\r\n      removeFromFavorites: 'Remove from favorites',\r\n      brandNewWithTags: 'BNWT',\r\n      newWithoutTags: 'New',\r\n      likeNew: 'Like New',\r\n      good: 'Good',\r\n      worn: 'Worn',\r\n      fair: 'Fair',\r\n      new: 'New'\r\n    }\r\n  }: Props = $props();\r\n\r\n  function handleClick() {\r\n    onclick?.(product);\r\n  }\r\n\r\n  // Tooltip content helpers\r\n  const getConditionTooltip = (condition: string) => {\r\n    const tooltipMap: Record<string, string> = {\r\n      'brand_new_with_tags': 'Brand New With Tags - Never worn, still has original tags',\r\n      'new_without_tags': 'New Without Tags - Never worn, tags removed',\r\n      'like_new': 'Like New - Worn once or twice, excellent condition',\r\n      'good': 'Good - Some signs of wear, good overall condition',\r\n      'worn': 'Worn - Noticeable wear, still wearable',\r\n      'fair': 'Fair - Significant wear, may have minor defects'\r\n    };\r\n    return tooltipMap[condition] || `Condition: ${condition}`;\r\n  };\r\n\r\n  // Check if text needs truncation tooltip (simplified check)\r\n  const shouldShowTitleTooltip = $derived(!!(product.title && product.title.length > 50));\r\n  const shouldShowCategoryTooltip = $derived(\r\n    !!(product.specific_category_name && product.brand && product.size && \r\n    `${product.specific_category_name} • ${product.brand} • ${translations.size} ${product.size}`.length > 60)\r\n  );\r\n</script>\r\n\r\n{#snippet conditionBadgeWithTooltip(condition: any)}\r\n  <Tooltip\r\n    content={getConditionTooltip(condition)}\r\n    positioning={{ side: 'bottom', align: 'start' }}\r\n    openDelay={600}\r\n    closeDelay={200}\r\n  >\r\n    {#snippet trigger()}\r\n      <ConditionBadge\r\n        condition={condition as any}\r\n        translations={{\r\n          brandNewWithTags: translations.brandNewWithTags,\r\n          newWithoutTags: translations.newWithoutTags || translations.new,\r\n          likeNew: translations.likeNew,\r\n          good: translations.good,\r\n          worn: translations.worn,\r\n          fair: translations.fair\r\n        }}\r\n      />\r\n    {/snippet}\r\n  </Tooltip>\r\n{/snippet}\r\n\r\n{#snippet titleWithTooltip(title: string, showTooltip: boolean)}\r\n  {#if showTooltip}\r\n    <Tooltip \r\n      content={title}\r\n      positioning={{ side: 'top', align: 'start' }}\r\n      openDelay={800}\r\n      closeDelay={200}\r\n      triggerClass=\"block\"\r\n    >\r\n      {#snippet trigger()}\r\n        <h3 class=\"text-sm font-medium text-gray-900 line-clamp-1 leading-none mb-0.5 cursor-help\">\r\n          {title}\r\n        </h3>\r\n      {/snippet}\r\n    </Tooltip>\r\n  {:else}\r\n    <h3 class=\"text-sm font-medium text-gray-900 line-clamp-1 leading-none mb-0.5\">\r\n      {title}\r\n    </h3>\r\n  {/if}\r\n{/snippet}\r\n\r\n{#snippet productDetailsText(fullText: string, showTooltip: boolean)}\r\n  {#if showTooltip}\r\n    <Tooltip \r\n      content={fullText}\r\n      positioning={{ side: 'top', align: 'start' }}\r\n      openDelay={800}\r\n      closeDelay={200}\r\n      triggerClass=\"block\"\r\n    >\r\n      {#snippet trigger()}\r\n        <p class=\"text-xs text-gray-700 line-clamp-1 leading-none mb-1 cursor-help\">\r\n          {#if product.specific_category_name}\r\n            <span class=\"font-medium text-gray-700\">{translations.categoryTranslation ? translations.categoryTranslation(product.specific_category_name) : product.specific_category_name}</span>\r\n          {/if}\r\n          {#if product.specific_category_name && product.brand} • {/if}\r\n          {#if product.brand}\r\n            <span class=\"text-gray-700\">{product.brand}</span>\r\n          {/if}\r\n          {#if (product.specific_category_name || product.brand) && product.size} • {/if}\r\n          {#if product.size}\r\n            <span class=\"text-gray-700\">{translations.size} {product.size}</span>\r\n          {/if}\r\n        </p>\r\n      {/snippet}\r\n    </Tooltip>\r\n  {:else}\r\n    <p class=\"text-xs text-gray-700 line-clamp-1 leading-none mb-1\">\r\n      {#if product.specific_category_name}\r\n        <span class=\"font-medium text-gray-700\">{translations.categoryTranslation ? translations.categoryTranslation(product.specific_category_name) : product.specific_category_name}</span>\r\n      {/if}\r\n      {#if product.specific_category_name && product.brand} • {/if}\r\n      {#if product.brand}\r\n        <span class=\"text-gray-700\">{product.brand}</span>\r\n      {/if}\r\n      {#if (product.specific_category_name || product.brand) && product.size} • {/if}\r\n      {#if product.size}\r\n        <span class=\"text-gray-700\">{translations.size} {product.size}</span>\r\n      {/if}\r\n    </p>\r\n  {/if}\r\n{/snippet}\r\n\r\n<button\r\n  type=\"button\"\r\n  class=\"product-card cursor-pointer transition-shadow duration-[var(--duration-base)] hover:shadow-[var(--shadow-md)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)] focus-visible:ring-offset-2 rounded-[var(--card-radius)] {highlighted ? 'highlighted' : ''} {className} text-left block w-full p-0 border-0 bg-transparent\"\r\n  onclick={handleClick}\r\n  aria-label=\"{product.title} - Price: {translations.formatPrice ? translations.formatPrice(product.price) : `${translations.currency}${product.price}`}\"\r\n>\r\n  <!-- Image Container with overlays -->\r\n  <div class=\"relative\">\r\n    <ProductImage \r\n      product_images={product.product_images}\r\n      images={product.images}\r\n      alt=\"{product.title} product image\"\r\n      {priority}\r\n    />\r\n    \r\n    \r\n    <!-- Ultrathink: Clean badge system - icons only, perfect positioning -->\r\n\r\n    <!-- Boost badge (top right) - clean design, no gradients -->\r\n    {#if product.is_boosted && showBoostBadge}\r\n      <div class=\"absolute top-1 left-1 z-20\">\r\n        <div class=\"bg-purple-600 text-white px-2 py-0.5 rounded text-xs font-semibold\">\r\n          BOOST\r\n        </div>\r\n      </div>\r\n    {/if}\r\n\r\n    <!-- Pro/Brand icon badges (top right, positioned precisely) -->\r\n    {#if showSellerBadges && (product.seller_badges?.is_pro || product.seller_badges?.is_brand)}\r\n      <div class=\"absolute top-10 right-2 z-20\">\r\n        {#if product.seller_badges.is_brand}\r\n          <BrandBadge\r\n            size=\"sm\"\r\n            position=\"static\"\r\n            variant=\"black\"\r\n            tooltipText=\"Brand Account\"\r\n          />\r\n        {:else if product.seller_badges.is_pro}\r\n          <ProBadge\r\n            size=\"sm\"\r\n            position=\"static\"\r\n            tooltipText=\"Pro Account\"\r\n          />\r\n        {/if}\r\n      </div>\r\n    {/if}\r\n\r\n    <!-- Wishlist (favorite) button overlay for tighter layout -->\r\n    <FavoriteButton\r\n      {product}\r\n      {favorited}\r\n      {favoritesState}\r\n      onFavorite={() => onFavorite?.(product.id)}\r\n      addToFavoritesText={translations.addToFavorites}\r\n      removeFromFavoritesText={translations.removeFromFavorites}\r\n      absolute={true}\r\n      showCount={false}\r\n      size=\"sm\"\r\n    />\r\n\r\n  </div>\r\n  \r\n  <!-- Content -->\r\n  <div class=\"px-1 pt-1 pb-1 relative\">\r\n\r\n    <!-- Top row: Condition badge (left) and Wishlist button (right) -->\r\n    <div class=\"flex items-start justify-start mb-0\">\r\n      {#if product.condition}\r\n        {@render conditionBadgeWithTooltip(product.condition)}\r\n      {/if}\r\n    </div>\r\n\r\n    <!-- Main Category (clean layout) -->\r\n    <div class=\"mb-0.5\">\r\n      {#if product.main_category_name || product.category_name}\r\n        <p class=\"text-xs font-medium text-gray-600 uppercase tracking-wider leading-none truncate\">\r\n          {translations.categoryTranslation ? translations.categoryTranslation(product.main_category_name || product.category_name || '') : (product.main_category_name || product.category_name)}\r\n        </p>\r\n      {/if}\r\n    </div>\r\n\r\n    <!-- Title with tooltip for truncated text -->\r\n    <div>\r\n      {@render titleWithTooltip(product.title, shouldShowTitleTooltip)}\r\n    </div>\r\n    \r\n    <!-- Specific Category • Brand • Size with tooltip for truncated text -->\r\n    {#if product.specific_category_name || product.brand || product.size}\r\n      {@const fullDetailsText = [\r\n        product.specific_category_name ? (translations.categoryTranslation ? translations.categoryTranslation(product.specific_category_name) : product.specific_category_name) : null,\r\n        product.brand,\r\n        product.size ? `${translations.size} ${product.size}` : null\r\n      ].filter(Boolean).join(' • ')}\r\n\r\n      <div>\r\n        {@render productDetailsText(fullDetailsText, shouldShowCategoryTooltip)}\r\n      </div>\r\n    {/if}\r\n\r\n    <!-- Price -->\r\n    <div class=\"-mt-0.5\">\r\n      <ProductPrice\r\n        price={product.price}\r\n        currency={translations.currency}\r\n        formatPrice={translations.formatPrice}\r\n      />\r\n    </div>\r\n  </div>\r\n</button>\r\n\r\n<style>\r\n  .product-card {\r\n    position: relative;\r\n  }\r\n  \r\n  .product-card.highlighted {\r\n    border-color: var(--status-warning-solid);\r\n    border-width: 2px;\r\n  }\r\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\cards\\ProductCardWithTracking.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[562,565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[562,565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"svelte/valid-compile","severity":1,"message":"Using a rest element or a non-destructured declaration with `$props()` means that Svelte can't infer what properties to expose when creating a custom element. Consider destructuring all the props or explicitly specifying the `customElement.props` option.\nhttps://svelte.dev/e/custom_element_props_identifier(custom_element_props_identifier)","line":24,"column":5,"nodeType":null,"endLine":24,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<!--\n  ProductCard with automatic view tracking\n  Wraps the existing ProductCard with intersection observer\n-->\n<script lang=\"ts\">\n  import { trackView, type ViewTrackingOptions, type ViewTrackingData } from '../../utils/viewTracking.js';\n  import ProductCard from './ProductCard.svelte';\n  import type { Product } from '../../types/product';\n\n  interface Props {\n    product: Product;\n    userId?: string;\n    onView?: (data: ViewTrackingData) => void;\n    viewTrackingOptions?: ViewTrackingOptions;\n    // Pass through all ProductCard props\n    [key: string]: any;\n  }\n\n  let {\n    product,\n    userId,\n    onView,\n    viewTrackingOptions,\n    ...productCardProps\n  }: Props = $props();\n\n  // Default view handler - logs to console in development\n  function handleView(data: ViewTrackingData) {\n    // Call user-provided handler\n    onView?.(data);\n\n    // Default behavior - log in development\n    if (typeof window !== 'undefined' && window.location.hostname === 'localhost') {\n      console.log('[ViewTracking] Product viewed:', {\n        productId: data.productId,\n        userId: data.userId,\n        timestamp: data.metadata?.timestamp\n      });\n    }\n  }\n</script>\n\n<div\n  use:trackView={{\n    productId: product.id,\n    userId,\n    onView: handleView,\n    options: viewTrackingOptions\n  }}\n  class=\"product-card-wrapper\"\n>\n  <ProductCard {product} {...productCardProps} />\n</div>\n\n<style>\n  .product-card-wrapper {\n    /* Ensure the wrapper takes full dimensions for proper intersection detection */\n    display: contents;\n  }\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\cards\\SellerCard.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[70,73],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[70,73],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":35,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":7}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import * as i18n from '@repo/i18n';\r\n  const m: any = i18n;\r\n  // @ts-expect-error: Svelte component types are resolved by svelte2tsx during build\r\n  import Avatar from '../ui/Avatar.svelte';\r\n\r\n  interface SellerStats {\r\n    rating: number;\r\n    totalSales: number;\r\n    responseTime: number;\r\n    joinedDate: string;\r\n    verificationLevel?: 'basic' | 'verified' | 'superstar';\r\n    lastActive?: string;\r\n  }\r\n\r\n  interface Props {\r\n    id: string;\r\n    name: string;\r\n    avatar?: string;\r\n    stats: SellerStats;\r\n    onMessage?: () => void;\r\n    onViewProfile?: () => void;\r\n    class?: string;\r\n    translations?: {\r\n      soldBy?: string;\r\n      message?: string;\r\n      viewFullProfile?: string;\r\n      sales?: string;\r\n      memberFor?: string;\r\n      newMember?: string;\r\n    };\r\n  }\r\n\r\n  let { \r\n    id,\r\n    name,\r\n    avatar,\r\n    stats,\r\n    onMessage,\r\n    onViewProfile,\r\n    class: className = '',\r\n    translations = {}\r\n  }: Props = $props();\r\n\r\n  function formatJoinDate(dateString: string) {\r\n    try {\r\n      const date = new Date(dateString);\r\n      const now = new Date();\r\n      const years = now.getFullYear() - date.getFullYear();\r\n      const months = (now.getFullYear() - date.getFullYear()) * 12 + now.getMonth() - date.getMonth();\r\n      \r\n      if (years > 0) return `${translations.memberFor || m.seller_memberFor()} ${years} year${years > 1 ? 's' : ''}`;\r\n      if (months > 0) return `${translations.memberFor || m.seller_memberFor()} ${months} month${months > 1 ? 's' : ''}`;\r\n      return translations.newMember || m.seller_newMember();\r\n    } catch {\r\n      return translations.newMember || m.seller_newMember();\r\n    }\r\n  }\r\n</script>\r\n\r\n<div \r\n  class=\"bg-white border border-gray-200 rounded-[var(--card-radius)] p-3 {className}\"\r\n  role=\"region\"\r\n  aria-label=\"Seller information\"\r\n>\r\n  <!-- Header -->\r\n  <div class=\"flex items-center justify-between mb-2\">\r\n    <h3 class=\"text-xs font-semibold text-gray-700 uppercase tracking-wide\">{translations.soldBy || m.seller_soldBy()}</h3>\r\n  </div>\r\n\r\n  <!-- Seller Info -->\r\n  <div class=\"flex items-center gap-2 mb-3\">\r\n    <Avatar \r\n      name={name} \r\n      src={avatar} \r\n      size=\"md\"\r\n      class=\"shrink-0\"\r\n    />\r\n    \r\n    <div class=\"flex-1 min-w-0\">\r\n      <h4 class=\"font-medium text-gray-900 truncate mb-0.5\">{name}</h4>\r\n      <div class=\"flex items-center gap-3 text-xs sm:text-sm text-gray-600\">\r\n        <!-- Rating -->\r\n        <div class=\"flex items-center gap-1\">\r\n          <svg class=\"w-4 h-4 text-yellow-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n            <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/>\r\n          </svg>\r\n          <span class=\"font-medium text-gray-900\">{stats.rating?.toFixed(1) || '0.0'}</span>\r\n          <span>({stats.totalSales} {translations.sales || m.seller_sales()})</span>\r\n        </div>\r\n      </div>\r\n      <div class=\"text-xs sm:text-sm text-gray-500 mt-1\">\r\n        {formatJoinDate(stats.joinedDate)}\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Action Buttons -->\r\n  <div class=\"flex gap-2\">\r\n    <button\r\n      onclick={onMessage}\r\n      class=\"btn-action btn-secondary flex-1\"\r\n      aria-label=\"Send message to {name}\"\r\n      type=\"button\"\r\n    >\r\n      <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\"/>\r\n      </svg>\r\n      <span>{translations.message || m.message()}</span>\r\n    </button>\r\n    \r\n    <button\r\n      onclick={onViewProfile}\r\n      class=\"btn-action btn-ghost\"\r\n      aria-label=\"View full profile of {name}\"\r\n      type=\"button\"\r\n    >\r\n      <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M9 5l7 7-7 7\"/>\r\n      </svg>\r\n    </button>\r\n  </div>\r\n</div>\r\n\r\n<style>\r\n  .btn-action {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    gap: 0.5rem;\r\n    min-height: 40px;\r\n    padding: 0.5rem 1rem;\r\n    border-radius: 0.5rem;\r\n    font-weight: 500;\r\n    font-size: 0.875rem;\r\n    transition: all 0.2s;\r\n    border: none;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .btn-action:focus {\r\n    outline: none;\r\n    box-shadow: 0 0 0 2px rgb(59 130 246);\r\n  }\r\n\r\n  .btn-secondary {\r\n    background: white;\r\n    color: rgb(55 65 81);\r\n    border: 1px solid rgb(209 213 219);\r\n  }\r\n\r\n  .btn-secondary:hover {\r\n    background: rgb(249 250 251);\r\n    border-color: rgb(156 163 175);\r\n  }\r\n\r\n  .btn-ghost {\r\n    background: transparent;\r\n    color: rgb(107 114 128);\r\n    border: 1px solid transparent;\r\n    padding: 0.5rem 0.75rem;\r\n  }\r\n\r\n  .btn-ghost:hover {\r\n    background: rgb(243 244 246);\r\n    color: rgb(55 65 81);\r\n  }\r\n\r\n  .btn-action:active {\r\n    transform: scale(0.95);\r\n  }\r\n\r\n  @media (max-width: 640px) {\r\n    .btn-action {\r\n      min-height: 36px;\r\n      font-size: 0.75rem;\r\n      padding: 0.5rem 0.75rem;\r\n    }\r\n  }\r\n</style>\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\cards\\SellerProfileCard.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\description-list\\DescriptionDetails.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\description-list\\DescriptionList.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\description-list\\DescriptionTerm.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\AvatarSelector.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\BrandSelector.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\CategorySelector.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\CollapsibleCategorySelector.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedText' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":40,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  interface Category {\n    id: string;\n    name: string;\n    parent_id: string | null;\n  }\n\n  interface Props {\n    categories: Category[];\n    gender?: string;\n    type?: string;\n    specific?: string;\n    onGenderSelect?: (id: string) => void;\n    onTypeSelect?: (id: string) => void;\n    onSpecificSelect?: (id: string) => void;\n    // Translation props\n    whoIsItForLabel?: string;\n    categoryLabel?: string;\n    translateCategory?: (categoryName: string) => string;\n    includesText?: string;\n    selectedText?: string;\n    accessoriesListText?: string;\n    beMoreSpecificLabel?: string;\n    optionalText?: string;\n    typeCategoryPlaceholder?: string;\n  }\n\n  let {\n    categories = [],\n    gender = $bindable(),\n    type = $bindable(),\n    specific = $bindable(),\n    onGenderSelect,\n    onTypeSelect,\n    onSpecificSelect,\n    whoIsItForLabel = \"Who's it for?\",\n    categoryLabel = \"Category\",\n    translateCategory = (name: string) => name,\n    includesText = \"Includes:\",\n    selectedText = \"Selected:\",\n    accessoriesListText = \"Hats, Caps, Belts, Scarves, Sunglasses, Bags, Wallets\",\n    beMoreSpecificLabel = \"Be more specific\",\n    optionalText = \"(optional)\",\n    typeCategoryPlaceholder = \"Type category...\"\n  }: Props = $props();\n\n  // Component state\n  let isExpanded = $state(false);\n  let showTypeLevel = $state(false);\n  let showSpecificLevel = $state(false);\n  let customCategoryInput = $state('');\n\n  // Emojis for categories\n  const categoryEmoji: Record<string, string> = {\n    // Gender\n    'Men': '👔',\n    'Women': '👗', \n    'Kids': '👶',\n    'Unisex': '🔄',\n    \n    // Product Types (Level 2)\n    'Clothing': '👕',\n    'Shoes': '👟',\n    'Accessories': '🎒',\n    'Bags': '👜',\n  };\n\n  // Get categories by level\n  const genderCategories = $derived(categories.filter(c => !c.parent_id));\n  const typeCategories = $derived(\n    gender ? categories.filter(c => c.parent_id === gender) : []\n  );\n  const specificCategories = $derived(\n    type ? categories.filter(c => c.parent_id === type) : []\n  );\n\n  // Get selected names for display\n  const selectedGenderName = $derived(\n    gender ? genderCategories.find(c => c.id === gender)?.name : null\n  );\n  const selectedTypeName = $derived(\n    type ? typeCategories.find(c => c.id === type)?.name : null\n  );\n  const selectedSpecificName = $derived(\n    specific ? specificCategories.find(c => c.id === specific)?.name || specific : null\n  );\n\n  function selectGender(id: string) {\n    gender = id;\n    type = '';\n    specific = '';\n    showTypeLevel = true;\n    showSpecificLevel = false;\n    onGenderSelect?.(id);\n  }\n\n  function selectType(id: string) {\n    type = id;\n    specific = '';\n    showSpecificLevel = true;\n    onTypeSelect?.(id);\n  }\n\n  function selectSpecific(id: string) {\n    // If custom input provided, use that instead of id\n    if (customCategoryInput && id === customCategoryInput) {\n      specific = customCategoryInput;\n      onSpecificSelect?.(customCategoryInput);\n    } else {\n      specific = id;\n      onSpecificSelect?.(id);\n    }\n    // Clear custom input\n    customCategoryInput = '';\n    // Auto-collapse after final selection\n    setTimeout(() => {\n      isExpanded = false;\n      showTypeLevel = false;\n      showSpecificLevel = false;\n    }, 300);\n  }\n\n  function toggleExpanded() {\n    isExpanded = !isExpanded;\n    if (!isExpanded) {\n      showTypeLevel = false;\n      showSpecificLevel = false;\n    } else if (gender) {\n      showTypeLevel = true;\n      if (type) {\n        showSpecificLevel = true;\n      }\n    }\n  }\n\n  // Build display text\n  const displayText = $derived(() => {\n    if (!gender) return 'Select Category';\n    \n    let parts = [translateCategory(selectedGenderName || '')];\n    if (type) parts.push(translateCategory(selectedTypeName || ''));\n    if (specific) parts.push(translateCategory(selectedSpecificName || ''));\n    \n    return parts.join(' → ');\n  });\n</script>\n\n<div class=\"space-y-2\">\n  <!-- Collapsible Trigger Button -->\n  <button\n    type=\"button\"\n    onclick={toggleExpanded}\n    class=\"w-full flex items-center justify-between px-4 py-3 bg-white border rounded-lg transition-colors {\n      isExpanded \n        ? 'border-gray-900 ring-2 ring-gray-900 ring-offset-2' \n        : gender \n          ? 'border-gray-900 ring-1 ring-gray-900' \n          : 'border-gray-300 hover:border-gray-400'\n    }\"\n  >\n    <div class=\"flex items-center gap-2\">\n      <span class=\"text-lg\">\n        {#if selectedGenderName}\n          {categoryEmoji[selectedGenderName] || '📦'}\n        {:else}\n          📦\n        {/if}\n      </span>\n      <div class=\"text-left\">\n        <div class=\"text-sm font-medium text-gray-900\">\n          {whoIsItForLabel} & {categoryLabel} <span class=\"text-red-500\">*</span>\n        </div>\n        <div class=\"text-xs {gender ? 'text-gray-900 font-medium' : 'text-gray-500'}\">\n          {displayText()}\n        </div>\n      </div>\n    </div>\n    <svg \n      class=\"w-5 h-5 text-gray-400 transition-transform {isExpanded ? 'rotate-180' : ''}\" \n      fill=\"none\" \n      stroke=\"currentColor\" \n      viewBox=\"0 0 24 24\"\n    >\n      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\" />\n    </svg>\n  </button>\n\n  <!-- Expandable Content -->\n  {#if isExpanded}\n    <div class=\"bg-white border border-gray-200 rounded-lg p-3 space-y-3 animate-in fade-in slide-in-from-top-2 duration-200\">\n      \n      <!-- Step 1: Gender Selection -->\n      <div>\n        <div class=\"block text-xs font-medium text-gray-500 mb-1.5\" role=\"group\" aria-label=\"{whoIsItForLabel}\">\n          {whoIsItForLabel}\n        </div>\n        <div class=\"grid grid-cols-4 gap-1.5\">\n          {#each genderCategories as category}\n            <button\n              type=\"button\"\n              onclick={() => selectGender(category.id)}\n              class=\"px-2 py-2 text-xs font-medium rounded-md border transition-colors {\n                gender === category.id \n                  ? 'border-gray-900 bg-gray-50 text-gray-900 ring-2 ring-gray-900' \n                  : 'border-gray-200 bg-white text-gray-900 hover:bg-gray-50'\n              }\"\n            >\n              <span class=\"block text-base mb-0.5\">{categoryEmoji[category.name] || '📦'}</span>\n              <span class=\"block text-xs\">{translateCategory(category.name)}</span>\n            </button>\n          {/each}\n        </div>\n      </div>\n\n      <!-- Step 2: Type Selection (slides in) -->\n      {#if showTypeLevel && typeCategories.length > 0}\n        <div class=\"animate-in fade-in slide-in-from-left-2 duration-200\">\n          <div class=\"block text-xs font-medium text-gray-500 mb-1.5\" role=\"group\" aria-label=\"{categoryLabel}\">\n            {categoryLabel}\n          </div>\n          <div class=\"grid grid-cols-2 gap-1.5\">\n            {#each typeCategories as category}\n              <button\n                type=\"button\"\n                onclick={() => selectType(category.id)}\n                class=\"flex items-center gap-2 px-2.5 py-2 text-xs font-medium rounded-md border transition-colors text-left {\n                  type === category.id \n                    ? 'border-gray-900 bg-gray-50 text-gray-900 ring-2 ring-gray-900' \n                    : 'border-gray-200 bg-white text-gray-900 hover:bg-gray-50'\n                }\"\n              >\n                {#if categoryEmoji[category.name]}\n                  <span class=\"text-sm\">{categoryEmoji[category.name]}</span>\n                {/if}\n                <span class=\"flex-1\">{translateCategory(category.name)}</span>\n                {#if type === category.id}\n                  <svg class=\"w-3 h-3 text-gray-900\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                    <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" />\n                  </svg>\n                {/if}\n              </button>\n            {/each}\n          </div>\n\n          {#if type && typeCategories.find(c => c.id === type)?.name === 'Accessories'}\n            <p class=\"mt-1.5 text-xs text-gray-500 bg-yellow-50 border border-yellow-200 rounded-md p-1.5\">\n              <strong>{includesText}</strong> {accessoriesListText}\n            </p>\n          {/if}\n        </div>\n      {/if}\n\n      <!-- Step 3: Specific Selection (optional, slides in) -->\n      {#if showSpecificLevel && specificCategories.length > 0}\n        <div class=\"animate-in fade-in slide-in-from-left-2 duration-200\">\n          <div class=\"block text-xs font-medium text-gray-500 mb-1.5\" role=\"group\" aria-label=\"{beMoreSpecificLabel}\">\n            {beMoreSpecificLabel} <span class=\"text-gray-400\">{optionalText}</span>\n          </div>\n          \n          <!-- Specific options in compact grid FIRST -->\n          <div class=\"max-h-32 overflow-y-auto border border-gray-200 rounded-md p-1.5 mb-2\">\n            <div class=\"grid grid-cols-2 gap-1\">\n              {#each specificCategories as category}\n                <button\n                  type=\"button\"\n                  onclick={() => selectSpecific(category.id)}\n                  class=\"px-3 py-2.5 text-sm font-medium rounded border transition-colors text-left {\n                    specific === category.id \n                      ? 'border-gray-900 bg-gray-50 text-gray-900 ring-1 ring-gray-900' \n                      : 'border-gray-200 bg-white text-gray-900 hover:bg-gray-50'\n                  }\"\n                >\n                  {translateCategory(category.name)}\n                </button>\n              {/each}\n            </div>\n          </div>\n\n          <!-- Quick input option BELOW the categories -->\n          <div>\n            <input\n              type=\"text\"\n              bind:value={customCategoryInput}\n              placeholder=\"{typeCategoryPlaceholder}\"\n              onkeydown={(e: KeyboardEvent) => {\n                if (e.key === 'Enter') {\n                  e.preventDefault();\n                  selectSpecific(customCategoryInput || '');\n                }\n              }}\n              class=\"w-full px-2.5 py-2 text-xs rounded-md border border-gray-200 bg-white text-gray-900 placeholder-gray-400 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 focus:outline-none\"\n            />\n            <p class=\"mt-0.5 text-xs text-gray-500\">Press Enter to confirm custom category</p>\n          </div>\n        </div>\n      {/if}\n    </div>\n  {/if}\n</div>\n\n<style>\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n      transform: translateY(-4px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n  \n  @keyframes slideInFromTop {\n    from {\n      opacity: 0;\n      transform: translateY(-8px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n  \n  @keyframes slideInFromLeft {\n    from {\n      opacity: 0;\n      transform: translateX(-8px);\n    }\n    to {\n      opacity: 1;\n      transform: translateX(0);\n    }\n  }\n  \n  .animate-in {\n    animation-fill-mode: both;\n  }\n  \n  .fade-in {\n    animation: fadeIn 0.2s ease-out;\n  }\n  \n  .slide-in-from-top-2 {\n    animation: slideInFromTop 0.2s ease-out;\n  }\n  \n  .slide-in-from-left-2 {\n    animation: slideInFromLeft 0.2s ease-out;\n  }\n\n  /* Respect reduced motion preferences */\n  @media (prefers-reduced-motion: reduce) {\n    .fade-in,\n    .slide-in-from-top-2,\n    .slide-in-from-left-2 {\n      animation: none;\n    }\n  }\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\CollectionSelector.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  import { Button } from '@repo/ui';\n\n  interface Collection {\n    id: string;\n    name: string;\n    slug: string;\n    description: string;\n    collection_type: 'drip' | 'designer';\n    is_featured: boolean;\n  }\n\n  interface Props {\n    collections: Collection[];\n    selectedCollectionId?: string;\n    onCollectionChange: (collectionId: string | null) => void;\n    error?: string;\n    class?: string;\n  }\n\n  let {\n    collections = [],\n    selectedCollectionId = undefined,\n    onCollectionChange,\n    error = undefined,\n    class: className = ''\n  }: Props = $props();\n\n  // Group collections by type\n  const dripCollections = $derived(collections.filter(c => c.collection_type === 'drip'));\n  const designerCollections = $derived(collections.filter(c => c.collection_type === 'designer'));\n\n  // Collection emojis for visual appeal\n  const collectionEmojis: Record<string, string> = {\n    'drip': '💧',\n    'designer': '👑',\n    'vintage': '✨',\n    'sport': '⚡',\n    'outdoor': '🏔️',\n    'streetwear': '🔥',\n    'luxury': '💎',\n    'corteiz': '🎯',\n    'nike': '✓',\n    'fear-of-god-essentials': '🤍',\n    'off-white': '⚡',\n    'stone-island': '🧭',\n    'bape': '🐒',\n    'chanel': '👑',\n    'gucci': '🐝',\n    'dior': '🌹',\n    'ysl': '💋',\n    'versace': '⚡',\n    'celine': '🤎'\n  };\n\n  function getCollectionEmoji(slug: string): string {\n    return collectionEmojis[slug] || '📦';\n  }\n</script>\n\n<div class=\"space-y-4 {className}\">\n  <!-- Section Header -->\n  <div>\n    <h3 class=\"text-lg font-semibold text-gray-900 mb-1\">Collection</h3>\n    <p class=\"text-sm text-gray-600\">Choose a collection that best describes your item's style</p>\n  </div>\n\n  <!-- DRIP Collections -->\n  {#if dripCollections.length > 0}\n    <div class=\"space-y-3\">\n      <div class=\"flex items-center gap-2\">\n        <span class=\"text-lg\">💧</span>\n        <h4 class=\"font-medium text-gray-900\">DRIP Collections</h4>\n        <span class=\"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full\">Trendy</span>\n      </div>\n\n      <div class=\"grid grid-cols-1 gap-2\">\n        {#each dripCollections as collection}\n          <button\n            type=\"button\"\n            onclick={() => onCollectionChange(selectedCollectionId === collection.id ? null : collection.id)}\n            class=\"text-left p-3 rounded-lg border-2 transition-all duration-200 {\n              selectedCollectionId === collection.id\n                ? 'border-blue-500 bg-blue-50 ring-2 ring-blue-200'\n                : 'border-gray-200 hover:border-gray-300 hover:bg-gray-50'\n            }\"\n          >\n            <div class=\"flex items-start gap-3\">\n              <span class=\"text-xl flex-shrink-0 mt-0.5\">{getCollectionEmoji(collection.slug)}</span>\n              <div class=\"flex-1 min-w-0\">\n                <div class=\"font-medium text-gray-900\">{collection.name}</div>\n                <div class=\"text-sm text-gray-600 line-clamp-2\">{collection.description}</div>\n              </div>\n              {#if selectedCollectionId === collection.id}\n                <div class=\"flex-shrink-0\">\n                  <svg class=\"w-5 h-5 text-blue-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                    <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" />\n                  </svg>\n                </div>\n              {/if}\n            </div>\n          </button>\n        {/each}\n      </div>\n    </div>\n  {/if}\n\n  <!-- Designer Collections -->\n  {#if designerCollections.length > 0}\n    <div class=\"space-y-3\">\n      <div class=\"flex items-center gap-2\">\n        <span class=\"text-lg\">👑</span>\n        <h4 class=\"font-medium text-gray-900\">Designer Collections</h4>\n        <span class=\"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full\">Luxury</span>\n      </div>\n\n      <div class=\"grid grid-cols-2 gap-2\">\n        {#each designerCollections as collection}\n          <button\n            type=\"button\"\n            onclick={() => onCollectionChange(selectedCollectionId === collection.id ? null : collection.id)}\n            class=\"text-left p-3 rounded-lg border-2 transition-all duration-200 {\n              selectedCollectionId === collection.id\n                ? 'border-purple-500 bg-purple-50 ring-2 ring-purple-200'\n                : 'border-gray-200 hover:border-gray-300 hover:bg-gray-50'\n            }\"\n          >\n            <div class=\"flex flex-col gap-2\">\n              <div class=\"flex items-center justify-between\">\n                <span class=\"text-lg\">{getCollectionEmoji(collection.slug)}</span>\n                {#if selectedCollectionId === collection.id}\n                  <svg class=\"w-4 h-4 text-purple-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                    <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" />\n                  </svg>\n                {/if}\n              </div>\n              <div>\n                <div class=\"font-medium text-gray-900 text-sm\">{collection.name}</div>\n              </div>\n            </div>\n          </button>\n        {/each}\n      </div>\n    </div>\n  {/if}\n\n  <!-- Skip Option -->\n  <div class=\"pt-2 border-t border-gray-100\">\n    <button\n      type=\"button\"\n      onclick={() => onCollectionChange(null)}\n      class=\"text-left w-full p-3 rounded-lg border-2 transition-all duration-200 {\n        selectedCollectionId === null || selectedCollectionId === undefined\n          ? 'border-gray-500 bg-gray-50 ring-2 ring-gray-200'\n          : 'border-gray-200 hover:border-gray-300 hover:bg-gray-50'\n      }\"\n    >\n      <div class=\"flex items-center gap-3\">\n        <span class=\"text-xl\">📦</span>\n        <div class=\"flex-1\">\n          <div class=\"font-medium text-gray-900\">General Collection</div>\n          <div class=\"text-sm text-gray-600\">No specific collection - just regular marketplace listing</div>\n        </div>\n        {#if selectedCollectionId === null || selectedCollectionId === undefined}\n          <svg class=\"w-5 h-5 text-gray-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n            <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" />\n          </svg>\n        {/if}\n      </div>\n    </button>\n  </div>\n\n  <!-- Error Display -->\n  {#if error}\n    <div class=\"p-3 bg-red-50 border border-red-200 rounded-lg\">\n      <p class=\"text-sm text-red-600\">{error}</p>\n    </div>\n  {/if}\n</div>\n\n<style>\n  .line-clamp-2 {\n    overflow: hidden;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    line-clamp: 2;\n    -webkit-box-orient: vertical;\n  }\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\ConditionSelector.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\DynamicContentErrorBoundary.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1617,1620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1617,1620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import type { Snippet } from 'svelte';\r\n  import { isBrowser } from '../../utils/runtime.js';\r\n  import { createLogger } from '../../utils/log.js';\r\n\r\n  const logger = createLogger('ErrorBoundary');\r\n\r\n  interface Props {\r\n    children: Snippet;\r\n    fallback?: Snippet<[error: Error, retry: () => void]>;\r\n    name?: string;\r\n    level?: 'page' | 'component' | 'widget';\r\n    showErrorDetails?: boolean;\r\n  }\r\n\r\n  let {\r\n    children,\r\n    fallback,\r\n    name = 'Unknown Component',\r\n    level = 'component',\r\n    showErrorDetails = false\r\n  }: Props = $props();\r\n\r\n  let hasError = $state(false);\r\n  let error = $state<Error | null>(null);\r\n  let retryCount = $state(0);\r\n\r\n  function handleError(err: Error) {\r\n    hasError = true;\r\n    error = err;\r\n\r\n    // Log error with context\r\n    logger.error(`Error in ${name}`, {\r\n      error: err.message,\r\n      stack: err.stack,\r\n      level,\r\n      retryCount,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n\r\n    // Report to error tracking if available\r\n    if (isBrowser && window.Sentry?.captureException) {\r\n      window.Sentry.captureException(err, {\r\n        tags: {\r\n          component: name,\r\n          level,\r\n          retryCount\r\n        },\r\n        contexts: {\r\n          errorBoundary: {\r\n            name,\r\n            level,\r\n            retryCount\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function retry() {\r\n    retryCount++;\r\n    hasError = false;\r\n    error = null;\r\n\r\n    logger.info(`Retrying ${name} (attempt ${retryCount})`);\r\n  }\r\n\r\n  // Catch synchronous errors\r\n  function safeRender(renderFn: () => any) {\r\n    try {\r\n      return renderFn();\r\n    } catch (err) {\r\n      if (err instanceof Error) {\r\n        handleError(err);\r\n      }\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Handle promise rejections for async content\r\n  function handleUnhandledRejection(event: PromiseRejectionEvent) {\r\n    handleError(new Error(`Unhandled promise rejection: ${event.reason}`));\r\n  }\r\n\r\n  // Set up global error handling for this boundary\r\n  if (isBrowser) {\r\n    window.addEventListener('unhandledrejection', handleUnhandledRejection);\r\n  }\r\n</script>\r\n\r\n{#if hasError && error}\r\n  {#if fallback}\r\n    {@render fallback(error, retry)}\r\n  {:else}\r\n    <div class=\"error-boundary\" data-level={level}>\r\n      <div class=\"error-content\">\r\n        <div class=\"error-icon\">\r\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n            <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\"/>\r\n            <line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\"/>\r\n          </svg>\r\n        </div>\r\n\r\n        <h3 class=\"error-title\">\r\n          {level === 'page' ? 'Page Error' : level === 'widget' ? 'Widget Error' : 'Component Error'}\r\n        </h3>\r\n\r\n        <p class=\"error-message\">\r\n          {level === 'page' ? 'The page encountered an error and cannot be displayed.' :\r\n           level === 'widget' ? 'This content is temporarily unavailable.' :\r\n           'This component failed to load properly.'}\r\n        </p>\r\n\r\n        {#if showErrorDetails && error}\r\n          <details class=\"error-details\">\r\n            <summary>Error Details</summary>\r\n            <pre>{error.message}</pre>\r\n          </details>\r\n        {/if}\r\n\r\n        <div class=\"error-actions\">\r\n          <button onclick={retry} class=\"retry-button\">\r\n            Try Again\r\n          </button>\r\n\r\n          {#if level === 'page'}\r\n            <button onclick={() => window.location.reload()} class=\"reload-button\">\r\n              Reload Page\r\n            </button>\r\n          {/if}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  {/if}\r\n{:else}\r\n  {safeRender(() => children())}\r\n{/if}\r\n\r\n<style>\r\n  .error-boundary {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    min-height: 200px;\r\n    padding: 1rem;\r\n    border: 1px dashed #e5e7eb;\r\n    border-radius: 8px;\r\n    background-color: #fef7f0;\r\n  }\r\n\r\n  .error-boundary[data-level=\"page\"] {\r\n    min-height: 400px;\r\n    background-color: #fefefe;\r\n  }\r\n\r\n  .error-boundary[data-level=\"widget\"] {\r\n    min-height: 100px;\r\n    background-color: #f9fafb;\r\n  }\r\n\r\n  .error-content {\r\n    text-align: center;\r\n    max-width: 400px;\r\n  }\r\n\r\n  .error-icon {\r\n    color: #f59e0b;\r\n    margin-bottom: 1rem;\r\n    display: flex;\r\n    justify-content: center;\r\n  }\r\n\r\n  .error-title {\r\n    font-size: 1.125rem;\r\n    font-weight: 600;\r\n    color: #374151;\r\n    margin: 0 0 0.5rem 0;\r\n  }\r\n\r\n  .error-message {\r\n    color: #6b7280;\r\n    margin: 0 0 1rem 0;\r\n    line-height: 1.5;\r\n  }\r\n\r\n  .error-details {\r\n    margin: 1rem 0;\r\n    text-align: left;\r\n  }\r\n\r\n  .error-details summary {\r\n    cursor: pointer;\r\n    font-weight: 500;\r\n    color: #374151;\r\n  }\r\n\r\n  .error-details pre {\r\n    background: #f3f4f6;\r\n    padding: 0.75rem;\r\n    border-radius: 4px;\r\n    font-size: 0.875rem;\r\n    color: #374151;\r\n    white-space: pre-wrap;\r\n    word-break: break-word;\r\n    margin-top: 0.5rem;\r\n  }\r\n\r\n  .error-actions {\r\n    display: flex;\r\n    gap: 0.75rem;\r\n    justify-content: center;\r\n    flex-wrap: wrap;\r\n  }\r\n\r\n  .retry-button,\r\n  .reload-button {\r\n    padding: 0.5rem 1rem;\r\n    border-radius: 6px;\r\n    font-weight: 500;\r\n    font-size: 0.875rem;\r\n    cursor: pointer;\r\n    transition: all 0.15s ease;\r\n    border: 1px solid transparent;\r\n  }\r\n\r\n  .retry-button {\r\n    background-color: #3b82f6;\r\n    color: white;\r\n  }\r\n\r\n  .retry-button:hover {\r\n    background-color: #2563eb;\r\n  }\r\n\r\n  .reload-button {\r\n    background-color: #f3f4f6;\r\n    color: #374151;\r\n    border-color: #d1d5db;\r\n  }\r\n\r\n  .reload-button:hover {\r\n    background-color: #e5e7eb;\r\n  }\r\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\ErrorBoundary.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\FormField.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\Input.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\PaymentForm.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ConfirmPaymentData' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PaymentIntent' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[696,699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[696,699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2584,2587],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2584,2587],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2597,2600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2597,2600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'productId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":95,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":95,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sellerId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":96,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'buyerId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":97,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":10},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4326,4329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4326,4329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":276,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7783,7786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7783,7786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":298,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":298,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n\t// No lifecycle imports needed - using $effect\r\n\timport type {\r\n\t\tStripe,\r\n\t\tStripeElements,\r\n\t\tStripePaymentElement,\r\n\t\tStripePaymentElementChangeEvent,\r\n\t\tConfirmPaymentData\r\n\t} from '@stripe/stripe-js';\r\n\timport Button from '../ui/Button.svelte';\r\n\timport type { PaymentIntent } from '../../types';\r\n\r\n\t// Local utility functions (since we can't import from web app)\r\n\tfunction formatCurrency(amount: number, currency: string = 'eur'): string {\r\n\t\treturn new Intl.NumberFormat('en-US', {\r\n\t\t\tstyle: 'currency',\r\n\t\t\tcurrency: currency.toUpperCase(),\r\n\t\t\tminimumFractionDigits: 2,\r\n\t\t\tmaximumFractionDigits: 2\r\n\t\t}).format(amount);\r\n\t}\r\n\r\n\tfunction formatStripeError(error: any): string {\r\n\t\tif (!error) return 'An unknown error occurred';\r\n\t\t\r\n\t\tswitch (error.type) {\r\n\t\t\tcase 'card_error':\r\n\t\t\t\tswitch (error.code) {\r\n\t\t\t\t\tcase 'card_declined':\r\n\t\t\t\t\t\treturn 'Your card was declined. Please try a different payment method.';\r\n\t\t\t\t\tcase 'insufficient_funds':\r\n\t\t\t\t\t\treturn 'Your card has insufficient funds.';\r\n\t\t\t\t\tcase 'expired_card':\r\n\t\t\t\t\t\treturn 'Your card has expired. Please use a different card.';\r\n\t\t\t\t\tcase 'incorrect_cvc':\r\n\t\t\t\t\t\treturn 'Your card\\'s security code is incorrect.';\r\n\t\t\t\t\tcase 'processing_error':\r\n\t\t\t\t\t\treturn 'An error occurred while processing your card. Please try again.';\r\n\t\t\t\t\tcase 'incorrect_number':\r\n\t\t\t\t\t\treturn 'Your card number is incorrect.';\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn error.message || 'Your card was declined.';\r\n\t\t\t\t}\r\n\t\t\tcase 'validation_error':\r\n\t\t\t\treturn error.message || 'Please check your payment information.';\r\n\t\t\tcase 'api_error':\r\n\t\t\t\treturn 'A payment processing error occurred. Please try again.';\r\n\t\t\tdefault:\r\n\t\t\t\treturn error.message || 'An error occurred while processing your payment.';\r\n\t\t}\r\n\t}\r\n\r\n\tinterface Translations {\r\n\t\ttotal?: string;\r\n\t\tprocessing?: string;\r\n\t\tpay?: string;\r\n\t\tpaymentSystemNotInitialized?: string;\r\n\t\tpaymentFailed?: string;\r\n\t\tcardNumber?: string;\r\n\t\texpiryDate?: string;\r\n\t\tcvc?: string;\r\n\t\tcardholderName?: string;\r\n\t\tvalidationError?: string;\r\n\t}\r\n\r\n\tinterface Props {\r\n\t\t// Required props\r\n\t\tamount: number;\r\n\t\tproductId: string;\r\n\t\tsellerId: string;\r\n\t\tbuyerId: string;\r\n\t\tclientSecret: string;\r\n\t\tstripe: Stripe | null;\r\n\t\t\r\n\t\t// Optional props\r\n\t\tcurrency?: string;\r\n\t\tshowBillingAddress?: boolean;\r\n\t\tshowCardholderName?: boolean;\r\n\t\tallowSaveCard?: boolean;\r\n\t\tloading?: boolean;\r\n\t\tdisabled?: boolean;\r\n\t\ttheme?: 'light' | 'dark' | 'auto';\r\n\t\tlocale?: string;\r\n\t\ttranslations?: Translations;\r\n\t\t\r\n\t\t// Callbacks\r\n\t\tonPaymentSuccess?: (result: { paymentIntent: any; order?: any }) => Promise<void>;\r\n\t\tonPaymentError?: (error: string) => void;\r\n\t\tonValidationError?: (errors: Record<string, string>) => void;\r\n\t\tonProcessingChange?: (processing: boolean) => void;\r\n\t}\r\n\r\n\tlet { \r\n\t\tamount, \r\n\t\tproductId,\r\n\t\tsellerId,\r\n\t\tbuyerId,\r\n\t\tclientSecret,\r\n\t\tstripe,\r\n\t\tcurrency = 'eur',\r\n\t\tshowBillingAddress = false,\r\n\t\tshowCardholderName = false,\r\n\t\tallowSaveCard = false,\r\n\t\tloading = false,\r\n\t\tdisabled = false,\r\n\t\ttheme = 'light',\r\n\t\tlocale = 'en',\r\n\t\ttranslations = {},\r\n\t\tonPaymentSuccess,\r\n\t\tonPaymentError,\r\n\t\tonValidationError,\r\n\t\tonProcessingChange\r\n\t}: Props = $props();\r\n\r\n\t// State\r\n\tlet paymentProcessing = $state(false);\r\n\tlet validationErrors = $state<Record<string, string>>({});\r\n\tlet elements: StripeElements | null = $state(null);\r\n\tlet paymentElement: StripePaymentElement | null = $state(null);\r\n\tlet formValid = $state(false);\r\n\tlet cardholderName = $state('');\r\n\tlet saveCard = $state(false);\r\n\tlet mounted = $state(false);\r\n\r\n\t// Form elements\r\n\tlet cardContainer: HTMLElement;\r\n\tlet formElement: HTMLFormElement;\r\n\r\n\t// Initialize Stripe Elements\r\n\tasync function initializeStripeElements() {\r\n\t\tif (!stripe || !clientSecret || mounted) return;\r\n\r\n\t\ttry {\r\n\t\t\t// Create elements instance\r\n\t\t\telements = stripe.elements({\r\n\t\t\t\tclientSecret,\r\n\t\t\t\tappearance: {\r\n\t\t\t\t\ttheme: theme === 'auto' ? 'stripe' : theme === 'dark' ? 'night' : 'flat',\r\n\t\t\t\t\tvariables: {\r\n\t\t\t\t\t\tcolorPrimary: '#3b82f6',\r\n\t\t\t\t\t\tcolorBackground: theme === 'dark' ? '#1f2937' : '#ffffff',\r\n\t\t\t\t\t\tcolorText: theme === 'dark' ? '#f9fafb' : '#374151',\r\n\t\t\t\t\t\tcolorDanger: '#ef4444',\r\n\t\t\t\t\t\tfontFamily: 'system-ui, sans-serif',\r\n\t\t\t\t\t\tspacingUnit: '4px',\r\n\t\t\t\t\t\tborderRadius: '8px'\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tlocale: locale as any\r\n\t\t\t});\r\n\r\n\t\t\t// Create payment element (recommended)\r\n\t\t\tpaymentElement = elements.create('payment', {\r\n\t\t\t\tlayout: {\r\n\t\t\t\t\ttype: 'tabs',\r\n\t\t\t\t\tdefaultCollapsed: false\r\n\t\t\t\t},\r\n\t\t\t\tpaymentMethodOrder: ['card', 'paypal', 'apple_pay', 'google_pay'],\r\n\t\t\t\tfields: {\r\n\t\t\t\t\tbillingDetails: showBillingAddress ? {\r\n\t\t\t\t\t\tname: showCardholderName ? 'auto' : 'never',\r\n\t\t\t\t\t\temail: 'never',\r\n\t\t\t\t\t\tphone: 'never',\r\n\t\t\t\t\t\taddress: {\r\n\t\t\t\t\t\t\tline1: 'auto',\r\n\t\t\t\t\t\t\tline2: 'auto',\r\n\t\t\t\t\t\t\tcity: 'auto',\r\n\t\t\t\t\t\t\tstate: 'auto',\r\n\t\t\t\t\t\t\tcountry: 'auto',\r\n\t\t\t\t\t\t\tpostalCode: 'auto'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} : 'never'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Mount the element\r\n\t\t\tpaymentElement.mount(cardContainer);\r\n\r\n\t\t\t// Listen for changes\r\n\t\t\tpaymentElement.on('change', handleElementChange);\r\n\t\t\tpaymentElement.on('ready', handleElementReady);\r\n\r\n\t\t\tmounted = true;\r\n\t\t} catch (error) {\r\n\t\t\t\r\n\t\t\tonPaymentError?.(formatStripeError(error));\r\n\t\t}\r\n\t}\r\n\r\n\t// Handle element changes\r\n\tfunction handleElementChange(event: StripePaymentElementChangeEvent) {\r\n\t\tformValid = event.complete;\r\n\r\n\t\t// Clear any previous card errors when the element is complete\r\n\t\tif (event.complete) {\r\n\t\t\tvalidationErrors.card = '';\r\n\t\t} else {\r\n\t\t\tdelete validationErrors.card;\r\n\t\t\tvalidationErrors = { ...validationErrors };\r\n\t\t}\r\n\r\n\t\tonValidationError?.(validationErrors);\r\n\t}\r\n\r\n\tfunction handleElementReady() {\r\n\t\t\r\n\t}\r\n\r\n\t// Handle form submission\r\n\tasync function handleSubmit(event: Event) {\r\n\t\tevent.preventDefault();\r\n\t\t\r\n\t\tif (!stripe || !elements || !paymentElement) {\r\n\t\t\tonPaymentError?.(translations.paymentSystemNotInitialized || 'Payment system not initialized');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Validate amount\r\n\t\tif (amount < 50) { // 50 cents minimum\r\n\t\t\tonPaymentError?.('Amount must be at least €0.50');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!formValid) {\r\n\t\t\tonPaymentError?.(translations.validationError || 'Please complete all payment information');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tpaymentProcessing = true;\r\n\t\tonProcessingChange?.(true);\r\n\r\n\t\ttry {\r\n\t\t\t// Confirm payment with Stripe\r\n\t\t\tconst result = await stripe.confirmPayment({\r\n\t\t\t\telements,\r\n\t\t\t\tconfirmParams: {\r\n\t\t\t\t\treturn_url: `${window.location.origin}/payment/success`,\r\n\t\t\t\t\t...(showCardholderName && cardholderName ? {\r\n\t\t\t\t\t\tpayment_method_data: {\r\n\t\t\t\t\t\t\tbilling_details: {\r\n\t\t\t\t\t\t\t\tname: cardholderName\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} : {})\r\n\t\t\t\t},\r\n\t\t\t\tredirect: 'if_required'\r\n\t\t\t});\r\n\r\n\t\t\tif (result.error) {\r\n\t\t\t\t// Payment failed\r\n\t\t\t\tonPaymentError?.(formatStripeError(result.error));\r\n\t\t\t} else if (result.paymentIntent) {\r\n\t\t\t\t// Check payment status\r\n\t\t\t\tconst paymentIntent = result.paymentIntent;\r\n\t\t\t\tif (paymentIntent.status === 'succeeded') {\r\n\t\t\t\t\t// Payment succeeded - now confirm with backend\r\n\t\t\t\t\tawait confirmPaymentWithBackend(paymentIntent);\r\n\t\t\t\t} else if (paymentIntent.status === 'processing') {\r\n\t\t\t\t\tonPaymentError?.('Payment is being processed. You will receive a confirmation email once complete.');\r\n\t\t\t\t} else if (paymentIntent.status === 'requires_action') {\r\n\t\t\t\t\tonPaymentError?.('Additional authentication required. Please complete the verification.');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tonPaymentError?.(`Payment ${paymentIntent.status}. Please try again.`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\t\r\n\t\t\tonPaymentError?.(formatStripeError(error));\r\n\t\t} finally {\r\n\t\t\tpaymentProcessing = false;\r\n\t\t\tonProcessingChange?.(false);\r\n\t\t}\r\n\t}\r\n\r\n\t// Confirm payment with backend\r\n\tasync function confirmPaymentWithBackend(paymentIntent: any) {\r\n\t\ttry {\r\n\t\t\tconst response = await fetch('/api/payments/confirm', {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json'\r\n\t\t\t\t},\r\n\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\tpaymentIntentId: paymentIntent.id\r\n\t\t\t\t})\r\n\t\t\t});\r\n\r\n\t\t\tconst result = await response.json();\r\n\r\n\t\t\tif (result.success) {\r\n\t\t\t\tonPaymentSuccess?.({\r\n\t\t\t\t\tpaymentIntent,\r\n\t\t\t\t\torder: result.orderId ? { id: result.orderId } : undefined\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tonPaymentError?.(result.error || 'Payment confirmation failed');\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\t\r\n\t\t\tonPaymentError?.(translations.paymentFailed || 'Payment confirmation failed');\r\n\t\t}\r\n\t}\r\n\r\n\t// Initialize Stripe and handle cleanup\r\n\t$effect(() => {\r\n\t\tif (stripe && clientSecret && !mounted) {\r\n\t\t\tinitializeStripeElements();\r\n\t\t}\r\n\r\n\t\treturn () => {\r\n\t\t\tif (paymentElement) {\r\n\t\t\t\tpaymentElement.destroy();\r\n\t\t\t}\r\n\t\t};\r\n\t});\r\n</script>\r\n\r\n<form bind:this={formElement} onsubmit={handleSubmit} class=\"space-y-6\">\r\n\t<!-- Payment Summary -->\r\n\t<div class=\"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg\">\r\n\t\t<div class=\"flex justify-between items-center\">\r\n\t\t\t<span class=\"text-sm font-medium text-[color:var(--text-muted)] dark:text-gray-300\">\r\n\t\t\t\t{translations.total || 'Total'}\r\n\t\t\t</span>\r\n\t\t\t<span class=\"text-lg font-bold text-[color:var(--text-primary)] dark:text-gray-100\">\r\n\t\t\t\t{formatCurrency(amount / 100, currency)}\r\n\t\t\t</span>\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<!-- Cardholder Name (if enabled) -->\r\n\t{#if showCardholderName}\r\n\t\t<div class=\"space-y-2\">\r\n\t\t\t<label for=\"cardholder-name\" class=\"block text-sm font-medium text-[color:var(--text-primary)] dark:text-gray-300\">\r\n\t\t\t\t{translations.cardholderName || 'Cardholder Name'}\r\n\t\t\t</label>\r\n\t\t\t<input\r\n\t\t\t\tid=\"cardholder-name\"\r\n\t\t\t\ttype=\"text\"\r\n\t\t\t\tbind:value={cardholderName}\r\n\t\t\t\tplaceholder=\"Enter cardholder name\"\r\n\t\t\t\tdisabled={disabled || paymentProcessing}\r\n\t\t\t\tclass=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg \r\n\t\t\t\t       bg-white dark:bg-gray-700 text-[color:var(--text-primary)] dark:text-gray-100\r\n\t\t\t\t       focus:ring-2 focus:ring-blue-500 focus:border-transparent\r\n\t\t\t\t       disabled:opacity-50 disabled:cursor-not-allowed\"\r\n\t\t\t/>\r\n\t\t</div>\r\n\t{/if}\r\n\r\n\t<!-- Stripe Elements Container -->\r\n\t<div class=\"space-y-4\">\r\n\t\t<div \r\n\t\t\tbind:this={cardContainer}\r\n\t\t\tclass=\"p-4 border border-gray-300 dark:border-gray-600 rounded-lg \r\n\t\t\t       bg-white dark:bg-gray-700 min-h-30\r\n\t\t\t       transition-colors duration-200\r\n\t\t\t       {validationErrors.card ? 'border-red-500 dark:border-red-400' : ''}\"\r\n\t\t>\r\n\t\t\t<!-- Stripe Elements will be mounted here -->\r\n\t\t\t{#if !mounted && stripe}\r\n\t\t\t\t<div class=\"flex items-center justify-center h-full\">\r\n\t\t\t\t\t<div class=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500\"></div>\r\n\t\t\t\t\t<span class=\"ml-2 text-sm text-[color:var(--text-muted)] dark:text-gray-400\">\r\n\t\t\t\t\t\tLoading payment form...\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</div>\r\n\t\t\t{:else if !stripe}\r\n\t\t\t\t<div class=\"flex items-center justify-center h-full\">\r\n\t\t\t\t\t<span class=\"text-sm text-red-500 dark:text-red-400\">\r\n\t\t\t\t\t\tPayment system not available\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</div>\r\n\t\t\t{/if}\r\n\t\t</div>\r\n\t\t\r\n\t\t<!-- Error Messages -->\r\n\t\t{#if validationErrors.card}\r\n\t\t\t<p class=\"text-sm text-red-600 dark:text-red-400\">\r\n\t\t\t\t{validationErrors.card}\r\n\t\t\t</p>\r\n\t\t{/if}\r\n\t</div>\r\n\r\n\t<!-- Save Payment Method Option -->\r\n\t{#if allowSaveCard}\r\n\t\t<div class=\"flex items-center\">\r\n\t\t\t<input\r\n\t\t\t\tid=\"save-card\"\r\n\t\t\t\ttype=\"checkbox\"\r\n\t\t\t\tbind:checked={saveCard}\r\n\t\t\t\tdisabled={disabled || paymentProcessing}\r\n\t\t\t\tclass=\"h-4 w-4 text-[color:var(--text-link)] focus:ring-blue-500 border-gray-300 rounded\"\r\n\t\t\t/>\r\n\t\t\t<label for=\"save-card\" class=\"ml-2 block text-sm text-[color:var(--text-primary)] dark:text-gray-300\">\r\n\t\t\t\tSave this payment method for future purchases\r\n\t\t\t</label>\r\n\t\t</div>\r\n\t{/if}\r\n\r\n\t<!-- Submit Button -->\r\n\t<Button\r\n\t\ttype=\"submit\"\r\n\t\tdisabled={disabled || loading || paymentProcessing || !formValid || !mounted}\r\n\t\tclass=\"w-full {paymentProcessing ? 'animate-pulse' : ''}\"\r\n\t\tvariant=\"primary\"\r\n\t>\r\n\t\t{#if paymentProcessing}\r\n\t\t\t<div class=\"flex items-center justify-center\">\r\n\t\t\t\t<div class=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\r\n\t\t\t\t{translations.processing || 'Processing...'}\r\n\t\t\t</div>\r\n\t\t{:else}\r\n\t\t\t{translations.pay || 'Pay'} {formatCurrency(amount / 100, currency)}\r\n\t\t{/if}\r\n\t</Button>\r\n\r\n\t<!-- Security Notice -->\r\n\t<div class=\"flex items-center justify-center text-xs text-[color:var(--text-muted)] dark:text-gray-400\">\r\n\t\t<svg class=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" \r\n\t\t\t      d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" />\r\n\t\t</svg>\r\n\t\tSecured by Stripe\r\n\t</div>\r\n</form>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\PayoutMethodSelector.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onDetailsChange' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":31,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onNameChange' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":32,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":17},{"ruleId":"svelte/no-at-html-tags","severity":1,"message":"`{@html}` can lead to XSS attack.","line":106,"column":19,"nodeType":"SvelteMustacheTag","messageId":"unexpected","endLine":106,"endColumn":41},{"ruleId":"svelte/no-at-html-tags","severity":1,"message":"`{@html}` can lead to XSS attack.","line":159,"column":21,"nodeType":"SvelteMustacheTag","messageId":"unexpected","endLine":159,"endColumn":50},{"ruleId":"svelte/no-at-html-tags","severity":1,"message":"`{@html}` can lead to XSS attack.","line":226,"column":17,"nodeType":"SvelteMustacheTag","messageId":"unexpected","endLine":226,"endColumn":46}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  import Input from '../forms/Input.svelte';\n\n  interface PayoutMethod {\n    type: 'revolut' | 'paypal' | 'card';\n    name: string;\n    description: string;\n    icon: string;\n    svgIcon?: string;\n    placeholder: string;\n    hint: string;\n    recommended?: boolean;\n    color: string;\n  }\n\n  interface Props {\n    selectedMethod?: 'revolut' | 'paypal' | 'card';\n    payoutDetails?: string;\n    payoutName?: string;\n    onMethodChange?: (method: 'revolut' | 'paypal' | 'card') => void;\n    onDetailsChange?: (details: string) => void;\n    onNameChange?: (name: string) => void;\n    class?: string;\n  }\n\n  let { \n    selectedMethod = $bindable('revolut'),\n    payoutDetails = $bindable(''),\n    payoutName = $bindable(''),\n    onMethodChange,\n    onDetailsChange,\n    onNameChange,\n    class: className = ''\n  }: Props = $props();\n\n  const payoutMethods: PayoutMethod[] = [\n    {\n      type: 'revolut',\n      name: 'Revolut',\n      description: 'Fast & secure transfers',\n      icon: 'R',\n      svgIcon: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M21.376 0H2.624A2.625 2.625 0 000 2.624v18.752A2.625 2.625 0 002.624 24h18.752A2.625 2.625 0 0024 21.376V2.624A2.625 2.625 0 0021.376 0zm-9.245 18.35a2.634 2.634 0 01-2.475-1.742H8.071v5.267H5.935V7.982h5.23c3.115 0 4.573 1.388 4.573 3.593 0 2.082-1.318 3.324-3.13 3.596l2.83 6.704h-2.459a2.634 2.634 0 01-2.848-3.525zm-.965-6.823c1.45 0 2.185-.68 2.185-1.703 0-1.024-.735-1.704-2.185-1.704H8.071v3.407z\"/></svg>`,\n      placeholder: '@your_revolut_tag',\n      hint: 'Your Revolut tag should start with @ (e.g., @username)',\n      recommended: true,\n      color: 'bg-gradient-to-br from-blue-600 to-indigo-700'\n    },\n    {\n      type: 'paypal',\n      name: 'PayPal',\n      description: 'Global payments',\n      icon: 'P',\n      svgIcon: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M7.076 21.337H2.47a.641.641 0 01-.633-.74L4.944 2.419a.641.641 0 01.633-.542h7.26c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.42 1.012 4.287-.023.143-.047.288-.077.437-.983 5.05-4.349 6.797-8.647 6.797h-2.19a.641.641 0 00-.633.542l-1.259 6.934a.641.641 0 01-.633.542zm7.392-17.15h-4.79L7.69 15.123h2.022c3.359 0 5.632-1.469 6.276-4.715.32-1.61.094-2.81-.65-3.478-.665-.596-1.732-.91-3.08-.91l.21-1.833z\"/></svg>`,\n      placeholder: 'your-email@example.com',\n      hint: 'Use the email address associated with your PayPal account',\n      color: 'bg-gradient-to-br from-blue-500 to-sky-600'\n    },\n    {\n      type: 'card',\n      name: 'Bank Card',\n      description: 'Bank transfer',\n      icon: '💳',\n      svgIcon: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"2\" y=\"5\" width=\"20\" height=\"14\" rx=\"2\"/><line x1=\"2\" y1=\"10\" x2=\"22\" y2=\"10\"/></svg>`,\n      placeholder: 'Bank account or card details',\n      hint: 'Include bank name, account number, or card details for transfers',\n      color: 'bg-gradient-to-br from-gray-700 to-gray-900'\n    }\n  ];\n\n  let expandedMethod = $state<'revolut' | 'paypal' | 'card' | null>(null);\n\n  function handleMethodSelect(method: 'revolut' | 'paypal' | 'card') {\n    if (selectedMethod === method && expandedMethod === method) {\n      // If clicking the already selected and expanded method, just collapse\n      expandedMethod = null;\n    } else {\n      selectedMethod = method;\n      expandedMethod = method;\n      onMethodChange?.(method);\n      // Don't clear details when re-selecting same method\n      if (selectedMethod !== method) {\n        payoutDetails = '';\n      }\n    }\n  }\n\n  const currentMethod = $derived(payoutMethods.find(m => m.type === selectedMethod) || payoutMethods[0]);\n</script>\n\n<div class=\"space-y-4 {className}\">\n  <!-- Method Selection - Mobile Optimized -->\n  <div class=\"grid grid-cols-1 sm:grid-cols-3 gap-3\">\n    {#each payoutMethods as method}\n      <button\n        onclick={() => handleMethodSelect(method.type)}\n        type=\"button\"\n        class=\"relative group transition-colors duration-300 {expandedMethod === method.type ? 'sm:col-span-1' : ''}\"\n      >\n        <!-- Mobile: Horizontal card, Desktop: Vertical card -->\n        <div class=\"{method.color} text-white rounded-xl p-4 sm:p-5 transition-colors duration-300 shadow-lg hover:shadow-xl {selectedMethod === method.type ? 'ring-2 ring-offset-2 ring-white/40 scale-[1.02]' : ''}\">\n          <div class=\"flex sm:flex-col sm:items-center sm:text-center gap-4 sm:gap-3\">\n            <!-- Icon -->\n            <div class=\"w-14 h-14 sm:w-16 sm:h-16 bg-white/20 md:backdrop-blur rounded-xl flex items-center justify-center flex-shrink-0\">\n              {#if method.svgIcon}\n                <div class=\"w-8 h-8 sm:w-9 sm:h-9 text-white\">\n                  {@html method.svgIcon}\n                </div>\n              {:else}\n                <span class=\"text-2xl\">{method.icon}</span>\n              {/if}\n            </div>\n            \n            <!-- Text Content -->\n            <div class=\"flex-1 text-left sm:text-center\">\n              <div class=\"font-semibold text-base sm:text-lg flex items-center gap-2\">\n                {method.name}\n                {#if method.recommended}\n                  <span class=\"bg-white/25 text-white text-xs px-2 py-0.5 rounded-full font-medium\">\n                    Recommended\n                  </span>\n                {/if}\n              </div>\n              <div class=\"text-sm text-white/80 mt-0.5\">{method.description}</div>\n            </div>\n            \n            <!-- Selected/Expand Indicator -->\n            <div class=\"flex-shrink-0 sm:absolute sm:top-2 sm:right-2\">\n              {#if selectedMethod === method.type}\n                <div class=\"w-6 h-6 bg-white/25 md:backdrop-blur rounded-full flex items-center justify-center\">\n                  <svg class=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2.5\" d=\"M5 13l4 4L19 7\" />\n                  </svg>\n                </div>\n              {:else}\n                <div class=\"w-6 h-6 bg-white/10 rounded-full flex items-center justify-center sm:opacity-0 sm:group-hover:opacity-100 transition-opacity\">\n                  <svg class=\"w-4 h-4 text-white/70\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\" />\n                  </svg>\n                </div>\n              {/if}\n            </div>\n          </div>\n        </div>\n      </button>\n    {/each}\n  </div>\n\n  <!-- Expandable Details Input -->\n  {#if expandedMethod && selectedMethod}\n    <div class=\"animate-in slide-in-from-top-2 duration-300\">\n      <div class=\"bg-white rounded-xl border border-gray-200 shadow-sm p-5\">\n        <div class=\"space-y-4\">\n          <!-- Method Header with Collapse Button -->\n          <div class=\"flex items-center justify-between mb-2\">\n            <h3 class=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\n              <span class=\"w-8 h-8 {currentMethod.color} text-white rounded-lg flex items-center justify-center text-sm\">\n                {#if currentMethod.svgIcon}\n                  <div class=\"w-5 h-5\">\n                    {@html currentMethod.svgIcon}\n                  </div>\n                {:else}\n                  {currentMethod.icon}\n                {/if}\n              </span>\n              {currentMethod.name} Details\n            </h3>\n            <button\n              type=\"button\"\n              onclick={() => expandedMethod = null}\n              class=\"text-gray-400 hover:text-gray-500 transition-colors\"\n              aria-label={`Close ${currentMethod.name} payout method details`}\n            >\n              <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\n              </svg>\n            </button>\n          </div>\n          \n          <div>\n            <label for=\"payout-details\" class=\"block text-sm font-medium text-gray-900 mb-2\">\n              {currentMethod.name} Account <span class=\"text-red-500\">*</span>\n            </label>\n            <Input\n              id=\"payout-details\"\n              bind:value={payoutDetails}\n              placeholder={currentMethod.placeholder}\n              required\n              class=\"bg-gray-50 border-gray-300 focus:bg-white\"\n            />\n            <p class=\"text-xs text-gray-500 mt-2 flex items-start gap-1\">\n              <svg class=\"w-3 h-3 text-gray-400 mt-0.5 flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                <path fill-rule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clip-rule=\"evenodd\"/>\n              </svg>\n              <span>{currentMethod.hint}</span>\n            </p>\n          </div>\n\n          <div>\n            <label for=\"payout-name\" class=\"block text-sm font-medium text-gray-900 mb-2\">\n              Account Holder Name <span class=\"text-red-500\">*</span>\n            </label>\n            <Input\n              id=\"payout-name\"\n              bind:value={payoutName}\n              placeholder=\"Your full legal name\"\n              required\n              class=\"bg-gray-50 border-gray-300 focus:bg-white\"\n            />\n            <p class=\"text-xs text-gray-500 mt-1\">Must match the name on your {currentMethod.name} account for payouts</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  {:else if selectedMethod && !expandedMethod}\n    <!-- Collapsed state - show mini indicator -->\n    <div class=\"bg-gray-50 rounded-lg p-3 border border-gray-200\">\n      <button\n        type=\"button\"\n        onclick={() => expandedMethod = selectedMethod}\n        class=\"w-full flex items-center justify-between text-left group\"\n      >\n        <div class=\"flex items-center gap-3\">\n          <div class=\"w-8 h-8 {currentMethod.color} text-white rounded-lg flex items-center justify-center text-sm\">\n            {#if currentMethod.svgIcon}\n              <div class=\"w-5 h-5\">\n                {@html currentMethod.svgIcon}\n              </div>\n            {:else}\n              {currentMethod.icon}\n            {/if}\n          </div>\n          <div>\n            <p class=\"text-sm font-medium text-gray-900\">{currentMethod.name} selected</p>\n            {#if !payoutDetails || !payoutName}\n              <p class=\"text-xs text-red-500 font-medium\">\n                ⚠️ Missing: {!payoutDetails ? 'Account details' : ''}{!payoutDetails && !payoutName ? ' & ' : ''}{!payoutName ? 'Account holder name' : ''}\n              </p>\n            {:else}\n              <p class=\"text-xs text-gray-500 truncate max-w-52\">{payoutDetails}</p>\n            {/if}\n          </div>\n        </div>\n        <svg class=\"w-5 h-5 text-gray-400 group-hover:text-gray-500 transition-colors\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\" />\n        </svg>\n      </button>\n    </div>\n  {/if}\n\n  <!-- Security Note - More compact on mobile -->\n  <div class=\"bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-4\">\n    <div class=\"flex items-start gap-3\">\n      <div class=\"w-8 h-8 bg-black rounded-lg flex items-center justify-center flex-shrink-0\">\n        <svg class=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"></path>\n        </svg>\n      </div>\n      <div class=\"flex-1\">\n        <p class=\"text-sm font-semibold text-gray-900\">Secure & Private</p>\n        <p class=\"text-xs sm:text-sm text-gray-500 mt-0.5\">Your payout information is encrypted and only used for processing payments to you.</p>\n      </div>\n    </div>\n  </div>\n</div>\n\n<style>\n  @keyframes slide-in-from-top-2 {\n    from {\n      transform: translateY(-0.5rem);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n  \n  .animate-in {\n    animation-fill-mode: both;\n  }\n  \n  .slide-in-from-top-2 {\n    animation-name: slide-in-from-top-2;\n  }\n  \n  .duration-300 {\n    animation-duration: 300ms;\n  }\n\n  /* Respect reduced motion preferences */\n  @media (prefers-reduced-motion: reduce) {\n    .animate-in,\n    .slide-in-from-top-2 {\n      animation: none;\n    }\n  }\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\PriceInput.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\SearchInput.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mode' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":45,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'startTime' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":62,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\nimport type { Database } from '@repo/database';\r\nimport type { Snippet } from 'svelte';\r\nimport SearchDropdown from '../navigation/SearchDropdown.svelte';\r\n\r\n// Define ProductWithImages type locally\r\ntype Product = Database['public']['Tables']['products']['Row'];\r\ntype ProductImage = Database['public']['Tables']['product_images']['Row'];\r\n\r\nexport interface ProductWithImages extends Product {\r\n  images: ProductImage[];\r\n  category_name?: string;\r\n  seller_name?: string;\r\n  seller_username?: string;\r\n  seller_rating?: number;\r\n}\r\n\r\ninterface Props {\r\n  searchValue?: string;\r\n  placeholder?: string;\r\n  onSearch?: (query: string) => void;\r\n  onProductSelect?: (product: ProductWithImages) => void;\r\n  searchFunction?: (query: string) => Promise<{ data: ProductWithImages[]; error: string | null }>;\r\n  leftSection?: Snippet;\r\n  rightSection?: Snippet;\r\n  class?: string;\r\n  searchId?: string;\r\n  showDropdown?: boolean;\r\n  maxResults?: number;\r\n  mode?: 'power' | 'compact' | 'full';\r\n}\r\n\r\nlet {\r\n  searchValue = $bindable(''),\r\n  placeholder = 'Search...',\r\n  onSearch,\r\n  onProductSelect,\r\n  searchFunction,\r\n  leftSection,\r\n  rightSection,\r\n  class: className = '',\r\n  searchId = 'search-input',\r\n  showDropdown = true,\r\n  maxResults = 5,\r\n  mode = 'full'\r\n}: Props = $props();\r\n\r\n// Analytics functionality removed for build optimization\r\n// TODO: Implement analytics tracking when needed\r\n\r\nlet inputElement: HTMLInputElement;\r\nlet focused = $state(false);\r\nlet dropdownVisible = $derived.by(() => {\r\n\treturn focused && showDropdown && searchValue.trim().length > 0;\r\n});\r\nconst listboxId = $derived(`${searchId}-listbox`);\r\n\r\n\r\nfunction handleSubmit(event: Event) {\r\n  event.preventDefault();\r\n  if (searchValue.trim()) {\r\n    const startTime = performance.now();\r\n\r\n    // Analytics tracking would go here when implemented\r\n    // trackSearch({\r\n    //   query: searchValue.trim(),\r\n    //   mode: mode as any,\r\n    //   session_id: '' // Will be set by analytics service\r\n    // });\r\n\r\n    onSearch?.(searchValue.trim());\r\n    inputElement.blur();\r\n\r\n    // Note: Performance tracking would happen in parent component when results are received\r\n  }\r\n}\r\n\r\nfunction handleKeydown(event: KeyboardEvent) {\r\n  // Prevent event bubbling that could interfere with dropdown handling\r\n  event.stopPropagation();\r\n\r\n  if (event.key === 'Enter') {\r\n    handleSubmit(event);\r\n  } else if (event.key === 'Escape') {\r\n    inputElement.blur();\r\n  }\r\n}\r\n\r\nfunction handleProductSelect(product: ProductWithImages) {\r\n  onProductSelect?.(product);\r\n  focused = false;\r\n}\r\n</script>\r\n\r\n<div class=\"search-input-container relative w-full {className}\">\r\n  <form onsubmit={handleSubmit} class=\"bg-[color:var(--surface-emphasis)] rounded-[var(--input-radius)] flex items-center relative shadow-none border border-[color:var(--border-subtle)] hover:bg-[color:var(--surface-muted)] focus-within:bg-[color:var(--surface-muted)] transition-colors\">\r\n    {#if leftSection}\r\n      {@render leftSection()}\r\n    {/if}\r\n\r\n    <div class=\"flex-1 relative\">\r\n      <input\r\n        bind:this={inputElement}\r\n        bind:value={searchValue}\r\n        onkeydown={handleKeydown}\r\n        onfocus={() => focused = true}\r\n        onblur={() => setTimeout(() => focused = false, 200)}\r\n        type=\"search\"\r\n        id={searchId}\r\n        {placeholder}\r\n        class=\"w-full h-11 pl-10 {rightSection ? 'pr-16' : 'pr-4'} bg-transparent border-0 text-base text-[color:var(--text-primary)] placeholder:text-[color:var(--text-muted)] focus:ring-0 focus:outline-none\"\r\n        autocomplete=\"off\"\r\n        spellcheck=\"false\"\r\n        role=\"combobox\"\r\n        aria-autocomplete=\"list\"\r\n        aria-expanded={dropdownVisible}\r\n        aria-controls={listboxId}\r\n        aria-label={placeholder}\r\n      />\r\n      <svg class=\"absolute left-3 top-3 w-5 h-5 text-[color:var(--text-tertiary)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\r\n      </svg>\r\n    </div>\r\n\r\n    {#if rightSection}\r\n      {@render rightSection()}\r\n    {/if}\r\n  </form>\r\n\r\n  {#if dropdownVisible && searchFunction}\r\n    <div class=\"absolute top-full left-0 right-0 mt-1 z-50\">\r\n      <SearchDropdown\r\n        query={searchValue}\r\n        onSearch={searchFunction}\r\n        {maxResults}\r\n        visible={dropdownVisible}\r\n        listboxId={listboxId}\r\n        onSelect={handleProductSelect}\r\n        onClose={() => { focused = false; }}\r\n      />\r\n    </div>\r\n  {/if}\r\n</div>\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\Select.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectOption' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import type { Snippet } from 'svelte';\r\n  import { Select as MeltSelect } from '../../primitives/select/index';\r\n  import type { SelectOption } from '../../primitives/select/index';\r\n  \r\n  interface Option {\r\n    value: string;\r\n    label: string;\r\n  }\r\n\r\n  interface Props {\r\n    value?: string;\r\n    options?: Option[] | string[];\r\n    placeholder?: string;\r\n    label?: string;\r\n    description?: string;\r\n    error?: string;\r\n    disabled?: boolean;\r\n    required?: boolean;\r\n    class?: string;\r\n    id?: string;\r\n    name?: string;\r\n    onChange?: (event: Event) => void;\r\n    onBlur?: (event: Event) => void;\r\n    children?: Snippet;\r\n  }\r\n\r\n  let {\r\n    value = $bindable(),\r\n    options,\r\n    placeholder = 'Select an option',\r\n    label,\r\n    description,\r\n    error,\r\n    disabled = false,\r\n    required = false,\r\n    class: className = '',\r\n    id,\r\n    name,\r\n    onChange,\r\n    onBlur,\r\n    children\r\n  }: Props = $props();\r\n\r\n  let generatedId = $state<string | null>(null);\r\n\r\n  $effect(() => {\r\n    if (!id && !generatedId) {\r\n      generatedId = typeof crypto !== 'undefined' && crypto.randomUUID\r\n        ? crypto.randomUUID()\r\n        : `select-${Math.random().toString(36).slice(2)}`;\r\n    }\r\n  });\r\n\r\n  const selectId = $derived(id ?? generatedId ?? 'select');\r\n  const descriptionId = $derived(description ? `${selectId}-description` : undefined);\r\n  const errorId = $derived(error ? `${selectId}-error` : undefined);\r\n  const describedBy = $derived([\r\n    descriptionId,\r\n    errorId\r\n  ].filter(Boolean).join(' ') || undefined);\r\n\r\n  // Support both options prop and children pattern\r\n  const normalizedOptions = $derived(\r\n    options ? options.map(opt => \r\n      typeof opt === 'string' \r\n        ? { value: opt, label: opt }\r\n        : opt\r\n    ) : []\r\n  );\r\n\r\n  // Convert our string value to the primitive's string | null format\r\n  let primitiveValue = $derived<string | null>(value || null);\r\n\r\n  // Handle value change and event mapping\r\n  function handleValueChange(newValue: string | null) {\r\n    const stringValue = newValue || '';\r\n    value = stringValue;\r\n    primitiveValue = newValue;\r\n    \r\n    // Create synthetic events for backward compatibility\r\n    if (onChange) {\r\n      const changeEvent = new Event('change', { bubbles: true });\r\n      Object.defineProperty(changeEvent, 'target', {\r\n        value: { value: stringValue },\r\n        enumerable: true\r\n      });\r\n      onChange(changeEvent);\r\n    }\r\n  }\r\n\r\n  // Handle blur event for backward compatibility\r\n  function handleBlur() {\r\n    if (onBlur) {\r\n      const blurEvent = new Event('blur', { bubbles: true });\r\n      Object.defineProperty(blurEvent, 'target', {\r\n        value: { value: value || '' },\r\n        enumerable: true\r\n      });\r\n      onBlur(blurEvent);\r\n    }\r\n  }\r\n\r\n  // Error state classes for the trigger\r\n  const errorClasses = $derived(\r\n    error\r\n      ? 'border-[color:var(--status-error-border)] focus:ring-[color:var(--status-error-solid)] focus:border-[color:var(--status-error-solid)]'\r\n      : 'border-[color:var(--input-border)] focus:ring-[color:var(--state-focus)] focus:border-[color:var(--state-focus)]'\r\n  );\r\n\r\n  const triggerClasses = $derived(\r\n    `block w-full rounded-[length:var(--input-radius)] border px-[length:var(--input-padding)] py-2 pr-10 min-h-[length:var(--input-height)] text-[length:var(--input-font)] bg-[color:var(--input-bg)] text-[color:var(--text-primary)] transition-colors duration-[var(--duration-base)] focus:outline-none focus:ring-2 appearance-none cursor-pointer disabled:cursor-not-allowed disabled:opacity-60 ${errorClasses} ${className}`.trim()\r\n  );\r\n</script>\r\n\r\n<div class=\"space-y-[var(--space-1)]\">\r\n  {#if label}\r\n    <label for={selectId} class=\"block text-sm font-medium text-[color:var(--text-primary)] mb-1.5\">\r\n      {label}\r\n      {#if required}\r\n        <span class=\"text-[color:var(--status-error-solid)]\">*</span>\r\n      {/if}\r\n    </label>\r\n  {/if}\r\n  \r\n  <MeltSelect\r\n    options={normalizedOptions}\r\n    bind:value={primitiveValue}\r\n    {placeholder}\r\n    {disabled}\r\n    {required}\r\n    {name}\r\n    id={selectId}\r\n    onValueChange={handleValueChange}\r\n    onBlur={handleBlur}\r\n    triggerClass={triggerClasses}\r\n    aria-describedby={describedBy}\r\n    class=\"\"\r\n    menuClass=\"z-[var(--z-50,50)] max-h-60 w-full overflow-auto rounded-[length:var(--radius-lg)] bg-[color:var(--surface-base)] border border-[color:var(--border-subtle)] shadow-[var(--shadow-lg)] py-[var(--space-1)] focus:outline-none\"\r\n    optionClass=\"relative w-full cursor-pointer select-none px-[var(--space-3)] py-[var(--space-2)] text-[length:var(--text-sm)] text-[color:var(--text-primary)] hover:bg-[color:var(--surface-subtle)] focus:bg-[color:var(--surface-muted)] focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed min-h-[length:var(--touch-standard)] flex items-center transition-colors duration-[var(--duration-base)]\"\r\n  >\r\n    {#if children}\r\n      {@render children()}\r\n    {/if}\r\n  </MeltSelect>\r\n\r\n  {#if description}\r\n    <p id={descriptionId} class=\"text-sm text-[color:var(--text-muted)]\">\r\n      {description}\r\n    </p>\r\n  {/if}\r\n\r\n  {#if error}\r\n    <p id={errorId} class=\"text-sm text-[color:var(--status-error-text)]\" role=\"alert\">{error}</p>\r\n  {/if}\r\n</div>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\SizeSelector.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\forms\\TagInput.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\layout\\CategoryBottomSheet.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\layout\\Container.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\layout\\Footer.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":24,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import * as i18n from '@repo/i18n';\r\n  import type { FooterProps } from '../../types/panels';\r\n\r\n  let {\r\n    currentLanguage = 'en',\r\n    onLanguageChange\r\n  }: FooterProps = $props();\r\n\r\n  let email = $state('');\r\n  let isSubscribing = $state(false);\r\n\r\n  async function handleNewsletterSubmit() {\r\n    if (!email.trim()) return;\r\n    \r\n    isSubscribing = true;\r\n    \r\n    try {\r\n      await new Promise(resolve => setTimeout(resolve, 1000)); // Simulate API call\r\n      \r\n      // Show success message\r\n      email = '';\r\n      // Could dispatch success event here\r\n    } catch (error) {\r\n      \r\n    } finally {\r\n      isSubscribing = false;\r\n    }\r\n  }\r\n</script>\r\n\r\n<footer class=\"bg-white border-t border-gray-200 mt-auto\">\r\n  <!-- Main Footer Content -->\r\n  <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12\">\r\n    <div class=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8\">\r\n      \r\n      <!-- Company -->\r\n      <div class=\"space-y-4\">\r\n        <h3 class=\"text-sm font-semibold text-gray-900 uppercase tracking-wider\">\r\n          {i18n.footer_company()}\r\n        </h3>\r\n        <ul class=\"space-y-2\">\r\n          <li>\r\n            <a \r\n              href=\"/about\" \r\n              class=\"text-sm text-gray-500 hover:text-gray-900 transition-colors\"\r\n            >\r\n              {i18n.footer_about()}\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a \r\n              href=\"/careers\" \r\n              class=\"text-sm text-gray-500 hover:text-gray-900 transition-colors\"\r\n            >\r\n              {i18n.footer_careers()}\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a \r\n              href=\"/press\" \r\n              class=\"text-sm text-gray-500 hover:text-gray-900 transition-colors\"\r\n            >\r\n              {i18n.footer_press()}\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a \r\n              href=\"/blog\" \r\n              class=\"text-sm text-gray-500 hover:text-gray-900 transition-colors\"\r\n            >\r\n              {i18n.footer_blog()}\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n\r\n      <!-- Support -->\r\n      <div class=\"space-y-4\">\r\n        <h3 class=\"text-sm font-semibold text-gray-900 uppercase tracking-wider\">\r\n          {i18n.footer_support()}\r\n        </h3>\r\n        <ul class=\"space-y-2\">\r\n          <li>\r\n            <a \r\n              href=\"/help\" \r\n              class=\"text-sm text-gray-500 hover:text-gray-900 transition-colors\"\r\n            >\r\n              {i18n.footer_help()}\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a \r\n              href=\"/trust-safety\" \r\n              class=\"text-sm text-gray-500 hover:text-gray-900 transition-colors\"\r\n            >\r\n              {i18n.footer_trustSafety()}\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a \r\n              href=\"/returns\" \r\n              class=\"text-sm text-gray-500 hover:text-gray-900 transition-colors\"\r\n            >\r\n              {i18n.footer_returns()}\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n\r\n      <!-- Legal -->\r\n      <div class=\"space-y-4\">\r\n        <h3 class=\"text-sm font-semibold text-gray-900 uppercase tracking-wider\">\r\n          {i18n.footer_legal()}\r\n        </h3>\r\n        <ul class=\"space-y-2\">\r\n          <li>\r\n            <a \r\n              href=\"/privacy\" \r\n              class=\"text-sm text-gray-500 hover:text-gray-900 transition-colors\"\r\n            >\r\n              {i18n.footer_privacy()}\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a \r\n              href=\"/terms\" \r\n              class=\"text-sm text-gray-500 hover:text-gray-900 transition-colors\"\r\n            >\r\n              {i18n.footer_terms()}\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a \r\n              href=\"/privacy/cookies\" \r\n              class=\"text-sm text-gray-500 hover:text-gray-900 transition-colors\"\r\n            >\r\n              {i18n.footer_cookies()}\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n\r\n      <!-- Newsletter & Social -->\r\n      <div class=\"space-y-4\">\r\n        <h3 class=\"text-sm font-semibold text-gray-900 uppercase tracking-wider\">\r\n          {i18n.footer_newsletter()}\r\n        </h3>\r\n        \r\n        <!-- Newsletter Signup -->\r\n        <form onsubmit={handleNewsletterSubmit} class=\"space-y-3\">\r\n          <div class=\"flex gap-2\">\r\n            <input\r\n              bind:value={email}\r\n              type=\"email\"\r\n              placeholder={i18n.footer_newsletterPlaceholder()}\r\n              class=\"flex-1 min-h-[36px] px-3 py-2 text-sm border border-gray-200 rounded-lg \r\n                     focus:ring-2 focus:ring-black focus:border-transparent transition-colors\"\r\n              disabled={isSubscribing}\r\n            />\r\n            <button\r\n              type=\"submit\"\r\n              disabled={!email.trim() || isSubscribing}\r\n              class=\"min-h-[36px] px-4 py-2 bg-black text-white text-sm font-medium rounded-lg\r\n                     hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed \r\n                     transition-colors flex items-center justify-center\"\r\n            >\r\n              {#if isSubscribing}\r\n                <svg class=\"animate-spin w-4 h-4\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                  <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\r\n                  <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                </svg>\r\n              {:else}\r\n                {i18n.footer_subscribe()}\r\n              {/if}\r\n            </button>\r\n          </div>\r\n        </form>\r\n\r\n        <!-- Social Media -->\r\n        <div class=\"space-y-3\">\r\n          <h4 class=\"text-sm font-medium text-gray-900\">{i18n.footer_followUs()}</h4>\r\n          <div class=\"flex space-x-3\">\r\n            <a \r\n              href=\"https://instagram.com/driplo.xyz\" \r\n              class=\"w-8 h-8 bg-white rounded-lg flex items-center justify-center \r\n                     hover:bg-white transition-colors group\"\r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n              aria-label=\"Instagram\"\r\n            >\r\n              <svg class=\"w-4 h-4 text-gray-500 group-hover:text-gray-900\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path d=\"M12.017 0C8.396 0 7.929.013 6.71.072 5.493.131 4.73.33 4.058.63c-.692.3-1.281.72-1.866 1.305-.585.585-1.006 1.174-1.305 1.866-.3.672-.499 1.435-.558 2.652C.013 7.929 0 8.396 0 12.017s.013 4.088.072 5.307c.059 1.217.258 1.98.558 2.652.3.692.72 1.281 1.305 1.866.585.585 1.174 1.006 1.866 1.305.672.3 1.435.499 2.652.558 1.219.059 1.686.072 5.307.072s4.088-.013 5.307-.072c1.217-.059 1.98-.258 2.652-.558.692-.3 1.281-.72 1.866-1.305.585-.585 1.006-1.174 1.305-1.866.3-.672.499-1.435.558-2.652.059-1.219.072-1.686.072-5.307s-.013-4.088-.072-5.307c-.059-1.217-.258-1.98-.558-2.652C21.36 2.437 20.94 1.848 20.355 1.263S18.462.632 17.77.33c-.672-.3-1.435-.499-2.652-.558C13.899.013 13.432 0 12.017 0zm0 2.167c3.555 0 3.977.012 5.378.07 1.297.059 2.001.277 2.47.46.62.24 1.062.527 1.527.992.465.465.752.907.992 1.527.183.469.401 1.173.46 2.47.058 1.401.07 1.823.07 5.378s-.012 3.977-.07 5.378c-.059 1.297-.277 2.001-.46 2.47-.24.62-.527 1.062-.992 1.527-.465.465-.907.752-1.527.992-.469.183-1.173.401-2.47.46-1.401.058-1.823.07-5.378.07s-3.977-.012-5.378-.07c-1.297-.059-2.001-.277-2.47-.46-.62-.24-1.062-.527-1.527-.992-.465-.465-.752-.907-.992-1.527-.183-.469-.401-1.173-.46-2.47C2.179 15.994 2.167 15.572 2.167 12.017s.012-3.977.07-5.378c.059-1.297.277-2.001.46-2.47.24-.62.527-1.062.992-1.527.465-.465.907-.752 1.527-.992.469-.183 1.173-.401 2.47-.46 1.401-.058 1.823-.07 5.378-.07z\"/>\r\n                <path d=\"M12.017 5.838a6.179 6.179 0 100 12.358 6.179 6.179 0 000-12.358zm0 10.191a4.012 4.012 0 110-8.024 4.012 4.012 0 010 8.024z\"/>\r\n                <circle cx=\"18.406\" cy=\"5.594\" r=\"1.444\"/>\r\n              </svg>\r\n            </a>\r\n            \r\n            <a \r\n              href=\"https://twitter.com/driplo_xyz\" \r\n              class=\"w-8 h-8 bg-white rounded-lg flex items-center justify-center \r\n                     hover:bg-white transition-colors group\"\r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n              aria-label=\"Twitter\"\r\n            >\r\n              <svg class=\"w-4 h-4 text-gray-500 group-hover:text-gray-900\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path d=\"M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z\"/>\r\n              </svg>\r\n            </a>\r\n            \r\n            <a \r\n              href=\"https://facebook.com/driplo.xyz\" \r\n              class=\"w-8 h-8 bg-white rounded-lg flex items-center justify-center \r\n                     hover:bg-white transition-colors group\"\r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n              aria-label=\"Facebook\"\r\n            >\r\n              <svg class=\"w-4 h-4 text-gray-500 group-hover:text-gray-900\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path d=\"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z\"/>\r\n              </svg>\r\n            </a>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Bottom Bar -->\r\n  <div class=\"border-t border-gray-200\">\r\n    <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\r\n      <div class=\"flex flex-col sm:flex-row justify-between items-center space-y-3 sm:space-y-0\">\r\n        \r\n        <!-- Copyright -->\r\n        <div class=\"flex flex-col sm:flex-row items-center space-y-1 sm:space-y-0 sm:space-x-2\">\r\n          <div class=\"flex items-center space-x-2 text-sm text-gray-500\">\r\n            <span>© {new Date().getFullYear()} Driplo.</span>\r\n            <span>{i18n.footer_allRightsReserved()}</span>\r\n          </div>\r\n          <div class=\"flex items-center space-x-1 text-sm text-gray-500\">\r\n            <span>{i18n.footer_madeWith()}</span>\r\n            <span class=\"text-red-500\">❤️</span>\r\n            <span>{i18n.footer_in()}</span>\r\n            <span class=\"font-medium\">{i18n.footer_bulgaria()} 🇧🇬</span>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Language Switcher (Mobile Only) -->\r\n        {#if onLanguageChange}\r\n          <div class=\"sm:hidden\">\r\n            <select \r\n              value={currentLanguage}\r\n              onchange={(e: Event & { currentTarget: EventTarget & HTMLSelectElement }) => onLanguageChange?.(e.currentTarget.value)}\r\n              class=\"text-sm border border-gray-200 rounded-lg px-3 py-1 bg-white\r\n                     focus:ring-2 focus:ring-black focus:border-transparent\"\r\n            >\r\n              <option value=\"en\">🇬🇧 English</option>\r\n              <option value=\"bg\">🇧🇬 Български</option>\r\n            </select>\r\n          </div>\r\n        {/if}\r\n        \r\n        <!-- Logo/Branding -->\r\n        <div class=\"flex items-center space-x-4\">\r\n          <div class=\"flex items-center space-x-2\">\r\n            <div class=\"w-6 h-6 bg-black rounded-md flex items-center justify-center\">\r\n              <span class=\"text-white font-bold text-xs\">D</span>\r\n            </div>\r\n            <span class=\"font-bold text-gray-900 text-sm\">Driplo</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</footer>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\layout\\HStack.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\layout\\NotificationPanel.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\layout\\SoldNotificationPanel.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\layout\\Stack.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\media\\ImageUploader.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":96,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":119,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":119,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  interface Props {\n    images?: string[];\n    maxImages?: number;\n    maxSize?: number; // in MB\n    acceptedFormats?: string[];\n    onImagesChange?: (images: string[]) => void;\n    onError?: (error: string) => void;\n    disabled?: boolean;\n    convertToWebP?: boolean; // Auto-convert to WebP for listings\n    webpQuality?: number; // WebP quality (0-1)\n    maxDimensions?: { width: number; height: number }; // Max dimensions for resize\n    class?: string;\n  }\n\n  let { \n    images = [],\n    maxImages = 10,\n    maxSize = 10, // 10MB default\n    acceptedFormats = ['image/jpeg', 'image/png', 'image/webp'],\n    onImagesChange,\n    onError,\n    disabled = false,\n    convertToWebP = true, // Default to true for listings\n    webpQuality = 0.85, // High quality WebP\n    maxDimensions = { width: 1920, height: 1920 }, // Max dimensions for listings\n    class: className = ''\n  }: Props = $props();\n\n  let fileInput: HTMLInputElement;\n  let dragOver = $state(false);\n  let uploading = $state(false);\n\n  function handleFileSelect(event: Event) {\n    const target = event.target as HTMLInputElement;\n    if (target.files) {\n      handleFiles(Array.from(target.files));\n    }\n  }\n\n  function handleDrop(event: DragEvent) {\n    event.preventDefault();\n    dragOver = false;\n    \n    if (disabled) return;\n    \n    const files = event.dataTransfer?.files;\n    if (files) {\n      handleFiles(Array.from(files));\n    }\n  }\n\n  function handleDragOver(event: DragEvent) {\n    event.preventDefault();\n    if (!disabled) {\n      dragOver = true;\n    }\n  }\n\n  function handleDragLeave() {\n    dragOver = false;\n  }\n\n  async function handleFiles(files: File[]) {\n    if (images.length + files.length > maxImages) {\n      onError?.(`You can only upload up to ${maxImages} images`);\n      return;\n    }\n\n    uploading = true;\n    const newImages: string[] = [];\n\n    try {\n      for (const file of files) {\n        // Validate file type\n        if (!acceptedFormats.includes(file.type)) {\n          onError?.(`File ${file.name} is not a supported format`);\n          continue;\n        }\n\n        // Validate file size\n        if (file.size > maxSize * 1024 * 1024) {\n          onError?.(`File ${file.name} is too large. Max size is ${maxSize}MB`);\n          continue;\n        }\n\n        // Convert to base64 or create object URL\n        const imageUrl = await processImage(file);\n        newImages.push(imageUrl);\n      }\n\n      if (newImages.length > 0) {\n        const updatedImages = [...images, ...newImages];\n        onImagesChange?.(updatedImages);\n      }\n    } catch (error) {\n      onError?.('Failed to process images');\n    } finally {\n      uploading = false;\n    }\n  }\n\n  async function processImage(file: File): Promise<string> {\n    if (convertToWebP && file.type !== 'image/webp') {\n      try {\n        const webpBlob = await convertToWebPFormat(file);\n        return new Promise((resolve, reject) => {\n          const reader = new FileReader();\n          reader.onload = () => {\n            if (typeof reader.result === 'string') {\n              resolve(reader.result);\n            } else {\n              reject(new Error('Failed to read WebP file'));\n            }\n          };\n          reader.onerror = () => reject(new Error('Failed to read WebP file'));\n          reader.readAsDataURL(webpBlob);\n        });\n      } catch (error) {\n        // WebP conversion failed, using original\n      }\n    }\n    \n    // Original processing or fallback\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => {\n        if (typeof reader.result === 'string') {\n          resolve(reader.result);\n        } else {\n          reject(new Error('Failed to read file'));\n        }\n      };\n      reader.onerror = () => reject(new Error('Failed to read file'));\n      reader.readAsDataURL(file);\n    });\n  }\n\n  async function convertToWebPFormat(file: File): Promise<Blob> {\n    return new Promise((resolve, reject) => {\n      const img = new Image();\n      const canvas = document.createElement('canvas');\n      const ctx = canvas.getContext('2d');\n      \n      if (!ctx) {\n        reject(new Error('Cannot get canvas context'));\n        return;\n      }\n\n      img.onload = () => {\n        // Calculate dimensions with max constraints\n        let { width, height } = img;\n        \n        if (maxDimensions) {\n          const aspectRatio = width / height;\n          if (width > maxDimensions.width) {\n            width = maxDimensions.width;\n            height = width / aspectRatio;\n          }\n          if (height > maxDimensions.height) {\n            height = maxDimensions.height;\n            width = height * aspectRatio;\n          }\n        }\n        \n        canvas.width = width;\n        canvas.height = height;\n        \n        // Draw and convert to WebP\n        ctx.drawImage(img, 0, 0, width, height);\n        \n        canvas.toBlob(\n          (blob) => {\n            if (blob) {\n              resolve(blob);\n            } else {\n              reject(new Error('WebP conversion failed'));\n            }\n          },\n          'image/webp',\n          webpQuality\n        );\n        \n        // Clean up\n        URL.revokeObjectURL(img.src);\n      };\n      \n      img.onerror = () => {\n        URL.revokeObjectURL(img.src);\n        reject(new Error('Failed to load image'));\n      };\n      \n      img.src = URL.createObjectURL(file);\n    });\n  }\n\n  function removeImage(index: number) {\n    const updatedImages = images.filter((_, i) => i !== index);\n    onImagesChange?.(updatedImages);\n  }\n\n  function reorderImages(fromIndex: number, toIndex: number) {\n    const updatedImages = [...images];\n    const [movedItem] = updatedImages.splice(fromIndex, 1);\n    updatedImages.splice(toIndex, 0, movedItem);\n    onImagesChange?.(updatedImages);\n  }\n\n  function openFileDialog() {\n    if (!disabled) {\n      fileInput?.click();\n    }\n  }\n</script>\n\n<div class=\"image-uploader {className}\">\n  <!-- Hidden file input -->\n  <input\n    bind:this={fileInput}\n    type=\"file\"\n    multiple\n    accept={acceptedFormats.join(',')}\n    onchange={handleFileSelect}\n    class=\"hidden\"\n    {disabled}\n  />\n\n  <!-- Image Grid -->\n  {#if images.length > 0}\n    <div class=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 mb-4\">\n      {#each images as image, index}\n        <div class=\"relative group\">\n          <img\n            src={image}\n            alt=\"Upload {index + 1}\"\n            class=\"w-full aspect-square object-cover rounded-lg border border-gray-200\"\n          />\n          \n          <!-- Image Controls -->\n          <div class=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 \n            transition-opacity rounded-lg flex items-center justify-center space-x-2\">\n            \n            <!-- Move Left -->\n            {#if index > 0}\n              <button\n                onclick={() => reorderImages(index, index - 1)}\n                aria-label=\"Move image left\"\n                class=\"p-1.5 bg-white/20 hover:bg-white/30 rounded-full text-white\"\n                title=\"Move left\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 19l-7-7 7-7\" />\n                </svg>\n              </button>\n            {/if}\n\n            <!-- Delete -->\n            <button\n              onclick={() => removeImage(index)}\n              aria-label=\"Remove image\"\n              class=\"p-1.5 bg-red-500/80 hover:bg-red-500 rounded-full text-white\"\n              title=\"Remove image\"\n            >\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n              </svg>\n            </button>\n\n            <!-- Move Right -->\n            {#if index < images.length - 1}\n              <button\n                onclick={() => reorderImages(index, index + 1)}\n                aria-label=\"Move image right\"\n                class=\"p-1.5 bg-white/20 hover:bg-white/30 rounded-full text-white\"\n                title=\"Move right\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\" />\n                </svg>\n              </button>\n            {/if}\n          </div>\n\n          <!-- Primary Badge -->\n          {#if index === 0}\n            <div class=\"absolute top-2 left-2 bg-blue-500 text-white text-xs px-2 py-1 rounded-full font-medium\">\n              Primary\n            </div>\n          {/if}\n        </div>\n      {/each}\n    </div>\n  {/if}\n\n  <!-- Upload Area -->\n  {#if images.length < maxImages}\n    <button\n      class=\"w-full border-2 border-dashed rounded-lg p-6 text-center transition-colors\n        {dragOver ? 'border-blue-400 bg-blue-50' : 'border-gray-300'}\n        {disabled ? 'opacity-50 cursor-not-allowed' : 'hover:border-gray-400 cursor-pointer'}\"\n      ondrop={handleDrop}\n      ondragover={handleDragOver}\n      ondragleave={handleDragLeave}\n      onclick={openFileDialog}\n      onkeydown={(e: KeyboardEvent) => e.key === 'Enter' && openFileDialog()}\n      aria-label=\"Upload images\"\n      {disabled}\n    >\n      {#if uploading}\n        <div class=\"flex flex-col items-center\">\n          <div class=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mb-2\"></div>\n          <p class=\"text-sm text-gray-500\">Uploading images...</p>\n        </div>\n      {:else}\n        <div class=\"flex flex-col items-center\">\n          <svg class=\"w-12 h-12 text-gray-400 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\" />\n          </svg>\n          \n          <h3 class=\"text-lg font-medium text-gray-900 mb-1\">\n            {images.length === 0 ? 'Add photos' : 'Add more photos'}\n          </h3>\n          \n          <p class=\"text-sm text-gray-500 mb-4\">\n            Drag & drop images here, or click to browse\n          </p>\n          \n          <div class=\"text-xs text-gray-500 space-y-1\">\n            <p>Up to {maxImages} images, max {maxSize}MB each</p>\n            <p>Supported: JPG, PNG, WebP</p>\n            {#if convertToWebP}\n              <p class=\"text-green-600 font-medium\">✓ Auto-converted to WebP for optimal quality</p>\n            {/if}\n            {#if images.length === 0}\n              <p class=\"text-blue-600 font-medium\">First image will be the main photo</p>\n            {/if}\n          </div>\n        </div>\n      {/if}\n    </button>\n  {/if}\n\n  <!-- Image Count -->\n  {#if images.length > 0}\n    <div class=\"flex items-center justify-between mt-3 text-sm text-gray-500\">\n      <span>{images.length} of {maxImages} images</span>\n      {#if images.length > 1}\n        <span class=\"text-xs\">Drag images to reorder</span>\n      {/if}\n    </div>\n  {/if}\n</div>\n\n<style>\n  .image-uploader {\n    /* Component styles */\n  }\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\media\\ImageUploaderSupabase.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":131,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":131,"endColumn":21},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":135,"column":12,"nodeType":"BlockStatement","messageId":"unexpected","endLine":137,"endColumn":6,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4903,4915],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":280,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":280,"endColumn":21},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":319,"column":69,"nodeType":"BlockStatement","messageId":"unexpected","endLine":321,"endColumn":16,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[11312,11344],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'innerError' is defined but never used.","line":324,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":324,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":334,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":334,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleKeyDown' is defined but never used. Allowed unused vars must match /^_/u.","line":348,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":348,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  // Svelte 5 implementation with WebP enforcement\n  interface UploadedImage {\n    url: string;\n    path: string;\n  }\n\n  interface Props {\n    id?: string;\n    images?: UploadedImage[];\n    maxImages?: number;\n    error?: string;\n    helpText?: string;\n    onUpload: (files: File[]) => Promise<UploadedImage[]>;\n    onDelete?: (path: string) => Promise<boolean>;\n    uploading?: boolean;\n    acceptedFormats?: string;\n    maxFileSize?: number; // in MB\n    // Translation props\n    uploadingImagesText?: string;\n    imagesOptimizedText?: string;\n    dropHereText?: string;\n    addPhotoText?: string;\n    coverText?: string;\n    removeImageText?: string;\n    photosUploadedText?: (count: number) => string;\n    moreAllowedText?: (count: number) => string;\n    optimizedForWebText?: string;\n  }\n\n  // Svelte 5 props with proper typing\n  let { \n    id = 'image-uploader',\n    images = $bindable([]),\n    maxImages = 10,\n    error = '',\n    helpText = 'Upload JPG/PNG images (optimized automatically)',\n    onUpload,\n    onDelete,\n    uploading = $bindable(false),\n    // Android fix: Use wildcard for better compatibility\n    acceptedFormats = 'image/*',\n    maxFileSize = 10,\n    // Translation props with defaults\n    uploadingImagesText = 'Uploading images...',\n    imagesOptimizedText = 'Images will be optimized automatically on our servers',\n    dropHereText = 'Drop Here',\n    addPhotoText = 'Add Photo',\n    coverText = 'Cover',\n    removeImageText = 'Remove image',\n    photosUploadedText = (count: number) => `${count} photo${count === 1 ? '' : 's'} uploaded`,\n    moreAllowedText = (count: number) => `${count} more allowed`,\n    optimizedForWebText = 'Optimized for web'\n  }: Props = $props();\n\n  // State using $state rune\n  let fileInput: HTMLInputElement;\n  let isDragging = $state(false);\n  let isProcessing = $state(false);\n  let conversionProgress = $state({ current: 0, total: 0 });\n  let currentError = $state('');\n  let failedFiles = $state<File[]>([]);\n  let retryAttempts = $state(0);\n\n  // Derived states using $derived\n  const remainingSlots = $derived(maxImages - images.length);\n  const canUploadMore = $derived(remainingSlots > 0 && !uploading && !isProcessing);\n  const hasError = $derived(error || currentError);\n\n  // Enhanced file validation with user-friendly messages\n  function validateFiles(files: File[]): string | null {\n    for (const file of files) {\n      // Check file type with specific guidance\n      if (!file.type.startsWith('image/')) {\n        const fileExt = file.name.split('.').pop()?.toLowerCase();\n        if (fileExt && ['pdf', 'doc', 'docx', 'txt'].includes(fileExt)) {\n          return `\"${file.name}\" is a document file. Please upload photos of your item instead.`;\n        } else if (fileExt && ['mp4', 'mov', 'avi', 'mkv'].includes(fileExt)) {\n          return `\"${file.name}\" is a video file. Please upload photos instead, or take screenshots from your video.`;\n        } else {\n          return `\"${file.name}\" is not a supported image format. Please use JPG, PNG, or WEBP images.`;\n        }\n      }\n      \n      // Check file size with helpful suggestions\n      if (file.size > maxFileSize * 1024 * 1024) {\n        const fileSizeMB = Math.round(file.size / (1024 * 1024) * 10) / 10;\n        if (fileSizeMB > 50) {\n          return `\"${file.name}\" is ${fileSizeMB}MB, which is very large. Try taking a new photo with your phone camera instead of using saved images.`;\n        } else {\n          return `\"${file.name}\" is ${fileSizeMB}MB (max ${maxFileSize}MB). Try compressing the image or taking a new photo.`;\n        }\n      }\n      \n      // Check for corrupted or empty files\n      if (file.size === 0) {\n        return `\"${file.name}\" appears to be empty or corrupted. Please try selecting the file again.`;\n      }\n    }\n    \n    // Check if total would exceed limit with context\n    if (files.length > remainingSlots) {\n      const trying = files.length;\n      const allowed = remainingSlots;\n      if (allowed === 0) {\n        return `You've reached the maximum of ${maxImages} photos. Remove some photos to add new ones.`;\n      } else {\n        return `You selected ${trying} photos, but can only add ${allowed} more. You can upload up to ${maxImages} photos total.`;\n      }\n    }\n    \n    return null;\n  }\n\n  // File selection handler - Enhanced for Android compatibility\n  async function handleFileSelect(event: Event) {\n    const input = event.target as HTMLInputElement;\n    \n    \n    if (input.files && input.files.length > 0) {\n      const files = Array.from(input.files);\n      \n      \n      await processFiles(files);\n      \n      // Clear input to allow re-selecting same files (Android fix)\n      try {\n        input.value = '';\n        input.type = '';\n        input.type = 'file';\n      } catch (error) {\n        // Fallback if above doesn't work on some Android browsers\n        \n      }\n    } else {\n      \n    }\n  }\n\n  // Drag and drop handlers\n  function handleDragOver(event: DragEvent) {\n    event.preventDefault();\n    if (canUploadMore) {\n      isDragging = true;\n    }\n  }\n\n  function handleDragLeave(event: DragEvent) {\n    event.preventDefault();\n    // Only stop dragging if we're leaving the main container\n    const currentTarget = event.currentTarget as HTMLElement | null;\n    const relatedTarget = event.relatedTarget as Node | null;\n\n    if (!currentTarget || !relatedTarget || !currentTarget.contains(relatedTarget)) {\n      isDragging = false;\n    }\n  }\n\n  async function handleDrop(event: DragEvent) {\n    event.preventDefault();\n    isDragging = false;\n    \n    if (!canUploadMore || !event.dataTransfer?.files) {\n      return;\n    }\n    \n    await processFiles(Array.from(event.dataTransfer.files));\n  }\n\n  // Main file processing function\n  async function processFiles(newFiles: File[]) {\n    \n    \n    // Clear any previous errors\n    currentError = '';\n    \n    // Validate files\n    const validationError = validateFiles(newFiles);\n    if (validationError) {\n      currentError = validationError;\n      return;\n    }\n\n    // Filter to only image files\n    const imageFiles = newFiles.filter(file => file.type.startsWith('image/'));\n    \n    if (imageFiles.length === 0) {\n      currentError = 'No valid image files found';\n      return;\n    }\n\n    \n    \n    // Set processing state\n    isProcessing = true;\n    conversionProgress = { current: 0, total: imageFiles.length };\n\n    try {\n      \n      \n      // Call the upload function provided by parent\n      const uploadedImages = await onUpload(imageFiles);\n      \n      \n      \n      // Check if all files were uploaded successfully\n      if (uploadedImages.length === 0) {\n        throw new Error('No images were uploaded successfully. Please check your internet connection and try again.');\n      } else if (uploadedImages.length < imageFiles.length) {\n        currentError = `Only ${uploadedImages.length} of ${imageFiles.length} images uploaded successfully. Some may have been too large or corrupted.`;\n      }\n      \n      // Add successfully uploaded images\n      images = [...images, ...uploadedImages];\n      \n      \n    } catch (error) {\n      \n      failedFiles = imageFiles; // Store failed files for retry\n      retryAttempts++;\n      \n      // Provide specific user-friendly error messages\n      if (error instanceof Error) {\n        const errorMsg = error.message.toLowerCase();\n        if (errorMsg.includes('network') || errorMsg.includes('fetch')) {\n          currentError = retryAttempts < 3 \n            ? 'Upload failed due to network issues. Click \"Try Again\" or check your internet connection.' \n            : 'Upload failed multiple times due to network issues. Please check your internet connection and try again later.';\n        } else if (errorMsg.includes('token') || errorMsg.includes('auth')) {\n          currentError = 'Upload failed due to authentication issues. Please refresh the page and try again.';\n        } else if (errorMsg.includes('size') || errorMsg.includes('large')) {\n          currentError = 'One or more images are too large to upload. Try using smaller images or taking new photos.';\n        } else if (errorMsg.includes('format') || errorMsg.includes('type')) {\n          currentError = 'One or more files are in an unsupported format. Please use JPG, PNG, or WEBP images only.';\n        } else if (errorMsg.includes('quota') || errorMsg.includes('limit')) {\n          currentError = 'Upload failed due to storage limits. Please contact support if this continues.';\n        } else if (errorMsg.includes('timeout')) {\n          currentError = 'Upload timed out. This usually happens with very large images or slow connections. Try again with smaller images.';\n        } else {\n          currentError = retryAttempts < 3 \n            ? `Upload failed: ${error.message}. Click \"Try Again\" or contact support if the problem persists.` \n            : `Upload failed multiple times: ${error.message}. Please contact support.`;\n        }\n      } else {\n        currentError = retryAttempts < 3 \n          ? 'Upload failed due to an unknown error. Click \"Try Again\" below or contact support if the problem continues.' \n          : 'Upload failed multiple times due to unknown errors. Please contact support.';\n      }\n    } finally {\n      isProcessing = false;\n      conversionProgress = { current: 0, total: 0 };\n    }\n  }\n\n  // Retry failed upload\n  async function retryUpload() {\n    if (failedFiles.length > 0) {\n      currentError = '';\n      await processFiles(failedFiles);\n    }\n  }\n\n  // Image removal handler\n  async function removeImage(index: number) {\n    const image = images[index];\n    \n    \n    // Optimistic update - remove immediately from UI\n    const originalImages = [...images];\n    images = images.filter((_, i) => i !== index);\n    \n    if (onDelete) {\n      try {\n        const deleted = await onDelete(image.path);\n        if (!deleted) {\n          // Restore image if deletion failed\n          images = originalImages;\n          currentError = 'Failed to delete image';\n        }\n      } catch (error) {\n        \n        // Restore image on error\n        images = originalImages;\n        currentError = 'Failed to delete image';\n      }\n    }\n  }\n\n  // Trigger file input - Enhanced for mobile/Android with detailed error handling\n  function triggerFileInput() {\n    if (!canUploadMore) {\n      if (remainingSlots === 0) {\n        currentError = `You've reached the maximum of ${maxImages} photos. Remove some photos to add more.`;\n      } else if (uploading) {\n        currentError = 'Please wait for current upload to finish before adding more photos.';\n      }\n      return;\n    }\n    \n    currentError = '';\n    \n    \n    // Detect user agent for specific Android handling\n    const isAndroid = /Android/i.test(navigator.userAgent);\n    const isMobile = /Mobi|Android/i.test(navigator.userAgent);\n    \n    try {\n      if (isAndroid || isMobile) {\n        // Android-specific handling with longer delay\n        \n        setTimeout(() => {\n          try {\n            // Try multiple methods for Android compatibility\n            fileInput.focus();\n            fileInput.click();\n            \n            // Fallback: trigger the input change event manually\n            setTimeout(() => {\n              if (!fileInput.files || fileInput.files.length === 0) {\n                \n              }\n            }, 1000);\n            \n          } catch (innerError) {\n            \n            currentError = 'Camera/gallery access failed. Please check app permissions and try again.';\n          }\n        }, 150);\n      } else {\n        // Desktop handling\n        fileInput.focus();\n        fileInput.click();\n      }\n    } catch (error) {\n      \n      \n      if (isAndroid) {\n        currentError = 'Unable to access camera/gallery. Please check that Driplo has permission to access your photos, then try again.';\n      } else if (isMobile) {\n        currentError = 'Unable to open file picker. Please try using a different browser or check your browser permissions.';\n      } else {\n        currentError = 'Unable to open file picker. Please try again or use a different browser.';\n      }\n    }\n  }\n\n  // Handle keyboard interaction\n  function handleKeyDown(event: KeyboardEvent) {\n    if (event.key === 'Enter' || event.key === ' ') {\n      event.preventDefault();\n      triggerFileInput();\n    }\n  }\n</script>\n\n<div class=\"w-full space-y-4\">\n  <!-- Upload progress -->\n  {#if uploading || isProcessing}\n    <div class=\"p-4 bg-blue-50 rounded-lg border border-blue-200\">\n      <div class=\"flex items-center justify-between mb-2\">\n        <span class=\"text-sm font-medium text-blue-700\">\n          {uploadingImagesText}\n        </span>\n        {#if conversionProgress.total > 0}\n          <span class=\"text-sm text-blue-600\">\n            {conversionProgress.current}/{conversionProgress.total}\n          </span>\n        {/if}\n      </div>\n      <div class=\"w-full bg-blue-200 rounded-full h-2\">\n        <div \n          class=\"bg-blue-600 h-2 rounded-full transition-colors duration-300 ease-out\"\n          style=\"width: {conversionProgress.total > 0 ? (conversionProgress.current / conversionProgress.total) * 100 : 0}%\"\n        ></div>\n      </div>\n      <p class=\"text-xs text-blue-600 mt-2\">\n        {imagesOptimizedText}\n      </p>\n    </div>\n  {/if}\n\n  <!-- Image grid with upload area -->\n  <div \n    class=\"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3\"\n    ondrop={handleDrop}\n    ondragover={handleDragOver}\n    ondragleave={handleDragLeave}\n    role=\"application\"\n    aria-label=\"Image upload area with drag and drop support\"\n  >\n    <!-- Uploaded images -->\n    {#each images as image, index}\n      <div class=\"relative aspect-square group\">\n        <img \n          src={image.url} \n          alt={`Upload ${index + 1}`}\n          class=\"w-full h-full object-cover rounded-lg border border-gray-200\"\n          loading=\"lazy\"\n        />\n        \n        <!-- Cover badge for first image -->\n        {#if index === 0}\n          <div class=\"absolute top-1.5 left-1.5 bg-green-600 text-white text-xs px-2 py-0.5 rounded font-medium\">\n            {coverText}\n          </div>\n        {/if}\n        \n        <!-- Format badge -->\n        <div class=\"absolute top-1.5 right-1.5 bg-black/70 text-white text-xs px-1.5 py-0.5 rounded font-mono\">\n          {#if image.url.toLowerCase().endsWith('.webp')}\n            WebP\n          {:else if image.url.toLowerCase().includes('.jp')}\n            JPG\n          {:else}\n            IMG\n          {/if}\n        </div>\n        \n        <!-- Remove button -->\n        <button\n          type=\"button\"\n          onclick={() => removeImage(index)}\n          disabled={uploading || isProcessing}\n          class=\"absolute bottom-1.5 right-1.5 bg-red-500 hover:bg-red-600 text-white rounded-full p-1.5 min-w-[36px] min-h-[36px] flex items-center justify-center\n                 opacity-0 group-hover:opacity-100 transition-colors duration-200 \n                 disabled:opacity-50 disabled:cursor-not-allowed\"\n          aria-label={removeImageText}\n        >\n          <svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\n          </svg>\n        </button>\n      </div>\n    {/each}\n\n    <!-- Upload area -->\n    {#if canUploadMore}\n      <button\n        type=\"button\"\n        class=\"aspect-square border-2 border-dashed rounded-lg flex flex-col items-center justify-center \n               cursor-pointer transition-colors duration-200 w-full\n               {isDragging \n                 ? 'border-blue-500 bg-blue-50 scale-105' \n                 : 'border-gray-300 hover:border-gray-400 hover:bg-gray-50'}\"\n        onclick={triggerFileInput}\n        aria-label={addPhotoText}\n      >\n        <div class=\"flex flex-col items-center space-y-1\">\n          {#if isDragging}\n            <svg class=\"h-6 w-6 text-blue-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" \n                d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\" />\n            </svg>\n            <span class=\"text-xs text-blue-600 font-medium text-center px-1\">{dropHereText}</span>\n          {:else}\n            <svg class=\"h-6 w-6 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\" />\n            </svg>\n            <span class=\"text-xs text-gray-500 text-center px-1\">{addPhotoText}</span>\n          {/if}\n        </div>\n      </button>\n    {/if}\n  </div>\n\n  <!-- File input - Fixed for Android compatibility -->\n  <input\n    bind:this={fileInput}\n    {id}\n    type=\"file\"\n    accept={acceptedFormats}\n    multiple\n    class=\"sr-only\"\n    style=\"position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0;\"\n    onchange={handleFileSelect}\n    disabled={!canUploadMore}\n  />\n\n  <!-- Info and error messages -->\n  <div class=\"space-y-2\">\n    {#if hasError}\n      <div class=\"p-4 bg-red-50 border-l-4 border-red-400 rounded-r-lg\">\n        <div class=\"flex\">\n          <div class=\"flex-shrink-0\">\n            <svg class=\"h-5 w-5 text-red-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n              <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clip-rule=\"evenodd\" />\n            </svg>\n          </div>\n          <div class=\"ml-3 flex-1\">\n            <h3 class=\"text-sm font-medium text-red-800\">Upload Issue</h3>\n            <div class=\"mt-1 text-sm text-red-700\">\n              <p>{hasError}</p>\n            </div>\n            <!-- Action buttons for errors -->\n            <div class=\"mt-3 flex gap-2\">\n              <!-- Retry button for retryable errors -->\n              {#if failedFiles.length > 0 && retryAttempts < 3 && (hasError.includes('network') || hasError.includes('timeout') || hasError.includes('Try Again'))}\n                <button\n                  type=\"button\"\n                  class=\"text-xs bg-blue-600 text-white px-3 py-1.5 rounded-md hover:bg-blue-700 transition-colors\"\n                  onclick={retryUpload}\n                  disabled={isProcessing}\n                >\n                  {isProcessing ? 'Retrying...' : 'Try Again'}\n                </button>\n              {/if}\n              \n              <!-- Help button for complex errors -->\n              {#if hasError.includes('permission') || hasError.includes('Android') || hasError.includes('browser')}\n                <button\n                  type=\"button\"\n                  class=\"text-xs bg-red-100 text-red-800 px-3 py-1 rounded-full hover:bg-red-200 transition-colors\"\n                  onclick={() => {\n                    // Show help modal or instructions\n                    if (hasError.includes('permission')) {\n                      alert('To fix permissions on Android:\\n1. Open your browser settings\\n2. Find \"Site permissions\" or \"Privacy\"\\n3. Allow camera/storage access for driplo.xyz\\n4. Refresh the page and try again');\n                    } else if (hasError.includes('browser')) {\n                      alert('Try these steps:\\n1. Update your browser to the latest version\\n2. Try using Chrome or Firefox\\n3. Clear your browser cache\\n4. Try in incognito/private mode');\n                    }\n                  }}\n                >\n                  Need help?\n                </button>\n              {/if}\n            </div>\n          </div>\n          <!-- Dismiss button -->\n          <div class=\"ml-auto pl-3\">\n            <button\n              type=\"button\"\n              onclick={() => currentError = ''}\n              class=\"inline-flex rounded-md bg-red-50 p-1.5 text-red-400 hover:bg-red-100 focus:outline-none min-w-[36px] min-h-[36px]\"\n              aria-label=\"Dismiss error message\"\n            >\n              <svg class=\"h-3 w-3\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                <path fill-rule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clip-rule=\"evenodd\" />\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div>\n    {:else if helpText}\n      <div class=\"flex items-start space-x-2\">\n        <svg class=\"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n        </svg>\n        <p class=\"text-xs text-gray-500\">{helpText}</p>\n      </div>\n    {/if}\n\n    <!-- Upload stats -->\n    {#if images.length > 0}\n      <div class=\"flex items-center justify-between text-xs text-gray-500\">\n        <span>\n          {photosUploadedText(images.length)}\n          {#if remainingSlots > 0}\n            • {moreAllowedText(remainingSlots)}\n          {/if}\n        </span>\n        <span class=\"flex items-center\">\n          <span class=\"inline-block w-2 h-2 bg-green-500 rounded-full mr-1\"></span>\n          {optimizedForWebText}\n        </span>\n      </div>\n    {/if}\n  </div>\n\n</div>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\media\\LazyImage.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isIntersecting' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":32,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  // No lifecycle imports needed - using $effect\n\n  interface Props {\n    src: string;\n    alt: string;\n    class?: string;\n    width?: number;\n    height?: number;\n    loading?: 'lazy' | 'eager';\n    priority?: boolean;\n    fallback?: string;\n    placeholder?: string;\n  }\n\n  let {\n    src,\n    alt,\n    class: className = '',\n    width,\n    height,\n    loading = 'lazy',\n    priority = false,\n    fallback = '/placeholder-image.svg',\n    placeholder = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIwIiBoZWlnaHQ9IjMyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+'\n  }: Props = $props();\n\n  let imgElement: HTMLImageElement;\n  let isLoaded = $state(false);\n  let isError = $state(false);\n  let currentSrc = $state(placeholder);\n  let isIntersecting = $state(false);\n\n  // Load image immediately if priority is true or loading is eager\n  let shouldLoadImmediately = priority || loading === 'eager';\n\n  $effect(() => {\n    if (shouldLoadImmediately) {\n      loadImage();\n      return;\n    }\n\n    // Set up intersection observer for lazy loading\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            isIntersecting = true;\n            loadImage();\n            observer.unobserve(entry.target);\n          }\n        });\n      },\n      {\n        rootMargin: '50px', // Start loading 50px before the image enters viewport\n        threshold: 0.1\n      }\n    );\n\n    if (imgElement) {\n      observer.observe(imgElement);\n    }\n\n    return () => {\n      if (imgElement) {\n        observer.unobserve(imgElement);\n      }\n      observer.disconnect();\n    };\n  });\n\n  function loadImage() {\n    const img = new Image();\n\n    img.onload = () => {\n      currentSrc = src;\n      isLoaded = true;\n      isError = false;\n    };\n\n    img.onerror = () => {\n      currentSrc = fallback;\n      isError = true;\n      isLoaded = true;\n    };\n\n    // Set sizes for responsive images\n    if (width && height) {\n      img.width = width;\n      img.height = height;\n    }\n\n    img.src = src;\n  }\n\n  // Handle image error after it's loaded\n  function handleError() {\n    if (!isError) {\n      currentSrc = fallback;\n      isError = true;\n    }\n  }\n</script>\n\n<img\n  bind:this={imgElement}\n  src={currentSrc}\n  {alt}\n  class={`transition-opacity duration-300 ${isLoaded ? 'opacity-100' : 'opacity-50'} ${className}`}\n  {width}\n  {height}\n  loading={priority ? 'eager' : 'lazy'}\n  decoding={priority ? 'sync' : 'async'}\n  onerror={handleError}\n  style={!isLoaded && width && height ? `aspect-ratio: ${width}/${height}` : undefined}\n/>\n\n<style>\n  img {\n    display: block;\n    max-width: 100%;\n    height: auto;\n  }\n\n  /* Prevent layout shift during loading */\n  img[width][height] {\n    width: auto;\n    height: auto;\n    max-width: 100%;\n  }\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\modals\\AdminModal.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\modals\\BrandPaymentModal.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":100,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":100,"endColumn":17},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":207,"column":35,"nodeType":"BlockStatement","messageId":"unexpected","endLine":209,"endColumn":12,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[6035,6059],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":210,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":210,"endColumn":21}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[606,609],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[606,609],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[707,710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[707,710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[811,814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[811,814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'validateDiscountCode' is defined but never used. Allowed unused vars must match /^_/u.","line":76,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":76,"endColumn":38,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  const browser = typeof window !== 'undefined';\n\n  interface Props {\n    show: boolean;\n    stripePublishableKey?: string;\n    accountType?: 'pro' | 'brand';\n    initialDiscountCode?: string;\n    onSuccess?: () => void;\n    onCancel?: () => void;\n    onClose?: () => void;\n  }\n\n  let { \n    show, \n    stripePublishableKey, \n    accountType = 'brand',\n    initialDiscountCode = '',\n    onSuccess, \n    onCancel, \n    onClose \n  }: Props = $props();\n\n  let loading = $state(false);\n  let error = $state('');\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  let stripe: any = $state(null);\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  let elements: any = $state(null);\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  let cardElement: any = $state(null);\n  let cardContainer: HTMLDivElement | undefined = $state();\n  let discountCode = $state('');\n  let discountAmount = $state(0);\n  let discountError = $state('');\n\n  // Set correct price and plan ID based on account type\n  const basePrice = accountType === 'pro' ? 25 : 50;\n  \n  // Use correct plan ID based on account type\n  let actualPlanId = $state(\n    accountType === 'pro' \n      ? 'c0587696-cbcd-4e6b-b6bc-ba84fb47ddce' // Pro plan ID\n      : '989b722e-4050-4c63-ac8b-ab105f14027c'  // Brand plan ID\n  );\n  \n  // Initialize final price - reactive computed value\n  let finalPrice = $derived(discountAmount > 0 ? basePrice - discountAmount : basePrice);\n\n  // Set initial discount code from prop - always sync with prop when modal opens\n  $effect(() => {\n    if (show && initialDiscountCode) {\n      discountCode = initialDiscountCode;\n    }\n  });\n  \n  // Simple discount validation for INDECISIVE test code\n  $effect(() => {\n    if (discountCode && discountCode.trim()) {\n      if (discountCode.trim().toUpperCase() === 'INDECISIVE') {\n        discountAmount = basePrice * 0.90; // 90% off\n        discountError = '';\n      } else {\n        // Don't set an error here - let the server validate other codes\n        // The server will handle validation when payment is submitted\n        discountAmount = 0;\n        discountError = '';\n      }\n    } else {\n      discountAmount = 0;\n      discountError = '';\n    }\n  });\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  async function validateDiscountCode(code: string) {\n    if (!code || !actualPlanId) return;\n    \n    discountError = '';\n    \n    try {\n      const response = await fetch('/api/subscriptions/validate-discount', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          code: code,\n          planId: actualPlanId\n        })\n      });\n      \n      const result = await response.json();\n      \n      if (result.valid) {\n        discountAmount = result.discount_amount || 0;\n        // Don't set finalPrice here - let the $effect handle it reactively\n      } else {\n        discountAmount = 0;\n        discountError = result.error || 'Invalid discount code';\n      }\n    } catch (err) {\n      \n      discountAmount = 0;\n      discountError = 'Failed to validate discount code';\n    }\n  }\n\n  // Initialize Stripe when modal shows\n  $effect(() => {\n    if (show && browser && !stripe) {\n      initializeStripe();\n    }\n  });\n\n  async function initializeStripe() {\n    try {\n      if (!stripePublishableKey) {\n        throw new Error('Stripe publishable key is required');\n      }\n      const { loadStripe } = await import('@stripe/stripe-js');\n      stripe = await loadStripe(stripePublishableKey);\n      \n      if (stripe && cardContainer) {\n        elements = stripe.elements();\n        cardElement = elements.create('card', {\n          style: {\n            base: {\n              fontSize: '16px',\n              color: '#424770',\n              fontFamily: '\"Helvetica Neue\", Helvetica, sans-serif',\n              fontSmoothing: 'antialiased',\n              '::placeholder': {\n                color: '#aab7c4',\n              },\n            },\n            invalid: {\n              color: '#fa755a',\n              iconColor: '#fa755a'\n            },\n          },\n        });\n        cardElement.mount(cardContainer);\n      }\n    } catch {\n      error = 'Failed to load payment form';\n    }\n  }\n\n  async function handlePayment() {\n    if (!stripe || !cardElement) {\n      error = 'Payment form not ready';\n      return;\n    }\n    \n    loading = true;\n    error = '';\n    \n    try {\n      \n      // Create subscription on server with discount\n      const response = await fetch('/api/subscriptions/create', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ \n          planId: actualPlanId,\n          discountCode: discountCode\n        })\n      });\n\n      const result = await response.json();\n      \n      if (result.error) {\n        // More specific error handling for discount validation\n        if (result.error.includes('discount')) {\n          error = 'Error validating discount code. Please try again or remove the discount code.';\n        } else {\n          error = result.error;\n        }\n        throw new Error(error);\n      }\n\n      const { clientSecret } = result;\n      \n      if (!clientSecret) {\n        throw new Error('No payment client secret received from server');\n      }\n\n      // Confirm payment with card element\n      const { error: paymentError } = await stripe.confirmCardPayment(clientSecret, {\n        payment_method: {\n          card: cardElement,\n        }\n      });\n\n      if (paymentError) {\n        error = paymentError.message || 'Payment failed';\n      } else {\n        // Payment successful - update profile account type\n        try {\n          const updateResponse = await fetch('/api/profile/update-account-type', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ \n              accountType: accountType\n            })\n          });\n          \n          if (!updateResponse.ok) {\n            \n          }\n        } catch (err) {\n          \n        }\n        \n        onSuccess?.();\n      }\n      \n    } catch (err) {\n      error = err instanceof Error ? err.message : 'Payment failed';\n    } finally {\n      loading = false;\n    }\n  }\n\n  function handleCancel() {\n    onCancel?.();\n    onClose?.();\n  }\n</script>\n\n{#if show}\n  <div class=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/20 md:backdrop-blur-xs\">\n    <div class=\"w-full max-w-sm bg-white rounded-lg shadow-sm md:shadow-lg border border-gray-200 p-5\">\n      <!-- Header -->\n      <div class=\"text-center mb-4\">\n        <h3 class=\"text-lg font-semibold text-gray-900 mb-1\">\n          {accountType === 'pro' ? 'Pro Account' : 'Brand Account'}\n        </h3>\n        <div class=\"space-y-1\">\n          {#if discountAmount > 0}\n            <p class=\"text-sm text-gray-500\">\n              <span class=\"line-through\">{basePrice.toFixed(2)} BGN</span>\n              <span class=\"text-green-600 font-semibold ml-2\">{finalPrice.toFixed(2)} BGN/month</span>\n            </p>\n            <p class=\"text-xs text-green-600 font-medium\">\n              {discountAmount.toFixed(2)} BGN discount applied\n              {#if discountCode === 'INDECISIVE'}\n                (Test discount)\n              {/if}\n            </p>\n          {:else}\n            <p class=\"text-sm text-gray-500\">{basePrice} BGN/month subscription</p>\n          {/if}\n        </div>\n      </div>\n\n      <!-- Discount Code Input -->\n      <div class=\"mb-4\">\n        <label for=\"discount-code\" class=\"block text-sm font-medium text-gray-900 mb-1\">\n          Discount Code\n        </label>\n        <input\n          id=\"discount-code\"\n          type=\"text\"\n          placeholder=\"Enter discount code (e.g. INDECISIVE)\"\n          bind:value={discountCode}\n          disabled={loading}\n          class=\"w-full p-2.5 border border-gray-200 rounded-sm text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 disabled:bg-white disabled:cursor-not-allowed\"\n        />\n        {#if discountError}\n          <p class=\"mt-1 text-xs text-red-600\">{discountError}</p>\n        {:else if discountAmount > 0}\n          <p class=\"mt-1 text-xs text-green-600\">\n            ✓ {discountAmount.toFixed(2)} BGN discount applied (90% off)\n          </p>\n        {/if}\n      </div>\n\n      <!-- Card Input -->\n      <div class=\"mb-4\" role=\"group\" aria-labelledby=\"payment-details-label\">\n        <div id=\"payment-details-label\" class=\"block text-sm font-medium text-gray-900 mb-1\">\n          Payment Details\n        </div>\n        <div bind:this={cardContainer} class=\"p-2.5 border border-gray-200 rounded-sm bg-white text-sm\"></div>\n      </div>\n\n      <!-- Error Message -->\n      {#if error}\n        <div class=\"mb-3 p-2 bg-red-50 border border-red-200 rounded-sm text-sm text-red-600\">\n          {error}\n        </div>\n      {/if}\n\n      <!-- Actions -->\n      <div class=\"flex gap-2\">\n        <button\n          onclick={handleCancel}\n          disabled={loading}\n          class=\"px-3 py-1.5 text-sm text-gray-900 bg-white border border-gray-200 rounded-sm hover:bg-white transition-colors disabled:opacity-50\"\n        >\n          Cancel\n        </button>\n        <button\n          onclick={handlePayment}\n          disabled={loading || !stripe}\n          class=\"flex-1 px-3 py-1.5 text-sm text-white bg-gray-900 rounded-sm hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n        >\n          {#if loading}\n            <div class=\"flex items-center justify-center gap-1\">\n              <div class=\"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin\"></div>\n              Processing...\n            </div>\n          {:else}\n            Pay {finalPrice.toFixed(2)} BGN\n          {/if}\n        </button>\n      </div>\n\n      <!-- Security Note -->\n      <div class=\"mt-3 text-center text-xs text-gray-500\">\n        Secured by Stripe\n      </div>\n    </div>\n  </div>\n{/if}","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\modals\\FollowNotificationToast.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\modals\\MessageNotificationToast.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\modals\\Modal.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\modals\\OnboardingSuccessModal.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\modals\\OrderNotificationToast.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\modals\\RatingModal.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":79,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":79,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import Dialog from '../../primitives/dialog/Dialog.svelte';\r\n  import Button from '../ui/Button.svelte';\r\n  // Simple inline utility to generate unique IDs\r\n  function generateId(prefix: string) {\r\n    return `${prefix}-${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  interface Props {\r\n    open: boolean;\r\n    orderId: string;\r\n    sellerName: string;\r\n    productTitle: string;\r\n    onsuccess?: () => void;\r\n  }\r\n\r\n  let { open = $bindable(), orderId, sellerName, productTitle, onsuccess }: Props = $props();\r\n  \r\n  let rating = $state(0);\r\n  let communicationRating = $state(0);\r\n  let shippingRating = $state(0);\r\n  let productQualityRating = $state(0);\r\n  let comment = $state('');\r\n  let submitting = $state(false);\r\n  \r\n  // Generate IDs for accessibility\r\n  const overallRatingId = generateId('overall-rating');\r\n  const communicationId = generateId('communication');\r\n  const shippingId = generateId('shipping');\r\n  const productQualityId = generateId('product-quality');\r\n  const commentId = generateId('comment');\r\n  \r\n  function setRating(value: number) {\r\n    rating = value;\r\n  }\r\n  \r\n  function setCommunicationRating(value: number) {\r\n    communicationRating = value;\r\n  }\r\n  \r\n  function setShippingRating(value: number) {\r\n    shippingRating = value;\r\n  }\r\n  \r\n  function setProductQualityRating(value: number) {\r\n    productQualityRating = value;\r\n  }\r\n  \r\n  async function submitRating() {\r\n    if (rating === 0) {\r\n      alert('Please select an overall rating');\r\n      return;\r\n    }\r\n    \r\n    submitting = true;\r\n    \r\n    try {\r\n      const response = await fetch('/api/reviews', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          orderId,\r\n          rating,\r\n          communicationRating: communicationRating || null,\r\n          shippingRating: shippingRating || null,\r\n          productQualityRating: productQualityRating || null,\r\n          comment: comment.trim() || null\r\n        })\r\n      });\r\n      \r\n      if (response.ok) {\r\n        onsuccess?.();\r\n        open = false;\r\n        resetForm();\r\n      } else {\r\n        const error = await response.json();\r\n        alert(error.message || 'Failed to submit review');\r\n      }\r\n    } catch (error) {\r\n      alert('An error occurred while submitting your review');\r\n    } finally {\r\n      submitting = false;\r\n    }\r\n  }\r\n  \r\n  function resetForm() {\r\n    rating = 0;\r\n    communicationRating = 0;\r\n    shippingRating = 0;\r\n    productQualityRating = 0;\r\n    comment = '';\r\n  }\r\n</script>\r\n\r\n<Dialog bind:open>\r\n  {#snippet title()}\r\n    Rate Your Purchase\r\n  {/snippet}\r\n\r\n  {#snippet description()}\r\n    How was your experience with <span class=\"font-medium\">{sellerName}</span>?\r\n    <br>\r\n    <span class=\"text-xs text-gray-500\">Product: {productTitle}</span>\r\n  {/snippet}\r\n\r\n  {#snippet children()}\r\n    <!-- Overall Rating -->\r\n    <fieldset class=\"mb-6\">\r\n      <legend class=\"block text-sm font-medium text-gray-900 mb-2\">\r\n        Overall Rating <span class=\"text-red-500\">*</span>\r\n      </legend>\r\n      <div class=\"flex gap-2\" role=\"radiogroup\" aria-labelledby=\"{overallRatingId}-legend\">\r\n        {#each [1, 2, 3, 4, 5] as star}\r\n          <button\r\n            type=\"button\"\r\n            onclick={() => setRating(star)}\r\n            class=\"min-w-[44px] min-h-[44px] w-10 h-10 rounded-lg border-2 transition-colors {rating >= star ? 'bg-yellow-400 border-yellow-500' : 'bg-gray-100 border-gray-300 hover:bg-gray-200'}\"\r\n            aria-label=\"{star} stars overall rating\"\r\n            role=\"radio\"\r\n            aria-checked={rating === star}\r\n          >\r\n            <svg class=\"w-6 h-6 mx-auto {rating >= star ? 'text-white' : 'text-gray-400'}\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n              <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\r\n            </svg>\r\n          </button>\r\n        {/each}\r\n      </div>\r\n    </fieldset>\r\n    \r\n    <!-- Detailed Ratings (Optional) -->\r\n    <div class=\"space-y-4 mb-6\">\r\n      <!-- Communication -->\r\n      <fieldset>\r\n        <legend class=\"block text-sm font-medium text-gray-900 mb-1\">\r\n          Communication\r\n        </legend>\r\n        <div class=\"flex gap-1\" role=\"radiogroup\" aria-labelledby=\"{communicationId}-legend\">\r\n          {#each [1, 2, 3, 4, 5] as star}\r\n            <button\r\n              type=\"button\"\r\n              onclick={() => setCommunicationRating(star)}\r\n              class=\"min-w-[36px] min-h-[36px] w-8 h-8 rounded border transition-colors {communicationRating >= star ? 'bg-blue-400 border-blue-500' : 'bg-gray-50 border-gray-200 hover:bg-gray-100'}\"\r\n              aria-label=\"{star} stars for communication\"\r\n              role=\"radio\"\r\n              aria-checked={communicationRating === star}\r\n            >\r\n              <svg class=\"w-4 h-4 mx-auto {communicationRating >= star ? 'text-white' : 'text-gray-400'}\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\r\n              </svg>\r\n            </button>\r\n          {/each}\r\n        </div>\r\n      </fieldset>\r\n      \r\n      <!-- Shipping Speed -->\r\n      <fieldset>\r\n        <legend class=\"block text-sm font-medium text-gray-900 mb-1\">\r\n          Shipping Speed\r\n        </legend>\r\n        <div class=\"flex gap-1\" role=\"radiogroup\" aria-labelledby=\"{shippingId}-legend\">\r\n          {#each [1, 2, 3, 4, 5] as star}\r\n            <button\r\n              type=\"button\"\r\n              onclick={() => setShippingRating(star)}\r\n              class=\"min-w-[36px] min-h-[36px] w-8 h-8 rounded border transition-colors {shippingRating >= star ? 'bg-green-400 border-green-500' : 'bg-gray-50 border-gray-200 hover:bg-gray-100'}\"\r\n              aria-label=\"{star} stars for shipping\"\r\n              role=\"radio\"\r\n              aria-checked={shippingRating === star}\r\n            >\r\n              <svg class=\"w-4 h-4 mx-auto {shippingRating >= star ? 'text-white' : 'text-gray-400'}\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\r\n              </svg>\r\n            </button>\r\n          {/each}\r\n        </div>\r\n      </fieldset>\r\n      \r\n      <!-- Product Quality -->\r\n      <fieldset>\r\n        <legend class=\"block text-sm font-medium text-gray-900 mb-1\">\r\n          Product as Described\r\n        </legend>\r\n        <div class=\"flex gap-1\" role=\"radiogroup\" aria-labelledby=\"{productQualityId}-legend\">\r\n          {#each [1, 2, 3, 4, 5] as star}\r\n            <button\r\n              type=\"button\"\r\n              onclick={() => setProductQualityRating(star)}\r\n              class=\"min-w-[36px] min-h-[36px] w-8 h-8 rounded border transition-colors {productQualityRating >= star ? 'bg-purple-400 border-purple-500' : 'bg-gray-50 border-gray-200 hover:bg-gray-100'}\"\r\n              aria-label=\"{star} stars for product quality\"\r\n              role=\"radio\"\r\n              aria-checked={productQualityRating === star}\r\n            >\r\n              <svg class=\"w-4 h-4 mx-auto {productQualityRating >= star ? 'text-white' : 'text-gray-400'}\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\r\n              </svg>\r\n            </button>\r\n          {/each}\r\n        </div>\r\n      </fieldset>\r\n    </div>\r\n    \r\n    <!-- Comment -->\r\n    <div class=\"mb-6\">\r\n      <label for=\"{commentId}\" class=\"block text-sm font-medium text-gray-900 mb-2\">\r\n        Add a Comment (Optional)\r\n      </label>\r\n      <textarea\r\n        id=\"{commentId}\"\r\n        bind:value={comment}\r\n        rows=\"3\"\r\n        class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n        placeholder=\"Share your experience with other buyers...\"\r\n      ></textarea>\r\n    </div>\r\n  {/snippet}\r\n\r\n  {#snippet actions()}\r\n    <Button\r\n      onclick={submitRating}\r\n      variant=\"primary\"\r\n      class=\"flex-1 min-h-[44px]\"\r\n      disabled={submitting || rating === 0}\r\n    >\r\n      {submitting ? 'Submitting...' : 'Submit Review'}\r\n    </Button>\r\n  {/snippet}\r\n</Dialog>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\modals\\ReviewModal.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userType' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":57}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"﻿<script lang=\"ts\">\r\n\timport Dialog from '../../primitives/dialog/Dialog.svelte';\r\n\timport Button from '../ui/Button.svelte';\r\n\timport ImageUploader from '../media/ImageUploader.svelte';\r\n\t\r\n\tinterface Props {\r\n\t\tisOpen: boolean;\r\n\t\tonClose: () => void;\r\n\t\tonSubmit: (data: {\r\n\t\t\trating: number;\r\n\t\t\ttitle: string;\r\n\t\t\tcomment: string;\r\n\t\t\timageUrls: string[];\r\n\t\t}) => Promise<void>;\r\n\t\torderDetails?: {\r\n\t\t\torderId?: string;\r\n\t\t\tseller?: string;\r\n\t\t\tbuyer?: string;\r\n\t\t\tproduct?: string;\r\n\t\t\tproductImage?: string;\r\n\t\t};\r\n\t\tuserType: 'buyer' | 'seller';\r\n\t\tloading?: boolean;\r\n\t}\r\n\r\n\tlet { isOpen, onClose, onSubmit, orderDetails, userType, loading: externalLoading = false }: Props = $props();\r\n\t\r\n\tlet rating = $state(0);\r\n\tlet title = $state('');\r\n\tlet comment = $state('');\r\n\tlet imageUrls = $state<string[]>([]);\r\n\tlet loading = $state(false);\r\n\tlet error = $state('');\r\n\tlet uploadError = $state('');\r\n\t\r\n\tconst stars = [1, 2, 3, 4, 5];\r\n\t\r\n\t// Convert isOpen prop to bindable open for Dialog\r\n\tlet dialogOpen = $state(isOpen);\r\n\t\r\n\t// Sync isOpen prop changes with dialog state\r\n\t$effect(() => {\r\n\t\tdialogOpen = isOpen;\r\n\t});\r\n\t\r\n\t// Handle dialog open/close changes\r\n\tfunction handleOpenChange(open: boolean) {\r\n\t\tif (!open && !loading && !externalLoading) {\r\n\t\t\tresetForm();\r\n\t\t\tonClose();\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction resetForm() {\r\n\t\trating = 0;\r\n\t\ttitle = '';\r\n\t\tcomment = '';\r\n\t\timageUrls = [];\r\n\t\terror = '';\r\n\t\tuploadError = '';\r\n\t}\r\n\t\r\n\tasync function handleSubmit() {\r\n\t\tif (rating < 1 || rating > 5) {\r\n\t\t\terror = 'Please select a rating';\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tloading = true;\r\n\t\terror = '';\r\n\t\t\r\n\t\ttry {\r\n\t\t\tawait onSubmit({\r\n\t\t\t\trating,\r\n\t\t\t\ttitle: title.trim(),\r\n\t\t\t\tcomment: comment.trim(),\r\n\t\t\t\timageUrls: imageUrls.filter(Boolean)\r\n\t\t\t});\r\n\t\t\tresetForm();\r\n\t\t\tonClose();\r\n\t\t} catch (err) {\r\n\t\t\terror = err instanceof Error ? err.message : 'Failed to submit review';\r\n\t\t} finally {\r\n\t\t\tloading = false;\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction handleClose() {\r\n\t\tif (!loading && !externalLoading) {\r\n\t\t\tresetForm();\r\n\t\t\tonClose();\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction handleImageUpload(urls: string[]) {\r\n\t\timageUrls = urls;\r\n\t\tuploadError = '';\r\n\t}\r\n\t\r\n\tfunction handleImageUploadError(errorMsg: string) {\r\n\t\tuploadError = errorMsg;\r\n\t}\r\n\t\r\n\t// Computed state for submit button\r\n\tconst isSubmitting = $derived(loading || externalLoading);\r\n\tconst canSubmit = $derived(rating >= 1 && rating <= 5 && !isSubmitting);\r\n</script>\r\n\r\n<Dialog \r\n\topen={dialogOpen} \r\n\tonOpenChange={handleOpenChange}\r\n>\r\n\t{#snippet title()}\r\n\t\tLeave a Review\r\n\t{/snippet}\r\n\t\r\n\t{#snippet children()}\r\n\t\t<div class=\"space-y-6\">\r\n\t\t\t{#if orderDetails}\r\n\t\t\t\t<div class=\"bg-[color:var(--surface-subtle)] rounded-lg p-4 border border-[color:var(--border-subtle)]\">\r\n\t\t\t\t\t<div class=\"flex items-start gap-3\">\r\n\t\t\t\t\t\t{#if orderDetails.productImage}\r\n\t\t\t\t\t\t\t<img \r\n\t\t\t\t\t\t\t\tsrc={orderDetails.productImage} \r\n\t\t\t\t\t\t\t\talt={orderDetails.product || 'Product'} \r\n\t\t\t\t\t\t\t\tclass=\"w-12 h-12 rounded-lg object-cover bg-[color:var(--surface-base)]\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t{/if}\r\n\t\t\t\t\t\t<div class=\"min-w-0 flex-1\">\r\n\t\t\t\t\t\t\t<p class=\"text-sm font-medium text-[color:var(--text-primary)]\">\r\n\t\t\t\t\t\t\t\t{orderDetails.product || 'Product Review'}\r\n\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t<p class=\"text-xs text-[color:var(--text-muted)] mt-1\">\r\n\t\t\t\t\t\t\t\tSeller: <span class=\"font-medium\">{orderDetails.seller || 'Unknown'}</span>\r\n\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t{/if}\r\n\t\t\t\r\n\t\t\t<!-- Star Rating -->\r\n\t\t\t<div>\r\n\t\t\t\t<label for=\"rating-input\" class=\"block text-sm font-medium text-[color:var(--text-primary)] mb-3\">\r\n\t\t\t\t\tRating <span class=\"text-[color:var(--text-error)]\">*</span>\r\n\t\t\t\t</label>\r\n\t\t\t\t<div class=\"flex items-center gap-2\" role=\"radiogroup\" aria-labelledby=\"rating-input\">\r\n\t\t\t\t\t{#each stars as star}\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\tonclick={() => rating = star}\r\n\t\t\t\t\t\t\tclass=\"p-2 hover:scale-110 transition-all duration-200 min-h-[44px] min-w-[44px] flex items-center justify-center rounded-lg {star <= rating ? 'bg-yellow-50' : ''}\"\r\n\t\t\t\t\t\t\tdisabled={isSubmitting}\r\n\t\t\t\t\t\t\taria-label=\"{star} star{star === 1 ? '' : 's'} rating\"\r\n\t\t\t\t\t\t\trole=\"radio\"\r\n\t\t\t\t\t\t\taria-checked={rating === star}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\tclass=\"w-7 h-7 transition-colors {star <= rating ? 'text-yellow-500 fill-current' : 'text-[color:var(--border-default)] hover:text-yellow-300'}\"\r\n\t\t\t\t\t\t\t\tfill={star <= rating ? 'currentColor' : 'none'}\r\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\tstroke-width=\"1.5\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\r\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\r\n\t\t\t\t\t\t\t\t\td=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t{/each}\r\n\t\t\t\t\t{#if rating > 0}\r\n\t\t\t\t\t\t<span class=\"ml-3 text-sm text-[color:var(--text-muted)]\">\r\n\t\t\t\t\t\t\t{rating} star{rating === 1 ? '' : 's'}\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t{/if}\r\n\t\t\t\t</div>\r\n\t\t\t\t{#if rating === 0}\r\n\t\t\t\t\t<p class=\"text-xs text-[color:var(--text-muted)] mt-2\">\r\n\t\t\t\t\t\tTap a star to rate your experience\r\n\t\t\t\t\t</p>\r\n\t\t\t\t{/if}\r\n\t\t\t</div>\r\n\t\t\t\r\n\t\t\t<!-- Review Title -->\r\n\t\t\t<div>\r\n\t\t\t\t<label for=\"review-title\" class=\"block text-sm font-medium text-[color:var(--text-primary)] mb-2\">\r\n\t\t\t\t\tTitle (optional)\r\n\t\t\t\t</label>\r\n\t\t\t\t<input\r\n\t\t\t\t\tid=\"review-title\"\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tbind:value={title}\r\n\t\t\t\t\tdisabled={isSubmitting}\r\n\t\t\t\t\tmaxlength=\"255\"\r\n\t\t\t\t\tplaceholder=\"Summarize your experience\"\r\n\t\t\t\t\tclass=\"w-full h-[--touch-standard] px-3 border border-[color:var(--border-default)] rounded-lg focus:ring-2 focus:ring-[color:var(--state-focus)] focus:border-[color:var(--state-focus)] bg-[color:var(--surface-base)] text-[color:var(--text-primary)] placeholder:text-[color:var(--text-placeholder)] disabled:opacity-50\"\r\n\t\t\t\t/>\r\n\t\t\t\t<div class=\"flex justify-between mt-1\">\r\n\t\t\t\t\t<span class=\"text-xs text-[color:var(--text-muted)]\">\r\n\t\t\t\t\t\tHelp others understand your experience\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t<span class=\"text-xs text-[color:var(--text-muted)]\">\r\n\t\t\t\t\t\t{title?.length || 0}/255\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t\r\n\t\t\t<!-- Review Comment -->\r\n\t\t\t<div>\r\n\t\t\t\t<label for=\"review-comment\" class=\"block text-sm font-medium text-[color:var(--text-primary)] mb-2\">\r\n\t\t\t\t\tComment (optional)\r\n\t\t\t\t</label>\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tid=\"review-comment\"\r\n\t\t\t\t\tbind:value={comment}\r\n\t\t\t\t\tdisabled={isSubmitting}\r\n\t\t\t\t\trows=\"4\"\r\n\t\t\t\t\tmaxlength=\"2000\"\r\n\t\t\t\t\tplaceholder=\"Share details about your experience, product quality, shipping, communication...\"\r\n\t\t\t\t\tclass=\"w-full px-3 py-3 border border-[color:var(--border-default)] rounded-lg focus:ring-2 focus:ring-[color:var(--state-focus)] focus:border-[color:var(--state-focus)] resize-none bg-[color:var(--surface-base)] text-[color:var(--text-primary)] placeholder:text-[color:var(--text-placeholder)] disabled:opacity-50\"\r\n\t\t\t\t></textarea>\r\n\t\t\t\t<div class=\"flex justify-between mt-1\">\r\n\t\t\t\t\t<span class=\"text-xs text-[color:var(--text-muted)]\">\r\n\t\t\t\t\t\tBe specific and honest to help other buyers\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t<span class=\"text-xs text-[color:var(--text-muted)]\">\r\n\t\t\t\t\t\t{comment.length}/2000\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t\r\n\t\t\t<!-- Image Upload -->\r\n\t\t\t<div>\r\n\t\t\t\t<div class=\"block text-sm font-medium text-[color:var(--text-primary)] mb-2\">\r\n\t\t\t\t\tPhotos (optional)\r\n\t\t\t\t</div>\r\n\t\t\t\t<ImageUploader\r\n\t\t\t\t\tmaxImages={5}\r\n\t\t\t\t\tonImagesChange={handleImageUpload}\r\n\t\t\t\t\tonError={handleImageUploadError}\r\n\t\t\t\t\tdisabled={isSubmitting}\r\n\t\t\t\t\t\t\t\t\t\tclass=\"w-full\"\r\n\t\t\t\t/>\r\n\t\t\t\t<p class=\"text-xs text-[color:var(--text-muted)] mt-2\">\r\n\t\t\t\t\tAdd up to 5 photos to show the product condition or packaging\r\n\t\t\t\t</p>\r\n\t\t\t</div>\r\n\t\t\t\r\n\t\t\t<!-- Error Messages -->\r\n\t\t\t{#if error || uploadError}\r\n\t\t\t\t<div class=\"space-y-2\">\r\n\t\t\t\t\t{#if error}\r\n\t\t\t\t\t\t<div class=\"p-3 bg-[color:var(--surface-error-subtle)] border border-[color:var(--border-error)] rounded-lg\">\r\n\t\t\t\t\t\t\t<p class=\"text-sm text-[color:var(--text-error)]\">{error}</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t{/if}\r\n\t\t\t\t\t{#if uploadError}\r\n\t\t\t\t\t\t<div class=\"p-3 bg-[color:var(--surface-warning-subtle)] border border-[color:var(--border-warning)] rounded-lg\">\r\n\t\t\t\t\t\t\t<p class=\"text-sm text-[color:var(--text-warning)]\">{uploadError}</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t{/if}\r\n\t\t\t\t</div>\r\n\t\t\t{/if}\r\n\t\t</div>\r\n\t{/snippet}\r\n\t\r\n\t{#snippet actions()}\r\n\t\t<div class=\"flex gap-3\">\r\n\t\t\t<Button\r\n\t\t\t\tvariant=\"ghost\"\r\n\t\t\t\tonclick={handleClose}\r\n\t\t\t\tdisabled={isSubmitting}\r\n\t\t\t\tclass=\"min-h-[--touch-standard] flex-1\"\r\n\t\t\t>\r\n\t\t\t\tCancel\r\n\t\t\t</Button>\r\n\t\t\t<Button\r\n\t\t\t\tvariant=\"primary\"\r\n\t\t\t\tonclick={handleSubmit}\r\n\t\t\t\tdisabled={!canSubmit}\r\n\t\t\t\tloading={isSubmitting}\r\n\t\t\t\tclass=\"min-h-[--touch-standard] flex-2\"\r\n\t\t\t>\r\n\t\t\t\t{isSubmitting ? 'Submitting...' : 'Submit Review'}\r\n\t\t\t</Button>\r\n\t\t</div>\r\n\t{/snippet}\r\n</Dialog>\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\modals\\SoldNotificationToast.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\modals\\WelcomeModal.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'step' is defined but never used. Allowed unused args must match /^_/u.","line":157,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":157,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  import Dialog from '../../primitives/dialog/Dialog.svelte';\n\n  interface WelcomeStep {\n    id: string;\n    title: string;\n    description: string;\n    icon: string;\n    gradient?: string;\n    color?: string;\n  }\n\n  interface Translations {\n    welcome?: string;\n    welcomeBrand?: string;\n    welcomePersonal?: string;\n    discover?: string;\n    discoverDesc?: string;\n    sell?: string;\n    sellDesc?: string;\n    ready?: string;\n    readyDesc?: string;\n    back?: string;\n    next?: string;\n    getStarted?: string;\n    skip?: string;\n    designer?: string;\n    vintage?: string;\n    trending?: string;\n    totalSales?: string;\n    happySellers?: string;\n    trustedMarketplace?: string;\n  }\n\n  interface Props {\n    show?: boolean;\n    steps?: WelcomeStep[];\n    currentStep?: number;\n    onNext?: () => void;\n    onPrevious?: () => void;\n    onComplete?: () => void;\n    onSkip?: () => void;\n    translations?: Translations;\n    // Backward compatibility props\n    username?: string;\n  }\n\n  let { \n    show = false,\n    steps,\n    currentStep = 0,\n    onNext,\n    onPrevious,\n    onComplete,\n    onSkip,\n    translations = {},\n    username\n  }: Props = $props();\n\n  // Handle dialog open/close state\n  let isOpen = $derived(show);\n\n  const defaultSteps = $derived([\n    {\n      id: 'welcome',\n      title: username \n        ? `${translations.welcome || 'Welcome'} ${username}!`\n        : (translations.welcome || 'Welcome to Driplo'),\n      description: translations.trustedMarketplace || 'The trusted marketplace for buying and selling pre-owned fashion. Join thousands of users trading quality clothing.',\n      icon: '👋',\n      gradient: 'bg-gray-900',\n      color: 'bg-gray-900'\n    },\n    {\n      id: 'discover',\n      title: translations.discover || 'Discover Quality Fashion',\n      description: translations.discoverDesc || 'Browse curated items from verified sellers. Find authentic pieces, designer brands, and unique vintage items.',\n      icon: '🔍',\n      gradient: 'bg-blue-600',\n      color: 'bg-blue-600'\n    },\n    {\n      id: 'sell',\n      title: translations.sell || 'Sell with Confidence',\n      description: translations.sellDesc || 'List your items quickly with our simple tools. Secure payments, buyer protection, and transparent fees.',\n      icon: '💼',\n      gradient: 'bg-green-600',\n      color: 'bg-green-600'\n    },\n    {\n      id: 'ready',\n      title: translations.ready || 'Ready to Start',\n      description: translations.readyDesc || 'Complete your profile setup to start buying and selling. Your secure marketplace experience begins now.',\n      icon: '✅',\n      gradient: 'bg-black',\n      color: 'bg-black'\n    }\n  ]);\n\n  const effectiveSteps = $derived(steps || defaultSteps);\n\n  const currentStepData = $derived(effectiveSteps[currentStep]);\n  const isLastStep = $derived(currentStep === effectiveSteps.length - 1);\n  const isFirstStep = $derived(currentStep === 0);\n\n  function handleNext() {\n    if (isLastStep) {\n      onComplete?.();\n    } else {\n      onNext?.();\n    }\n  }\n</script>\n\n<Dialog \n  open={isOpen} \n  class=\"welcome-modal-dialog\"\n  onOpenChange={(open) => {\n    if (!open) {\n      // Only trigger onSkip if dialog is closing and we're not on the last step\n      // This maintains backward compatibility with the show prop behavior\n    }\n  }}\n>\n  {#snippet title()}\n    <div class=\"text-center\">\n      <!-- Progress Bar -->\n      <div class=\"h-1 bg-gray-200/50 rounded-full mb-6 -mt-2 -mx-6\">\n        <div \n          class=\"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out rounded-full\"\n          style=\"width: {((currentStep + 1) / effectiveSteps.length) * 100}%\"\n        ></div>\n      </div>\n\n      <!-- Icon -->\n      <div class=\"mb-6\">\n        <div class=\"w-16 h-16 mx-auto rounded-xl {currentStepData.color} flex items-center justify-center\">\n          <span class=\"text-2xl text-white\">{currentStepData.icon}</span>\n        </div>\n      </div>\n\n      <span class=\"text-2xl font-bold text-gray-900 leading-tight\">\n        {currentStepData.title}\n      </span>\n    </div>\n  {/snippet}\n\n  {#snippet children()}\n    <div class=\"text-center\">\n      <!-- Description -->\n      <p class=\"text-gray-500 text-base leading-relaxed mb-6\">\n        {currentStepData.description}\n      </p>\n\n      <!-- Step Indicators -->\n      <div class=\"flex justify-center space-x-2 mb-6\">\n        {#each effectiveSteps as step, index}\n          <button\n            onclick={() => currentStep = index}\n            class=\"w-2 h-2 rounded-full transition-colors duration-300 {index === currentStep ? 'bg-black w-8' : 'bg-gray-300 hover:bg-gray-400'}\"\n            aria-label={`Go to step ${index + 1}`}\n          ></button>\n        {/each}\n      </div>\n\n      <!-- Feature Highlights for Discovery Step -->\n      {#if currentStepData.id === 'discover'}\n        <div class=\"grid grid-cols-3 gap-3 mb-6\">\n          <div class=\"bg-gray-50 rounded-xl p-3 text-center\">\n            <div class=\"text-lg mb-1\">👗</div>\n            <div class=\"text-xs font-medium text-gray-900\">{translations.designer || 'Designer'}</div>\n          </div>\n          <div class=\"bg-gray-50 rounded-xl p-3 text-center\">\n            <div class=\"text-lg mb-1\">♻️</div>\n            <div class=\"text-xs font-medium text-gray-900\">{translations.vintage || 'Vintage'}</div>\n          </div>\n          <div class=\"bg-gray-50 rounded-xl p-3 text-center\">\n            <div class=\"text-lg mb-1\">⚡</div>\n            <div class=\"text-xs font-medium text-gray-900\">{translations.trending || 'Trending'}</div>\n          </div>\n        </div>\n      {/if}\n\n      <!-- Stats for Sell Step -->\n      {#if currentStepData.id === 'sell'}\n        <div class=\"grid grid-cols-2 gap-3 mb-6\">\n          <div class=\"bg-gray-50 rounded-xl p-4 text-center\">\n            <div class=\"text-lg font-bold text-green-600 mb-1\">$2.5M+</div>\n            <div class=\"text-xs text-gray-500\">{translations.totalSales || 'Total Sales'}</div>\n          </div>\n          <div class=\"bg-gray-50 rounded-xl p-4 text-center\">\n            <div class=\"text-lg font-bold text-blue-600 mb-1\">50K+</div>\n            <div class=\"text-xs text-gray-500\">{translations.happySellers || 'Happy Sellers'}</div>\n          </div>\n        </div>\n      {/if}\n    </div>\n  {/snippet}\n\n  {#snippet actions()}\n    <div class=\"flex space-x-3 w-full\">\n      {#if !isFirstStep}\n        <button\n          onclick={onPrevious}\n          class=\"btn btn-ghost flex-1 min-h-[44px] px-6 py-3 text-gray-500 hover:text-gray-800 font-medium rounded-xl hover:bg-gray-100/50 transition-colors\"\n        >\n          {translations.back || 'Back'}\n        </button>\n      {/if}\n\n      <button\n        onclick={handleNext}\n        class=\"btn btn-primary flex-1 min-h-[44px] px-6 py-3 bg-black text-white font-semibold rounded-xl hover:bg-gray-800 transition-colors\"\n      >\n        {#if isLastStep}\n          {translations.getStarted || 'Get Started'}\n        {:else}\n          {translations.next || 'Next'}\n        {/if}\n      </button>\n\n      {#if !isLastStep && onSkip}\n        <button\n          onclick={onSkip}\n          class=\"btn btn-ghost px-4 py-3 min-h-[44px] text-gray-500 hover:text-gray-900 text-sm font-medium rounded-xl hover:bg-gray-100/50 transition-colors\"\n        >\n          {translations.skip || 'Skip'}\n        </button>\n      {/if}\n    </div>\n  {/snippet}\n</Dialog>\n\n<style>\n  /* Custom styling for welcome modal to maintain glass morphism design */\n  :global(.welcome-modal-dialog [data-dialog-overlay]) {\n    background: rgba(0, 0, 0, 0.4);\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n  }\n\n  :global(.welcome-modal-dialog [data-dialog-content]) {\n    background: rgba(255, 255, 255, 0.95);\n    backdrop-filter: blur(20px);\n    -webkit-backdrop-filter: blur(20px);\n    border-radius: 1.5rem;\n    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    ring: 1px solid rgba(255, 255, 255, 0.2);\n  }\n\n  :global(.welcome-modal-dialog .bg-gray-50) {\n    /* Keep actions section clean without the default gray background */\n    background: transparent;\n  }\n\n  /* Ensure step indicators have proper touch targets on mobile */\n  @media (max-width: 640px) {\n    :global(.welcome-modal-dialog) button[aria-label*=\"Go to step\"] {\n      min-width: 32px;\n      min-height: 32px;\n      padding: 8px;\n    }\n  }\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\BottomNav.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isAuthenticated' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":29,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  interface NavItem {\r\n    id: string;\r\n    href: string;\r\n    label: string;\r\n    icon: string;\r\n    matchPath?: string;\r\n    showBadge?: boolean;\r\n  }\r\n\r\n  interface Props {\r\n    currentPath: string;\r\n    unreadMessageCount?: number;\r\n    profileHref?: string;\r\n    isAuthenticated?: boolean;\r\n    labels?: {\r\n      home: string;\r\n      search: string;\r\n      sell: string;\r\n      messages: string;\r\n      profile: string;\r\n    };\r\n  }\r\n\r\n  let {\r\n    currentPath,\r\n    unreadMessageCount = 0,\r\n    profileHref = '/account',\r\n    isAuthenticated = false,\r\n    labels = {\r\n      home: 'Home',\r\n      search: 'Search',\r\n      sell: 'Sell',\r\n      messages: 'Messages',\r\n      profile: 'Profile'\r\n    }\r\n  }: Props = $props();\r\n\r\n  // Navigation items\r\n  const navItems = $derived<NavItem[]>([\r\n    {\r\n      id: 'home',\r\n      href: '/',\r\n      label: labels.home,\r\n      icon: 'M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25',\r\n      matchPath: '/'\r\n    },\r\n    {\r\n      id: 'search',\r\n      href: '/search',\r\n      label: labels.search,\r\n      icon: 'm21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z'\r\n    },\r\n    {\r\n      id: 'sell',\r\n      href: '/sell',\r\n      label: labels.sell,\r\n      icon: 'M12 4.5v15m7.5-7.5h-15'\r\n    },\r\n    {\r\n      id: 'messages',\r\n      href: '/messages',\r\n      label: labels.messages,\r\n      icon: 'M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z',\r\n      showBadge: true\r\n    },\r\n    {\r\n      id: 'profile',\r\n      href: profileHref,\r\n      label: labels.profile,\r\n      icon: 'M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z',\r\n      matchPath: profileHref.startsWith('/profile/') ? '/profile' : profileHref\r\n    }\r\n  ]);\r\n\r\n  // Active state logic\r\n  function isActive(item: NavItem): boolean {\r\n    const path = item.matchPath || item.href;\r\n    if (path === '/') return currentPath === '/';\r\n    return currentPath.startsWith(path);\r\n  }\r\n</script>\r\n\r\n<!-- Native mobile bottom navigation -->\r\n<nav\r\n  aria-label=\"Bottom navigation\"\r\n  data-bottom-nav\r\n  class=\"fixed bottom-0 left-0 right-0 z-50 sm:hidden\r\n         bg-[color:var(--surface-base)]/95 backdrop-blur-xl\r\n         border-t border-[color:var(--border-subtle)]\r\n         pb-[env(safe-area-inset-bottom)]\"\r\n>\r\n  <div class=\"grid grid-cols-5\">\r\n    {#each navItems as item (item.id)}\r\n      {@const active = isActive(item)}\r\n      \r\n      <a\r\n        href={item.href}\r\n        class=\"flex items-center justify-center\r\n               min-h-[var(--touch-primary)] py-[var(--space-3)]\r\n               no-underline hover:no-underline touch-manipulation\"\r\n        data-sveltekit-preload-data=\"hover\"\r\n        aria-current={active ? 'page' : undefined}\r\n        aria-label={item.label}\r\n        title={item.label}\r\n      >\r\n        <!-- Icon -->\r\n        <div class=\"relative\">\r\n          <svg\r\n            class=\"w-7 h-7 transition-colors duration-200 {active ? 'text-[color:var(--brand-primary)]' : 'text-[color:var(--text-tertiary)] hover:text-[color:var(--text-secondary)]'}\"\r\n            fill=\"none\"\r\n            stroke=\"currentColor\"\r\n            viewBox=\"0 0 24 24\"\r\n            stroke-width=\"1.5\"\r\n          >\r\n            <path d={item.icon} />\r\n          </svg>\r\n\r\n          <!-- Badge for messages only -->\r\n          {#if item.showBadge && item.id === 'messages' && unreadMessageCount > 0}\r\n            <div\r\n              class=\"absolute -top-1 -right-1 min-w-4 h-4 px-1\r\n                     bg-[color:var(--status-error-solid)] text-[color:var(--text-inverse)]\r\n                     text-[10px] font-bold rounded-full flex items-center justify-center\"\r\n            >\r\n              {unreadMessageCount > 99 ? '99' : unreadMessageCount}\r\n            </div>\r\n          {/if}\r\n        </div>\r\n      </a>\r\n    {/each}\r\n  </div>\r\n</nav>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\Breadcrumb.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\CategoryDropdown.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\CategoryNavigationSheet.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\CategorySearchBar.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentCategory' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onQuickSearch' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":24,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\nimport SearchInput from '../forms/SearchInput.svelte';\r\nimport MegaMenuCategories from './MegaMenuCategories.svelte';\r\nimport CategoryPill from '../ui/CategoryPill.svelte';\r\nimport AppliedFilterPills from '../product/AppliedFilterPills.svelte';\r\nimport { buildCategoryBreadcrumbs, type CategoryBreadcrumbItem } from '../../search/utils.js';\r\nimport type {\r\n  CategoryWithChildren,\r\n  SearchMainCategory,\r\n  CategorySearchBarProps,\r\n  SearchAppliedFilters\r\n} from '../../search/types.js';\r\nimport type { FilterOption, FilterValue } from '@repo/ui/types';\r\n\r\nlet {\r\n  searchValue = $bindable(''),\r\n  megaMenuData = [] as CategoryWithChildren[],\r\n  mainCategories = [] as SearchMainCategory[],\r\n  conditionFilters = [] as FilterOption[],\r\n  appliedFilters = {} as SearchAppliedFilters,\r\n  currentCategory = null,\r\n  i18n,\r\n  onSearch,\r\n  onQuickSearch,\r\n  onCategorySelect,\r\n  onFilterChange,\r\n  onFilterRemove,\r\n  onClearAllFilters,\r\n  enableQuickResults = true\r\n}: CategorySearchBarProps = $props();\r\n\r\n// Component state using Svelte 5 runes\r\nlet showCategoryDropdown = $state(false);\r\nlet isNavigating = $state(false);\r\nlet selectedPillIndex = $state(-1);\r\n\r\nfunction i18nText(value: unknown, fallback: string): string {\r\n  return typeof value === 'function' ? (value as () => string)() : fallback;\r\n}\r\n\r\nfunction setFilter(key: string, value: FilterValue) {\r\n  onFilterChange(key, value);\r\n}\r\n\r\nconst categoryBreadcrumbs = $derived.by<CategoryBreadcrumbItem[]>(() =>\r\n  buildCategoryBreadcrumbs(appliedFilters, megaMenuData, mainCategories)\r\n);\r\n\r\n// Enhanced category display logic\r\nconst currentCategoryDisplay = $derived(() => {\r\n  if (categoryBreadcrumbs.length > 0) {\r\n    const breadcrumbLabels = categoryBreadcrumbs.map(crumb => crumb.label);\r\n    const mainCategory = mainCategories.find(cat => cat.key === appliedFilters?.category);\r\n    const iconSource = mainCategory?.icon ?? getCategoryIcon(breadcrumbLabels[0] ?? '');\r\n\r\n    return {\r\n      label: breadcrumbLabels.join(' → '),\r\n      icon: iconSource,\r\n      breadcrumb: breadcrumbLabels\r\n    };\r\n  }\r\n\r\n  return {\r\n    label: i18nText(i18n.filter_allCategories, 'All Categories'),\r\n    icon: '📂',\r\n    breadcrumb: [] as string[]\r\n  };\r\n});\r\n\r\n// Get category icon helper\r\nfunction getCategoryIcon(categoryName: string): string {\r\n  const iconMap: Record<string, string> = {\r\n    'Women': '👗',\r\n    'Men': '👔',\r\n    'Kids': '👶',\r\n    'Unisex': '🌍',\r\n    'Clothing': '👕',\r\n    'Shoes': '👟',\r\n    'Accessories': '💍',\r\n    'Bags': '👜'\r\n  };\r\n  return iconMap[categoryName] || '📂';\r\n}\r\n\r\n// Category dropdown handlers\r\nfunction handleCategoryDropdownToggle(e: Event) {\r\n  e.preventDefault();\r\n  e.stopPropagation();\r\n  showCategoryDropdown = !showCategoryDropdown;\r\n}\r\n\r\nfunction handleCategoryDropdownClose() {\r\n  showCategoryDropdown = false;\r\n}\r\n\r\n// Enhanced category selection handler\r\nfunction handleMegaMenuCategorySelect(categorySlug: string, level: number, path: string[]) {\r\n  isNavigating = true;\r\n\r\n  // Call the parent handler with full context\r\n  onCategorySelect(categorySlug, level, path);\r\n\r\n  // Close dropdown\r\n  handleCategoryDropdownClose();\r\n\r\n  // Reset navigation state\r\n  setTimeout(() => {\r\n    isNavigating = false;\r\n  }, 300);\r\n}\r\n\r\n// Roving tabindex for horizontal pill nav\r\nfunction handlePillKeyNav(e: KeyboardEvent, index: number) {\r\n  const pills = document.querySelectorAll('#category-pills button');\r\n  const totalPills = (mainCategories?.length || 0) + (conditionFilters?.length || 0);\r\n  switch (e.key) {\r\n    case 'ArrowRight':\r\n      e.preventDefault();\r\n      selectedPillIndex = Math.min(index + 1, totalPills - 1);\r\n      (pills[selectedPillIndex] as HTMLElement)?.focus();\r\n      break;\r\n    case 'ArrowLeft':\r\n      e.preventDefault();\r\n      selectedPillIndex = Math.max(index - 1, 0);\r\n      (pills[selectedPillIndex] as HTMLElement)?.focus();\r\n      break;\r\n    case 'Home':\r\n      e.preventDefault();\r\n      selectedPillIndex = 0;\r\n      (pills[0] as HTMLElement)?.focus();\r\n      break;\r\n    case 'End':\r\n      e.preventDefault();\r\n      selectedPillIndex = totalPills - 1;\r\n      (pills[totalPills - 1] as HTMLElement)?.focus();\r\n      break;\r\n  }\r\n}\r\n\r\n// Handle filter pills\r\nfunction handleCategoryPillClick(categoryKey: string) {\r\n  const currentCategory = appliedFilters?.category;\r\n  if (currentCategory === categoryKey) {\r\n    // Deselect if same category\r\n    onClearAllFilters();\r\n  } else {\r\n    // Select new category - this will be a level 1 selection\r\n    onCategorySelect(categoryKey, 1, [categoryKey]);\r\n  }\r\n}\r\n\r\nfunction handleConditionPillClick(conditionKey: string) {\r\n  const currentCondition = appliedFilters?.condition;\r\n  if (currentCondition === conditionKey) {\r\n    onFilterRemove('condition');\r\n  } else {\r\n    setFilter('condition', conditionKey);\r\n  }\r\n\r\n}\r\n\r\n// Handle click outside for category dropdown - improved with proper cleanup\r\n$effect(() => {\r\n  if (typeof window !== 'undefined' && showCategoryDropdown) {\r\n    const handleClickOutside = (e: MouseEvent) => {\r\n      const target = e.target as HTMLElement;\r\n      if (!target.closest('.category-search-dropdown-container')) {\r\n        showCategoryDropdown = false;\r\n      }\r\n    };\r\n\r\n    // Add event listener with proper capture\r\n    document.addEventListener('click', handleClickOutside, true);\r\n\r\n    return () => {\r\n      document.removeEventListener('click', handleClickOutside, true);\r\n    };\r\n  }\r\n});\r\n\r\n// Active filter count for display\r\nconst activeFilterCount = $derived.by(() => {\r\n  if (!appliedFilters) return 0;\r\n\r\n  return [\r\n    appliedFilters.category ? 1 : 0,\r\n    appliedFilters.subcategory ? 1 : 0,\r\n    appliedFilters.specific ? 1 : 0,\r\n    (appliedFilters.size && appliedFilters.size !== 'all') ? 1 : 0,\r\n    (appliedFilters.brand && appliedFilters.brand !== 'all') ? 1 : 0,\r\n    (appliedFilters.condition && appliedFilters.condition !== 'all') ? 1 : 0,\r\n    (appliedFilters.minPrice || appliedFilters.maxPrice) ? 1 : 0,\r\n    (appliedFilters.sortBy && appliedFilters.sortBy !== 'relevance') ? 1 : 0\r\n  ].reduce((sum, val) => sum + val, 0);\r\n});\r\n</script>\r\n\r\n<!-- Category-Specific Sticky Search Bar (compact) -->\r\n<div class=\"bg-[color:var(--surface-base)]/90 supports-[backdrop-filter]:backdrop-blur-sm sticky z-40 border-b border-[color:var(--border-subtle)]\" style=\"top: var(--app-header-offset, 56px) !important;\">\r\n  <div class=\"px-2 sm:px-4 lg:px-6 relative py-[var(--gutter-xxs)] sm:py-[var(--gutter-xs)]\">\r\n    <!-- Search Container with Advanced Category Navigation -->\r\n    <div class=\"py-0 relative category-search-dropdown-container\">\r\n      <SearchInput\r\n        bind:searchValue={searchValue}\r\n        placeholder={i18n.search_placeholder ? i18n.search_placeholder() : 'Search in category...'}\r\n        onSearch={onSearch}\r\n        searchId=\"category-search-input\"\r\n        showDropdown={enableQuickResults}\r\n        maxResults={6}\r\n      >\r\n        {#snippet leftSection()}\r\n          <button\r\n            onclick={handleCategoryDropdownToggle}\r\n            type=\"button\"\r\n            class=\"h-11 px-4 bg-transparent hover:bg-[color:var(--surface-subtle)] transition-all duration-200 flex items-center gap-2 focus:outline-none focus:bg-[color:var(--surface-subtle)] border-r border-[color:var(--border-subtle)] rounded-l-lg min-w-0 flex-shrink-0\"\r\n            class:animate-pulse={isNavigating}\r\n            aria-expanded={showCategoryDropdown}\r\n            aria-haspopup=\"listbox\"\r\n            aria-label=\"Select category\"\r\n            disabled={isNavigating}\r\n          >\r\n            <span class=\"text-lg flex-shrink-0\" role=\"img\" aria-hidden=\"true\">{currentCategoryDisplay().icon}</span>\r\n            <div class=\"flex flex-col items-start min-w-0 hidden sm:flex\">\r\n              {#if currentCategoryDisplay().breadcrumb && currentCategoryDisplay().breadcrumb.length > 1}\r\n                <span class=\"text-xs text-[color:var(--text-tertiary)] truncate max-w-32\">\r\n                  {currentCategoryDisplay().breadcrumb.slice(0, -1).join(' → ')}\r\n                </span>\r\n                <span class=\"text-sm font-medium text-[color:var(--text-primary)] truncate max-w-32\">\r\n                  {currentCategoryDisplay().breadcrumb[currentCategoryDisplay().breadcrumb.length - 1]}\r\n                </span>\r\n              {:else}\r\n                <span class=\"text-sm font-medium text-[color:var(--text-secondary)] truncate max-w-32\">\r\n                  {currentCategoryDisplay().label}\r\n                </span>\r\n              {/if}\r\n            </div>\r\n            <svg class=\"w-4 h-4 text-[color:var(--text-secondary)] transition-transform duration-200 flex-shrink-0 {showCategoryDropdown ? 'rotate-180' : ''}\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\" />\r\n            </svg>\r\n          </button>\r\n        {/snippet}\r\n      </SearchInput>\r\n\r\n      <!-- Enhanced MegaMenuCategories Dropdown -->\r\n      {#if showCategoryDropdown}\r\n        <div class=\"absolute top-full left-0 right-0 mt-1 bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden z-50 max-h-[70vh]\">\r\n          <MegaMenuCategories\r\n            onCategoryClick={handleMegaMenuCategorySelect}\r\n            onClose={handleCategoryDropdownClose}\r\n            categories={megaMenuData}\r\n            translations={{\r\n              back: i18n.common_back ? i18n.common_back() : 'Back',\r\n              items: i18n.search_items ? i18n.search_items() : 'items',\r\n              women: i18n.category_women ? i18n.category_women() : 'Women',\r\n              men: i18n.category_men ? i18n.category_men() : 'Men',\r\n              kids: i18n.category_kids ? i18n.category_kids() : 'Kids',\r\n              unisex: i18n.category_unisex ? i18n.category_unisex() : 'Unisex',\r\n              clothing: i18n.category_clothing ? i18n.category_clothing() : 'Clothing',\r\n              shoes: i18n.category_shoesType ? i18n.category_shoesType() : 'Shoes',\r\n              accessories: i18n.category_accessoriesType ? i18n.category_accessoriesType() : 'Accessories',\r\n              bags: i18n.category_bagsType ? i18n.category_bagsType() : 'Bags'\r\n            }}\r\n          />\r\n        </div>\r\n      {/if}\r\n    </div>\r\n\r\n    <!-- Enhanced Quick Filter Pills -->\r\n    <nav id=\"category-pills\" class=\"flex items-center gap-2 sm:gap-3 overflow-x-auto scrollbarhide pb-[var(--gutter-xxs)] pt-[var(--gutter-xxs)]\" aria-label=\"Quick filters\">\r\n      <!-- Main Category Pills -->\r\n      {#each mainCategories as category, index}\r\n        <CategoryPill\r\n          variant={appliedFilters?.category === category.key ? 'primary' : 'outline'}\r\n          label={category.label}\r\n          emoji={category.icon}\r\n          onclick={() => handleCategoryPillClick(category.key)}\r\n          class=\"shrink-0 min-h-11\"\r\n          disabled={isNavigating}\r\n          onkeydown={(e: KeyboardEvent) => handlePillKeyNav(e, index)}\r\n        />\r\n      {/each}\r\n\r\n      <!-- Condition Pills -->\r\n      {#each conditionFilters as condition, cIdx}\r\n        <button\r\n          type=\"button\"\r\n          onclick={() => handleConditionPillClick((condition.key ?? condition.value))}\r\n          disabled={isNavigating}\r\n            class=\"shrink-0 px-3 py-2 rounded-full text-xs font-semibold transition-all duration-200 min-h-11 disabled:opacity-50 disabled:cursor-not-allowed\r\n              {appliedFilters?.condition === (condition.key ?? condition.value)\r\n                ? 'bg-[color:var(--brand-primary)] text-[color:var(--text-inverse)] border border-[color:var(--brand-primary)]'\r\n                : 'bg-[color:var(--surface-subtle)] text-[color:var(--text-secondary)] border border-[color:var(--border-default)] hover:border-[color:var(--border-emphasis)] hover:bg-[color:var(--surface-base)]'}\"\r\n          aria-label={`Filter by ${condition.label}`}\r\n          aria-pressed={appliedFilters?.condition === (condition.key ?? condition.value)}\r\n          onkeydown={(e: KeyboardEvent) => handlePillKeyNav(e, (mainCategories?.length || 0) + cIdx)}\r\n        >\r\n          {condition.shortLabel}\r\n        </button>\r\n      {/each}\r\n    </nav>\r\n\r\n    <!-- Applied Filters with Enhanced Category Display -->\r\n    {#if activeFilterCount > 0}\r\n      <div class=\"pb-2\">\r\n        <AppliedFilterPills\r\n          filters={appliedFilters || {}}\r\n          categoryLabels={{\r\n            women: i18n.category_women ? i18n.category_women() : 'Women',\r\n            men: i18n.category_men ? i18n.category_men() : 'Men',\r\n            kids: i18n.category_kids ? i18n.category_kids() : 'Kids',\r\n            unisex: i18n.category_unisex ? i18n.category_unisex() : 'Unisex'\r\n          }}\r\n          onRemoveFilter={onFilterRemove}\r\n          onClearAll={onClearAllFilters}\r\n          clearAllLabel={i18n.filter_clearAll ? i18n.filter_clearAll() : 'Clear All'}\r\n          class=\"justify-start\"\r\n          maxDisplay={5}\r\n          showMore={false}\r\n        />\r\n      </div>\r\n    {/if}\r\n  </div>\r\n\r\n</div>\r\n\r\n<style>\r\n\r\n  .animate-pulse {\r\n    animation: pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite;\r\n  }\r\n\r\n  @keyframes pulse {\r\n    0%, 100% {\r\n      opacity: 1;\r\n    }\r\n    50% {\r\n      opacity: 0.8;\r\n    }\r\n  }\r\n</style>\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\EnhancedSearchBar.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\HeaderLogo.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isVisible' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":11,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  // No lifecycle imports needed - using $effect\r\n\r\n  interface Props {\r\n    subtitle?: string;\r\n    size?: 'sm' | 'md' | 'lg';\r\n  }\r\n\r\n  let { subtitle, size = 'md' }: Props = $props();\r\n\r\n  let isVisible = $state(true);\r\n  let logoRef = $state<HTMLElement>();\r\n\r\n  $effect(() => {\r\n    if (!logoRef) return;\r\n\r\n    // Simple visibility optimization - pause when page hidden\r\n    const handleVisibilityChange = () => {\r\n      isVisible = !document.hidden;\r\n    };\r\n\r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n\r\n    return () => {\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n    };\r\n  });\r\n\r\n  // Tech startup typography using design system tokens - balanced with header elements\r\n  const logoClasses = {\r\n    sm: 'text-xl sm:text-2xl font-semibold leading-tight tracking-tight',\r\n    md: 'text-xl sm:text-2xl md:text-3xl font-semibold leading-tight tracking-tight',\r\n    lg: 'text-2xl sm:text-3xl md:text-4xl font-semibold leading-tight tracking-tight'\r\n  };\r\n\r\n  const subtitleClasses = {\r\n    sm: 'text-xs font-medium tracking-wide',\r\n    md: 'text-sm font-medium tracking-wide',\r\n    lg: 'text-base font-medium tracking-wide'\r\n  };\r\n</script>\r\n\r\n<a\r\n  href=\"/\"\r\n  class=\"flex {subtitle ? 'flex-col items-start' : 'items-center'} no-underline hover:no-underline group transition-opacity duration-200\"\r\n  bind:this={logoRef}\r\n>\r\n  <span class=\"{logoClasses[size]} text-[color:var(--text-primary)] group-hover:text-[color:var(--text-secondary)] transition-colors duration-200\">\r\n    driplo.\r\n  </span>\r\n  {#if subtitle}\r\n    <span class=\"{subtitleClasses[size]} text-[color:var(--text-tertiary)] mt-0.5 uppercase\">\r\n      {subtitle}\r\n    </span>\r\n  {/if}\r\n</a>\r\n\r\n<style>\r\n  .emoji-carousel {\r\n    display: inline-block;\r\n    width: 1.2em;\r\n    height: 1.2em;\r\n    overflow: hidden;\r\n    vertical-align: bottom;\r\n    position: relative;\r\n  }\r\n\r\n  .emoji-track {\r\n    display: flex;\r\n    flex-direction: column;\r\n    /* Use transform for GPU acceleration */\r\n    will-change: transform;\r\n  }\r\n  \r\n  .emoji-track.animate {\r\n    /* Move exactly one emoji height per step (4 emojis => 0%, -25%, -50%, -75%) */\r\n    animation: emoji-slide 8s steps(4, end) infinite;\r\n  }\r\n  \r\n  .emoji-track.paused {\r\n    animation-play-state: paused;\r\n  }\r\n\r\n  @keyframes emoji-slide {\r\n    0% { transform: translateY(0); }\r\n    100% { transform: translateY(-75%); }\r\n  }\r\n\r\n  /* Respect prefers-reduced-motion for accessibility */\r\n  @media (prefers-reduced-motion: reduce) {\r\n    .emoji-track {\r\n      animation: none;\r\n    }\r\n  }\r\n</style>\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\HeaderNav.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\HeaderSearch.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\HeaderUserMenu.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[222,225],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[222,225],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[241,244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[241,244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import Avatar from '../ui/Avatar.svelte';\r\n  import type { AvatarVariant, AvatarSize } from '../../types';\r\n  import Menu from '../../primitives/menu/Menu.svelte';\r\n  \r\n  interface Props {\r\n    user: any;\r\n    profile: any;\r\n    userDisplayName: string;\r\n    initials: string;\r\n    canSell: boolean;\r\n    onSignOut: () => void;\r\n    onClose: () => void;\r\n    signingOut?: boolean;\r\n    avatarVariant?: AvatarVariant;\r\n    avatarSize?: AvatarSize; // base size; responsive overrides via class\r\n    translations?: {\r\n      myProfile?: string;\r\n      orders?: string;\r\n      favorites?: string;\r\n      startSelling?: string;\r\n      settings?: string;\r\n      signOut?: string;\r\n      signingOut?: string;\r\n    };\r\n  }\r\n\r\n  let { \r\n    user, \r\n    profile, \r\n    userDisplayName, \r\n    initials, \r\n    canSell, \r\n    onSignOut, \r\n    onClose,\r\n    signingOut = false,\r\n    avatarVariant = 'circle',\r\n    avatarSize = 'sm',\r\n    translations = {\r\n      myProfile: 'My Profile',\r\n      orders: 'Orders',\r\n      favorites: 'Favorites',\r\n      startSelling: 'Start Selling',\r\n      settings: 'Settings',\r\n      signOut: 'Sign Out',\r\n      signingOut: 'Signing out...'\r\n    }\r\n  }: Props = $props();\r\n\r\n  let menuOpen = $state(false);\r\n</script>\r\n\r\n<Menu \r\n  bind:open={menuOpen}\r\n  onOpenChange={(open) => {\r\n    if (!open) {\r\n      onClose();\r\n    }\r\n  }}\r\n  positioning=\"bottom-end\"\r\n  gutter={12}\r\n  portal=\"body\"\r\n  menuClass=\"menu w-auto sm:w-56 z-[60] bg-[color:var(--surface-base)] border border-[color:var(--border-subtle)] shadow-[var(--shadow-lg)] rounded-[var(--radius-lg)]\"\r\n  triggerClass=\"p-0 bg-transparent hover:bg-transparent focus:bg-transparent active:bg-transparent border-0 outline-0 shadow-none rounded-full cursor-pointer inline-flex items-center justify-center min-w-[44px] min-h-[44px] focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary\"\r\n  ariaLabel={`Open user menu for ${userDisplayName}`}\r\n>\r\n  {#snippet trigger()}\r\n    <Avatar \r\n      name={userDisplayName} \r\n      src={profile?.avatar_url}\r\n      alt={`${userDisplayName}'s avatar`}\r\n      size={avatarSize}\r\n      variant={avatarVariant}\r\n      fallback={initials}\r\n      class=\"sm:w-12 sm:h-12 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary transition-all cursor-pointer\"\r\n    />\r\n  {/snippet}\r\n  \r\n  {#snippet children()}\r\n    <!-- User Info Header inside menu -->\r\n    <div class=\"px-4 py-3 border-b border-[color:var(--border-subtle)]\">\r\n      <div class=\"flex-1 min-w-0\">\r\n        <p class=\"font-semibold text-[color:var(--text-primary)] truncate text-sm\">{userDisplayName}</p>\r\n        <p class=\"text-xs text-[color:var(--text-secondary)] truncate\">{user?.email}</p>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- Menu Items -->\r\n    <div class=\"py-1\">\r\n      <a \r\n        href=\"/account\" \r\n        class=\"flex items-center px-4 py-2 text-sm text-[color:var(--text-primary)] hover:bg-[color:var(--surface-muted)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-primary transition-colors duration-[var(--duration-fast)] min-h-[var(--touch-primary)]\" \r\n        role=\"menuitem\" \r\n        onclick={(e: MouseEvent) => {\r\n          e.preventDefault();\r\n          onClose();\r\n          window.location.href = '/account';\r\n        }}\r\n      >\r\n        <svg class=\"w-4 h-4 mr-3 text-[color:var(--text-tertiary)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\r\n        </svg>\r\n        {translations.myProfile}\r\n      </a>\r\n      <a \r\n        href=\"/orders\" \r\n        class=\"flex items-center px-4 py-2 text-sm text-[color:var(--text-primary)] hover:bg-[color:var(--surface-muted)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-primary transition-colors duration-[var(--duration-fast)] min-h-[var(--touch-primary)]\" \r\n        role=\"menuitem\" \r\n        onclick={(e: MouseEvent) => {\r\n          e.preventDefault();\r\n          onClose();\r\n          window.location.href = '/orders';\r\n        }}\r\n      >\r\n        <svg class=\"w-4 h-4 mr-3 text-[color:var(--text-tertiary)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z\" />\r\n        </svg>\r\n        {translations.orders}\r\n      </a>\r\n      <a \r\n        href=\"/favorites\" \r\n        class=\"flex items-center px-4 py-2 text-sm text-[color:var(--text-primary)] hover:bg-[color:var(--surface-muted)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-primary transition-colors duration-[var(--duration-fast)] min-h-[var(--touch-primary)]\" \r\n        role=\"menuitem\" \r\n        onclick={(e: MouseEvent) => {\r\n          e.preventDefault();\r\n          onClose();\r\n          window.location.href = '/favorites';\r\n        }}\r\n      >\r\n        <svg class=\"w-4 h-4 mr-3 text-[color:var(--text-tertiary)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\" />\r\n        </svg>\r\n        {translations.favorites}\r\n      </a>\r\n      {#if !canSell}\r\n        <a \r\n          href=\"/sell\" \r\n          class=\"flex items-center px-4 py-2 text-sm text-[color:var(--primary)] hover:bg-[color:var(--status-info-bg)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-primary transition-colors duration-[var(--duration-fast)] min-h-[var(--touch-primary)]\" \r\n          role=\"menuitem\" \r\n          onclick={(e: MouseEvent) => {\r\n            e.preventDefault();\r\n            onClose();\r\n            window.location.href = '/sell';\r\n          }}\r\n        >\r\n          <svg class=\"w-4 h-4 mr-3 text-[color:var(--primary)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n          </svg>\r\n          {translations.startSelling}\r\n        </a>\r\n      {/if}\r\n    </div>\r\n    \r\n    <div class=\"border-t border-[color:var(--border-subtle)] pt-1\">\r\n      <a \r\n        href=\"/settings\" \r\n        class=\"flex items-center px-4 py-2 text-sm text-[color:var(--text-primary)] hover:bg-[color:var(--surface-muted)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-primary transition-colors duration-[var(--duration-fast)] min-h-[var(--touch-primary)]\" \r\n        role=\"menuitem\" \r\n        onclick={(e: MouseEvent) => {\r\n          e.preventDefault();\r\n          onClose();\r\n          window.location.href = '/settings';\r\n        }}\r\n      >\r\n        <svg class=\"w-4 h-4 mr-3 text-[color:var(--text-tertiary)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.50 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\" />\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n        </svg>\r\n        {translations.settings}\r\n      </a>\r\n      <button\r\n        onclick={(e: MouseEvent) => {\r\n          e.preventDefault();\r\n          onSignOut();\r\n        }}\r\n        disabled={signingOut}\r\n        class=\"flex items-center w-full px-4 py-2 text-sm text-[color:var(--status-error-text)] hover:bg-[color:var(--status-error-bg)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-primary transition-colors duration-[var(--duration-fast)] disabled:opacity-50 disabled:cursor-not-allowed min-h-[var(--touch-primary)]\" \r\n        role=\"menuitem\"\r\n      >\r\n        {#if signingOut}\r\n          <svg class=\"animate-spin w-4 h-4 mr-3 text-[color:var(--status-error-solid)]\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n            <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\r\n            <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n          </svg>\r\n          {translations.signingOut}\r\n        {:else}\r\n          <svg class=\"w-4 h-4 mr-3 text-[color:var(--status-error-solid)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\r\n          </svg>\r\n          {translations.signOut}\r\n        {/if}\r\n      </button>\r\n    </div>\r\n  {/snippet}\r\n</Menu>\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\IntegratedSearchBar.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\LazySearchResults.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ProductGrid' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":31,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":54,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  // No lifecycle imports needed - using $effect\r\n  import { VirtualProductGrid } from '@repo/ui';\r\n  import type { Product } from '../../types/product';\r\n  \r\n  interface Props {\r\n    searchQuery?: string;\r\n    filters?: Record<string, unknown>;\r\n    onProductClick: (product: Product) => void;\r\n    onFavorite: (product: Product) => void;\r\n    searchFunction: (params: { query?: string; page?: number; limit?: number; filters?: Record<string, unknown> }) => Promise<{ products: Product[]; totalCount: number; totalPages: number }>;\r\n    translations?: Record<string, string>;\r\n    loadComponent?: (importFn: () => Promise<{ default: unknown }>) => Promise<unknown>;\r\n    createLazyLoader?: (callback: () => void, options?: IntersectionObserverInit) => (node: Element) => { destroy?: () => void };\r\n    class?: string;\r\n  }\r\n  \r\n  let { \r\n    searchQuery = '', \r\n    filters = {},\r\n    onProductClick, \r\n    onFavorite,\r\n    searchFunction,\r\n    translations = {},\r\n    loadComponent,\r\n    createLazyLoader,\r\n    class: className = ''\r\n  }: Props = $props();\r\n  \r\n  let container: HTMLElement;\r\n  let ProductGrid: unknown;\r\n  let isLoaded = $state(false);\r\n  let products = $state<Product[]>([]);\r\n  let loading = $state(false);\r\n  let error = $state<string | null>(null);\r\n  let totalCount = $state(0);\r\n  let currentPage = $state(1);\r\n  let hasMore = $state(true);\r\n  \r\n  // Lazy load components when they're needed\r\n  async function loadComponents() {\r\n    if (isLoaded) return;\r\n    \r\n    try {\r\n      if (loadComponent) {\r\n        // Use provided loadComponent function for dynamic imports\r\n        ProductGrid = await loadComponent(() => import('../cards/ProductCard.svelte'));\r\n      }\r\n      \r\n      isLoaded = true;\r\n      \r\n      // Load initial data\r\n      await loadSearchResults();\r\n    } catch (err) {\r\n      \r\n      error = 'Failed to load search interface';\r\n    }\r\n  }\r\n  \r\n  // Search function using provided search function\r\n  async function loadSearchResults(page = 1, append = false) {\r\n    if (loading) return;\r\n    \r\n    loading = true;\r\n    error = null;\r\n    \r\n    try {\r\n      const result = await searchFunction({\r\n        query: searchQuery,\r\n        page,\r\n        limit: 20,\r\n        ...filters\r\n      });\r\n      \r\n      if (append) {\r\n        products = [...products, ...result.products];\r\n      } else {\r\n        products = result.products;\r\n      }\r\n      \r\n      totalCount = result.totalCount;\r\n      currentPage = page;\r\n      hasMore = page < result.totalPages;\r\n      \r\n    } catch (err) {\r\n      \r\n      error = err instanceof Error ? err.message : 'Search failed';\r\n    } finally {\r\n      loading = false;\r\n    }\r\n  }\r\n  \r\n  // Load more products for infinite scroll\r\n  async function loadMore() {\r\n    if (hasMore && !loading) {\r\n      await loadSearchResults(currentPage + 1, true);\r\n    }\r\n  }\r\n  \r\n  // Intersection observer for infinite scroll\r\n  function createInfiniteScroll(node: Element) {\r\n    if (!window.IntersectionObserver) return;\r\n    \r\n    const observer = new IntersectionObserver((entries) => {\r\n      entries.forEach(entry => {\r\n        if (entry.isIntersecting && hasMore && !loading) {\r\n          loadMore();\r\n        }\r\n      });\r\n    }, {\r\n      rootMargin: '200px'\r\n    });\r\n    \r\n    observer.observe(node);\r\n    \r\n    return {\r\n      destroy() {\r\n        observer.disconnect();\r\n      }\r\n    };\r\n  }\r\n  \r\n  // Watch for search query changes\r\n  $effect(() => {\r\n    if (searchQuery && isLoaded) {\r\n      currentPage = 1;\r\n      loadSearchResults();\r\n    }\r\n  });\r\n  \r\n  // Watch for filter changes\r\n  $effect(() => {\r\n    if (filters && isLoaded) {\r\n      currentPage = 1;\r\n      loadSearchResults();\r\n    }\r\n  });\r\n  \r\n  $effect(() => {\r\n    if (createLazyLoader) {\r\n      // Use provided lazy loader\r\n      const lazyLoader = createLazyLoader(loadComponents, { rootMargin: '100px' });\r\n      return lazyLoader(container);\r\n    } else {\r\n      // Fallback - load immediately\r\n      loadComponents();\r\n    }\r\n  });\r\n</script>\r\n\r\n<div bind:this={container} class=\"lazy-search-results {className}\">\r\n  {#if !isLoaded}\r\n    <!-- Loading placeholder (token-based for dark mode) -->\r\n    <div class=\"flex items-center justify-center h-64\">\r\n      <div class=\"animate-pulse space-y-4 w-full\">\r\n        <div class=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 sm:gap-4\">\r\n          {#each Array(10) as _}\r\n            <div class=\"rounded-lg aspect-square bg-[color:var(--surface-subtle)]\"></div>\r\n          {/each}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  {:else if error}\r\n    <!-- Error state -->\r\n    <div class=\"text-center py-12\">\r\n      <div class=\"text-[color:var(--status-error-solid)] mb-4\">\r\n        <svg class=\"mx-auto h-12 w-12\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" \r\n            d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z\" />\r\n        </svg>\r\n      </div>\r\n      <h3 class=\"text-lg font-medium text-[color:var(--text-primary)] mb-2\">Search Error</h3>\r\n      <p class=\"text-[color:var(--text-muted)] mb-4\">{error}</p>\r\n      <button \r\n        onclick={() => loadSearchResults()}\r\n        class=\"px-4 py-2 rounded-lg transition-colors bg-[color:var(--status-info-solid)] text-[color:var(--text-inverse)] hover:brightness-95\"\r\n      >\r\n        Try Again\r\n      </button>\r\n    </div>\r\n  {:else if products.length === 0 && !loading}\r\n    <!-- Empty state -->\r\n    <div class=\"text-center py-12\">\r\n      <div class=\"text-[color:var(--text-muted)] mb-4\">\r\n        <svg class=\"mx-auto h-12 w-12\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" \r\n            d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\r\n        </svg>\r\n      </div>\r\n      <h3 class=\"text-lg font-medium text-[color:var(--text-primary)] mb-2\">No products found</h3>\r\n      <p class=\"text-[color:var(--text-muted)]\">Try adjusting your search or filters</p>\r\n    </div>\r\n  {:else}\r\n    <!-- Results -->\r\n    <div class=\"space-y-4\">\r\n      <!-- Results count -->\r\n      <div class=\"text-sm text-[color:var(--text-muted)]\">\r\n        {totalCount} {totalCount === 1 ? 'product' : 'products'} found\r\n      </div>\r\n      \r\n      <!-- Use virtual scrolling for large result sets -->\r\n      {#if products.length > 50}\r\n        <VirtualProductGrid \r\n          items={products}\r\n          {onProductClick}\r\n          {onFavorite}\r\n          {translations}\r\n          itemHeight={320}\r\n          containerHeight={600}\r\n        />\r\n      {:else}\r\n        <!-- Regular grid for smaller result sets -->\r\n        <div class=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 sm:gap-4\">\r\n          {#each products as product}\r\n            <div class=\"product-item\">\r\n              <!-- Product card will be rendered here -->\r\n              <div class=\"bg-white rounded-lg shadow-sm border p-3\">\r\n                <div class=\"aspect-square bg-gray-100 rounded-lg mb-3\">\r\n                  <enhanced:img\r\n                    src={product.images?.[0] || '/placeholder-product.svg'}\r\n                    alt={product.title}\r\n                    class=\"w-full h-full object-cover rounded-lg\"\r\n                    loading=\"lazy\"\r\n                    sizes=\"(max-width: 768px) 50vw, (max-width: 1024px) 33vw, 20vw\"\r\n                  />\r\n                </div>\r\n                <h3 class=\"text-sm font-medium text-gray-900 line-clamp-2 mb-1\">\r\n                  {product.title}\r\n                </h3>\r\n                <p class=\"text-lg font-semibold text-gray-900\">\r\n                  ${product.price}\r\n                </p>\r\n                {#if product.brand}\r\n                  <p class=\"text-xs text-gray-500 mt-1\">{product.brand}</p>\r\n                {/if}\r\n                <button\r\n                  onclick={() => onProductClick(product)}\r\n                  class=\"mt-2 w-full bg-blue-600 text-white py-2 px-4 rounded-lg text-sm hover:bg-blue-700 transition-colors\"\r\n                >\r\n                  View Details\r\n                </button>\r\n              </div>\r\n            </div>\r\n          {/each}\r\n        </div>\r\n      {/if}\r\n      \r\n      <!-- Load more trigger for infinite scroll -->\r\n      {#if hasMore}\r\n        <div use:createInfiniteScroll class=\"text-center py-8\">\r\n          {#if loading}\r\n            <div class=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"></div>\r\n          {:else}\r\n            <button \r\n              onclick={loadMore}\r\n              class=\"px-6 py-3 border border-gray-300 rounded-lg text-gray-900 hover:bg-gray-50 transition-colors\"\r\n            >\r\n              Load More\r\n            </button>\r\n          {/if}\r\n        </div>\r\n      {/if}\r\n    </div>\r\n  {/if}\r\n</div>\r\n\r\n<style>\r\n  .lazy-search-results {\r\n    contain: layout style;\r\n  }\r\n  \r\n  .product-item {\r\n    contain: layout style;\r\n  }\r\n  \r\n  .line-clamp-2 {\r\n    display: -webkit-box;\r\n    -webkit-line-clamp: 2;\r\n    -webkit-box-orient: vertical;\r\n    overflow: hidden;\r\n  }\r\n</style>\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\MainPageSearchBar.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Profile' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'QuickShopItem' is defined but never used. Allowed unused vars must match /^_/u.","line":37,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1404,1407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1404,1407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1600,1603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1600,1603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentLang' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":84,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":84,"endColumn":14},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":191,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":191,"endColumn":63,"suggestions":[{"messageId":"addBrackets","fix":{"range":[5910,6062],"text":"{ e.preventDefault();\r\n        const nextIndex = Math.min(index + 1, totalPills - 1);\r\n        (pills[nextIndex] as HTMLElement)?.focus();\r\n        break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":196,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":196,"endColumn":50,"suggestions":[{"messageId":"addBrackets","fix":{"range":[6097,6236],"text":"{ e.preventDefault();\r\n        const prevIndex = Math.max(index - 1, 0);\r\n        (pills[prevIndex] as HTMLElement)?.focus();\r\n        break; }"},"desc":"Add {} brackets around the case block."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\nimport type { Database } from '@repo/database';\r\nimport SearchInput from '../forms/SearchInput.svelte';\r\nimport CategoryPill from '../ui/CategoryPill.svelte';\r\n\r\ntype Category = Database['public']['Tables']['categories']['Row'];\r\ntype Profile = Database['public']['Tables']['profiles']['Row'];\r\n\r\n// Extended category with UI-specific fields\r\ninterface CategoryWithCount extends Category {\r\n  product_count?: number;\r\n}\r\n\r\ninterface TopBrand {\r\n  id: string;\r\n  name: string;\r\n  avatar?: string | null;\r\n  verified?: boolean;\r\n  trending: string;\r\n  items: number;\r\n}\r\n\r\ninterface TopSeller {\r\n  id: string;\r\n  username: string;\r\n  display_name?: string | null;\r\n  full_name?: string | null;\r\n  avatar_url?: string | null;\r\n  name?: string | null; // Computed from display_name || full_name || username\r\n  avatar?: string | null; // Alias for avatar_url\r\n  verified?: boolean;\r\n  items?: number;\r\n  product_count?: number;\r\n  rating?: number;\r\n}\r\n\r\ninterface QuickShopItem {\r\n  label: string;\r\n  description: string;\r\n  filter: string;\r\n  icon: string;\r\n}\r\n\r\ninterface ConditionFilter {\r\n  key: string;\r\n  label: string;\r\n  shortLabel: string;\r\n}\r\n\r\ninterface Props {\r\n  searchQuery?: string;\r\n  topBrands?: TopBrand[];\r\n  topSellers?: TopSeller[];\r\n  mainCategories?: CategoryWithCount[];\r\n  virtualCategories?: CategoryWithCount[];\r\n  conditionFilters?: ConditionFilter[];\r\n  i18n: any;\r\n  currentLang?: string;\r\n  selectedCondition?: string | null;\r\n  loadingCategory?: string | null;\r\n  onSearch: (query: string) => void;\r\n  onQuickSearch?: (query: string) => Promise<{ data: any[]; error: string | null }>;\r\n  onCategorySelect: (slug: string) => void;\r\n  onConditionFilter: (condition: string) => void;\r\n  onNavigateToAll: () => void;\r\n  onPillKeyNav?: (e: KeyboardEvent, index: number) => void;\r\n  onPrefetchCategory?: (slug: string) => void;\r\n  onPrefetchSearch?: () => void;\r\n  onNavigateToBrand?: (brandName: string) => void;\r\n  onNavigateToSeller?: (sellerName: string) => void;\r\n  onNavigateToDrip?: () => void;\r\n  onNavigateToQuickShop?: (filter: string) => void;\r\n  currentPath?: string;\r\n}\r\n\r\nlet {\r\n  searchQuery = $bindable(''),\r\n  topBrands = [],\r\n  topSellers = [],\r\n  mainCategories = [],\r\n  virtualCategories = [],\r\n  conditionFilters = [],\r\n  i18n,\r\n  currentLang = 'bg',\r\n  selectedCondition = null,\r\n  loadingCategory = null,\r\n  onSearch,\r\n  onQuickSearch,\r\n  onCategorySelect,\r\n  onConditionFilter,\r\n  onNavigateToAll,\r\n  onPillKeyNav,\r\n  onPrefetchCategory,\r\n  onPrefetchSearch,\r\n  onNavigateToBrand,\r\n  onNavigateToSeller,\r\n  onNavigateToDrip,\r\n  onNavigateToQuickShop,\r\n  currentPath = ''\r\n}: Props = $props();\r\n\r\n\r\n// Component state\r\nlet showTrendingDropdown = $state(false);\r\nlet activeDropdownTab = $state('trending');\r\nlet dropdownSearchQuery = $state('');\r\n\r\n// Optimized derived data for dropdown - using $derived.by() for better performance\r\nconst filteredTopBrands = $derived.by(() => {\r\n  if (!dropdownSearchQuery.trim()) return topBrands;\r\n  const query = dropdownSearchQuery.toLowerCase();\r\n  return topBrands.filter(brand =>\r\n    brand.name.toLowerCase().includes(query)\r\n  );\r\n});\r\n\r\nconst filteredTopSellers = $derived.by(() => {\r\n  if (!dropdownSearchQuery.trim()) return topSellers;\r\n  const query = dropdownSearchQuery.toLowerCase();\r\n  return topSellers.filter(seller => {\r\n    const name = seller.name || seller.display_name || seller.username || '';\r\n    return name.toLowerCase().includes(query);\r\n  });\r\n});\r\n\r\n// Quick shop items\r\nconst quickShopItems = [\r\n  { label: 'Under $25', description: 'Budget finds', filter: 'max_price=25', icon: '💰' },\r\n  { label: 'Drip Collection', description: 'Staff picks', filter: 'collection=drip', icon: '💧' },\r\n  { label: 'Designer $100+', description: 'Premium pieces', filter: 'min_price=100', icon: '💎' },\r\n  { label: 'New with Tags', description: 'Brand new condition', filter: 'condition=brand_new_with_tags', icon: '🏷️' },\r\n  { label: 'Like New', description: 'Excellent condition', filter: 'condition=like_new', icon: '✨' }\r\n];\r\n\r\n// Optimized quick shop items filtering\r\nconst filteredQuickShopItems = $derived.by(() => {\r\n  if (!dropdownSearchQuery.trim()) return quickShopItems;\r\n  const query = dropdownSearchQuery.toLowerCase();\r\n  return quickShopItems.filter(item =>\r\n    item.label.toLowerCase().includes(query) ||\r\n    item.description.toLowerCase().includes(query)\r\n  );\r\n});\r\n\r\n// Hide trending dropdown when user starts typing - use derived instead of effect\r\nconst shouldHideTrendingDropdown = $derived(searchQuery.trim().length > 0);\r\n\r\n// Update showTrendingDropdown based on derived value\r\n$effect(() => {\r\n  if (shouldHideTrendingDropdown) {\r\n    showTrendingDropdown = false;\r\n  }\r\n});\r\n\r\n// Handle click outside for trending dropdown - effect for DOM listeners only\r\n$effect(() => {\r\n  if (typeof window !== 'undefined' && showTrendingDropdown) {\r\n    const handleClickOutside = (e: MouseEvent) => {\r\n      const target = e.target as HTMLElement;\r\n      if (!target.closest('#hero-search-container')) {\r\n        showTrendingDropdown = false;\r\n      }\r\n    };\r\n\r\n    document.addEventListener('click', handleClickOutside, true);\r\n    return () => document.removeEventListener('click', handleClickOutside, true);\r\n  }\r\n});\r\n\r\nfunction handleQuickCondition(conditionKey: string) {\r\n  onConditionFilter(conditionKey);\r\n}\r\n\r\nfunction prefetchCategoryPage(categorySlug: string) {\r\n  if (onPrefetchCategory) {\r\n    onPrefetchCategory(categorySlug);\r\n  }\r\n  // Note: UI package components should use callback props for navigation/prefetching\r\n}\r\n\r\nfunction handlePillKeyNav(e: KeyboardEvent, index: number) {\r\n  if (onPillKeyNav) {\r\n    onPillKeyNav(e, index);\r\n  } else {\r\n    const pills = document.querySelectorAll('#category-pills button');\r\n    const totalPills = mainCategories.length + 1 + virtualCategories.length;\r\n\r\n    switch(e.key) {\r\n      case 'ArrowRight':\r\n        e.preventDefault();\r\n        const nextIndex = Math.min(index + 1, totalPills - 1);\r\n        (pills[nextIndex] as HTMLElement)?.focus();\r\n        break;\r\n      case 'ArrowLeft':\r\n        e.preventDefault();\r\n        const prevIndex = Math.max(index - 1, 0);\r\n        (pills[prevIndex] as HTMLElement)?.focus();\r\n        break;\r\n      case 'Home':\r\n        e.preventDefault();\r\n        (pills[0] as HTMLElement)?.focus();\r\n        break;\r\n      case 'End':\r\n        e.preventDefault();\r\n        (pills[totalPills - 1] as HTMLElement)?.focus();\r\n        break;\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<!-- Sticky Search + Category Navigation (compact) -->\r\n<div class=\"bg-[color:var(--surface-base)] sticky top-[var(--app-header-offset)] z-40 border-b border-[color:var(--border-subtle)]\">\r\n  <div class=\"px-2 sm:px-4 lg:px-6 py-[var(--gutter-xxs)] sm:py-[var(--gutter-xs)]\">\r\n    <div class=\"mx-auto relative\">\r\n      <!-- Hero Search -->\r\n      <div id=\"hero-search-container\" class=\"relative py-0\">\r\n        <SearchInput\r\n          bind:searchValue={searchQuery}\r\n          onSearch={onSearch}\r\n          placeholder={i18n.search_placeholder()}\r\n          searchId=\"hero-search-input\"\r\n          searchFunction={onQuickSearch}\r\n          showDropdown={true}\r\n          maxResults={6}\r\n        >\r\n          {#snippet leftSection()}\r\n            <button\r\n              type=\"button\"\r\n              onclick={() => showTrendingDropdown = !showTrendingDropdown}\r\n              class=\"h-11 px-3 bg-transparent hover:bg-[color:var(--surface-subtle)] transition-all duration-200 flex items-center gap-2 focus:outline-none focus:bg-[color:var(--surface-subtle)] border-r border-[color:var(--border-subtle)] rounded-l-[var(--input-radius)] focus-visible:ring-2 focus-visible:ring-[color:var(--input-focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[color:var(--surface-emphasis)]\"\r\n              aria-expanded={showTrendingDropdown}\r\n              aria-haspopup=\"listbox\"\r\n              aria-label={i18n.search_categories()}\r\n            >\r\n              <span class=\"text-sm font-medium text-[color:var(--text-secondary)]\">{i18n.menu_browse()}</span>\r\n              <svg class=\"w-3 h-3 text-[color:var(--text-tertiary)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\" />\r\n              </svg>\r\n            </button>\r\n          {/snippet}\r\n        </SearchInput>\r\n\r\n        {#if showTrendingDropdown}\r\n          <div class=\"absolute top-full left-0 right-0 mt-1 z-50\">\r\n            <div class=\"bg-[color:var(--surface-base)] border border-[color:var(--border-subtle)] rounded-[var(--radius-sm)] shadow-lg p-[var(--space-4)] min-h-[300px] max-h-[80vh] overflow-y-auto\">\r\n              <div class=\"flex items-center gap-1 mb-3 bg-[color:var(--surface-subtle)] p-1 rounded-[var(--radius-sm)]\">\r\n                <button\r\n                  onclick={() => activeDropdownTab = 'trending'}\r\n                  class=\"flex-1 px-4 py-2.5 text-sm font-medium rounded-[var(--radius-sm)] transition-all duration-200 {activeDropdownTab === 'trending' ? 'bg-[color:var(--surface-base)] text-[color:var(--text-primary)] shadow-sm' : 'text-[color:var(--text-secondary)] hover:text-[color:var(--text-primary)]'}\"\r\n                >\r\n                  {i18n.nav_topBrands()}\r\n                </button>\r\n                <button\r\n                  onclick={() => activeDropdownTab = 'sellers'}\r\n                  class=\"flex-1 px-4 py-2.5 text-sm font-medium rounded-[var(--radius-sm)] transition-all duration-200 {activeDropdownTab === 'sellers' ? 'bg-white text-[color:var(--text-primary)] shadow-sm' : 'text-gray-600 hover:text-gray-900'}\"\r\n                >\r\n                  {i18n.nav_topSellers()}\r\n                </button>\r\n                <button\r\n                  onclick={() => activeDropdownTab = 'quickshop'}\r\n                  class=\"flex-1 px-4 py-2.5 text-sm font-medium rounded-[var(--radius-sm)] transition-all duration-200 {activeDropdownTab === 'quickshop' ? 'bg-white text-[color:var(--text-primary)] shadow-sm' : 'text-gray-600 hover:text-gray-900'}\"\r\n                >\r\n                  {i18n.nav_quickShop()}\r\n                </button>\r\n              </div>\r\n\r\n              <!-- Search Input -->\r\n              <div class=\"mb-4\">\r\n                <div class=\"relative\">\r\n                  <svg class=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[color:var(--text-tertiary)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"></path>\r\n                  </svg>\r\n                  <input\r\n                    type=\"text\"\r\n                    bind:value={dropdownSearchQuery}\r\n                    placeholder={activeDropdownTab === 'trending' ? 'Search brands...' :\r\n                                activeDropdownTab === 'sellers' ? 'Search sellers...' :\r\n                                'Search quick actions...'}\r\n                    class=\"w-full pl-10 pr-4 py-2.5 text-sm border border-gray-200 rounded-[var(--radius-sm)] focus:outline-none focus:ring-2 focus:ring-[color:var(--input-focus-ring)] focus:border-[color:var(--input-focus-border)] bg-gray-50 hover:bg-white transition-colors\"\r\n                  />\r\n                  {#if dropdownSearchQuery.trim()}\r\n                    <button\r\n                      onclick={() => dropdownSearchQuery = ''}\r\n                      class=\"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 hover:text-gray-600\"\r\n                      aria-label=\"Clear search input\"\r\n                      type=\"button\"\r\n                    >\r\n                      <svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                      </svg>\r\n                    </button>\r\n                  {/if}\r\n                </div>\r\n              </div>\r\n\r\n              {#if activeDropdownTab === 'trending'}\r\n                <div class=\"space-y-2\">\r\n                  {#if filteredTopBrands.length > 0}\r\n                    {#each filteredTopBrands as brand}\r\n                      <button\r\n                        onclick={() => {\r\n                          onNavigateToBrand?.(brand.name);\r\n                          showTrendingDropdown = false;\r\n                        }}\r\n                        class=\"w-full flex items-center gap-3 p-2.5 bg-gray-50 hover:bg-gray-100 hover:shadow-sm rounded-[var(--radius-sm)] border border-gray-200 hover:border-gray-300 transition-all duration-200 text-left group\"\r\n                      >\r\n                        <img\r\n                          src={brand.avatar || '/avatars/1.png'}\r\n                          alt={brand.name}\r\n                          class=\"w-8 h-8 rounded-full object-cover flex-shrink-0\"\r\n                          onerror={(e) => {\r\n                            const target = e.target as HTMLImageElement;\r\n                            target.src = '/avatars/1.png';\r\n                          }}\r\n                        />\r\n                        <div class=\"flex-1 min-w-0\">\r\n                          <div class=\"flex items-center gap-2\">\r\n                            <span class=\"text-sm font-medium text-gray-900 group-hover:text-[color:var(--text-primary)]\">{brand.name}</span>\r\n                            {#if brand.verified}\r\n                              <svg class=\"w-3 h-3 text-gray-900\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                                <path fill-rule=\"evenodd\" d=\"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\" />\r\n                              </svg>\r\n                            {/if}\r\n                            <span class=\"text-xs font-medium text-green-600 bg-green-50 px-1.5 py-0.5 rounded\">{brand.trending}</span>\r\n                          </div>\r\n                          <span class=\"text-xs text-gray-500\">{brand.items} items</span>\r\n                        </div>\r\n                      </button>\r\n                    {/each}\r\n                  {:else if dropdownSearchQuery.trim()}\r\n                    <div class=\"text-center py-8 text-gray-500\">\r\n                      <svg class=\"w-8 h-8 mx-auto mb-2 text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"></path>\r\n                      </svg>\r\n                      <p class=\"text-sm\">No brands found matching \"{dropdownSearchQuery}\"</p>\r\n                    </div>\r\n                  {/if}\r\n                </div>\r\n              {:else if activeDropdownTab === 'sellers'}\r\n                <div class=\"space-y-2\">\r\n                  {#if filteredTopSellers.length > 0}\r\n                    {#each filteredTopSellers as seller}\r\n                      <button\r\n                        onclick={() => {\r\n                          onNavigateToSeller?.(seller.name ?? seller.username ?? \"\");\r\n                          showTrendingDropdown = false;\r\n                        }}\r\n                        class=\"w-full flex items-center gap-3 p-2.5 bg-gray-50 hover:bg-gray-100 hover:shadow-sm rounded-[var(--radius-sm)] border border-gray-200 hover:border-gray-300 transition-all duration-200 text-left group\"\r\n                      >\r\n                        <img\r\n                          src={seller.avatar || '/avatars/1.png'}\r\n                          alt={seller.name}\r\n                          class=\"w-8 h-8 rounded-full object-cover flex-shrink-0\"\r\n                          onerror={(e) => {\r\n                            const target = e.target as HTMLImageElement;\r\n                            target.src = '/avatars/1.png';\r\n                          }}\r\n                        />\r\n                        <div class=\"flex-1 min-w-0\">\r\n                          <div class=\"flex items-center gap-2\">\r\n                            <span class=\"text-sm font-medium text-gray-900 group-hover:text-[color:var(--text-primary)] truncate\">{seller.name}</span>\r\n                            {#if seller.verified}\r\n                              <svg class=\"w-3 h-3 text-gray-900\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                                <path fill-rule=\"evenodd\" d=\"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\" />\r\n                              </svg>\r\n                            {/if}\r\n                          </div>\r\n                          <div class=\"flex items-center gap-2 text-xs text-gray-500\">\r\n                            <span>{seller.items} items</span>\r\n                            {#if seller.rating && seller.rating > 0}\r\n                              <span>•</span>\r\n                              <div class=\"flex items-center gap-1\">\r\n                                <svg class=\"w-3 h-3 text-yellow-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                                  <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\r\n                                </svg>\r\n                                <span>{seller.rating?.toFixed(1)}</span>\r\n                              </div>\r\n                            {/if}\r\n                          </div>\r\n                        </div>\r\n                      </button>\r\n                    {/each}\r\n                  {:else if dropdownSearchQuery.trim()}\r\n                    <div class=\"text-center py-8 text-gray-500\">\r\n                      <svg class=\"w-8 h-8 mx-auto mb-2 text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"></path>\r\n                      </svg>\r\n                      <p class=\"text-sm\">No sellers found matching \"{dropdownSearchQuery}\"</p>\r\n                    </div>\r\n                  {/if}\r\n                </div>\r\n              {:else if activeDropdownTab === 'quickshop'}\r\n                <div class=\"space-y-2\">\r\n                  {#if filteredQuickShopItems.length > 0}\r\n                    {#each filteredQuickShopItems as item}\r\n                      <button\r\n                        onclick={() => {\r\n                          if (item.filter === 'collection=drip') {\r\n                            onNavigateToDrip?.();\r\n                          } else {\r\n                            onNavigateToQuickShop?.(item.filter);\r\n                          }\r\n                          showTrendingDropdown = false;\r\n                        }}\r\n                        class=\"w-full flex items-center gap-2.5 p-2.5 bg-gray-50 hover:bg-gray-100 hover:shadow-sm rounded-[var(--radius-sm)] border border-gray-200 hover:border-gray-300 transition-all duration-200 text-left group\"\r\n                      >\r\n                        <span class=\"text-lg\">{item.icon}</span>\r\n                        <div class=\"flex-1 min-w-0\">\r\n                          <span class=\"text-sm font-medium text-gray-900 group-hover:text-[color:var(--text-primary)] block\">{item.label}</span>\r\n                          <span class=\"text-xs text-gray-500\">{item.description}</span>\r\n                        </div>\r\n                      </button>\r\n                    {/each}\r\n                  {:else if dropdownSearchQuery.trim()}\r\n                    <div class=\"text-center py-8 text-gray-500\">\r\n                      <svg class=\"w-8 h-8 mx-auto mb-2 text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"></path>\r\n                      </svg>\r\n                      <p class=\"text-sm\">No quick actions found matching \"{dropdownSearchQuery}\"</p>\r\n                    </div>\r\n                  {/if}\r\n                </div>\r\n              {/if}\r\n            </div>\r\n          </div>\r\n        {/if}\r\n      </div>\r\n\r\n      <!-- Category Pills -->\r\n      <nav\r\n        id=\"category-pills\"\r\n        aria-label={i18n.nav_browseCategories()}\r\n        class=\"flex items-center justify-start gap-2 sm:gap-3 overflow-x-auto scrollbarhide pt-[var(--gutter-xxs)] pb-[var(--gutter-xxs)] sm:justify-center\"\r\n      >\r\n        <!-- All Categories -->\r\n        <CategoryPill\r\n          variant=\"muted\"\r\n          label={i18n.search_all()}\r\n          loading={loadingCategory === 'all'}\r\n          disabled={loadingCategory === 'all'}\r\n          ariaLabel={i18n.search_viewAll()}\r\n          ariaCurrent={currentPath === '/search' ? 'page' : undefined}\r\n          data-prefetch=\"hover\"\r\n          onmouseenter={() => onPrefetchSearch?.()}\r\n          ontouchstart={() => onPrefetchSearch?.()}\r\n          onclick={onNavigateToAll}\r\n          onkeydown={(e: KeyboardEvent) => handlePillKeyNav(e, 0)}\r\n          class=\"min-h-11\"\r\n        />\r\n\r\n        <!-- Main Categories -->\r\n        {#each mainCategories as category, index}\r\n          <CategoryPill\r\n            label={category.name}\r\n            loading={loadingCategory === category.slug}\r\n            disabled={loadingCategory === category.slug}\r\n            ariaLabel={`Browse ${category.name}`}\r\n            itemCount={category.product_count || 0}\r\n            showItemCount={(category.product_count || 0) > 0}\r\n            data-prefetch=\"hover\"\r\n            data-category={category.slug}\r\n            onmouseenter={() => prefetchCategoryPage(category.slug)}\r\n            ontouchstart={() => prefetchCategoryPage(category.slug)}\r\n            onclick={() => onCategorySelect(category.slug)}\r\n            onkeydown={(e: KeyboardEvent) => handlePillKeyNav(e, index + 1)}\r\n            class=\"min-h-11\"\r\n          />\r\n        {/each}\r\n\r\n        <!-- Virtual Categories -->\r\n        {#each virtualCategories as virtualCategory, index}\r\n          <CategoryPill\r\n            variant=\"outline\"\r\n            label={virtualCategory.name}\r\n            loading={loadingCategory === virtualCategory.slug}\r\n            disabled={loadingCategory === virtualCategory.slug}\r\n            ariaLabel={`Browse ${virtualCategory.name}`}\r\n            itemCount={virtualCategory.product_count || 0}\r\n            showItemCount={true}\r\n            data-prefetch=\"hover\"\r\n            data-category={virtualCategory.slug}\r\n            onmouseenter={() => prefetchCategoryPage(virtualCategory.slug)}\r\n            ontouchstart={() => prefetchCategoryPage(virtualCategory.slug)}\r\n            onclick={() => onCategorySelect(virtualCategory.slug)}\r\n            onkeydown={(e: KeyboardEvent) => handlePillKeyNav(e, mainCategories.length + 1 + index)}\r\n            class=\"min-h-11\"\r\n          />\r\n        {/each}\r\n\r\n        <!-- Condition Pills -->\r\n        {#each conditionFilters as condition, index}\r\n          <CategoryPill\r\n            variant={selectedCondition === condition.key ? 'primary' : 'secondary'}\r\n            label={condition.shortLabel}\r\n            emoji={index === 0 ? '🏷️' : index === 1 ? '💎' : '👍'}\r\n            ariaLabel={`Filter by ${condition.label}`}\r\n            onclick={() => handleQuickCondition(condition.key)}\r\n            class=\"min-h-11\"\r\n          />\r\n        {/each}\r\n      </nav>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\MegaMenuCategories.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\MobileMenuSearch.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":56,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":56,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import type { Database } from '@repo/database';\r\n\r\n  // Define ProductWithImages type locally\r\n  type Product = Database['public']['Tables']['products']['Row'];\r\n  type ProductImage = Database['public']['Tables']['product_images']['Row'];\r\n\r\n  export interface ProductWithImages extends Product {\r\n    images: ProductImage[];\r\n    category_name?: string;\r\n    seller_name?: string;\r\n    seller_username?: string;\r\n    seller_rating?: number;\r\n  }\r\n\r\n  interface Props {\r\n    placeholder?: string;\r\n    onSearch?: (query: string) => void;\r\n    onClose?: () => void;\r\n    searchFunction?: (query: string) => Promise<{ data: ProductWithImages[]; error: string | null }>;\r\n    onNavigateToSearch?: (query: string) => void;\r\n    onNavigateToProduct?: (productId: string) => void;\r\n    class?: string;\r\n  }\r\n\r\n  let {\r\n    placeholder = 'Search for items...',\r\n    onSearch,\r\n    onClose,\r\n    searchFunction,\r\n    onNavigateToSearch,\r\n    onNavigateToProduct,\r\n    class: className = ''\r\n  }: Props = $props();\r\n\r\n  let searchValue = $state('');\r\n  let inputElement: HTMLInputElement;\r\n  let isSearching = $state(false);\r\n  let quickResults = $state<ProductWithImages[]>([]);\r\n  let showResults = $derived(searchValue.trim().length > 0 && quickResults.length > 0);\r\n\r\n  // Debounce search to avoid too many API calls\r\n  let searchTimeout: ReturnType<typeof setTimeout>;\r\n\r\n  $effect(() => {\r\n    if (searchValue.trim().length > 1 && searchFunction) {\r\n      if (searchTimeout) clearTimeout(searchTimeout);\r\n\r\n      searchTimeout = setTimeout(async () => {\r\n        isSearching = true;\r\n        try {\r\n          const result = await searchFunction(searchValue.trim());\r\n          if (result.data) {\r\n            quickResults = result.data.slice(0, 4); // Show max 4 quick results\r\n          }\r\n        } catch (error) {\r\n          \r\n          quickResults = [];\r\n        } finally {\r\n          isSearching = false;\r\n        }\r\n      }, 300);\r\n    } else {\r\n      quickResults = [];\r\n    }\r\n\r\n    return () => {\r\n      if (searchTimeout) clearTimeout(searchTimeout);\r\n    };\r\n  });\r\n\r\n  function handleInput(e: Event) {\r\n    const value = (e.target as HTMLInputElement).value;\r\n    searchValue = value;\r\n  }\r\n\r\n  function handleSubmit(e: SubmitEvent) {\r\n    e.preventDefault();\r\n    executeSearch();\r\n  }\r\n\r\n  function handleKeyDown(e: KeyboardEvent) {\r\n    if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      executeSearch();\r\n    }\r\n  }\r\n\r\n  function executeSearch() {\r\n    if (!searchValue.trim()) return;\r\n\r\n    const query = searchValue.trim();\r\n\r\n    if (onSearch) {\r\n      onSearch(query);\r\n    } else if (onNavigateToSearch) {\r\n      onNavigateToSearch(query);\r\n    }\r\n\r\n    // Close the mobile menu after search\r\n    if (onClose) {\r\n      onClose();\r\n    }\r\n  }\r\n\r\n  function handleProductSelect(product: ProductWithImages) {\r\n    if (onNavigateToProduct) {\r\n      onNavigateToProduct(product.id);\r\n    }\r\n    if (onClose) {\r\n      onClose();\r\n    }\r\n  }\r\n\r\n  function clearSearch() {\r\n    searchValue = '';\r\n    quickResults = [];\r\n    inputElement?.focus();\r\n  }\r\n\r\n  // Format price for display\r\n  function formatPrice(price: number): string {\r\n    return new Intl.NumberFormat('en-US', {\r\n      style: 'currency',\r\n      currency: 'USD'\r\n    }).format(price);\r\n  }\r\n</script>\r\n\r\n<div class=\"mobile-menu-search {className}\">\r\n  <!-- Search Form -->\r\n  <form onsubmit={handleSubmit} class=\"mb-4\">\r\n    <div class=\"relative\">\r\n      <input\r\n        bind:this={inputElement}\r\n        type=\"search\"\r\n        value={searchValue}\r\n        oninput={handleInput}\r\n        onkeydown={handleKeyDown}\r\n        {placeholder}\r\n        class=\"w-full h-12 pl-12 pr-12 bg-gray-50 border border-gray-200 rounded-xl text-base placeholder-gray-500 focus:bg-white focus:border-gray-400 focus:ring-0 focus:outline-none transition-all duration-200 touch-manipulation\"\r\n        autocomplete=\"off\"\r\n        spellcheck=\"false\"\r\n        aria-label={placeholder}\r\n      />\r\n\r\n      <!-- Search Icon -->\r\n      <svg class=\"absolute left-4 top-3.5 w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\r\n      </svg>\r\n\r\n      <!-- Clear Button -->\r\n      {#if searchValue}\r\n        <button\r\n          type=\"button\"\r\n          onclick={clearSearch}\r\n          class=\"absolute right-3 top-3 p-1 text-gray-400 hover:text-gray-600 rounded-md touch-manipulation\"\r\n          aria-label=\"Clear search\"\r\n        >\r\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\r\n          </svg>\r\n        </button>\r\n      {/if}\r\n\r\n      <!-- Loading Indicator -->\r\n      {#if isSearching}\r\n        <div class=\"absolute right-3 top-3.5\">\r\n          <svg class=\"animate-spin w-5 h-5 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n            <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\r\n            <path class=\"opacity-75\" fill=\"currentColor\" d=\"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n          </svg>\r\n        </div>\r\n      {/if}\r\n    </div>\r\n  </form>\r\n\r\n  <!-- Quick Search Results -->\r\n  {#if showResults}\r\n    <div class=\"quick-results bg-white rounded-lg border border-gray-200 shadow-sm mb-4\">\r\n      <div class=\"p-3 border-b border-gray-100\">\r\n        <h3 class=\"text-sm font-medium text-gray-900\">Quick Results</h3>\r\n      </div>\r\n\r\n      <div class=\"max-h-64 overflow-y-auto\">\r\n        {#each quickResults as product}\r\n          <button\r\n            onclick={() => handleProductSelect(product)}\r\n            class=\"w-full flex items-center gap-3 px-3 py-3 hover:bg-gray-50 active:bg-gray-100 transition-colors touch-manipulation\"\r\n          >\r\n            <!-- Product Image -->\r\n            <div class=\"flex-shrink-0 w-12 h-12 rounded-lg overflow-hidden bg-gray-100\">\r\n              {#if product.images && product.images[0]?.image_url}\r\n                <img\r\n                  src={product.images[0].image_url}\r\n                  alt={product.title}\r\n                  class=\"w-full h-full object-cover\"\r\n                  loading=\"lazy\"\r\n                />\r\n              {:else}\r\n                <div class=\"w-full h-full bg-gray-200 flex items-center justify-center\">\r\n                  <svg class=\"w-6 h-6 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                  </svg>\r\n                </div>\r\n              {/if}\r\n            </div>\r\n\r\n            <!-- Product Details -->\r\n            <div class=\"flex-1 min-w-0 text-left\">\r\n              <div class=\"font-medium text-gray-900 text-sm truncate\">\r\n                {product.title}\r\n              </div>\r\n              <div class=\"text-sm text-gray-500 truncate\">\r\n                {product.category_name || 'Category'}\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Price -->\r\n            <div class=\"flex-shrink-0 text-sm font-semibold text-gray-900\">\r\n              {formatPrice(product.price)}\r\n            </div>\r\n          </button>\r\n        {/each}\r\n      </div>\r\n\r\n      <!-- View All Results -->\r\n      <div class=\"p-3 border-t border-gray-100\">\r\n        <button\r\n          onclick={executeSearch}\r\n          class=\"w-full px-4 py-2 bg-black text-white text-sm font-medium rounded-lg hover:bg-gray-800 active:bg-gray-900 transition-colors touch-manipulation\"\r\n        >\r\n          View all results for \"{searchValue}\"\r\n        </button>\r\n      </div>\r\n    </div>\r\n  {/if}\r\n</div>\r\n\r\n<style>\r\n  .mobile-menu-search {\r\n    /* Ensure proper touch scrolling on mobile */\r\n    -webkit-overflow-scrolling: touch;\r\n  }\r\n\r\n  .quick-results {\r\n    /* Ensure dropdown doesn't interfere with mobile navigation */\r\n    z-index: 10;\r\n  }\r\n\r\n  /* iOS Safari specific fixes */\r\n  @supports (-webkit-touch-callout: none) {\r\n    .mobile-menu-search input[type=\"search\"] {\r\n      -webkit-appearance: none;\r\n      appearance: none;\r\n    }\r\n  }\r\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\MobileNavigationDialog.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MegaMenuCategories' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'i18n' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'canSell' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":20,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onCategoryClick' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'level' is assigned a value but never used. Allowed unused args must match /^_/u.","line":101,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'path' is assigned a value but never used. Allowed unused args must match /^_/u.","line":101,"column":73,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":77},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'query' is defined but never used. Allowed unused args must match /^_/u.","line":159,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":159,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import MegaMenuCategories from './MegaMenuCategories.svelte';\r\n  import MobileMenuSearch from './MobileMenuSearch.svelte';\r\n  import Avatar from '../ui/Avatar.svelte';\r\n  import LanguageSwitcher from '../utilities/LanguageSwitcher.svelte';\r\n  import ThemeToggle from '../ui/ThemeToggle.svelte';\r\n  import { isBrowser } from '../../utils/runtime.js';\r\n  import { portal } from '../../actions/portal';\r\n  import * as i18n from '@repo/i18n';\r\n  import type { CategoryWithChildren, CategoryBreadcrumb, MobileNavigationDialogProps } from './search/types';\r\n\r\n  let {\r\n    id,\r\n    isOpen,\r\n    isLoggedIn,\r\n    user,\r\n    profile,\r\n    userDisplayName,\r\n    initials,\r\n    canSell,\r\n    currentLanguage,\r\n    languages,\r\n    categories = [],\r\n    onClose,\r\n    onSignOut,\r\n    onCategoryClick,\r\n    onLanguageChange,\r\n    signingOut = false,\r\n    searchFunction,\r\n    unreadMessages,\r\n    unreadNotifications,\r\n    translations = {\r\n      sellItems: 'Sell Items',\r\n      myProfile: 'My Profile',\r\n      startSelling: 'Start Selling',\r\n      settings: 'Settings',\r\n      signOut: 'Sign Out',\r\n      signingOut: 'Signing out...',\r\n      signIn: 'Sign In',\r\n      signUp: 'Sign Up',\r\n      browseCategories: 'Browse Categories',\r\n      whatLookingFor: 'What are you looking for?',\r\n      browseAll: 'Browse All',\r\n      popularBrands: 'Popular Brands',\r\n      newToday: 'New Today',\r\n      orders: 'Orders',\r\n      favorites: 'Favorites',\r\n      categoryWomen: 'Women',\r\n      categoryMen: 'Men',\r\n      categoryKids: 'Kids',\r\n      categoryUnisex: 'Unisex',\r\n      help: 'Help Center',\r\n      privacy: 'Privacy',\r\n      terms: 'Terms',\r\n      returns: 'Returns',\r\n      trustSafety: 'Trust & Safety',\r\n      searchPlaceholder: 'Search for items...',\r\n      quickActionsLabel: 'Quick Actions',\r\n      settingsLabel: 'Settings',\r\n      supportLabel: 'Support'\r\n    }\r\n  }: MobileNavigationDialogProps = $props();\r\n\r\n  // Category navigation state - now within the same menu\r\n  let currentView = $state('main'); // 'main' | 'subcategory'\r\n  let selectedMainCategory = $state<CategoryWithChildren | null>(null);\r\n  let categoryBreadcrumb = $state<CategoryBreadcrumb[]>([]);\r\n\r\n  // Dialog element reference\r\n  let dialogElement = $state<HTMLDivElement | null>(null);\r\n\r\n  // Simple escape key handling and body scroll lock\r\n  $effect(() => {\r\n    if (!isBrowser) return;\r\n\r\n    function handleKeyDown(e: KeyboardEvent) {\r\n      if (e.key === 'Escape' && isOpen) {\r\n        closeMenu();\r\n      }\r\n    }\r\n\r\n    document.addEventListener('keydown', handleKeyDown);\r\n\r\n    if (isOpen) {\r\n      document.body.classList.add('overflow-hidden');\r\n      document.documentElement.classList.add('mobile-nav-open');\r\n    } else {\r\n      document.body.classList.remove('overflow-hidden');\r\n      document.documentElement.classList.remove('mobile-nav-open');\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener('keydown', handleKeyDown);\r\n      document.body.classList.remove('overflow-hidden');\r\n      document.documentElement.classList.remove('mobile-nav-open');\r\n    };\r\n  });\r\n\r\n\r\n  // Enhanced category click handler - now shows subcategories in same menu\r\n  function handleCategoryClick(categorySlug: string, level: number = 1, path: string[] = [categorySlug]) {\r\n    // Find the full category data\r\n    const category = categories.find(cat => cat.slug === categorySlug);\r\n    if (category && category.children && category.children.length > 0) {\r\n      // Has subcategories - show them in the same menu\r\n      selectedMainCategory = category;\r\n      categoryBreadcrumb = [{ name: category.name, slug: category.slug }];\r\n      currentView = 'subcategory';\r\n    } else {\r\n      // No subcategories - navigate directly\r\n      onClose();\r\n      window.location.href = `/category/${categorySlug}`;\r\n    }\r\n  }\r\n\r\n  // Handle subcategory click - check for level 3 first\r\n  function handleSubcategoryClick(subcategory: CategoryWithChildren) {\r\n    if (subcategory.children && subcategory.children.length > 0) {\r\n      // Has level 3 subcategories - show them\r\n      selectedMainCategory = subcategory;\r\n      categoryBreadcrumb = [...categoryBreadcrumb, { name: subcategory.name, slug: subcategory.slug }];\r\n      currentView = 'subcategory'; // Keep same view type for level 3\r\n    } else {\r\n      // No more subcategories - navigate to category page\r\n      closeMenu();\r\n      window.location.href = `/category/${subcategory.slug}`;\r\n    }\r\n  }\r\n\r\n  // Handle back navigation with breadcrumb support\r\n  function handleBackToMain() {\r\n    if (categoryBreadcrumb.length > 1) {\r\n      // Go back one level in breadcrumb\r\n      categoryBreadcrumb = categoryBreadcrumb.slice(0, -1);\r\n      const parentCategory = categories.find(cat => cat.slug === categoryBreadcrumb[0].slug);\r\n      selectedMainCategory = parentCategory || null;\r\n    } else {\r\n      // Go back to main menu\r\n      currentView = 'main';\r\n      selectedMainCategory = null;\r\n      categoryBreadcrumb = [];\r\n    }\r\n  }\r\n\r\n  // No backdrop handler needed - Vinted style menu\r\n\r\n  // Simple close menu function\r\n  function closeMenu() {\r\n    // Reset all navigation state\r\n    currentView = 'main';\r\n    selectedMainCategory = null;\r\n    categoryBreadcrumb = [];\r\n\r\n    // Call parent close handler\r\n    onClose();\r\n  }\r\n\r\n  // Handle search from mobile search component\r\n  function handleSearch(query: string) {\r\n    // Close menu and navigate to search\r\n    closeMenu();\r\n  }\r\n\r\n  // Lightweight profile stats (tolerant to missing fields)\r\n  const profileStats = $derived(() => {\r\n    // Access profile fields directly since stats doesn't exist in Profile type\r\n    const ratingRaw = typeof profile?.rating === 'number' ? profile.rating : 0;\r\n    const rating = Number.isFinite(ratingRaw) ? ratingRaw : 0;\r\n    const itemsSold = typeof profile?.total_sales === 'number' ? profile.total_sales : 0;\r\n    const productsCount = (profile as { products_count?: number } | undefined)?.products_count;\r\n    const listings = typeof productsCount === 'number' ? productsCount : 0;\r\n    return { rating, itemsSold, listings };\r\n  });\r\n\r\n  function formatRating(r: number): string {\r\n    if (!Number.isFinite(r)) return '0';\r\n    const rounded = Math.round(r * 10) / 10;\r\n    // Show integer ratings without trailing .0 (e.g., 0, 4)\r\n    return Number.isInteger(rounded) ? String(rounded) : rounded.toFixed(1);\r\n  }\r\n\r\n  // Real category counts from props\r\n  const categoryCounts = $derived(() => {\r\n    const counts = {\r\n      women: 0,\r\n      men: 0,\r\n      kids: 0,\r\n      unisex: 0\r\n    };\r\n\r\n    if (categories && categories.length > 0) {\r\n      categories.forEach(cat => {\r\n        const slug = cat.slug.toLowerCase();\r\n        if (slug === 'women') counts.women = cat.product_count || 0;\r\n        else if (slug === 'men') counts.men = cat.product_count || 0;\r\n        else if (slug === 'kids') counts.kids = cat.product_count || 0;\r\n        else if (slug === 'unisex') counts.unisex = cat.product_count || 0;\r\n      });\r\n    }\r\n\r\n    return counts;\r\n  });\r\n\r\n  // Format item count for display\r\n  function formatItemCount(count: number): string {\r\n    const itemsText = 'items'; // Fallback text since home_itemCount doesn't exist\r\n    if (count === undefined || count === null || isNaN(count)) return `0 ${itemsText}`;\r\n    if (count === 0) return `0 ${itemsText}`;\r\n    if (count < 1000) return `${count} ${itemsText}`;\r\n    if (count < 1000000) return `${(count / 1000).toFixed(1)}k ${itemsText}`;\r\n    return `${(count / 1000000).toFixed(1)}m ${itemsText}`;\r\n  }\r\n</script>\r\n\r\n<!-- Mobile menu - Full screen overlay (always rendered for smooth transitions) -->\r\n<div\r\n  use:portal\r\n  class=\"sm:hidden fixed inset-0 z-[99999] mobile-nav-dialog transition-all duration-300 ease-out {isOpen ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'}\"\r\n  style=\"position: fixed; top: var(--app-header-offset, 56px); left: 0; right: 0; bottom: 0; z-index: 99999;\"\r\n  role=\"dialog\"\r\n  aria-label=\"Mobile navigation menu\"\r\n  {id}\r\n  bind:this={dialogElement}\r\n>\r\n  <!-- Full-screen mobile menu panel -->\r\n  <div\r\n    class=\"h-full bg-white shadow-lg overflow-hidden transition-opacity transition-transform duration-300 ease-out {isOpen ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-2'}\"\r\n  >\r\n      <!-- Main content container -->\r\n      <div class=\"h-full bg-white flex flex-col relative\">\r\n\r\n        <!-- Content area with scroll -->\r\n        <div class=\"flex-1 overflow-y-auto overscroll-contain\" style=\"-webkit-overflow-scrolling: touch;\">\r\n          <div class=\"px-4 pt-6 pb-4 space-y-6\">\r\n\r\n          {#if isLoggedIn && user && profile}\r\n            <!-- Enhanced User Profile Section -->\r\n            <div class=\"bg-gray-50 rounded-lg p-3 border border-gray-200 relative\">\r\n              <!-- Notifications quick action (top-right) -->\r\n              <a\r\n                href=\"/notifications\"\r\n                onclick={closeMenu}\r\n                aria-label=\"Notifications\"\r\n                class=\"absolute top-2 right-2 inline-flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-100 text-gray-600\"\r\n              >\r\n                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9\" />\r\n                </svg>\r\n                {#if typeof unreadNotifications === 'number' && unreadNotifications > 0}\r\n                  <span class=\"absolute -top-1 -right-1 min-w-4 h-4 px-1 bg-red-600 text-white text-[10px] font-bold rounded-full flex items-center justify-center\">\r\n                    {unreadNotifications > 99 ? '99' : unreadNotifications}\r\n                  </span>\r\n                {/if}\r\n              </a>\r\n              <div class=\"flex items-center gap-3\">\r\n                <!-- User Avatar -->\r\n                <Avatar\r\n                  name={userDisplayName}\r\n                  src={profile?.avatar_url || undefined}\r\n                  size=\"md\"\r\n                  fallback={initials}\r\n                  class=\"w-11 h-11\"\r\n                />\r\n\r\n                <!-- User Info -->\r\n                <div class=\"flex-1 min-w-0\">\r\n                  <div class=\"flex items-center gap-2 min-w-0\">\r\n                    <div class=\"font-semibold text-gray-900 text-sm truncate\">{userDisplayName}</div>\r\n                    <div class=\"flex items-center gap-1 text-[11px] text-gray-600 flex-shrink-0\">\r\n                      <svg class=\"w-3.5 h-3.5 text-yellow-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\r\n                        <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\r\n                      </svg>\r\n                      <span>{formatRating(profileStats().rating)}</span>\r\n                    </div>\r\n                  </div>\r\n                  {#if profile?.username}\r\n                    <div class=\"text-xs text-gray-500 truncate\">@{profile.username}</div>\r\n                  {/if}\r\n                </div>\r\n                </div>\r\n\r\n                <!-- Quick actions: compact and aligned -->\r\n                <div class=\"mt-3 grid grid-cols-2 gap-2\">\r\n                  <a\r\n                    href=\"/account\"\r\n                    onclick={closeMenu}\r\n                    class=\"inline-flex items-center justify-center min-h-[40px] px-3 text-sm font-medium rounded-lg border border-gray-200 bg-white hover:bg-gray-50 active:bg-gray-100 text-gray-900\"\r\n                  >\r\n                    <svg class=\"w-4 h-4 mr-2 text-gray-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\r\n                    </svg>\r\n                    {translations.myProfile || 'View Profile'}\r\n                  </a>\r\n                  <a\r\n                    href=\"/messages\"\r\n                    onclick={closeMenu}\r\n                    class=\"relative inline-flex items-center justify-center min-h-[40px] px-3 text-sm font-medium rounded-lg border border-gray-200 bg-white hover:bg-gray-50 active:bg-gray-100 text-gray-900\"\r\n                  >\r\n                    <svg class=\"w-4 h-4 mr-2 text-gray-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zM12 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm3.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zM21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337 5.972 5.972 0 01-3.035 1.557 4.48 4.48 0 00.467-1.226c.233-1.162-.758-2.204-1.535-2.943C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z\" />\r\n                    </svg>\r\n                    Messages\r\n                    {#if typeof unreadMessages === 'number' && unreadMessages > 0}\r\n                      <span class=\"absolute -top-1 -right-1 min-w-4 h-4 px-1 bg-red-600 text-white text-[10px] font-bold rounded-full flex items-center justify-center\">\r\n                        {unreadMessages > 99 ? '99' : unreadMessages}\r\n                      </span>\r\n                    {/if}\r\n                  </a>\r\n                </div>\r\n              </div>\r\n          {/if}\r\n\r\n          <!-- Search Section -->\r\n          {#if searchFunction}\r\n            <div>\r\n              <MobileMenuSearch\r\n                placeholder={translations.searchPlaceholder}\r\n                {searchFunction}\r\n                onSearch={handleSearch}\r\n                onClose={closeMenu}\r\n                class=\"w-full\"\r\n              />\r\n            </div>\r\n          {/if}\r\n\r\n          <!-- Categories Section - Dynamic View -->\r\n          {#if currentView === 'main'}\r\n            <!-- Main Categories -->\r\n            <div>\r\n              <h2 class=\"text-xs font-medium text-gray-700 uppercase tracking-wide mb-2 px-2\">\r\n                {translations.browseCategories}\r\n              </h2>\r\n              <div class=\"space-y-2.5\">\r\n              <!-- Women Category -->\r\n              <button\r\n                onclick={() => handleCategoryClick('women', 1, ['women'])}\r\n                class=\"w-full flex items-center justify-between py-2 px-3 bg-gray-50 border border-gray-200 hover:border-gray-300 hover:bg-gray-100 hover:shadow-sm rounded-lg transition-colors touch-manipulation min-h-[40px]\"\r\n                aria-label=\"Browse Women's items\"\r\n              >\r\n                <div class=\"flex items-center gap-4\">\r\n                  <!-- Category Icon -->\r\n                  <div class=\"flex-shrink-0 w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center\">\r\n                    <span class=\"text-2xl\">👗</span>\r\n                  </div>\r\n\r\n                  <!-- Category Info -->\r\n                  <div class=\"flex-1 text-left\">\r\n                    <div class=\"font-semibold text-gray-900 text-base\">{translations.categoryWomen}</div>\r\n                    <div class=\"text-sm text-gray-500\">\r\n                      {formatItemCount(categoryCounts().women)}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <!-- Arrow indicator -->\r\n                <div class=\"flex-shrink-0 text-gray-400\">\r\n                  <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\" />\r\n                  </svg>\r\n                </div>\r\n              </button>\r\n\r\n              <!-- Men Category -->\r\n              <button\r\n                onclick={() => handleCategoryClick('men', 1, ['men'])}\r\n                class=\"w-full flex items-center justify-between py-2 px-3 bg-gray-50 border border-gray-200 hover:border-gray-300 hover:bg-gray-100 hover:shadow-sm rounded-lg transition-colors touch-manipulation min-h-[40px]\"\r\n                aria-label=\"Browse Men's items\"\r\n              >\r\n                <div class=\"flex items-center gap-4\">\r\n                  <!-- Category Icon -->\r\n                  <div class=\"flex-shrink-0 w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center\">\r\n                    <span class=\"text-2xl\">👔</span>\r\n                  </div>\r\n\r\n                  <!-- Category Info -->\r\n                  <div class=\"flex-1 text-left\">\r\n                    <div class=\"font-semibold text-gray-900 text-base\">{translations.categoryMen}</div>\r\n                    <div class=\"text-sm text-gray-500\">\r\n                      {formatItemCount(categoryCounts().men)}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <!-- Arrow indicator -->\r\n                <div class=\"flex-shrink-0 text-gray-400\">\r\n                  <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\" />\r\n                  </svg>\r\n                </div>\r\n              </button>\r\n\r\n              <!-- Kids Category -->\r\n              <button\r\n                onclick={() => handleCategoryClick('kids', 1, ['kids'])}\r\n                class=\"w-full flex items-center justify-between py-2.5 px-3 bg-gray-50 border border-gray-200 hover:border-gray-300 hover:bg-gray-100 hover:shadow-sm rounded-lg transition-colors touch-manipulation min-h-[40px]\"\r\n                aria-label=\"Browse Kids items\"\r\n              >\r\n                <div class=\"flex items-center gap-4\">\r\n                  <!-- Category Icon -->\r\n                  <div class=\"flex-shrink-0 w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center\">\r\n                    <span class=\"text-2xl\">👶</span>\r\n                  </div>\r\n\r\n                  <!-- Category Info -->\r\n                  <div class=\"flex-1 text-left\">\r\n                    <div class=\"font-semibold text-gray-900 text-base\">{translations.categoryKids}</div>\r\n                    <div class=\"text-sm text-gray-500\">\r\n                      {formatItemCount(categoryCounts().kids)}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <!-- Arrow indicator -->\r\n                <div class=\"flex-shrink-0 text-gray-400\">\r\n                  <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\" />\r\n                  </svg>\r\n                </div>\r\n              </button>\r\n\r\n              <!-- Unisex Category -->\r\n              <button\r\n                onclick={() => handleCategoryClick('unisex', 1, ['unisex'])}\r\n                class=\"w-full flex items-center justify-between p-3 bg-gray-50 border border-gray-200 hover:border-gray-300 hover:bg-gray-100 hover:shadow-sm rounded-lg transition-colors touch-manipulation min-h-[40px]\"\r\n                aria-label=\"Browse Unisex items\"\r\n              >\r\n                <div class=\"flex items-center gap-4\">\r\n                  <!-- Category Icon -->\r\n                  <div class=\"flex-shrink-0 w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center\">\r\n                    <span class=\"text-2xl\">🌍</span>\r\n                  </div>\r\n\r\n                  <!-- Category Info -->\r\n                  <div class=\"flex-1 text-left\">\r\n                    <div class=\"font-semibold text-gray-900 text-base\">{translations.categoryUnisex}</div>\r\n                    <div class=\"text-sm text-gray-500\">\r\n                      {formatItemCount(categoryCounts().unisex)}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <!-- Arrow indicator -->\r\n                <div class=\"flex-shrink-0 text-gray-400\">\r\n                  <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\" />\r\n                  </svg>\r\n                </div>\r\n              </button>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Quick Actions Section -->\r\n            <div>\r\n              <h2 class=\"text-xs font-medium text-gray-700 uppercase tracking-wide mb-2 px-2\">{translations.quickActionsLabel}</h2>\r\n              <div class=\"grid grid-cols-3 gap-2.5\">\r\n                <a\r\n                  href=\"/search\"\r\n                  onclick={closeMenu}\r\n                  class=\"flex flex-col items-center px-2.5 py-2.5 bg-gray-50 border border-gray-200 hover:border-gray-300 hover:bg-gray-100 hover:shadow-sm rounded-lg transition-colors touch-manipulation min-h-[40px]\"\r\n                >\r\n                  <svg class=\"w-5 h-5 mb-1 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\r\n                  </svg>\r\n                  <span class=\"text-xs font-medium text-gray-900 text-center\">{translations.browseAll}</span>\r\n                </a>\r\n\r\n                <a\r\n                  href=\"/brands\"\r\n                  onclick={closeMenu}\r\n                  class=\"flex flex-col items-center px-2.5 py-2.5 bg-gray-50 border border-gray-200 hover:border-gray-300 hover:bg-gray-100 hover:shadow-sm rounded-lg transition-colors touch-manipulation min-h-[40px]\"\r\n                >\r\n                  <svg class=\"w-5 h-5 mb-1 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\r\n                  </svg>\r\n                  <span class=\"text-xs font-medium text-gray-900 text-center\">{translations.popularBrands}</span>\r\n                </a>\r\n\r\n                <a\r\n                  href=\"/new\"\r\n                  onclick={closeMenu}\r\n                  class=\"flex flex-col items-center px-2.5 py-2.5 bg-gray-50 border border-gray-200 hover:border-gray-300 hover:bg-gray-100 hover:shadow-sm rounded-lg transition-colors touch-manipulation min-h-[40px]\"\r\n                >\r\n                  <svg class=\"w-5 h-5 mb-1 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                  </svg>\r\n                  <span class=\"text-xs font-medium text-gray-900 text-center\">{translations.newToday}</span>\r\n                </a>\r\n              </div>\r\n\r\n              {#if isLoggedIn}\r\n                <div class=\"grid grid-cols-2 gap-3 mt-3\">\r\n                  <a\r\n                    href=\"/orders\"\r\n                    onclick={closeMenu}\r\n                    class=\"flex flex-col items-center px-2.5 py-2.5 bg-gray-50 border border-gray-200 hover:border-gray-300 hover:bg-gray-100 hover:shadow-sm rounded-lg transition-colors touch-manipulation min-h-[40px]\"\r\n                  >\r\n                    <svg class=\"w-5 h-5 mb-1 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 11V7a4 4 0 00-8 0v4M5 9h14l-1 12H6L5 9z\" />\r\n                    </svg>\r\n                    <span class=\"text-xs font-medium text-gray-900 text-center\">{translations.orders}</span>\r\n                  </a>\r\n\r\n                  <a\r\n                    href=\"/favorites\"\r\n                    onclick={closeMenu}\r\n                    class=\"flex flex-col items-center px-2.5 py-2.5 bg-gray-50 border border-gray-200 hover:border-gray-300 hover:bg-gray-100 hover:shadow-sm rounded-lg transition-colors touch-manipulation min-h-[40px]\"\r\n                  >\r\n                    <svg class=\"w-5 h-5 mb-1 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\" />\r\n                    </svg>\r\n                    <span class=\"text-xs font-medium text-gray-900 text-center\">{translations.favorites}</span>\r\n                  </a>\r\n                </div>\r\n              {/if}\r\n            </div>\r\n\r\n            <!-- Settings Section -->\r\n            <div>\r\n              <h2 class=\"text-xs font-medium text-gray-700 uppercase tracking-wide mb-2 px-2\">{translations.settingsLabel}</h2>\r\n              <div class=\"bg-white rounded-xl border border-gray-200 p-4 space-y-4\">\r\n                <!-- Language & Theme -->\r\n                <div class=\"flex items-center justify-between\">\r\n                  <span class=\"text-sm font-medium text-gray-900\">Language & Theme</span>\r\n                  <div class=\"flex items-center gap-2\">\r\n                    <LanguageSwitcher\r\n                      currentLanguage={currentLanguage}\r\n                      {languages}\r\n                      onLanguageChange={onLanguageChange}\r\n                      variant=\"compact\"\r\n                      class=\"text-xs\"\r\n                    />\r\n                    <ThemeToggle size=\"sm\" />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Support Links -->\r\n            <div>\r\n              <h2 class=\"text-xs font-medium text-gray-700 uppercase tracking-wide mb-2 px-2\">Support</h2>\r\n              <div class=\"bg-gray-50 rounded-lg border border-gray-200 overflow-hidden\">\r\n                <a\r\n                  href=\"/help\"\r\n                  onclick={closeMenu}\r\n                  class=\"flex items-center px-3 py-3 text-gray-900 hover:bg-gray-100 transition-colors border-b border-gray-200 last:border-b-0 touch-manipulation min-h-[36px]\"\r\n                >\r\n                  <svg class=\"w-4 h-4 mr-3 text-gray-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                  </svg>\r\n                  <span class=\"text-sm font-medium\">{translations.help}</span>\r\n                </a>\r\n\r\n                <a\r\n                  href=\"/privacy\"\r\n                  onclick={closeMenu}\r\n                  class=\"flex items-center px-3 py-3 text-gray-900 hover:bg-gray-100 transition-colors border-b border-gray-200 last:border-b-0 touch-manipulation min-h-[40px]\"\r\n                >\r\n                  <svg class=\"w-4 h-4 mr-3 text-gray-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" />\r\n                  </svg>\r\n                  <span class=\"text-sm font-medium\">{translations.privacy}</span>\r\n                </a>\r\n\r\n                <a\r\n                  href=\"/terms\"\r\n                  onclick={closeMenu}\r\n                  class=\"flex items-center px-3 py-3 text-gray-900 hover:bg-gray-100 transition-colors border-b border-gray-200 last:border-b-0 touch-manipulation min-h-[40px]\"\r\n                >\r\n                  <svg class=\"w-4 h-4 mr-3 text-gray-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                  </svg>\r\n                  <span class=\"text-sm font-medium\">{translations.terms}</span>\r\n                </a>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Authentication Section -->\r\n            {#if isLoggedIn}\r\n              <!-- Sign Out -->\r\n              <div class=\"pt-2\">\r\n                <button\r\n                  onclick={() => { closeMenu(); onSignOut(); }}\r\n                  disabled={signingOut}\r\n                  class=\"w-full flex items-center justify-center px-4 py-3.5 text-red-600 hover:text-red-700 hover:bg-red-50 active:bg-red-100 rounded-xl transition-all duration-200 border border-red-200 hover:border-red-300 disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation min-h-[40px]\"\r\n                >\r\n                  {#if signingOut}\r\n                    <svg class=\"animate-spin w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                      <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\r\n                      <path class=\"opacity-75\" fill=\"currentColor\" d=\"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                    </svg>\r\n                    <span class=\"font-medium\">{translations.signingOut}</span>\r\n                  {:else}\r\n                    <svg class=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\r\n                    </svg>\r\n                    <span class=\"font-medium\">{translations.signOut}</span>\r\n                  {/if}\r\n                </button>\r\n              </div>\r\n            {:else}\r\n              <!-- Sign In/Up -->\r\n              <div class=\"pt-2\">\r\n                <div class=\"grid grid-cols-2 gap-4\">\r\n                  <a\r\n                    href=\"/login\"\r\n                    onclick={closeMenu}\r\n                    class=\"flex items-center justify-center px-4 py-3.5 text-gray-900 hover:text-gray-700 hover:bg-gray-50 active:bg-gray-100 rounded-xl transition-all duration-200 border border-gray-200 hover:border-gray-300 touch-manipulation min-h-[40px]\"\r\n                  >\r\n                    <span class=\"font-semibold\">{translations.signIn}</span>\r\n                  </a>\r\n                  <a\r\n                    href=\"/signup\"\r\n                    onclick={closeMenu}\r\n                    class=\"flex items-center justify-center px-4 py-3.5 bg-black text-white rounded-xl font-semibold hover:bg-gray-800 active:bg-gray-900 transition-all duration-200 touch-manipulation min-h-[40px]\"\r\n                  >\r\n                    <span>{translations.signUp}</span>\r\n                  </a>\r\n                </div>\r\n              </div>\r\n            {/if}\r\n          {:else if currentView === 'subcategory' && selectedMainCategory?.children}\r\n            <!-- Subcategories View -->\r\n            <div>\r\n              <!-- Back Navigation -->\r\n              <div class=\"flex items-center gap-3 mb-4\">\r\n                <button\r\n                  onclick={handleBackToMain}\r\n                  class=\"flex items-center justify-center min-w-[40px] min-h-[40px] rounded-lg text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors touch-manipulation\"\r\n                  aria-label=\"Back to main menu\"\r\n                >\r\n                  <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 19l-7-7 7-7\" />\r\n                  </svg>\r\n                </button>\r\n                <h1 class=\"text-lg font-semibold text-gray-900\">\r\n                  {selectedMainCategory.name}\r\n                  {#if categoryBreadcrumb.length > 1}\r\n                    <span class=\"text-gray-500\"> / {categoryBreadcrumb[categoryBreadcrumb.length - 1].name}</span>\r\n                  {/if}\r\n                </h1>\r\n              </div>\r\n\r\n              <!-- Subcategories List -->\r\n              <div class=\"space-y-3\">\r\n                {#each selectedMainCategory.children as subcategory}\r\n                  <button\r\n                    onclick={() => handleSubcategoryClick(subcategory)}\r\n                  class=\"w-full flex items-center justify-between px-3 py-3 bg-gray-50 border border-gray-200 hover:border-gray-300 hover:bg-gray-100 hover:shadow-sm rounded-lg transition-colors touch-manipulation min-h-[40px]\"\r\n                  >\r\n                    <div class=\"flex items-center gap-3\">\r\n                      <div class=\"text-left\">\r\n                        <div class=\"font-medium text-gray-900\">{subcategory.name}</div>\r\n                        <div class=\"text-sm text-gray-500\">\r\n                          {formatItemCount(subcategory.product_count || 0)}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <!-- Arrow for further subcategories -->\r\n                    {#if subcategory.children && subcategory.children.length > 0}\r\n                      <div class=\"flex-shrink-0 text-gray-400\">\r\n                        <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\" />\r\n                        </svg>\r\n                      </div>\r\n                    {/if}\r\n                  </button>\r\n                {/each}\r\n              </div>\r\n            </div>\r\n          {/if}\r\n\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\SearchDropdown.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SearchContext' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showCategories' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":19},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":101,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":101,"endColumn":92,"suggestions":[{"messageId":"addBrackets","fix":{"range":[3670,3919],"text":"{ const level1 = categories.filter(cat => cat.level === 1 || !cat.level).slice(0, 4);\r\n        const level2Popular = categories.filter(cat => cat.level === 2 && (cat.product_count || 0) > 10).slice(0, 4);\r\n        return [...level1, ...level2Popular]; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":102,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":102,"endColumn":118,"suggestions":[{"messageId":"addBrackets","fix":{"range":[3670,3919],"text":"{ const level1 = categories.filter(cat => cat.level === 1 || !cat.level).slice(0, 4);\r\n        const level2Popular = categories.filter(cat => cat.level === 2 && (cat.product_count || 0) > 10).slice(0, 4);\r\n        return [...level1, ...level2Popular]; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":139,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":139,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":153,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":153,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":181,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":181,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  // Note: goto function should be passed as prop when used in SvelteKit apps\r\n  import { isBrowser } from '../../utils/runtime.js';\r\n  import type {\r\n    ProductWithImages,\r\n    CategoryWithChildren,\r\n    SearchSeller,\r\n    Collection,\r\n    SearchContext,\r\n    SearchDropdownProps\r\n  } from './search/types';\r\n\r\n  let {\r\n    query,\r\n    context = 'search',\r\n    categoryContext = null,\r\n    onSearch,\r\n    onSelect,\r\n    onClose,\r\n    maxResults = 5,\r\n    showCategories = true,\r\n    class: className = '',\r\n    visible = false,\r\n    listboxId = 'search-dropdown-listbox',\r\n    categories = [],\r\n    sellers = [],\r\n    collections = [],\r\n    onCategorySelect,\r\n    onSellerSelect,\r\n    onCollectionSelect,\r\n    translations = {}\r\n  }: SearchDropdownProps = $props();\r\n\r\n  let results: ProductWithImages[] = $state.raw([]);\r\n  let loading = $state(false);\r\n  let error = $state<string | null>(null);\r\n  let searchTimeout: NodeJS.Timeout;\r\n  let dropdownVisible = $derived(visible);\r\n  let selectedIndex = $state(-1);\r\n  let activeTab = $state<'categories' | 'collections' | 'sellers'>('categories');\r\n  let navigationStack = $state<{ categories: CategoryWithChildren[], level: number }>({ categories: [], level: 1 });\r\n\r\n  const recentSearches = $state<string[]>([]);\r\n\r\n  // Default translations\r\n  const defaultTranslations = {\r\n    categories: 'Categories',\r\n    collections: 'Collections',\r\n    sellers: 'Sellers',\r\n    products: 'Products',\r\n    searching: 'Searching...',\r\n    viewAllResults: 'View all results for',\r\n    ...translations\r\n  };\r\n\r\n  // Context-aware tab configuration\r\n  const availableTabs = $derived(() => {\r\n    const tabs: Array<{ key: 'categories' | 'collections' | 'sellers', label: string }> = [];\r\n\r\n    // Categories tab - always available but content varies by context\r\n    tabs.push({ key: 'categories', label: defaultTranslations.categories });\r\n\r\n    // Collections tab - available in main and search contexts\r\n    if (context === 'main' || context === 'search') {\r\n      tabs.push({ key: 'collections', label: defaultTranslations.collections });\r\n    }\r\n\r\n    // Sellers tab - available in main and search contexts\r\n    if (context === 'main' || context === 'search') {\r\n      tabs.push({ key: 'sellers', label: defaultTranslations.sellers });\r\n    }\r\n\r\n    return tabs;\r\n  });\r\n\r\n  // Context-aware categories display\r\n  const displayCategories = $derived(() => {\r\n    if (navigationStack.categories.length > 0) {\r\n      return navigationStack.categories;\r\n    }\r\n\r\n    switch (context) {\r\n      case 'category':\r\n        // For category pages, show subcategories specific to current category\r\n        // Filter out level 1 categories if we're already in a specific category\r\n        if (categoryContext && typeof categoryContext === 'string') {\r\n          // If we're in a specific category like 'men', show only men's subcategories\r\n          return categories.filter(cat => {\r\n            // Show level 2+ categories that belong to current category context\r\n            return cat.level && cat.level > 1 &&\r\n                   (cat.parent_id === categoryContext || cat.slug.startsWith(`${categoryContext}-`));\r\n          });\r\n        } else if (categoryContext && typeof categoryContext === 'object' && categoryContext.children) {\r\n          return categoryContext.children.filter(cat => (cat.product_count || 0) > 0);\r\n        }\r\n        // Fallback: show level 2 categories only (no level 1 since we're in a category page)\r\n        return categories.filter(cat => cat.level === 2).slice(0, 8);\r\n\r\n      case 'main':\r\n        // For main page, show level 1 categories + popular level 2 subcategories\r\n        const level1 = categories.filter(cat => cat.level === 1 || !cat.level).slice(0, 4);\r\n        const level2Popular = categories.filter(cat => cat.level === 2 && (cat.product_count || 0) > 10).slice(0, 4);\r\n        return [...level1, ...level2Popular];\r\n\r\n      case 'search':\r\n      default:\r\n        // For search, show all categories (current behavior)\r\n        return categories.filter(cat => cat.level === 1 || !cat.level).slice(0, 8);\r\n    }\r\n  });\r\n\r\n  // Filtered collections based on context\r\n  const displayCollections = $derived(() => {\r\n    if (context === 'category' && categoryContext) {\r\n      // For category pages, show collections relevant to that category\r\n      const contextSlug = typeof categoryContext === 'string' ? categoryContext : categoryContext.slug;\r\n      return collections.filter(collection =>\r\n        collection.key.includes(contextSlug) ||\r\n        !collection.key.includes('women') && !collection.key.includes('men') && !collection.key.includes('kids')\r\n      );\r\n    }\r\n    return collections;\r\n  });\r\n\r\n  // Top sellers with product counts\r\n  const displaySellers = $derived(() => {\r\n    return sellers.slice(0, 5); // Show top 5 sellers\r\n  });\r\n\r\n  // Load recent searches from localStorage\r\n  $effect(() => {\r\n    if (isBrowser) {\r\n      try {\r\n        const saved = localStorage.getItem('driplo_recent_searches');\r\n        if (saved) {\r\n          const parsed = JSON.parse(saved);\r\n          recentSearches.splice(0, recentSearches.length, ...parsed.slice(0, 5));\r\n        }\r\n      } catch (e) {\r\n        // Ignore localStorage errors\r\n      }\r\n    }\r\n  });\r\n\r\n  function saveRecentSearch(searchQuery: string) {\r\n    if (!isBrowser || !searchQuery || !searchQuery.trim()) return;\r\n    \r\n    try {\r\n      const trimmed = searchQuery.trim();\r\n      const updated = [trimmed, ...recentSearches.filter(s => s !== trimmed)].slice(0, 5);\r\n      recentSearches.splice(0, recentSearches.length, ...updated);\r\n      localStorage.setItem('driplo_recent_searches', JSON.stringify(updated));\r\n    } catch (e) {\r\n      // Ignore localStorage errors\r\n    }\r\n  }\r\n\r\n  // Perform search when query changes\r\n  $effect(() => {\r\n    if (!query || !query.trim()) {\r\n      results = [];\r\n      // Don't override visibility when parent controls it\r\n      return;\r\n    }\r\n\r\n    clearTimeout(searchTimeout);\r\n    searchTimeout = setTimeout(async () => {\r\n      if (!onSearch) return;\r\n\r\n      loading = true;\r\n      error = null;\r\n\r\n      try {\r\n        const response = await onSearch(query);\r\n        if (response.error) {\r\n          error = response.error;\r\n          results = [];\r\n        } else {\r\n          results = response.data.slice(0, maxResults);\r\n        }\r\n      } catch (e) {\r\n        error = 'Search failed';\r\n        results = [];\r\n      } finally {\r\n        loading = false;\r\n      }\r\n    }, 300);\r\n  });\r\n\r\n  function handleProductSelect(product: ProductWithImages) {\r\n    if (onSelect) {\r\n      onSelect(product);\r\n    } else {\r\n      // Default behavior - navigate to product page (via parent)\r\n      if (isBrowser) {\r\n        window.location.href = `/product/${product.id}`;\r\n      }\r\n    }\r\n    if (onClose) onClose();\r\n    selectedIndex = -1;\r\n  }\r\n\r\n  function handleSearchSelect(searchQuery: string) {\r\n    saveRecentSearch(searchQuery);\r\n    if (isBrowser) {\r\n      window.location.href = `/search?q=${encodeURIComponent(searchQuery)}`;\r\n    }\r\n    if (onClose) onClose();\r\n    selectedIndex = -1;\r\n  }\r\n\r\n  function handleCategorySelect(category: CategoryWithChildren) {\r\n    if (onCategorySelect) {\r\n      onCategorySelect(category);\r\n      if (onClose) onClose();\r\n    } else if (category.children && category.children.length > 0 && context === 'main') {\r\n      // For hierarchical navigation in main context, drill down\r\n      navigationStack = {\r\n        categories: category.children.filter(cat => (cat.product_count || 0) > 0),\r\n        level: navigationStack.level + 1\r\n      };\r\n    } else {\r\n      // Navigate to category page\r\n      if (isBrowser) {\r\n        window.location.href = `/category/${category.slug}`;\r\n      }\r\n      if (onClose) onClose();\r\n      selectedIndex = -1;\r\n    }\r\n  }\r\n\r\n  function handleCollectionSelect(collection: Collection) {\r\n    if (onCollectionSelect) {\r\n      onCollectionSelect(collection);\r\n      if (onClose) onClose();\r\n    } else {\r\n      if (isBrowser) {\r\n        window.location.href = `/collection/${collection.key}`;\r\n      }\r\n      if (onClose) onClose();\r\n      selectedIndex = -1;\r\n    }\r\n  }\r\n\r\n  function handleSellerSelect(seller: SearchSeller) {\r\n    if (onSellerSelect) {\r\n      onSellerSelect(seller);\r\n      if (onClose) onClose();\r\n    } else {\r\n      if (isBrowser) {\r\n        window.location.href = `/profile/${seller.username}`;\r\n      }\r\n      if (onClose) onClose();\r\n      selectedIndex = -1;\r\n    }\r\n  }\r\n\r\n  function handleBackNavigation() {\r\n    // Reset navigation stack to go back to top level\r\n    navigationStack = { categories: [], level: 1 };\r\n  }\r\n\r\n  function handleKeyDown(event: KeyboardEvent) {\r\n    if (!dropdownVisible) return;\r\n\r\n    const totalItems = results.length;\r\n\r\n    switch (event.key) {\r\n      case 'ArrowDown':\r\n        event.preventDefault();\r\n        selectedIndex = Math.min(selectedIndex + 1, totalItems - 1);\r\n        break;\r\n      case 'ArrowUp':\r\n        event.preventDefault();\r\n        selectedIndex = Math.max(selectedIndex - 1, -1);\r\n        break;\r\n      case 'Enter':\r\n        event.preventDefault();\r\n        if (selectedIndex >= 0 && selectedIndex < results.length) {\r\n          handleProductSelect(results[selectedIndex]);\r\n        } else if (query && query.trim()) {\r\n          handleSearchSelect(query);\r\n        }\r\n        break;\r\n      case 'Escape':\r\n        if (onClose) onClose();\r\n        selectedIndex = -1;\r\n        break;\r\n    }\r\n  }\r\n\r\n  function formatPrice(price: number) {\r\n    if (isBrowser) {\r\n      return new Intl.NumberFormat('en-BG', {\r\n        style: 'currency',\r\n        currency: 'BGN',\r\n        minimumFractionDigits: 0\r\n      }).format(price);\r\n    }\r\n    return `${price} лв`; // Fallback for SSR\r\n  }\r\n\r\n  // Close dropdown when clicking outside\r\n  function handleClickOutside(event: MouseEvent) {\r\n    // Only close if clicking outside the dropdown container\r\n    const target = event.target as HTMLElement;\r\n    if (!target.closest('.search-dropdown-container')) {\r\n      if (onClose) {\r\n        onClose();\r\n      }\r\n      selectedIndex = -1;\r\n    }\r\n  }\r\n\r\n  // Set up document listeners only when dropdown is visible\r\n  $effect(() => {\r\n    if (dropdownVisible && typeof window !== 'undefined') {\r\n      document.addEventListener('click', handleClickOutside);\r\n      document.addEventListener('keydown', handleKeyDown);\r\n\r\n      return () => {\r\n        document.removeEventListener('click', handleClickOutside);\r\n        document.removeEventListener('keydown', handleKeyDown);\r\n      };\r\n    }\r\n  });\r\n</script>\r\n\r\n{#if dropdownVisible}\r\n  <div\r\n    class=\"search-dropdown-container absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-b-[var(--input-radius)] shadow-lg z-50 {className}\"\r\n    onclick={(e) => e.stopPropagation()}\r\n    onkeydown={(e) => { if (e.key === 'Escape') handleClickOutside(); }}\r\n    role=\"dialog\"\r\n    tabindex=\"0\"\r\n    aria-label=\"Search results and browse options\"\r\n  >\r\n    {#if query && query.trim()}\r\n      <!-- Search Results Section -->\r\n      {#if loading}\r\n        <div class=\"p-4 text-center text-gray-500\">\r\n          <div class=\"inline-flex items-center gap-2\">\r\n            <div class=\"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin\"></div>\r\n            Searching...\r\n          </div>\r\n        </div>\r\n      {:else if error}\r\n        <div class=\"p-4 text-center text-red-500\">\r\n          {error}\r\n        </div>\r\n      {:else if results.length > 0}\r\n        <div class=\"border-b border-gray-100\" role=\"listbox\" id={listboxId} aria-label={defaultTranslations.products}>\r\n          <div class=\"px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n            Products\r\n          </div>\r\n          {#each results as product, index}\r\n            <button\r\n              class=\"w-full px-4 py-3 flex items-center gap-3 hover:bg-gray-50 text-left transition-colors {selectedIndex === index ? 'bg-blue-50' : ''}\"\r\n              onclick={() => handleProductSelect(product)}\r\n              role=\"option\"\r\n              aria-selected={selectedIndex === index}\r\n              id={`${listboxId}-option-${index}`}\r\n            >\r\n              {#if product.images?.[0]?.image_url}\r\n                <img\r\n                  src={product.images[0].image_url}\r\n                  alt={product.title}\r\n                  class=\"w-10 h-10 object-cover rounded-lg flex-shrink-0\"\r\n                />\r\n              {:else}\r\n                <div class=\"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center flex-shrink-0\">\r\n                  <svg class=\"w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                  </svg>\r\n                </div>\r\n              {/if}\r\n              <div class=\"flex-1 min-w-0\">\r\n                <div class=\"font-medium text-gray-900 truncate\">{product.title}</div>\r\n                <div class=\"text-sm text-gray-500 flex items-center gap-2\">\r\n                  <span>{formatPrice(product.price)}</span>\r\n                  {#if product.category_name}\r\n                    <span>•</span>\r\n                    <span>{product.category_name}</span>\r\n                  {/if}\r\n                </div>\r\n              </div>\r\n            </button>\r\n          {/each}\r\n\r\n          {#if results.length >= maxResults}\r\n            <button\r\n              class=\"w-full px-4 py-3 text-blue-600 hover:bg-blue-50 text-sm font-medium transition-colors border-t border-gray-100\"\r\n              onclick={() => handleSearchSelect(query)}\r\n            >\r\n              View all results for \"{query}\"\r\n            </button>\r\n          {/if}\r\n        </div>\r\n      {/if}\r\n    {/if}\r\n\r\n    <!-- Context-Aware Tabbed Browse Section -->\r\n    <div class=\"p-4\">\r\n      <!-- Tab Headers - Dynamic based on context -->\r\n      <div class=\"flex items-center gap-1 mb-4 bg-gray-100 p-1 rounded-lg\">\r\n        {#each availableTabs() as tab}\r\n          <button\r\n            class=\"flex-1 px-3 py-2 text-sm font-medium rounded-md transition-all duration-200 {activeTab === tab.key ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600 hover:text-gray-900'}\"\r\n            onclick={() => activeTab = tab.key}\r\n          >\r\n            {tab.label}\r\n          </button>\r\n        {/each}\r\n      </div>\r\n\r\n      <!-- Tab Content with Smooth Transitions -->\r\n      <div class=\"relative min-h-[120px]\">\r\n        {#key activeTab}\r\n          <div class=\"animate-in fade-in-0 duration-200\">\r\n            {#if activeTab === 'categories'}\r\n              <!-- Hierarchical Navigation Header -->\r\n              {#if navigationStack.level > 1}\r\n                <div class=\"mb-4\">\r\n                  <button\r\n                    onclick={handleBackNavigation}\r\n                    class=\"flex items-center gap-2 text-sm text-blue-600 hover:text-blue-700 transition-colors\"\r\n                  >\r\n                    <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 19l-7-7 7-7\" />\r\n                    </svg>\r\n                    Back to Categories\r\n                  </button>\r\n                </div>\r\n              {/if}\r\n\r\n              <!-- Categories Grid -->\r\n              <div class=\"grid grid-cols-2 gap-3\">\r\n                {#each displayCategories() as category}\r\n                  <button\r\n                    class=\"flex items-center gap-3 p-3 bg-gray-50 hover:bg-gray-100 hover:shadow-sm rounded-lg border border-gray-200 hover:border-gray-300 transition-all duration-200 text-left group\"\r\n                    onclick={() => handleCategorySelect(category)}\r\n                  >\r\n                    <span class=\"text-2xl\">{category.emoji || '📁'}</span>\r\n                    <div class=\"flex-1 min-w-0\">\r\n                      <span class=\"font-medium text-gray-900 group-hover:text-blue-600 truncate block\">{category.name}</span>\r\n                      {#if category.product_count}\r\n                        <span class=\"text-xs text-gray-500\">({category.product_count})</span>\r\n                      {/if}\r\n                    </div>\r\n                    {#if category.children && category.children.length > 0 && context === 'main'}\r\n                      <svg class=\"w-4 h-4 text-gray-400 group-hover:text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\" />\r\n                      </svg>\r\n                    {/if}\r\n                  </button>\r\n                {/each}\r\n              </div>\r\n\r\n              <!-- Empty state for categories -->\r\n              {#if displayCategories().length === 0}\r\n                <div class=\"text-center py-8 text-gray-500\">\r\n                  <svg class=\"w-12 h-12 mx-auto mb-4 text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\" />\r\n                  </svg>\r\n                  <p class=\"text-sm\">No categories available</p>\r\n                </div>\r\n              {/if}\r\n\r\n            {:else if activeTab === 'collections'}\r\n              <div class=\"grid grid-cols-2 gap-3\">\r\n                {#each displayCollections() as collection}\r\n                  <button\r\n                    class=\"flex items-center gap-3 p-3 bg-gray-50 hover:bg-gray-100 hover:shadow-sm rounded-lg border border-gray-200 hover:border-gray-300 transition-all duration-200 text-left group\"\r\n                    onclick={() => handleCollectionSelect(collection)}\r\n                  >\r\n                    <span class=\"text-2xl\">{collection.emoji}</span>\r\n                    <div class=\"flex-1 min-w-0\">\r\n                      <span class=\"font-medium text-gray-900 group-hover:text-blue-600 truncate block\">{collection.label}</span>\r\n                      {#if collection.product_count}\r\n                        <span class=\"text-xs text-gray-500\">({collection.product_count})</span>\r\n                      {/if}\r\n                    </div>\r\n                  </button>\r\n                {/each}\r\n              </div>\r\n\r\n            {:else if activeTab === 'sellers'}\r\n              <div class=\"space-y-3\">\r\n                {#each displaySellers() as seller}\r\n                  <button\r\n                    class=\"w-full flex items-center gap-3 p-3 bg-gray-50 hover:bg-gray-100 hover:shadow-sm rounded-lg border border-gray-200 hover:border-gray-300 transition-all duration-200 text-left group\"\r\n                    onclick={() => handleSellerSelect(seller)}\r\n                  >\r\n                    {#if seller.avatar_url}\r\n                      <img\r\n                        src={seller.avatar_url}\r\n                        alt={seller.username}\r\n                        class=\"w-10 h-10 rounded-full object-cover flex-shrink-0\"\r\n                      />\r\n                    {:else}\r\n                      <div class=\"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0\">\r\n                        <span class=\"text-white font-semibold text-sm\">{seller.username.charAt(0).toUpperCase()}</span>\r\n                      </div>\r\n                    {/if}\r\n                    <div class=\"flex-1 min-w-0\">\r\n                      <div class=\"flex items-center gap-2\">\r\n                        <span class=\"font-medium text-gray-900 group-hover:text-blue-600 truncate\">{seller.username}</span>\r\n                        {#if seller.is_verified}\r\n                          <svg class=\"w-4 h-4 text-blue-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                            <path fill-rule=\"evenodd\" d=\"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\" />\r\n                          </svg>\r\n                        {/if}\r\n                      </div>\r\n                      <div class=\"flex items-center gap-2 text-sm text-gray-500\">\r\n                        <span>{seller.total_products} items</span>\r\n                        {#if seller.rating}\r\n                          <span>•</span>\r\n                          <div class=\"flex items-center gap-1\">\r\n                            <svg class=\"w-3 h-3 text-yellow-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                              <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\r\n                            </svg>\r\n                            <span>{seller.rating.toFixed(1)}</span>\r\n                          </div>\r\n                        {/if}\r\n                      </div>\r\n                    </div>\r\n                  </button>\r\n                {/each}\r\n\r\n                <!-- View More Sellers Button -->\r\n                {#if sellers.length > 5}\r\n                  <button\r\n                    onclick={() => { if (isBrowser) window.location.href = '/sellers'; }}\r\n                    class=\"w-full px-4 py-3 text-center text-blue-600 hover:bg-blue-50 text-sm font-medium transition-colors border-t border-gray-100 rounded-lg\"\r\n                  >\r\n                    View All Sellers ({sellers.length})\r\n                  </button>\r\n                {/if}\r\n              </div>\r\n            {/if}\r\n          </div>\r\n        {/key}\r\n      </div>\r\n    </div>\r\n  </div>\r\n{/if}\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\SearchEmptyState.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\nimport type { SearchBarMode } from './types.js';\r\nimport { useAnalytics } from '../../hooks/analytics.js';\r\nimport Button from '../ui/Button.svelte';\r\n\r\ninterface Props {\r\n  mode: SearchBarMode;\r\n  searchQuery?: string;\r\n  totalProducts?: number;\r\n  suggestedCategories?: Array<{ slug: string; name: string; icon: string }>;\r\n  suggestedCollections?: Array<{ key: string; label: string; emoji: string }>;\r\n  onCategorySelect?: (categorySlug: string) => void;\r\n  onCollectionSelect?: (collectionKey: string) => void;\r\n  onSearchSuggestion?: (query: string) => void;\r\n  class?: string;\r\n}\r\n\r\nlet {\r\n  mode,\r\n  searchQuery = '',\r\n  totalProducts = 0,\r\n  suggestedCategories = [],\r\n  suggestedCollections = [],\r\n  onCategorySelect,\r\n  onCollectionSelect,\r\n  onSearchSuggestion,\r\n  class: className = ''\r\n}: Props = $props();\r\n\r\n// Analytics hooks\r\nconst { trackEmptyStateAction } = useAnalytics();\r\n\r\n// Suggested search terms based on mode\r\nconst searchSuggestions = $derived(() => {\r\n  const suggestions = [\r\n    'vintage leather jacket',\r\n    'nike sneakers',\r\n    'designer handbag',\r\n    'denim jeans',\r\n    'summer dress'\r\n  ];\r\n\r\n  if (mode === 'power') {\r\n    return suggestions.slice(0, 3);\r\n  } else if (mode === 'compact') {\r\n    return suggestions.slice(0, 2);\r\n  }\r\n  return suggestions;\r\n});\r\n\r\n// Handle suggestion clicks\r\nfunction handleSuggestionClick(suggestion: string) {\r\n  trackEmptyStateAction('search_suggestion_clicked', mode, suggestion);\r\n  onSearchSuggestion?.(suggestion);\r\n}\r\n\r\nfunction handleCategoryClick(categorySlug: string, categoryName: string) {\r\n  trackEmptyStateAction('category_suggestion_clicked', mode, categoryName);\r\n  onCategorySelect?.(categorySlug);\r\n}\r\n\r\nfunction handleCollectionClick(collectionKey: string, collectionLabel: string) {\r\n  trackEmptyStateAction('collection_suggestion_clicked', mode, collectionLabel);\r\n  onCollectionSelect?.(collectionKey);\r\n}\r\n\r\n// Get appropriate empty state content based on mode and context\r\nconst emptyStateContent = $derived(() => {\r\n  if (searchQuery.trim()) {\r\n    // Search performed but no results\r\n    return {\r\n      title: 'No results found',\r\n      subtitle: `We couldn't find anything matching \"${searchQuery}\"`,\r\n      icon: '🔍',\r\n      showSuggestions: true,\r\n      actionText: 'Try these popular searches instead:'\r\n    };\r\n  } else {\r\n    // No search performed yet\r\n    switch (mode) {\r\n      case 'power':\r\n        return {\r\n          title: 'Find exactly what you\\'re looking for',\r\n          subtitle: `Browse ${totalProducts.toLocaleString()} unique items from verified sellers`,\r\n          icon: '⚡',\r\n          showSuggestions: true,\r\n          actionText: 'Popular searches:'\r\n        };\r\n      case 'compact':\r\n        return {\r\n          title: 'Start your search',\r\n          subtitle: 'Discover unique items',\r\n          icon: '👀',\r\n          showSuggestions: true,\r\n          actionText: 'Try:'\r\n        };\r\n      default: // full\r\n        return {\r\n          title: 'Welcome to the marketplace',\r\n          subtitle: `Discover ${totalProducts.toLocaleString()} unique items from trusted sellers worldwide`,\r\n          icon: '🌟',\r\n          showSuggestions: true,\r\n          actionText: 'Popular searches:'\r\n        };\r\n    }\r\n  }\r\n});\r\n</script>\r\n\r\n<div class=\"search-empty-state {className}\" role=\"status\" aria-label=\"Search suggestions\">\r\n  <div class=\"text-center py-12 px-4\">\r\n    <!-- Icon and primary content -->\r\n    <div class=\"mb-6\">\r\n      <div class=\"text-4xl mb-4\" role=\"img\" aria-label=\"Search icon\">\r\n        {emptyStateContent().icon}\r\n      </div>\r\n      <h3 class=\"text-[length:var(--text-xl)] font-semibold text-[color:var(--text-primary)] mb-2\">\r\n        {emptyStateContent().title}\r\n      </h3>\r\n      <p class=\"text-[length:var(--text-base)] text-[color:var(--text-secondary)] max-w-md mx-auto\">\r\n        {emptyStateContent().subtitle}\r\n      </p>\r\n    </div>\r\n\r\n    {#if emptyStateContent().showSuggestions}\r\n      <!-- Search suggestions -->\r\n      {#if searchSuggestions.length > 0}\r\n        <div class=\"mb-8\">\r\n          <h4 class=\"text-[length:var(--text-sm)] font-medium text-[color:var(--text-secondary)] mb-3\">\r\n            {emptyStateContent().actionText}\r\n          </h4>\r\n          <div class=\"flex flex-wrap justify-center gap-2\">\r\n            {#each searchSuggestions() as suggestion}\r\n              <button\r\n                onclick={() => handleSuggestionClick(suggestion)}\r\n                class=\"px-4 py-2 h-10 min-h-10 bg-[color:var(--surface-subtle)] hover:bg-[color:var(--surface-emphasis)] text-[color:var(--text-secondary)] hover:text-[color:var(--text-primary)] rounded-full text-[length:var(--text-sm)] font-medium transition-all duration-200 border border-[color:var(--border-subtle)] hover:border-[color:var(--border-default)]\"\r\n                aria-label=\"Search for {suggestion}\"\r\n              >\r\n                {suggestion}\r\n              </button>\r\n            {/each}\r\n          </div>\r\n        </div>\r\n      {/if}\r\n\r\n      <!-- Category suggestions -->\r\n      {#if suggestedCategories.length > 0}\r\n        <div class=\"mb-8\">\r\n          <h4 class=\"text-[length:var(--text-sm)] font-medium text-[color:var(--text-secondary)] mb-3\">\r\n            Browse by category:\r\n          </h4>\r\n          <div class=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 max-w-2xl mx-auto\">\r\n            {#each suggestedCategories as category}\r\n              <button\r\n                onclick={() => handleCategoryClick(category.slug, category.name)}\r\n                class=\"flex flex-col items-center p-4 h-20 min-h-20 bg-[color:var(--surface-base)] hover:bg-[color:var(--surface-subtle)] border border-[color:var(--border-subtle)] hover:border-[color:var(--border-default)] rounded-lg transition-all duration-200 group\"\r\n                aria-label=\"Browse {category.name} category\"\r\n              >\r\n                <div class=\"text-lg mb-1 group-hover:scale-110 transition-transform duration-200\">\r\n                  {category.icon}\r\n                </div>\r\n                <span class=\"text-[length:var(--text-xs)] font-medium text-[color:var(--text-secondary)] group-hover:text-[color:var(--text-primary)] text-center\">\r\n                  {category.name}\r\n                </span>\r\n              </button>\r\n            {/each}\r\n          </div>\r\n        </div>\r\n      {/if}\r\n\r\n      <!-- Collection suggestions -->\r\n      {#if suggestedCollections.length > 0}\r\n        <div>\r\n          <h4 class=\"text-[length:var(--text-sm)] font-medium text-[color:var(--text-secondary)] mb-3\">\r\n            Quick collections:\r\n          </h4>\r\n          <div class=\"flex flex-wrap justify-center gap-2\">\r\n            {#each suggestedCollections as collection}\r\n              <button\r\n                onclick={() => handleCollectionClick(collection.key, collection.label)}\r\n                class=\"flex items-center gap-2 px-3 py-2 h-10 min-h-10 bg-[color:var(--surface-base)] hover:bg-[color:var(--surface-subtle)] border border-[color:var(--border-subtle)] hover:border-[color:var(--border-default)] rounded-lg transition-all duration-200 group\"\r\n                aria-label=\"Browse {collection.label} collection\"\r\n              >\r\n                <span class=\"text-sm group-hover:scale-110 transition-transform duration-200\">\r\n                  {collection.emoji}\r\n                </span>\r\n                <span class=\"text-[length:var(--text-sm)] font-medium text-[color:var(--text-secondary)] group-hover:text-[color:var(--text-primary)]\">\r\n                  {collection.label}\r\n                </span>\r\n              </button>\r\n            {/each}\r\n          </div>\r\n        </div>\r\n      {/if}\r\n    {/if}\r\n  </div>\r\n</div>\r\n\r\n<style>\r\n  .search-empty-state {\r\n    position: relative;\r\n  }\r\n\r\n  /* Gentle animation for the icon */\r\n  .search-empty-state [role=\"img\"] {\r\n    animation: gentle-pulse 3s ease-in-out infinite;\r\n  }\r\n\r\n  @keyframes gentle-pulse {\r\n    0%, 100% {\r\n      transform: scale(1);\r\n    }\r\n    50% {\r\n      transform: scale(1.05);\r\n    }\r\n  }\r\n\r\n  /* Reduce motion for accessibility */\r\n  @media (prefers-reduced-motion: reduce) {\r\n    .search-empty-state [role=\"img\"] {\r\n      animation: none;\r\n    }\r\n  }\r\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\SearchFeedback.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\SearchPageSearchBar.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalResultCount' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":32,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleCategoryPillClick' is defined but never used. Allowed unused vars must match /^_/u.","line":163,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":163,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'category' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":277,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":277,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'specific' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":277,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":277,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentCategoryDisplay' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":313,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":313,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\nimport SearchInput from '../forms/SearchInput.svelte';\r\nimport MegaMenuCategories from './MegaMenuCategories.svelte';\r\nimport CategoryPill from '../ui/CategoryPill.svelte';\r\nimport AppliedFilterPills from '../product/AppliedFilterPills.svelte';\r\nimport {\r\n  buildCategoryBreadcrumbs,\r\n  flattenCategoryHierarchy,\r\n  type CategoryBreadcrumbItem,\r\n  type FlatCategoryItem\r\n} from '../../search/utils.js';\r\nimport type {\r\n  CategoryWithChildren,\r\n  SearchMainCategory,\r\n  SearchPageSearchBarProps,\r\n  SearchAppliedFilters,\r\n  Collection\r\n} from '../../search/types.js';\r\nimport type { FilterOption, FilterValue, SearchBarMode } from '@repo/ui/types';\r\n\r\nlet {\r\n  mode = 'full' as SearchBarMode,\r\n  searchValue = $bindable(''),\r\n  megaMenuData = [] as CategoryWithChildren[],\r\n  mainCategories = [] as SearchMainCategory[],\r\n  conditionFilters = [] as FilterOption[],\r\n  appliedFilters = {} as SearchAppliedFilters,\r\n  availableSizes = [] as string[],\r\n  availableColors = [] as string[],\r\n  availableBrands = [] as string[],\r\n  currentResultCount = 0,\r\n  totalResultCount = 0,\r\n  i18n,\r\n  onSearch,\r\n  onCategorySelect,\r\n  onFilterChange,\r\n  onFilterRemove,\r\n  onClearAllFilters\r\n}: SearchPageSearchBarProps = $props();\r\n\r\n// Analytics functionality removed for build optimization\r\n// TODO: Implement analytics tracking when needed\r\n\r\n// Component state\r\nlet showCategoryDropdown = $state(false);\r\nlet activeDropdownTab = $state('categories');\r\nlet dropdownSearchQuery = $state('');\r\nlet selectedPillIndex = $state(-1);\r\n\r\nfunction i18nText(value: unknown, fallback: string): string {\r\n  return typeof value === 'function' ? (value as () => string)() : fallback;\r\n}\r\n\r\nfunction setFilter(key: string, value: FilterValue) {\r\n  onFilterChange(key, value);\r\n}\r\n\r\ninterface SmartPill {\r\n  key: string;\r\n  label: string;\r\n  icon: string;\r\n  active: boolean;\r\n}\r\n\r\ninterface SmartPillState {\r\n  level: 1 | 2 | 3;\r\n  pills: SmartPill[];\r\n  showMainCategories: boolean;\r\n}\r\n\r\n// Collections data\r\nconst collections = $derived.by<Collection[]>(() => [\r\n  { key: 'newest', label: 'Newest', emoji: '🆕' },\r\n  { key: 'under25', label: i18nText(i18n.collections_under25, 'Under 25'), emoji: '💰' },\r\n  { key: 'price-low', label: 'Cheapest', emoji: '📉' },\r\n  { key: 'premium', label: i18nText(i18n.collections_designerPremium, 'Designer 100$+'), emoji: '💎' },\r\n  { key: 'condition=brand_new_with_tags', label: i18nText(i18n.collections_newWithTags, 'New with Tags'), emoji: '🏷️' },\r\n  { key: 'condition=like_new', label: i18nText(i18n.collections_likeNew, 'Like New'), emoji: '✨' },\r\n  { key: 'condition=good', label: 'Good', emoji: '👍' },\r\n  { key: 'category=clothing', label: 'All Clothing', emoji: '👕' },\r\n  { key: 'category=shoes', label: 'All Shoes', emoji: '👟' },\r\n  { key: 'category=bags', label: 'All Bags', emoji: '👜' },\r\n  { key: 'category=accessories', label: 'All Accessories', emoji: '💍' }\r\n]);\r\n\r\n// Filtered data for dropdown search\r\nconst filteredCollections = $derived.by<Collection[]>(() => {\r\n  const query = dropdownSearchQuery.trim().toLowerCase();\r\n  if (!query) return collections;\r\n  return collections.filter(collection => collection.label.toLowerCase().includes(query));\r\n});\r\n\r\nconst filteredConditions = $derived.by<FilterOption[]>(() => {\r\n  const query = dropdownSearchQuery.trim().toLowerCase();\r\n  if (!query) return conditionFilters;\r\n\r\n  return conditionFilters.filter(condition => {\r\n    const labelMatch = condition.label.toLowerCase().includes(query);\r\n    const shortLabel = condition.shortLabel?.toLowerCase() ?? '';\r\n    return labelMatch || shortLabel.includes(query);\r\n  });\r\n});\r\n\r\n// Filtered data for new filter types\r\nconst filteredSizes = $derived.by<string[]>(() => {\r\n  const query = dropdownSearchQuery.trim().toLowerCase();\r\n  if (!query) return availableSizes;\r\n  return availableSizes.filter(size => size.toLowerCase().includes(query));\r\n});\r\n\r\nconst filteredColors = $derived.by<string[]>(() => {\r\n  const query = dropdownSearchQuery.trim().toLowerCase();\r\n  if (!query) return availableColors;\r\n  return availableColors.filter(color => color.toLowerCase().includes(query));\r\n});\r\n\r\nconst filteredBrands = $derived.by<string[]>(() => {\r\n  const query = dropdownSearchQuery.trim().toLowerCase();\r\n  if (!query) return availableBrands;\r\n  return availableBrands.filter(brand => brand.toLowerCase().includes(query));\r\n});\r\n\r\n// Handle category dropdown\r\nfunction handleCategoryDropdownToggle(e: Event) {\r\n  e.preventDefault();\r\n  e.stopPropagation();\r\n  showCategoryDropdown = !showCategoryDropdown;\r\n}\r\n\r\nfunction handleCategoryDropdownClose() {\r\n  showCategoryDropdown = false;\r\n}\r\n\r\nfunction handleMegaMenuCategorySelect(categorySlug: string, level: number, path: string[]) {\r\n  // Analytics tracking would go here when implemented\r\n  // trackMegaMenuNavigation(level, categorySlug, path.join('/'));\r\n\r\n  onCategorySelect(categorySlug, level, path);\r\n  handleCategoryDropdownClose();\r\n}\r\n\r\n// Handle smart pill clicks\r\nfunction handleSmartPillClick(pillKey: string, level: number) {\r\n  // Analytics tracking would go here when implemented\r\n  // trackFilterUsage(level === 1 ? 'category' : level === 2 ? 'subcategory' : 'specific', pillKey, searchValue || '');\r\n\r\n  if (level === 1) {\r\n    // Main category selection\r\n    setFilter('category', pillKey);\r\n    setFilter('subcategory', null);\r\n    setFilter('specific', null);\r\n  } else if (level === 2) {\r\n    // Subcategory selection\r\n    setFilter('subcategory', pillKey);\r\n    setFilter('specific', null);\r\n  } else if (level === 3) {\r\n    // Specific category selection\r\n    setFilter('specific', pillKey);\r\n  }\r\n}\r\n\r\n// Handle filter pills (legacy - keeping for compatibility)\r\nfunction handleCategoryPillClick(categoryKey: string) {\r\n  setFilter('category', categoryKey);\r\n}\r\n\r\nfunction handleConditionPillClick(conditionKey: string) {\r\n  const currentCondition = appliedFilters?.condition;\r\n\r\n  // Analytics tracking would go here when implemented\r\n  // trackFilterUsage('condition', conditionKey, searchValue || '');\r\n\r\n  if (currentCondition === conditionKey) {\r\n    onFilterRemove('condition');\r\n  } else {\r\n    setFilter('condition', conditionKey);\r\n  }\r\n}\r\n\r\n// Roving tabindex for horizontal pill nav\r\nfunction handlePillKeyNav(e: KeyboardEvent, index: number) {\r\n  const pills = document.querySelectorAll('#category-pills button');\r\n  const totalPills = (mainCategories?.length || 0) + (conditionFilters?.length || 0);\r\n  switch (e.key) {\r\n    case 'ArrowRight':\r\n      e.preventDefault();\r\n      selectedPillIndex = Math.min(index + 1, totalPills - 1);\r\n      (pills[selectedPillIndex] as HTMLElement)?.focus();\r\n      break;\r\n    case 'ArrowLeft':\r\n      e.preventDefault();\r\n      selectedPillIndex = Math.max(index - 1, 0);\r\n      (pills[selectedPillIndex] as HTMLElement)?.focus();\r\n      break;\r\n    case 'Home':\r\n      e.preventDefault();\r\n      selectedPillIndex = 0;\r\n      (pills[0] as HTMLElement)?.focus();\r\n      break;\r\n    case 'End':\r\n      e.preventDefault();\r\n      selectedPillIndex = totalPills - 1;\r\n      (pills[totalPills - 1] as HTMLElement)?.focus();\r\n      break;\r\n  }\r\n}\r\n\r\n// Handle collection selection from dropdown\r\nfunction handleCollectionSelect(collection: Collection) {\r\n  // Analytics tracking would go here when implemented\r\n  // trackFilterUsage('collection', collection.key, searchValue || '');\r\n\r\n  if (collection.key.startsWith('category=')) {\r\n    const categorySlug = collection.key.replace('category=', '');\r\n    onCategorySelect(categorySlug, 1, [categorySlug]);\r\n  } else if (collection.key.startsWith('condition=')) {\r\n    const condition = collection.key.replace('condition=', '');\r\n    setFilter('condition', condition);\r\n  } else {\r\n    // Handle other collection types (newest, under25, etc.)\r\n    switch (collection.key) {\r\n      case 'newest':\r\n        setFilter('sortBy', 'newest');\r\n        break;\r\n      case 'price-low':\r\n        setFilter('sortBy', 'price-low');\r\n        break;\r\n      case 'under25':\r\n        setFilter('maxPrice', '25');\r\n        break;\r\n      case 'premium':\r\n        setFilter('minPrice', '100');\r\n        break;\r\n      default:\r\n        // Generic collection - could navigate to a collection page\r\n        break;\r\n    }\r\n  }\r\n  handleCategoryDropdownClose();\r\n}\r\n\r\n// Handle condition selection from dropdown\r\nfunction handleConditionSelect(condition: FilterOption) {\r\n  const key: FilterValue = condition.key ?? condition.value;\r\n  // Analytics tracking would go here when implemented\r\n  // trackFilterUsage('condition', key, searchValue || '');\r\n  setFilter('condition', key);\r\n  handleCategoryDropdownClose();\r\n}\r\n\r\n// Handle size selection from dropdown\r\nfunction handleSizeSelect(size: string) {\r\n  // Analytics tracking would go here when implemented\r\n  // trackFilterUsage('size', size, searchValue || '');\r\n  setFilter('size', size);\r\n  handleCategoryDropdownClose();\r\n}\r\n\r\n// Handle color selection from dropdown\r\nfunction handleColorSelect(color: string) {\r\n  // Analytics tracking would go here when implemented\r\n  // trackFilterUsage('color', color, searchValue || '');\r\n  setFilter('color', color);\r\n  handleCategoryDropdownClose();\r\n}\r\n\r\n// Handle brand selection from dropdown\r\nfunction handleBrandSelect(brand: string) {\r\n  // Analytics tracking would go here when implemented\r\n  // trackFilterUsage('brand', brand, searchValue || '');\r\n  setFilter('brand', brand);\r\n  handleCategoryDropdownClose();\r\n}\r\n\r\n// Handle breadcrumb navigation\r\nfunction handleBreadcrumbClick(level: number) {\r\n  const { category, subcategory, specific } = appliedFilters || {};\r\n\r\n  if (level === 1) {\r\n    // Go back to level 1 - clear subcategory and specific\r\n    setFilter('subcategory', null);\r\n    setFilter('specific', null);\r\n  } else if (level === 2 && subcategory) {\r\n    // Go back to level 2 - clear specific only\r\n    setFilter('specific', null);\r\n  }\r\n  // Level 3 doesn't need to clear anything as it's the most specific\r\n}\r\n\r\n// Handle click outside for category dropdown\r\n$effect(() => {\r\n  if (typeof window !== 'undefined') {\r\n    function handleClickOutside(e: MouseEvent) {\r\n      const target = e.target as HTMLElement;\r\n      if (!target.closest('.search-dropdown-container')) {\r\n        showCategoryDropdown = false;\r\n      }\r\n    }\r\n\r\n    if (showCategoryDropdown) {\r\n      document.addEventListener('click', handleClickOutside);\r\n      return () => document.removeEventListener('click', handleClickOutside);\r\n    }\r\n  }\r\n});\r\n\r\n// Build breadcrumb path for selected categories\r\nconst categoryBreadcrumbs = $derived.by<CategoryBreadcrumbItem[]>(() =>\r\n  buildCategoryBreadcrumbs(appliedFilters, megaMenuData, mainCategories)\r\n);\r\n\r\n// Determine current category for display\r\nconst currentCategoryDisplay = $derived(() => {\r\n  if (categoryBreadcrumbs.length > 0) {\r\n    const lastCrumb = categoryBreadcrumbs[categoryBreadcrumbs.length - 1];\r\n    const mainCat = mainCategories.find(c => c.key === appliedFilters?.category);\r\n    return {\r\n      label: lastCrumb.label,\r\n      icon: mainCat?.icon || '📂',\r\n      breadcrumbs: categoryBreadcrumbs\r\n    };\r\n  }\r\n\r\n  return {\r\n    label: i18nText(i18n.filter_allCategories, 'All Categories'),\r\n    icon: '📂',\r\n    breadcrumbs: [] as CategoryBreadcrumbItem[]\r\n  };\r\n});\r\n\r\n// Flatten categories (level 1/2/3) for typeahead matching in the search input\r\nconst flatCategories = $derived.by<FlatCategoryItem[]>(() => flattenCategoryHierarchy(megaMenuData));\r\n\r\nconst categoryMatches = $derived.by<FlatCategoryItem[]>(() => {\r\n  const query = (searchValue || '').trim().toLowerCase();\r\n  if (!query) return [];\r\n  return flatCategories.filter(category => category.name.toLowerCase().includes(query)).slice(0, 10);\r\n});\r\n\r\n// Smart pill system - determine what pills to show based on current selection\r\nconst smartPillData = $derived.by<SmartPillState>(() => {\r\n  const selectedCategory = appliedFilters?.category;\r\n  const selectedSubcategory = appliedFilters?.subcategory;\r\n  const selectedSpecific = appliedFilters?.specific;\r\n\r\n  if (selectedCategory && selectedSubcategory) {\r\n    const level1 = megaMenuData?.find(cat => cat.slug === selectedCategory || cat.key === selectedCategory);\r\n    const level2 = level1?.children?.find(sub => sub.slug === selectedSubcategory || sub.key === selectedSubcategory);\r\n    const specificItems = level2?.children ?? [];\r\n\r\n    if (specificItems.length > 0) {\r\n      return {\r\n        level: 3,\r\n        pills: specificItems.map(item => {\r\n          const slug = item.slug ?? item.key ?? item.name;\r\n          return {\r\n            key: slug,\r\n            label: item.name,\r\n            icon: '🔸',\r\n            active: selectedSpecific === slug\r\n          } satisfies SmartPill;\r\n        }),\r\n        showMainCategories: false\r\n      } satisfies SmartPillState;\r\n    }\r\n  }\r\n\r\n  if (selectedCategory) {\r\n    const level1 = megaMenuData?.find(cat => cat.slug === selectedCategory || cat.key === selectedCategory);\r\n    const subcategories = level1?.children ?? [];\r\n\r\n    if (subcategories.length > 0) {\r\n      return {\r\n        level: 2,\r\n        pills: subcategories.map(subcat => {\r\n          const slug = subcat.slug ?? subcat.key ?? subcat.name;\r\n          return {\r\n            key: slug,\r\n            label: subcat.name,\r\n            icon: getSubcategoryIcon(subcat.name),\r\n            active: selectedSubcategory === slug\r\n          } satisfies SmartPill;\r\n        }),\r\n        showMainCategories: false\r\n      } satisfies SmartPillState;\r\n    }\r\n  }\r\n\r\n  return {\r\n    level: 1,\r\n    pills: (mainCategories || []).map(category => ({\r\n      key: category.key,\r\n      label: category.label,\r\n      icon: category.icon,\r\n      active: selectedCategory === category.key\r\n    } satisfies SmartPill)),\r\n    showMainCategories: true\r\n  } satisfies SmartPillState;\r\n});\r\n\r\n// Helper function to get appropriate icons for subcategories\r\nfunction getSubcategoryIcon(name: string): string {\r\n  const iconMap: Record<string, string> = {\r\n    'Clothing': '👕',\r\n    'Shoes': '👟',\r\n    'Bags': '👜',\r\n    'Accessories': '💍',\r\n    'Dresses': '👗',\r\n    'Tops': '👔',\r\n    'Jeans': '👖',\r\n    'Sweaters': '🧥',\r\n    'Sneakers': '👟',\r\n    'Boots': '🥾',\r\n    'Heels': '👠'\r\n  };\r\n  return iconMap[name] || '🔸';\r\n}\r\n</script>\r\n\r\n<!-- Sticky Search Bar (compact) -->\r\n<div class=\"bg-[color:var(--surface-base)]/90 supports-[backdrop-filter]:backdrop-blur-sm sticky z-40 border-b border-[color:var(--border-subtle)]\" style=\"top: var(--app-header-offset, 56px) !important;\">\r\n  <div class=\"px-2 sm:px-4 lg:px-6 relative py-[var(--gutter-xxs)] sm:py-[var(--gutter-xs)]\">\r\n    <!-- Search Container -->\r\n    <div class=\"py-0 relative search-dropdown-container\">\r\n      <SearchInput\r\n        bind:searchValue={searchValue}\r\n        placeholder={typeof i18n?.search_placeholder === 'function' ? i18n.search_placeholder() : 'Search...'}\r\n        onSearch={onSearch}\r\n        searchId=\"search-page-input\"\r\n        showDropdown={false}\r\n        {mode}\r\n      >\r\n        {#snippet leftSection()}\r\n          <button\r\n            onclick={handleCategoryDropdownToggle}\r\n            type=\"button\"\r\n            class=\"h-11 px-4 bg-transparent hover:bg-[color:var(--surface-subtle)] transition-all duration-200 flex items-center gap-2 focus:outline-none focus:bg-[color:var(--surface-subtle)] border-r border-[color:var(--border-subtle)] rounded-l-lg\"\r\n            aria-expanded={showCategoryDropdown}\r\n            aria-haspopup=\"listbox\"\r\n            aria-label=\"Select category\"\r\n          >\r\n            <span class=\"text-[length:var(--text-sm)] font-medium text-[color:var(--text-secondary)]\">Browse</span>\r\n            {#if currentResultCount !== undefined}\r\n              <span class=\"px-2 py-1 text-[length:var(--text-xs)] font-semibold bg-[color:var(--surface-subtle)] text-[color:var(--text-primary)] rounded-full\">\r\n                {currentResultCount.toLocaleString()}\r\n              </span>\r\n            {/if}\r\n            <svg class=\"w-4 h-4 text-[color:var(--text-secondary)] transition-transform duration-200 {showCategoryDropdown ? 'rotate-180' : ''}\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\" />\r\n            </svg>\r\n          </button>\r\n        {/snippet}\r\n      </SearchInput>\r\n\r\n      <!-- Typeahead: Category matches as user types -->\r\n      {#if (searchValue || '').trim().length > 0 && categoryMatches.length > 0}\r\n        <div class=\"absolute top-full left-0 right-0 mt-1 z-50\">\r\n          <div class=\"bg-white border border-gray-200 rounded-xl shadow-lg overflow-hidden\">\r\n            <div class=\"max-h-[50vh] overflow-y-auto\">\r\n              <div class=\"p-2 text-[length:var(--text-xs)] font-semibold text-[color:var(--text-secondary)] uppercase tracking-wide\">Categories</div>\r\n              {#each categoryMatches as c}\r\n                <button\r\n                  onclick={() => handleMegaMenuCategorySelect(c.slug, c.level, c.path)}\r\n                  class=\"w-full flex items-center gap-2 px-3 h-9 min-h-9 hover:bg-gray-50 text-left transition-colors\"\r\n                  role=\"option\"\r\n                  aria-selected=\"false\"\r\n                  aria-label=\"Select category: {c.name} (Level {c.level})\"\r\n                >\r\n                  <span class=\"text-[color:var(--text-tertiary)] text-[length:var(--text-xs)] w-8\">{c.level === 1 ? 'L1' : c.level === 2 ? 'L2' : 'L3'}</span>\r\n                  <span class=\"flex-1 text-[length:var(--text-sm)] text-gray-900\">{c.name}</span>\r\n                  <svg class=\"w-4 h-4 text-[color:var(--text-tertiary)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\" />\r\n                  </svg>\r\n                </button>\r\n              {/each}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      {/if}\r\n\r\n      <!-- Tabbed Dropdown -->\r\n      {#if showCategoryDropdown}\r\n        <div class=\"absolute top-full left-0 right-0 mt-1 z-50\">\r\n          <div class=\"bg-white border border-gray-200 rounded-xl shadow-lg p-4 min-h-[350px] max-h-[80vh] overflow-hidden\">\r\n            <!-- Tab Headers - Scrollable on mobile (40px preferred for secondary actions) -->\r\n            <div class=\"flex items-center gap-1 mb-4 bg-gray-100 p-1 rounded-lg overflow-x-auto scrollbarhide\" role=\"tablist\" aria-label=\"Filter categories\">\r\n              <button\r\n                onclick={() => activeDropdownTab = 'categories'}\r\n                class=\"shrink-0 px-3 h-10 min-h-10 text-[length:var(--text-sm)] font-medium rounded-md transition-all duration-200 flex items-center justify-center {activeDropdownTab === 'categories' ? 'bg-white text-[color:var(--brand-primary)] shadow-sm' : 'text-[color:var(--text-secondary)] hover:text-[color:var(--text-primary)]'}\"\r\n                role=\"tab\"\r\n                aria-selected={activeDropdownTab === 'categories'}\r\n                aria-controls=\"categories-panel\"\r\n                id=\"categories-tab\"\r\n              >\r\n                Categories\r\n              </button>\r\n              <button\r\n                onclick={() => activeDropdownTab = 'collections'}\r\n                class=\"shrink-0 px-3 h-10 min-h-10 text-[length:var(--text-sm)] font-medium rounded-md transition-all duration-200 flex items-center justify-center {activeDropdownTab === 'collections' ? 'bg-white text-[color:var(--brand-primary)] shadow-sm' : 'text-[color:var(--text-secondary)] hover:text-[color:var(--text-primary)]'}\"\r\n                role=\"tab\"\r\n                aria-selected={activeDropdownTab === 'collections'}\r\n                aria-controls=\"collections-panel\"\r\n                id=\"collections-tab\"\r\n              >\r\n                Collections\r\n              </button>\r\n              <button\r\n                onclick={() => activeDropdownTab = 'size'}\r\n                class=\"shrink-0 px-3 h-10 min-h-10 text-[length:var(--text-sm)] font-medium rounded-md transition-all duration-200 flex items-center justify-center {activeDropdownTab === 'size' ? 'bg-white text-[color:var(--brand-primary)] shadow-sm' : 'text-[color:var(--text-secondary)] hover:text-[color:var(--text-primary)]'}\"\r\n                role=\"tab\"\r\n                aria-selected={activeDropdownTab === 'size'}\r\n                aria-controls=\"size-panel\"\r\n                id=\"size-tab\"\r\n              >\r\n                Size\r\n              </button>\r\n              <button\r\n                onclick={() => activeDropdownTab = 'color'}\r\n                class=\"shrink-0 px-3 h-10 min-h-10 text-[length:var(--text-sm)] font-medium rounded-md transition-all duration-200 flex items-center justify-center {activeDropdownTab === 'color' ? 'bg-white text-[color:var(--brand-primary)] shadow-sm' : 'text-[color:var(--text-secondary)] hover:text-[color:var(--text-primary)]'}\"\r\n                role=\"tab\"\r\n                aria-selected={activeDropdownTab === 'color'}\r\n                aria-controls=\"color-panel\"\r\n                id=\"color-tab\"\r\n              >\r\n                Color\r\n              </button>\r\n              <button\r\n                onclick={() => activeDropdownTab = 'brand'}\r\n                class=\"shrink-0 px-3 h-10 min-h-10 text-[length:var(--text-sm)] font-medium rounded-md transition-all duration-200 flex items-center justify-center {activeDropdownTab === 'brand' ? 'bg-white text-[color:var(--brand-primary)] shadow-sm' : 'text-[color:var(--text-secondary)] hover:text-[color:var(--text-primary)]'}\"\r\n                role=\"tab\"\r\n                aria-selected={activeDropdownTab === 'brand'}\r\n                aria-controls=\"brand-panel\"\r\n                id=\"brand-tab\"\r\n              >\r\n                Brand\r\n              </button>\r\n              <button\r\n                onclick={() => activeDropdownTab = 'condition'}\r\n                class=\"shrink-0 px-3 h-10 min-h-10 text-[length:var(--text-sm)] font-medium rounded-md transition-all duration-200 flex items-center justify-center {activeDropdownTab === 'condition' ? 'bg-white text-[color:var(--brand-primary)] shadow-sm' : 'text-[color:var(--text-secondary)] hover:text-[color:var(--text-primary)]'}\"\r\n                role=\"tab\"\r\n                aria-selected={activeDropdownTab === 'condition'}\r\n                aria-controls=\"condition-panel\"\r\n                id=\"condition-tab\"\r\n              >\r\n                Condition\r\n              </button>\r\n            </div>\r\n\r\n            <!-- Search Input -->\r\n            <div class=\"mb-4\">\r\n              <div class=\"relative\">\r\n                <svg class=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[color:var(--text-tertiary)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"></path>\r\n                </svg>\r\n                <input\r\n                  type=\"text\"\r\n                  bind:value={dropdownSearchQuery}\r\n                  placeholder={activeDropdownTab === 'categories' ? 'Search categories...' :\r\n                              activeDropdownTab === 'collections' ? 'Search collections...' :\r\n                              activeDropdownTab === 'size' ? 'Search sizes...' :\r\n                              activeDropdownTab === 'color' ? 'Search colors...' :\r\n                              activeDropdownTab === 'brand' ? 'Search brands...' :\r\n                              'Search conditions...'}\r\n                  class=\"w-full pl-10 pr-4 h-10 min-h-10 text-[length:var(--text-sm)] border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 hover:bg-white transition-colors\"\r\n                />\r\n                {#if dropdownSearchQuery.trim()}\r\n                  <button\r\n                    onclick={() => dropdownSearchQuery = ''}\r\n                    class=\"absolute right-3 top-1/2 transform -translate-y-1/2 w-9 h-9 min-w-9 min-h-9 flex items-center justify-center text-[color:var(--text-tertiary)] hover:text-[color:var(--text-secondary)] hover:bg-[color:var(--surface-subtle)] rounded-full transition-colors\"\r\n                    aria-label=\"Clear search query\"\r\n                    type=\"button\"\r\n                  >\r\n                    <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                    </svg>\r\n                  </button>\r\n                {/if}\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Tab Content -->\r\n            <div class=\"min-h-[200px] max-h-[300px] overflow-y-auto\" role=\"tabpanel\" aria-labelledby=\"{activeDropdownTab}-tab\" id=\"{activeDropdownTab}-panel\">\r\n              {#if activeDropdownTab === 'categories'}\r\n                <MegaMenuCategories\r\n                  categories={megaMenuData}\r\n                  onCategoryClick={handleMegaMenuCategorySelect}\r\n                  onClose={handleCategoryDropdownClose}\r\n                />\r\n              {:else if activeDropdownTab === 'collections'}\r\n                <div class=\"grid grid-cols-2 gap-2\" role=\"grid\" aria-label=\"Collection filters\">\r\n                  {#each filteredCollections as collection}\r\n                    <button\r\n                      onclick={() => handleCollectionSelect(collection)}\r\n                      class=\"flex items-center gap-2 p-3 h-10 min-h-10 bg-gray-50 hover:bg-gray-100 hover:shadow-sm rounded-lg border border-gray-200 hover:border-gray-300 transition-all duration-200 text-left group\"\r\n                      aria-label=\"Filter by collection: {collection.label}\"\r\n                    >\r\n                      <span class=\"text-[length:var(--text-lg)]\">{collection.emoji}</span>\r\n                      <span class=\"font-medium text-[color:var(--text-primary)] group-hover:text-[color:var(--brand-primary)] text-[length:var(--text-sm)]\">{collection.label}</span>\r\n                    </button>\r\n                  {/each}\r\n                  {#if filteredCollections.length === 0 && dropdownSearchQuery.trim()}\r\n                    <div class=\"col-span-2 text-center py-4 text-[color:var(--text-secondary)]\">\r\n                      <p class=\"text-[length:var(--text-sm)]\">No collections found</p>\r\n                    </div>\r\n                  {/if}\r\n                </div>\r\n              {:else if activeDropdownTab === 'size'}\r\n                <div class=\"grid grid-cols-3 sm:grid-cols-4 gap-2\" role=\"group\" aria-label=\"Size filters\">\r\n                  {#each filteredSizes as size}\r\n                    <button\r\n                      onclick={() => handleSizeSelect(size)}\r\n                      class=\"flex items-center justify-center p-3 h-10 min-h-10 bg-gray-50 hover:bg-gray-100 hover:shadow-sm rounded-lg border border-gray-200 hover:border-gray-300 transition-all duration-200 text-left group\r\n                        {appliedFilters?.size === size ? 'bg-blue-50 border-blue-300 text-blue-700' : ''}\"\r\n                      aria-label=\"Filter by size: {size}\"\r\n                      aria-pressed={appliedFilters?.size === size}\r\n                    >\r\n                      <span class=\"font-medium text-[length:var(--text-sm)]\">{size}</span>\r\n                    </button>\r\n                  {/each}\r\n                  {#if filteredSizes.length === 0}\r\n                    <div class=\"col-span-full text-center py-4 text-[color:var(--text-secondary)]\">\r\n                      <p class=\"text-[length:var(--text-sm)]\">{dropdownSearchQuery.trim() ? 'No sizes found' : 'No sizes available'}</p>\r\n                    </div>\r\n                  {/if}\r\n                </div>\r\n              {:else if activeDropdownTab === 'color'}\r\n                <div class=\"grid grid-cols-2 sm:grid-cols-3 gap-2\" role=\"group\" aria-label=\"Color filters\">\r\n                  {#each filteredColors as color}\r\n                    <button\r\n                      onclick={() => handleColorSelect(color)}\r\n                      class=\"flex items-center gap-2 p-3 h-10 min-h-10 bg-gray-50 hover:bg-gray-100 hover:shadow-sm rounded-lg border border-gray-200 hover:border-gray-300 transition-all duration-200 text-left group\r\n                        {appliedFilters?.color === color ? 'bg-blue-50 border-blue-300 text-blue-700' : ''}\"\r\n                      aria-label=\"Filter by color: {color}\"\r\n                      aria-pressed={appliedFilters?.color === color}\r\n                    >\r\n                      <div class=\"w-4 h-4 rounded-full border border-gray-300 flex-shrink-0\" style=\"background-color: {color.toLowerCase()}\"></div>\r\n                      <span class=\"font-medium text-[length:var(--text-sm)]\">{color}</span>\r\n                    </button>\r\n                  {/each}\r\n                  {#if filteredColors.length === 0}\r\n                    <div class=\"col-span-full text-center py-4 text-[color:var(--text-secondary)]\">\r\n                      <p class=\"text-[length:var(--text-sm)]\">{dropdownSearchQuery.trim() ? 'No colors found' : 'No colors available'}</p>\r\n                    </div>\r\n                  {/if}\r\n                </div>\r\n              {:else if activeDropdownTab === 'brand'}\r\n                <div class=\"grid grid-cols-1 gap-2\" role=\"group\" aria-label=\"Brand filters\">\r\n                  {#each filteredBrands as brand}\r\n                    <button\r\n                      onclick={() => handleBrandSelect(brand)}\r\n                      class=\"flex items-center justify-between p-3 h-10 min-h-10 bg-gray-50 hover:bg-gray-100 hover:shadow-sm rounded-lg border border-gray-200 hover:border-gray-300 transition-all duration-200 text-left group\r\n                        {appliedFilters?.brand === brand ? 'bg-blue-50 border-blue-300 text-blue-700' : ''}\"\r\n                      aria-label=\"Filter by brand: {brand}\"\r\n                      aria-pressed={appliedFilters?.brand === brand}\r\n                    >\r\n                      <span class=\"font-medium text-[color:var(--text-primary)] group-hover:text-[color:var(--brand-primary)] text-[length:var(--text-sm)]\">{brand}</span>\r\n                      {#if appliedFilters?.brand === brand}\r\n                        <svg class=\"w-4 h-4 text-blue-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                          <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" />\r\n                        </svg>\r\n                      {/if}\r\n                    </button>\r\n                  {/each}\r\n                  {#if filteredBrands.length === 0}\r\n                    <div class=\"text-center py-4 text-[color:var(--text-secondary)]\">\r\n                      <p class=\"text-[length:var(--text-sm)]\">{dropdownSearchQuery.trim() ? 'No brands found' : 'No brands available'}</p>\r\n                    </div>\r\n                  {/if}\r\n                </div>\r\n              {:else if activeDropdownTab === 'condition'}\r\n                <div class=\"grid grid-cols-1 gap-2\" role=\"group\" aria-label=\"Condition filters\">\r\n                  {#each filteredConditions as condition}\r\n                    <button\r\n                      onclick={() => handleConditionSelect(condition)}\r\n                      class=\"flex items-center justify-between p-3 h-10 min-h-10 bg-gray-50 hover:bg-gray-100 hover:shadow-sm rounded-lg border border-gray-200 hover:border-gray-300 transition-all duration-200 text-left group\"\r\n                      aria-label=\"Filter by condition: {condition.label}\"\r\n                    >\r\n                      <div>\r\n                        <div class=\"font-medium text-[color:var(--text-primary)] group-hover:text-[color:var(--brand-primary)] text-[length:var(--text-sm)]\">{condition.label}</div>\r\n                        {#if condition.shortLabel && condition.shortLabel !== condition.label}\r\n                          <div class=\"text-[length:var(--text-xs)] text-[color:var(--text-secondary)]\">{condition.shortLabel ?? condition.label}</div>\r\n                        {/if}\r\n                      </div>\r\n                    </button>\r\n                  {/each}\r\n                  {#if filteredConditions.length === 0 && dropdownSearchQuery.trim()}\r\n                    <div class=\"text-center py-4 text-[color:var(--text-secondary)]\">\r\n                      <p class=\"text-[length:var(--text-sm)]\">No conditions found</p>\r\n                    </div>\r\n                  {/if}\r\n                </div>\r\n              {/if}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      {/if}\r\n    </div>\r\n\r\n    <!-- Category Breadcrumbs -->\r\n    {#if categoryBreadcrumbs.length > 0}\r\n      <div class=\"flex items-center justify-between px-1 py-2 text-[length:var(--text-sm)]\">\r\n        <div class=\"flex items-center gap-1\">\r\n          <svg class=\"w-4 h-4 text-[color:var(--text-tertiary)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0l-4 4m4-4l-4-4\" />\r\n          </svg>\r\n        {#each categoryBreadcrumbs as crumb, index}\r\n          <button\r\n            onclick={() => handleBreadcrumbClick(crumb.level)}\r\n            class=\"px-2 py-1 h-9 min-h-9 flex items-center text-[color:var(--text-secondary)] hover:text-[color:var(--brand-primary)] hover:bg-[color:var(--surface-subtle)] rounded-md transition-colors duration-200 font-medium\r\n              {index === categoryBreadcrumbs.length - 1 ? 'text-blue-600' : 'hover:underline'}\"\r\n            aria-label={`Navigate to ${crumb.label} level`}\r\n          >\r\n            {crumb.label}\r\n          </button>\r\n          {#if index < categoryBreadcrumbs.length - 1}\r\n            <svg class=\"w-3 h-3 text-[color:var(--text-tertiary)]\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\" />\r\n            </svg>\r\n          {/if}\r\n        {/each}\r\n        <button\r\n          onclick={() => {\r\n            setFilter('category', null);\r\n            setFilter('subcategory', null);\r\n            setFilter('specific', null);\r\n          }}\r\n          class=\"ml-2 w-9 h-9 min-w-9 min-h-9 flex items-center justify-center text-[color:var(--text-tertiary)] hover:text-red-500 hover:bg-red-50 rounded-full transition-colors duration-200\"\r\n          aria-label=\"Clear category filter\"\r\n          title=\"Clear category selection\"\r\n        >\r\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\r\n          </svg>\r\n        </button>\r\n        </div>\r\n\r\n        <!-- Result count for current selection -->\r\n        {#if currentResultCount !== undefined}\r\n          <div class=\"text-[length:var(--text-xs)] text-[color:var(--text-secondary)] font-medium\" id=\"search-results-count\" aria-live=\"polite\">\r\n            {currentResultCount.toLocaleString()} items\r\n          </div>\r\n        {/if}\r\n      </div>\r\n    {/if}\r\n\r\n    <!-- Smart Filter Pills -->\r\n    <nav id=\"category-pills\" class=\"flex items-center gap-2 sm:gap-3 overflow-x-auto scrollbarhide pb-[var(--gutter-xxs)] pt-[var(--gutter-xxs)]\" aria-label=\"Smart category filters\">\r\n      <!-- Dynamic Category Pills -->\r\n      {#each smartPillData?.pills || [] as pill, index}\r\n        <CategoryPill\r\n          variant={pill.active ? 'primary' : 'outline'}\r\n          label={pill.label}\r\n          emoji={pill.icon}\r\n          onclick={() => handleSmartPillClick(pill.key, smartPillData?.level || 1)}\r\n          class=\"shrink-0 min-h-11\"\r\n          onkeydown={(e: KeyboardEvent) => handlePillKeyNav(e, index)}\r\n        />\r\n      {/each}\r\n\r\n      <!-- Separator between category and condition pills -->\r\n      {#if smartPillData?.pills?.length > 0 && conditionFilters?.length > 0}\r\n        <div class=\"w-px h-6 bg-[color:var(--border-default)] mx-1\"></div>\r\n      {/if}\r\n\r\n      <!-- Condition Pills -->\r\n      {#each conditionFilters as condition, cIdx}\r\n        <button\r\n          type=\"button\"\r\n          onclick={() => handleConditionPillClick((condition.key ?? condition.value))}\r\n          class=\"shrink-0 px-3 py-2 rounded-full text-[length:var(--text-xs)] font-semibold transition-all duration-200 min-h-11\r\n            {appliedFilters?.condition === (condition.key ?? condition.value)\r\n              ? 'bg-[color:var(--brand-primary)] text-[color:var(--text-inverse)] border border-[color:var(--brand-primary)]'\r\n              : 'bg-[color:var(--surface-subtle)] text-[color:var(--text-secondary)] border border-[color:var(--border-default)] hover:border-[color:var(--border-emphasis)] hover:bg-[color:var(--surface-base)]'}\"\r\n          aria-label={`Filter by ${condition.label}`}\r\n          aria-pressed={appliedFilters?.condition === (condition.key ?? condition.value)}\r\n          onkeydown={(e: KeyboardEvent) => handlePillKeyNav(e, (mainCategories?.length || 0) + cIdx)}\r\n        >\r\n          {condition.shortLabel ?? condition.label}\r\n        </button>\r\n      {/each}\r\n    </nav>\r\n\r\n    <!-- Applied Filters -->\r\n    {#if appliedFilters && Object.keys(appliedFilters).length > 0}\r\n      <div class=\"pb-2\">\r\n        <AppliedFilterPills\r\n          filters={appliedFilters}\r\n          onRemoveFilter={onFilterRemove}\r\n          onClearAll={onClearAllFilters}\r\n        />\r\n      </div>\r\n    {/if}\r\n  </div>\r\n</div>\r\n\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\TrendingDropdown.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Product' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'quickFilters' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":44,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getFilterButtonClasses' is defined but never used. Allowed unused vars must match /^_/u.","line":56,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":56,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import type { Product } from '../../types/product';\r\n  \r\n  interface Seller {\r\n    id: string;\r\n    name: string;\r\n    username?: string;\r\n    avatar?: string;\r\n    itemCount: number;\r\n  }\r\n\r\n  interface QuickFilter {\r\n    label: string;\r\n    value: string;\r\n    style?: 'default' | 'price' | 'new' | 'condition' | 'brand' | 'size';\r\n  }\r\n  \r\n  interface Props {\r\n    topSellers: Seller[];\r\n    quickFilters?: QuickFilter[];\r\n    onSellerClick: (seller: Seller) => void;\r\n    onFilterClick?: (filter: string) => void;\r\n    translations: {\r\n      quickShop: string;\r\n      shopByCondition: string;\r\n      shopByPrice: string;\r\n      quickAccess: string;\r\n      topSellers: string;\r\n      newWithTags: string;\r\n      likeNew: string;\r\n      good: string;\r\n      fair: string;\r\n      under25: string;\r\n      cheapest: string;\r\n      newest: string;\r\n      premium: string;\r\n      myFavorites: string;\r\n      browseAll: string;\r\n    };\r\n  }\r\n  \r\n  let { \r\n    topSellers,\r\n    quickFilters = [\r\n      { label: 'Under $20', value: 'price_under_20', style: 'price' },\r\n      { label: 'New Today', value: 'new_today', style: 'new' },\r\n      { label: 'Size S', value: 'size_s', style: 'size' },\r\n      { label: 'Size M', value: 'size_m', style: 'size' }\r\n    ],\r\n    onSellerClick,\r\n    onFilterClick = () => {},\r\n    translations\r\n  }: Props = $props();\r\n\r\n\r\n  function getFilterButtonClasses(style: string = 'default'): string {\r\n    const baseClasses = 'px-3 py-1.5 rounded-[var(--radius-md)] text-xs font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[color:var(--state-focus)] focus:ring-offset-1';\r\n    \r\n    switch(style) {\r\n      case 'price':\r\n        return `${baseClasses} bg-[color:var(--success-subtle)] text-[color:var(--success-text)] hover:bg-[color:var(--success-muted)]`;\r\n      case 'new':\r\n        return `${baseClasses} bg-[color:var(--primary-subtle)] text-[color:var(--primary-text)] hover:bg-[color:var(--primary-muted)]`;\r\n      case 'condition':\r\n        return `${baseClasses} bg-[color:var(--accent-subtle)] text-[color:var(--accent-text)] hover:bg-[color:var(--accent-muted)]`;\r\n      case 'brand':\r\n      case 'size':\r\n        return `${baseClasses} bg-[color:var(--surface-subtle)] text-[color:var(--text-secondary)] hover:bg-[color:var(--surface-muted)]`;\r\n      default:\r\n        return `${baseClasses} bg-[color:var(--surface-subtle)] text-[color:var(--text-secondary)] hover:bg-[color:var(--surface-muted)]`;\r\n    }\r\n  }\r\n</script>\r\n\r\n<div class=\"w-full bg-[color:var(--surface-base)] rounded-xl shadow-lg border border-[color:var(--border-default)] overflow-hidden max-w-4xl mx-auto\">\r\n\r\n  <!-- Main Content -->\r\n  <div class=\"p-6 space-y-6\">\r\n    \r\n    <!-- Condition Filters -->\r\n    <div class=\"space-y-3\">\r\n      <h3 class=\"text-xs uppercase tracking-wide font-semibold text-[color:var(--text-secondary)]\">{translations.shopByCondition}</h3>\r\n      <div class=\"flex items-center gap-2 overflow-x-auto scrollbarhide\">\r\n        <button \r\n          onclick={() => onFilterClick('condition=brand_new_with_tags')}\r\n          class=\"shrink-0 px-4 py-2 bg-[color:var(--surface-subtle)] border border-[color:var(--border-default)] rounded-lg text-sm font-medium text-[color:var(--text-secondary)] hover:bg-[color:var(--surface-muted)] hover:border-[color:var(--border-hover)] transition-colors min-h-[36px] focus:outline-none focus:ring-2 focus:ring-[color:var(--state-focus)] focus:ring-offset-1\"\r\n        >\r\n          🏷️ {translations.newWithTags}\r\n        </button>\r\n        <button \r\n          onclick={() => onFilterClick('condition=new_without_tags')}\r\n          class=\"shrink-0 px-4 py-2 bg-[color:var(--surface-subtle)] border border-[color:var(--border-default)] rounded-lg text-sm font-medium text-[color:var(--text-secondary)] hover:bg-[color:var(--surface-muted)] hover:border-[color:var(--border-hover)] transition-colors min-h-[36px] focus:outline-none focus:ring-2 focus:ring-[color:var(--state-focus)] focus:ring-offset-1\"\r\n        >\r\n          ✨ {translations.likeNew}\r\n        </button>\r\n        <button \r\n          onclick={() => onFilterClick('condition=like_new')}\r\n          class=\"shrink-0 px-4 py-2 bg-[color:var(--surface-subtle)] border border-[color:var(--border-default)] rounded-lg text-sm font-medium text-[color:var(--text-secondary)] hover:bg-[color:var(--surface-muted)] hover:border-[color:var(--border-hover)] transition-colors min-h-[36px] focus:outline-none focus:ring-2 focus:ring-[color:var(--state-focus)] focus:ring-offset-1\"\r\n        >\r\n          👍 {translations.good}\r\n        </button>\r\n        <button \r\n          onclick={() => onFilterClick('condition=good')}\r\n          class=\"shrink-0 px-4 py-2 bg-[color:var(--surface-subtle)] border border-[color:var(--border-default)] rounded-lg text-sm font-medium text-[color:var(--text-secondary)] hover:bg-[color:var(--surface-muted)] hover:border-[color:var(--border-hover)] transition-colors min-h-[36px] focus:outline-none focus:ring-2 focus:ring-[color:var(--state-focus)] focus:ring-offset-1\"\r\n        >\r\n          📦 {translations.fair}\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Price & Sort Filters -->\r\n    <div class=\"space-y-3\">\r\n      <h3 class=\"text-xs uppercase tracking-wide font-semibold text-[color:var(--text-secondary)]\">{translations.shopByPrice}</h3>\r\n      <div class=\"flex items-center gap-2 overflow-x-auto scrollbarhide\">\r\n        <button \r\n          onclick={() => onFilterClick('under25')}\r\n          class=\"shrink-0 px-4 py-2 bg-[color:var(--primary)] text-[color:var(--primary-fg)] rounded-lg text-sm font-medium hover:bg-[color:var(--primary-hover)] transition-colors min-h-[36px] focus:outline-none focus:ring-2 focus:ring-[color:var(--state-focus)] focus:ring-offset-1\"\r\n        >\r\n          💰 {translations.under25}\r\n        </button>\r\n        <button \r\n          onclick={() => onFilterClick('price-low')}\r\n          class=\"shrink-0 px-4 py-2 bg-[color:var(--surface-muted)] border border-[color:var(--border-default)] text-[color:var(--text-primary)] rounded-lg text-sm font-medium hover:bg-[color:var(--surface-subtle)] hover:border-[color:var(--border-hover)] transition-colors min-h-[36px] focus:outline-none focus:ring-2 focus:ring-[color:var(--state-focus)] focus:ring-offset-1\"\r\n        >\r\n          💸 {translations.cheapest}\r\n        </button>\r\n        <button \r\n          onclick={() => onFilterClick('newest')}\r\n          class=\"shrink-0 px-4 py-2 bg-[color:var(--surface-muted)] border border-[color:var(--border-default)] text-[color:var(--text-primary)] rounded-lg text-sm font-medium hover:bg-[color:var(--surface-subtle)] hover:border-[color:var(--border-hover)] transition-colors min-h-[36px] focus:outline-none focus:ring-2 focus:ring-[color:var(--state-focus)] focus:ring-offset-1\"\r\n        >\r\n          📅 {translations.newest}\r\n        </button>\r\n        <button \r\n          onclick={() => onFilterClick('price-high')}\r\n          class=\"shrink-0 px-4 py-2 bg-[color:var(--surface-muted)] border border-[color:var(--border-default)] text-[color:var(--text-primary)] rounded-lg text-sm font-medium hover:bg-[color:var(--surface-subtle)] hover:border-[color:var(--border-hover)] transition-colors min-h-[36px] focus:outline-none focus:ring-2 focus:ring-[color:var(--state-focus)] focus:ring-offset-1\"\r\n        >\r\n          🔥 {translations.premium}\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n  </div>\r\n\r\n  <!-- Top Sellers -->\r\n  {#if topSellers.length > 0}\r\n    <div class=\"border-t border-[color:var(--border-subtle)] p-6 bg-[color:var(--surface-subtle)]\">\r\n      <div class=\"space-y-3\">\r\n        <h3 class=\"text-xs uppercase tracking-wide font-semibold text-[color:var(--text-secondary)] flex items-center gap-2\">\r\n          <span class=\"w-2 h-2 bg-[color:var(--primary)] rounded-full animate-pulse\"></span>\r\n          {translations.topSellers}\r\n        </h3>\r\n        <div class=\"flex items-center gap-3 overflow-x-auto scrollbarhide pb-1\">\r\n          {#each topSellers.slice(0, 6) as seller, index}\r\n            <button\r\n              onclick={() => onSellerClick(seller)}\r\n              class=\"shrink-0 flex items-center gap-3 px-4 py-3 bg-[color:var(--surface-base)] border border-[color:var(--border-default)] rounded-xl hover:border-[color:var(--border-hover)] hover:shadow-sm transition-all duration-200 group min-w-[140px] focus:outline-none focus:ring-2 focus:ring-[color:var(--state-focus)] focus:ring-offset-1\"\r\n              aria-label=\"View {seller.name || seller.username}'s shop\"\r\n            >\r\n              <div class=\"relative\">\r\n                <div class=\"w-10 h-10 rounded-full bg-[color:var(--surface-subtle)] overflow-hidden border-2 border-[color:var(--surface-base)] shadow-sm\">\r\n                  {#if seller.avatar}\r\n                    <img \r\n                      src={seller.avatar} \r\n                      alt={seller.name || seller.username}\r\n                      class=\"w-full h-full object-cover\"\r\n                    />\r\n                  {:else}\r\n                    <div class=\"w-full h-full flex items-center justify-center text-[color:var(--text-secondary)] font-bold text-sm\">\r\n                      {(seller.name || seller.username || '?')[0].toUpperCase()}\r\n                    </div>\r\n                  {/if}\r\n                </div>\r\n                {#if index < 3}\r\n                  <div class=\"absolute -top-1 -right-1 bg-[color:var(--primary)] rounded-full w-5 h-5 flex items-center justify-center shadow-sm\">\r\n                    <span class=\"text-[color:var(--primary-fg)] text-xs font-bold\">{index + 1}</span>\r\n                  </div>\r\n                {/if}\r\n              </div>\r\n              <div class=\"flex flex-col items-start min-w-0\">\r\n                <span class=\"text-sm font-semibold text-[color:var(--text-primary)] truncate\">\r\n                  {(seller.name || seller.username || 'User').split(' ')[0]}\r\n                </span>\r\n                <span class=\"text-xs text-[color:var(--text-secondary)]\">\r\n                  {seller.itemCount || 0} items\r\n                </span>\r\n              </div>\r\n            </button>\r\n          {/each}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  {/if}\r\n</div>\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\navigation\\TrendingSection.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\notifications\\CountryDetectionBanner.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\notifications\\NotificationBell.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\AppliedFilterPills.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[290,293],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[290,293],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  interface FilterPill {\r\n    key: string;\r\n    label: string;\r\n    value: string;\r\n    type: 'category' | 'subcategory' | 'specific' | 'size' | 'brand' | 'condition' | 'price' | 'sort';\r\n    removable?: boolean;\r\n  }\r\n\r\n  interface Props {\r\n    filters: Record<string, any>;\r\n    categoryLabels?: Record<string, string>;\r\n    onRemoveFilter: (key: string, type?: string) => void;\r\n    onClearAll?: () => void;\r\n    class?: string;\r\n    clearAllLabel?: string;\r\n    maxDisplay?: number;\r\n    showMore?: boolean;\r\n  }\r\n\r\n  let {\r\n    filters,\r\n    categoryLabels = {},\r\n    onRemoveFilter,\r\n    onClearAll,\r\n    class: className = '',\r\n    clearAllLabel = 'Clear All',\r\n    maxDisplay = 10,\r\n    showMore = false\r\n  }: Props = $props();\r\n\r\n  // Generate filter pills from current filters with defensive programming\r\n  let filterPills = $derived((() => {\r\n    const pills: FilterPill[] = [];\r\n\r\n    // Ensure filters object exists and has properties before accessing\r\n    if (!filters || typeof filters !== 'object') {\r\n      return pills;\r\n    }\r\n\r\n    // Category hierarchy with null checks\r\n    if (filters.category) {\r\n      pills.push({\r\n        key: 'category',\r\n        label: categoryLabels?.[filters.category] || filters.category,\r\n        value: filters.category,\r\n        type: 'category',\r\n        removable: true\r\n      });\r\n    }\r\n\r\n    if (filters.subcategory) {\r\n      pills.push({\r\n        key: 'subcategory',\r\n        label: categoryLabels?.[filters.subcategory] || filters.subcategory,\r\n        value: filters.subcategory,\r\n        type: 'subcategory',\r\n        removable: true\r\n      });\r\n    }\r\n\r\n    if (filters.specific) {\r\n      pills.push({\r\n        key: 'specific',\r\n        label: categoryLabels?.[filters.specific] || filters.specific,\r\n        value: filters.specific,\r\n        type: 'specific',\r\n        removable: true\r\n      });\r\n    }\r\n\r\n    // Other filters with defensive checks\r\n    if (filters.size && filters.size !== 'all') {\r\n      pills.push({\r\n        key: 'size',\r\n        label: `Size: ${filters.size}`,\r\n        value: filters.size,\r\n        type: 'size',\r\n        removable: true\r\n      });\r\n    }\r\n\r\n    if (filters.brand && filters.brand !== 'all') {\r\n      pills.push({\r\n        key: 'brand',\r\n        label: filters.brand,\r\n        value: filters.brand,\r\n        type: 'brand',\r\n        removable: true\r\n      });\r\n    }\r\n\r\n    if (filters.condition && filters.condition !== 'all') {\r\n      const conditionLabels: Record<string, string> = {\r\n        'brand_new_with_tags': 'Brand New',\r\n        'new_without_tags': 'New',\r\n        'like_new': 'Like New',\r\n        'good': 'Good',\r\n        'fair': 'Fair'\r\n      };\r\n      pills.push({\r\n        key: 'condition',\r\n        label: conditionLabels[filters.condition] || filters.condition,\r\n        value: filters.condition,\r\n        type: 'condition',\r\n        removable: true\r\n      });\r\n    }\r\n\r\n    // Price range with defensive checks\r\n    if (filters.minPrice || filters.maxPrice) {\r\n      let priceLabel = 'Price: ';\r\n      if (filters.minPrice && filters.maxPrice) {\r\n        priceLabel += `${filters.minPrice} - ${filters.maxPrice} лв`;\r\n      } else if (filters.minPrice) {\r\n        priceLabel += `from ${filters.minPrice} лв`;\r\n      } else if (filters.maxPrice) {\r\n        priceLabel += `up to ${filters.maxPrice} лв`;\r\n      }\r\n\r\n      pills.push({\r\n        key: 'price',\r\n        label: priceLabel,\r\n        value: `${filters.minPrice || ''}-${filters.maxPrice || ''}`,\r\n        type: 'price',\r\n        removable: true\r\n      });\r\n    }\r\n\r\n    // Sort (if not default) with defensive check\r\n    if (filters.sortBy && filters.sortBy !== 'relevance') {\r\n      const sortLabels: Record<string, string> = {\r\n        'price-low': 'Price: Low to High',\r\n        'price-high': 'Price: High to Low',\r\n        'newest': 'Newest First'\r\n      };\r\n      pills.push({\r\n        key: 'sortBy',\r\n        label: sortLabels[filters.sortBy] || filters.sortBy,\r\n        value: filters.sortBy,\r\n        type: 'sort',\r\n        removable: true\r\n      });\r\n    }\r\n\r\n    return pills;\r\n  })());\r\n\r\n  // Display pills (with optional limit)\r\n  let displayedPills = $derived(\r\n    showMore || filterPills.length <= maxDisplay \r\n      ? filterPills \r\n      : filterPills.slice(0, maxDisplay)\r\n  );\r\n\r\n  let hasMorePills = $derived(filterPills.length > maxDisplay);\r\n\r\n  function handleRemoveFilter(pill: FilterPill) {\r\n    if (pill.type === 'price') {\r\n      onRemoveFilter('minPrice');\r\n      onRemoveFilter('maxPrice');\r\n    } else if (pill.type === 'category') {\r\n      // Remove entire category hierarchy\r\n      onRemoveFilter('category');\r\n      onRemoveFilter('subcategory');\r\n      onRemoveFilter('specific');\r\n    } else if (pill.type === 'subcategory') {\r\n      // Remove subcategory and specific, keep main category\r\n      onRemoveFilter('subcategory');\r\n      onRemoveFilter('specific');\r\n    } else if (pill.type === 'specific') {\r\n      // Remove only specific\r\n      onRemoveFilter('specific');\r\n    } else {\r\n      onRemoveFilter(pill.key);\r\n    }\r\n  }\r\n\r\n  let showMoreState = $state(false);\r\n\r\n  function toggleShowMore() {\r\n    showMoreState = !showMoreState;\r\n  }\r\n</script>\r\n\r\n{#if filterPills.length > 0}\r\n  <div class=\"flex items-center gap-2 flex-wrap {className}\">\r\n    {#each showMoreState ? filterPills : displayedPills as pill (pill.key + pill.value)}\r\n      <div class=\"inline-flex items-center gap-1.5 px-3 py-1.5 bg-[color:var(--primary-50)] text-[color:var(--primary-700)] \r\n                  rounded-full text-xs font-medium border border-[color:var(--primary-200)]\r\n                  transition-colors duration-[var(--duration-base)]\">\r\n        <span class=\"max-w-32 truncate\">{pill.label}</span>\r\n        {#if pill.removable}\r\n          <button\r\n            onclick={() => handleRemoveFilter(pill)}\r\n            class=\"ml-1 p-0.5 rounded-full hover:bg-[color:var(--primary-100)] \r\n                   focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-[color:var(--state-focus)]\r\n                   transition-colors duration-[var(--duration-base)]\"\r\n            aria-label=\"Remove {pill.label} filter\"\r\n          >\r\n            <svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        {/if}\r\n      </div>\r\n    {/each}\r\n\r\n    {#if hasMorePills && !showMoreState}\r\n      <button\r\n        onclick={toggleShowMore}\r\n        class=\"inline-flex items-center gap-1 px-2 py-1.5 text-xs font-medium text-[color:var(--text-secondary)]\r\n               hover:text-[color:var(--text-primary)] hover:bg-[color:var(--surface-subtle)]\r\n               rounded-full border border-[color:var(--border-default)] border-dashed\r\n               focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-[color:var(--state-focus)]\r\n               transition-colors duration-[var(--duration-base)]\"\r\n        aria-label=\"Show {filterPills.length - maxDisplay} more filters\"\r\n      >\r\n        +{filterPills.length - maxDisplay} more\r\n      </button>\r\n    {:else if showMoreState && hasMorePills}\r\n      <button\r\n        onclick={toggleShowMore}\r\n        class=\"inline-flex items-center gap-1 px-2 py-1.5 text-xs font-medium text-[color:var(--text-secondary)]\r\n               hover:text-[color:var(--text-primary)] hover:bg-[color:var(--surface-subtle)]\r\n               rounded-full border border-[color:var(--border-default)] border-dashed\r\n               focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-[color:var(--state-focus)]\r\n               transition-colors duration-[var(--duration-base)]\"\r\n        aria-label=\"Show fewer filters\"\r\n      >\r\n        Show less\r\n      </button>\r\n    {/if}\r\n\r\n    {#if onClearAll && filterPills.length > 1}\r\n      <button\r\n        onclick={onClearAll}\r\n        class=\"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium\r\n               text-[color:var(--text-secondary)] hover:text-[color:var(--danger-600)]\r\n               hover:bg-[color:var(--danger-50)] border border-[color:var(--border-default)]\r\n               hover:border-[color:var(--danger-200)] rounded-full\r\n               focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-[color:var(--state-focus)]\r\n               transition-colors duration-[var(--duration-base)]\"\r\n      >\r\n        <svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n        </svg>\r\n        {clearAllLabel}\r\n      </button>\r\n    {/if}\r\n  </div>\r\n{/if}","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\AppliedFilters.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'i18n' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import type { Snippet } from 'svelte';\r\n  import * as i18n from '@repo/i18n';\r\n\r\n  interface AppliedFilter {\r\n    key: string;\r\n    label: string;\r\n    value: string | null;\r\n    displayValue: string;\r\n    removable?: boolean;\r\n    icon?: string;\r\n    color?: string;\r\n  }\r\n\r\n  interface Props {\r\n    filters: AppliedFilter[];\r\n    onRemoveFilter?: (key: string) => void;\r\n    onClearAll?: () => void;\r\n    class?: string;\r\n    showClearAll?: boolean;\r\n    clearAllLabel?: string;\r\n    ariaLabel?: string;\r\n    filterItem?: Snippet<[AppliedFilter, { onRemove: () => void }]>;\r\n    /** Announce filter changes to screen readers */\r\n    announceChanges?: boolean;\r\n    /** Custom announcement template for filter removals */\r\n    announcementTemplate?: (filter: AppliedFilter) => string;\r\n  }\r\n\r\n  let {\r\n    filters,\r\n    onRemoveFilter,\r\n    onClearAll,\r\n    class: className = '',\r\n    showClearAll = true,\r\n    clearAllLabel = 'Clear All',\r\n    ariaLabel = 'Applied filters',\r\n    filterItem,\r\n    announceChanges = true,\r\n    announcementTemplate\r\n  }: Props = $props();\r\n\r\n  // Announcement state\r\n  let announcement = $state('');\r\n\r\n  // Filter out inactive filters\r\n  const activeFilters = $derived(\r\n    filters.filter(filter => \r\n      filter.value !== null && \r\n      filter.value !== 'all' && \r\n      filter.value !== '' &&\r\n      filter.displayValue.trim() !== ''\r\n    )\r\n  );\r\n\r\n  const hasActiveFilters = $derived(activeFilters.length > 0);\r\n\r\n  // Handle individual filter removal\r\n  function handleRemoveFilter(key: string) {\r\n    const removedFilter = filters.find(f => f.key === key);\r\n    \r\n    onRemoveFilter?.(key);\r\n    \r\n    // Announce removal\r\n    if (announceChanges && removedFilter) {\r\n      if (announcementTemplate) {\r\n        announcement = announcementTemplate(removedFilter);\r\n      } else {\r\n        announcement = `Filter removed: ${removedFilter.label}`;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Handle clear all\r\n  function handleClearAll() {\r\n    const activeCount = activeFilters.length;\r\n    \r\n    onClearAll?.();\r\n    \r\n    // Announce clearing all\r\n    if (announceChanges) {\r\n      announcement = `All ${activeCount} filters cleared`;\r\n    }\r\n  }\r\n  \r\n  // Clear announcement after it's been read\r\n  $effect(() => {\r\n    if (announcement) {\r\n      const timer = setTimeout(() => {\r\n        announcement = '';\r\n      }, 1000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  });\r\n\r\n  // Generate accessible label for filter\r\n  function getFilterAriaLabel(filter: AppliedFilter): string {\r\n    return `Remove filter: ${filter.label} - ${filter.displayValue}`;\r\n  }\r\n</script>\r\n\r\n{#if hasActiveFilters}\r\n  <div class=\"applied-filters {className}\" role=\"region\" aria-label={ariaLabel}>\r\n    <!-- Summary for screen readers -->\r\n    <div class=\"sr-only\" aria-live=\"polite\">\r\n      {activeFilters.length} active filters: {activeFilters.map(f => `${f.label}: ${f.displayValue}`).join(', ')}\r\n    </div>\r\n    \r\n    <div class=\"flex items-center gap-2 flex-wrap\">\r\n      <!-- Active Filter Pills -->\r\n      {#each activeFilters as filter (filter.key)}\r\n        {#if filter.removable !== false}\r\n          {#if filterItem}\r\n            {@render filterItem(filter, { onRemove: () => handleRemoveFilter(filter.key) })}\r\n          {:else}\r\n            <button\r\n              onclick={() => handleRemoveFilter(filter.key)}\r\n              onkeydown={(e) => {\r\n                if (e.key === 'Delete' || e.key === 'Backspace') {\r\n                  e.preventDefault();\r\n                  handleRemoveFilter(filter.key);\r\n                }\r\n              }}\r\n              class=\"inline-flex items-center gap-1.5 px-3 py-1.5 \r\n                     bg-[color:var(--surface-emphasis)] hover:bg-[color:var(--surface-muted)]\r\n                     border border-[color:var(--border-default)] hover:border-[color:var(--border-emphasis)]\r\n                     rounded-[var(--radius-full)] text-xs font-medium text-[color:var(--text-primary)]\r\n                     transition-all duration-[var(--duration-base)]\r\n                     min-h-[var(--touch-compact)] max-w-48\r\n                     focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)] focus-visible:ring-offset-1\r\n                     hover:shadow-sm active:scale-95\"\r\n              aria-label={getFilterAriaLabel(filter)}\r\n              aria-describedby=\"filter-removal-help\"\r\n              title={getFilterAriaLabel(filter)}\r\n            >\r\n              <!-- Filter Icon -->\r\n              {#if filter.icon}\r\n                <span class=\"text-xs\" aria-hidden=\"true\">{filter.icon}</span>\r\n              {:else if filter.color}\r\n                <span \r\n                  class=\"w-2 h-2 rounded-full flex-shrink-0\"\r\n                  style=\"background-color: {filter.color}\"\r\n                  aria-hidden=\"true\"\r\n                ></span>\r\n              {/if}\r\n              \r\n              <!-- Filter Label and Value -->\r\n              <span class=\"truncate\">\r\n                <span class=\"text-[color:var(--text-secondary)]\">{filter.label}:</span>\r\n                <span class=\"font-semibold ml-1\">{filter.displayValue}</span>\r\n              </span>\r\n              \r\n              <!-- Remove Icon -->\r\n              <svg \r\n                class=\"w-3 h-3 flex-shrink-0 text-[color:var(--text-tertiary)] hover:text-[color:var(--text-primary)]\" \r\n                fill=\"none\" \r\n                stroke=\"currentColor\" \r\n                viewBox=\"0 0 24 24\"\r\n                aria-hidden=\"true\"\r\n              >\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2.5\" d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n          {/if}\r\n        {:else}\r\n          <!-- Non-removable filter display -->\r\n          <span class=\"inline-flex items-center gap-1.5 px-3 py-1.5 \r\n                       bg-[color:var(--surface-subtle)] border border-[color:var(--border-subtle)]\r\n                       rounded-[var(--radius-full)] text-xs font-medium text-[color:var(--text-secondary)]\r\n                       min-h-[var(--touch-compact)] max-w-48\">\r\n            {#if filter.icon}\r\n              <span class=\"text-xs\" aria-hidden=\"true\">{filter.icon}</span>\r\n            {:else if filter.color}\r\n              <span \r\n                class=\"w-2 h-2 rounded-full flex-shrink-0\"\r\n                style=\"background-color: {filter.color}\"\r\n                aria-hidden=\"true\"\r\n              ></span>\r\n            {/if}\r\n            \r\n            <span class=\"truncate\">\r\n              <span class=\"text-[color:var(--text-tertiary)]\">{filter.label}:</span>\r\n              <span class=\"font-semibold ml-1 text-[color:var(--text-primary)]\">{filter.displayValue}</span>\r\n            </span>\r\n          </span>\r\n        {/if}\r\n      {/each}\r\n      \r\n      <!-- Clear All Button -->\r\n      {#if showClearAll && activeFilters.length > 1}\r\n        <button\r\n          onclick={handleClearAll}\r\n          onkeydown={(e) => {\r\n            if (e.key === 'Delete' || e.key === 'Backspace') {\r\n              e.preventDefault();\r\n              handleClearAll();\r\n            }\r\n          }}\r\n          class=\"inline-flex items-center gap-1 px-2 py-1.5 \r\n                 text-[color:var(--text-secondary)] hover:text-[color:var(--text-primary)]\r\n                 hover:bg-[color:var(--surface-subtle)] rounded-[var(--radius-md)] \r\n                 text-xs font-medium transition-colors duration-[var(--duration-base)]\r\n                 min-h-[var(--touch-compact)]\r\n                 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)] focus-visible:ring-offset-1\"\r\n          aria-label=\"Clear all applied filters\"\r\n          aria-describedby=\"clear-all-help\"\r\n        >\r\n          <svg \r\n            class=\"w-3.5 h-3.5\" \r\n            fill=\"none\" \r\n            stroke=\"currentColor\" \r\n            viewBox=\"0 0 24 24\"\r\n            aria-hidden=\"true\"\r\n          >\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n          </svg>\r\n          {clearAllLabel}\r\n        </button>\r\n      {/if}\r\n    </div>\r\n    \r\n    <!-- Hidden help text -->\r\n    <div id=\"filter-removal-help\" class=\"sr-only\">\r\n      Click or press Enter to remove individual filters\r\n    </div>\r\n    \r\n    <div id=\"clear-all-help\" class=\"sr-only\">\r\n      Use Clear All button to remove all filters at once\r\n    </div>\r\n  </div>\r\n{/if}\r\n\r\n<!-- Live region for announcements -->\r\n{#if announcement}\r\n  <div \r\n    role=\"status\" \r\n    aria-live=\"polite\" \r\n    aria-atomic=\"true\"\r\n    class=\"sr-only\"\r\n  >\r\n    {announcement}\r\n  </div>\r\n{/if}\r\n\r\n<style>\r\n  /* Screen reader only text */\r\n  .sr-only {\r\n    position: absolute;\r\n    width: 1px;\r\n    height: 1px;\r\n    padding: 0;\r\n    margin: -1px;\r\n    overflow: hidden;\r\n    clip: rect(0, 0, 0, 0);\r\n    white-space: nowrap;\r\n    border: 0;\r\n  }\r\n  \r\n  .applied-filters {\r\n    /* Ensure proper spacing and alignment */\r\n    min-height: 2rem;\r\n  }\r\n  \r\n  /* Enhanced mobile touch targets and feedback */\r\n  @media (hover: none) and (pointer: coarse) {\r\n    button:active {\r\n      transform: scale(0.95);\r\n    }\r\n  }\r\n  \r\n  /* Smooth hover transitions */\r\n  button {\r\n    transition-property: background-color, border-color, color, box-shadow, transform;\r\n  }\r\n  \r\n  /* Accessibility: High contrast focus indicators */\r\n  @media (prefers-contrast: high) {\r\n    button:focus-visible {\r\n      outline: 2px solid currentColor;\r\n      outline-offset: 2px;\r\n    }\r\n  }\r\n  \r\n  /* Reduced motion support */\r\n  @media (prefers-reduced-motion: reduce) {\r\n    button {\r\n      transition: none;\r\n    }\r\n    \r\n    button:active {\r\n      transform: none;\r\n    }\r\n  }\r\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\CategoryFilterDropdown.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Snippet' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CategoryOption' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":60},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CategoryHierarchy' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":62,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":79},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'translateCategoryName' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'categoryId' is defined but never used. Allowed unused args must match /^_/u.","line":8,"column":75,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":85},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[929,932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[929,932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":27,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'originalFocus' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":62,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import type { Snippet } from 'svelte';\r\n  import { tick } from 'svelte';\r\n  import * as i18n from '@repo/i18n';\r\n  import type { CategoryFilterDropdownProps, CategoryOption, CategoryHierarchy } from '@repo/ui/types';\r\n  \r\n  // Enhanced category translation with fallback system\r\n  function translateCategoryName(categoryName: string | undefined | null, categoryId?: string): string {\r\n    if (!categoryName) return '';\r\n    \r\n    // Try i18n key first\r\n    const messageKey = 'category_' + categoryName\r\n      .replace(/[&+]/g, '') // Remove & and + symbols\r\n      .replace(/[^a-zA-Z0-9]/g, ' ') // Replace special chars with spaces\r\n      .trim()\r\n      .split(/\\s+/)\r\n      .map((word, index) => index === 0 ? word.toLowerCase() : word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\r\n      .join('');\r\n    \r\n    try {\r\n      if (messageKey in i18n) {\r\n        const translationFunction = (i18n as any)[messageKey];\r\n        if (typeof translationFunction === 'function') {\r\n          return translationFunction();\r\n        }\r\n      }\r\n    } catch (error) {\r\n      // i18n key doesn't exist or function call failed\r\n    }\r\n    \r\n    // Fallback to cleaned category name\r\n    return categoryName\r\n      .replace(/([a-z])([A-Z])/g, '$1 $2') // Add spaces between camelCase\r\n      .replace(/[_-]/g, ' ') // Replace underscores/hyphens with spaces\r\n      .replace(/\\s+/g, ' ') // Normalize multiple spaces\r\n      .trim();\r\n  }\r\n\r\n  let {\r\n    categoryHierarchy,\r\n    selectedCategory = $bindable(null),\r\n    selectedSubcategory = $bindable(null),\r\n    selectedSpecific = $bindable(null),\r\n    placeholder = i18n.category_dropdown_allCategories(),\r\n    disabled = false,\r\n    class: className = '',\r\n    onCategorySelect,\r\n    trigger,\r\n    categoryItem,\r\n    announceChanges = true\r\n  }: CategoryFilterDropdownProps = $props();\r\n\r\n  // Navigation state\r\n  let currentLevel = $state(1); // 1=gender, 2=type, 3=specific\r\n  let isOpen = $state(false);\r\n  let focusedIndex = $state(-1);\r\n  let dropdownRef = $state<HTMLDivElement>();\r\n  let triggerRef = $state<HTMLButtonElement>();\r\n  let announcement = $state('');\r\n  \r\n  // Track the original focus for restoration\r\n  let originalFocus: HTMLElement | null = null;\r\n\r\n  // Computed display text\r\n  const selectedText = $derived.by(() => {\r\n    if (selectedSpecific) {\r\n      const specificKey = `${selectedCategory}-${selectedSubcategory}`;\r\n      const specificItem = categoryHierarchy.specifics[specificKey]?.find(cat => cat.key === selectedSpecific);\r\n      return specificItem?.name || placeholder;\r\n    }\r\n    if (selectedSubcategory) {\r\n      const subcategoryItem = categoryHierarchy.subcategories[selectedCategory || '']?.find(cat => cat.key === selectedSubcategory);\r\n      return subcategoryItem?.name || placeholder;\r\n    }\r\n    if (selectedCategory) {\r\n      const categoryItem = categoryHierarchy.categories.find(cat => cat.key === selectedCategory);\r\n      return categoryItem?.name || placeholder;\r\n    }\r\n    return placeholder;\r\n  });\r\n\r\n  // Get current category icon\r\n  const selectedIcon = $derived.by(() => {\r\n    if (selectedCategory) {\r\n      return categoryHierarchy.categories.find(cat => cat.key === selectedCategory)?.icon || '📁';\r\n    }\r\n    return '📁';\r\n  });\r\n\r\n  // Handle category selection\r\n  function handleCategorySelect(category: string | null) {\r\n    const categoryItem = category ? categoryHierarchy.categories.find(cat => cat.key === category) : null;\r\n    \r\n    selectedCategory = category;\r\n    selectedSubcategory = null;\r\n    selectedSpecific = null;\r\n    \r\n    if (category && categoryHierarchy.subcategories[category]?.length > 0) {\r\n      currentLevel = 2;\r\n      focusedIndex = -1;\r\n    } else {\r\n      isOpen = false;\r\n      currentLevel = 1;\r\n      // Restore focus to trigger\r\n      triggerRef?.focus();\r\n    }\r\n    \r\n    // Announce selection\r\n    if (announceChanges) {\r\n      if (category && categoryItem) {\r\n        announcement = i18n.category_dropdown_selectedCategory({ name: categoryItem.name });\r\n      } else {\r\n        announcement = i18n.category_dropdown_allCategoriesSelected();\r\n      }\r\n    }\r\n    \r\n    onCategorySelect?.(category, null, null);\r\n  }\r\n\r\n  // Handle subcategory selection\r\n  function handleSubcategorySelect(subcategory: string | null) {\r\n    const subcategoryItem = subcategory && selectedCategory \r\n      ? categoryHierarchy.subcategories[selectedCategory]?.find(cat => cat.key === subcategory)\r\n      : null;\r\n    \r\n    selectedSubcategory = subcategory;\r\n    selectedSpecific = null;\r\n    \r\n    if (subcategory && selectedCategory) {\r\n      const specificKey = `${selectedCategory}-${subcategory}`;\r\n      if (categoryHierarchy.specifics[specificKey]?.length > 0) {\r\n        currentLevel = 3;\r\n        focusedIndex = -1;\r\n      } else {\r\n        isOpen = false;\r\n        currentLevel = 1;\r\n        triggerRef?.focus();\r\n      }\r\n    } else {\r\n      isOpen = false;\r\n      currentLevel = 1;\r\n      triggerRef?.focus();\r\n    }\r\n    \r\n    // Announce selection\r\n    if (announceChanges) {\r\n      if (subcategory && subcategoryItem) {\r\n        announcement = i18n.category_dropdown_selectedSubcategory({ name: subcategoryItem.name });\r\n      } else {\r\n        const categoryName = selectedCategory\r\n          ? categoryHierarchy.categories.find(cat => cat.key === selectedCategory)?.name || 'category'\r\n          : 'category';\r\n        announcement = i18n.category_dropdown_allSubcategorySelected({ category: categoryName });\r\n      }\r\n    }\r\n    \r\n    onCategorySelect?.(selectedCategory, subcategory, null);\r\n  }\r\n\r\n  // Handle specific selection\r\n  function handleSpecificSelect(specific: string | null) {\r\n    const specificItem = specific && selectedCategory && selectedSubcategory\r\n      ? categoryHierarchy.specifics[`${selectedCategory}-${selectedSubcategory}`]?.find(cat => cat.key === specific)\r\n      : null;\r\n      \r\n    selectedSpecific = specific;\r\n    isOpen = false;\r\n    currentLevel = 1;\r\n    \r\n    // Restore focus to trigger\r\n    triggerRef?.focus();\r\n    \r\n    // Announce selection\r\n    if (announceChanges) {\r\n      if (specific && specificItem) {\r\n        announcement = i18n.category_dropdown_selectedSpecific({ name: specificItem.name });\r\n      } else {\r\n        const subcategoryName = selectedSubcategory && selectedCategory\r\n          ? categoryHierarchy.subcategories[selectedCategory]?.find(cat => cat.key === selectedSubcategory)?.name || 'items'\r\n          : 'items';\r\n        announcement = i18n.category_dropdown_allSpecificSelected({ subcategory: subcategoryName });\r\n      }\r\n    }\r\n    \r\n    onCategorySelect?.(selectedCategory, selectedSubcategory, specific);\r\n  }\r\n\r\n  // Navigate back in hierarchy\r\n  function navigateBack() {\r\n    if (currentLevel === 3) {\r\n      currentLevel = 2;\r\n      focusedIndex = -1;\r\n    } else if (currentLevel === 2) {\r\n      currentLevel = 1;\r\n      focusedIndex = -1;\r\n    }\r\n    \r\n    // Announce navigation\r\n    if (announceChanges) {\r\n      if (currentLevel === 1) {\r\n        announcement = 'Navigated back to main categories';\r\n      } else if (currentLevel === 2) {\r\n        const categoryName = selectedCategory \r\n          ? categoryHierarchy.categories.find(cat => cat.key === selectedCategory)?.name\r\n          : 'category';\r\n        announcement = `Navigated back to ${categoryName} subcategories`;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Clear all selections\r\n  function clearSelection() {\r\n    selectedCategory = null;\r\n    selectedSubcategory = null;\r\n    selectedSpecific = null;\r\n    isOpen = false;\r\n    currentLevel = 1;\r\n    focusedIndex = -1;\r\n    \r\n    // Announce clearing\r\n    if (announceChanges) {\r\n      announcement = i18n.category_dropdown_allFiltersCleared();\r\n    }\r\n    \r\n    onCategorySelect?.(null, null, null);\r\n  }\r\n\r\n  // Handle click outside to close\r\n  function handleClickOutside(e: MouseEvent) {\r\n    const target = e.target as HTMLElement;\r\n    if (!target.closest('.category-dropdown')) {\r\n      closeDropdown();\r\n    }\r\n  }\r\n  \r\n  // Close dropdown and restore focus\r\n  function closeDropdown() {\r\n    isOpen = false;\r\n    currentLevel = 1;\r\n    focusedIndex = -1;\r\n    triggerRef?.focus();\r\n  }\r\n  \r\n  // Enhanced keyboard navigation\r\n  function handleDropdownKeydown(event: KeyboardEvent) {\r\n    const { key } = event;\r\n    \r\n    // Get current options based on level\r\n    const getCurrentOptions = () => {\r\n      if (currentLevel === 1) {\r\n        return [{ key: 'all', name: 'All Categories' }, ...categoryHierarchy.categories];\r\n      } else if (currentLevel === 2 && selectedCategory) {\r\n        const baseOption = { \r\n          key: 'all-sub', \r\n          name: `All ${categoryHierarchy.categories.find(cat => cat.key === selectedCategory)?.name || 'Items'}` \r\n        };\r\n        return [baseOption, ...(categoryHierarchy.subcategories[selectedCategory] || [])];\r\n      } else if (currentLevel === 3 && selectedCategory && selectedSubcategory) {\r\n        const specificKey = `${selectedCategory}-${selectedSubcategory}`;\r\n        const baseOption = { \r\n          key: 'all-spec', \r\n          name: `All ${categoryHierarchy.subcategories[selectedCategory]?.find(cat => cat.key === selectedSubcategory)?.name || 'Items'}` \r\n        };\r\n        return [baseOption, ...(categoryHierarchy.specifics[specificKey] || [])];\r\n      }\r\n      return [];\r\n    };\r\n    \r\n    const options = getCurrentOptions();\r\n    \r\n    switch (key) {\r\n      case 'Escape':\r\n        event.preventDefault();\r\n        closeDropdown();\r\n        break;\r\n        \r\n      case 'ArrowDown':\r\n        event.preventDefault();\r\n        focusedIndex = focusedIndex < options.length - 1 ? focusedIndex + 1 : 0;\r\n        scrollToFocusedItem();\r\n        break;\r\n        \r\n      case 'ArrowUp':\r\n        event.preventDefault();\r\n        focusedIndex = focusedIndex > 0 ? focusedIndex - 1 : options.length - 1;\r\n        scrollToFocusedItem();\r\n        break;\r\n        \r\n      case 'Home':\r\n        event.preventDefault();\r\n        focusedIndex = 0;\r\n        scrollToFocusedItem();\r\n        break;\r\n        \r\n      case 'End':\r\n        event.preventDefault();\r\n        focusedIndex = options.length - 1;\r\n        scrollToFocusedItem();\r\n        break;\r\n        \r\n      case 'Enter':\r\n      case ' ':\r\n        if (focusedIndex >= 0 && focusedIndex < options.length) {\r\n          event.preventDefault();\r\n          const selectedOption = options[focusedIndex];\r\n          \r\n          if (currentLevel === 1) {\r\n            if (selectedOption.key === 'all') {\r\n              clearSelection();\r\n            } else {\r\n              handleCategorySelect(selectedOption.key);\r\n            }\r\n          } else if (currentLevel === 2) {\r\n            if (selectedOption.key === 'all-sub') {\r\n              handleSubcategorySelect(null);\r\n            } else {\r\n              handleSubcategorySelect(selectedOption.key);\r\n            }\r\n          } else if (currentLevel === 3) {\r\n            if (selectedOption.key === 'all-spec') {\r\n              handleSpecificSelect(null);\r\n            } else {\r\n              handleSpecificSelect(selectedOption.key);\r\n            }\r\n          }\r\n        }\r\n        break;\r\n        \r\n      case 'ArrowLeft':\r\n      case 'Backspace':\r\n        if (currentLevel > 1) {\r\n          event.preventDefault();\r\n          navigateBack();\r\n        }\r\n        break;\r\n    }\r\n  }\r\n  \r\n  // Scroll to focused item\r\n  async function scrollToFocusedItem() {\r\n    await tick();\r\n    if (dropdownRef && focusedIndex >= 0) {\r\n      const buttons = dropdownRef.querySelectorAll('[role=\"option\"]');\r\n      const focusedButton = buttons[focusedIndex] as HTMLElement;\r\n      if (focusedButton) {\r\n        focusedButton.scrollIntoView({ block: 'nearest' });\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Handle trigger click\r\n  function handleTriggerClick() {\r\n    if (isOpen) {\r\n      closeDropdown();\r\n    } else {\r\n      originalFocus = document.activeElement as HTMLElement;\r\n      isOpen = true;\r\n      currentLevel = 1;\r\n      focusedIndex = 0; // Start with first item focused\r\n    }\r\n  }\r\n  \r\n  // Clear announcement after it's been read\r\n  $effect(() => {\r\n    if (announcement) {\r\n      const timer = setTimeout(() => {\r\n        announcement = '';\r\n      }, 1000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  });\r\n</script>\r\n\r\n<svelte:window onclick={handleClickOutside} />\r\n\r\n<div class=\"category-dropdown relative {className}\">\r\n  <!-- Trigger Button -->\r\n  <button\r\n    bind:this={triggerRef}\r\n    onclick={handleTriggerClick}\r\n    onkeydown={(e) => {\r\n      if (e.key === 'ArrowDown' && !isOpen) {\r\n        e.preventDefault();\r\n        handleTriggerClick();\r\n      }\r\n    }}\r\n    {disabled}\r\n    class=\"flex items-center gap-2.5 h-12 px-3 sm:px-4 bg-[color:var(--surface-muted)] hover:bg-[color:var(--surface-emphasis)] \r\n           rounded-l-xl text-sm font-medium transition-colors duration-[var(--duration-base)] \r\n           border-0 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)] \r\n           disabled:opacity-50 disabled:cursor-not-allowed\r\n           min-w-0 flex-shrink-0\"\r\n    aria-expanded={isOpen}\r\n    aria-haspopup=\"listbox\"\r\n    aria-label={i18n.category_dropdown_ariaLabel({ selectedText })}\r\n  >\r\n    {#if trigger}\r\n      {@render trigger({ selectedText, isOpen })}\r\n    {:else}\r\n      <span class=\"text-base flex-shrink-0\" aria-hidden=\"true\">{selectedIcon}</span>\r\n      \r\n      <!-- Mobile: Just arrow -->\r\n      <span class=\"sm:hidden\">\r\n        <svg \r\n          class=\"w-4 h-4 transition-transform duration-[var(--duration-base)] {isOpen ? 'rotate-180' : ''}\" \r\n          fill=\"none\" \r\n          stroke=\"currentColor\" \r\n          viewBox=\"0 0 24 24\"\r\n          aria-hidden=\"true\"\r\n        >\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\" />\r\n        </svg>\r\n      </span>\r\n      \r\n      <!-- Desktop: Full text -->\r\n      <span class=\"hidden sm:block text-left flex-1 min-w-0 truncate\">\r\n        {selectedText}\r\n      </span>\r\n      <svg \r\n        class=\"hidden sm:block w-4 h-4 transition-transform duration-[var(--duration-base)] {isOpen ? 'rotate-180' : ''} flex-shrink-0\" \r\n        fill=\"none\" \r\n        stroke=\"currentColor\" \r\n        viewBox=\"0 0 24 24\"\r\n        aria-hidden=\"true\"\r\n      >\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\" />\r\n      </svg>\r\n    {/if}\r\n  </button>\r\n\r\n  <!-- Dropdown Menu -->\r\n  {#if isOpen}\r\n    <div \r\n      bind:this={dropdownRef}\r\n      class=\"absolute top-full left-0 mt-1 w-72 sm:w-80 bg-[color:var(--surface-base)] \r\n             rounded-[var(--radius-xl)] shadow-[var(--shadow-lg)] border border-[color:var(--border-subtle)] \r\n             z-40 max-h-[360px] overflow-hidden\"\r\n      role=\"listbox\"\r\n      aria-label={i18n.category_dropdown_listboxAriaLabel()}\r\n      onkeydown={handleDropdownKeydown}\r\n      tabindex=\"-1\"\r\n    >\r\n      \r\n      <!-- Level 1: Main Categories -->\r\n      {#if currentLevel === 1}\r\n        <div class=\"p-2\">\r\n          <div class=\"text-xs font-semibold text-[color:var(--text-tertiary)] uppercase tracking-wide px-3 py-2 border-b border-[color:var(--border-subtle)] mb-1\">\r\n            {i18n.category_dropdown_categories()}\r\n          </div>\r\n          <div class=\"space-y-0.5 overflow-y-auto max-h-72\">\r\n            <button\r\n              onclick={clearSelection}\r\n              class=\"w-full flex items-center gap-2.5 px-3 py-2 rounded-[var(--radius-md)] \r\n                     hover:bg-[color:var(--surface-subtle)] text-left transition-colors duration-[var(--duration-base)]\r\n                     min-h-[var(--touch-standard)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)]\r\n                     {focusedIndex === 0 ? 'bg-[color:var(--surface-emphasis)]' : ''}\r\n                     {!selectedCategory ? 'bg-[color:var(--surface-emphasis)]' : ''}\"\r\n              role=\"option\"\r\n              aria-selected={!selectedCategory}\r\n              tabindex=\"-1\"\r\n            >\r\n              <span class=\"text-base\" aria-hidden=\"true\">🌍</span>\r\n              <span class=\"text-sm font-medium text-[color:var(--text-primary)]\">{i18n.category_dropdown_allCategories()}</span>\r\n            </button>\r\n            \r\n            {#each categoryHierarchy.categories as category, index (category.key)}\r\n              {@const isSelected = selectedCategory === category.key}\r\n              {@const hasSubcategories = categoryHierarchy.subcategories[category.key]?.length > 0}\r\n              {@const isFocused = focusedIndex === index + 1}\r\n              \r\n              <button\r\n                onclick={() => handleCategorySelect(category.key)}\r\n                class=\"w-full flex items-center justify-between px-3 py-2 rounded-[var(--radius-md)] \r\n                       hover:bg-[color:var(--surface-subtle)] text-left transition-colors duration-[var(--duration-base)] group\r\n                       min-h-[var(--touch-standard)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)]\r\n                       {isFocused ? 'bg-[color:var(--surface-emphasis)]' : ''}\r\n                       {isSelected ? 'bg-[color:var(--primary-50)] text-[color:var(--primary-700)]' : ''}\"\r\n                role=\"option\"\r\n                aria-selected={isSelected}\r\n                tabindex=\"-1\"\r\n              >\r\n                {#if categoryItem}\r\n                  {@render categoryItem(category, { level: 1, isSelected })}\r\n                {:else}\r\n                  <div class=\"flex items-center gap-2.5\">\r\n                    <span class=\"text-base\" aria-hidden=\"true\">{category.icon}</span>\r\n                    <span class=\"text-sm font-medium {isSelected ? 'text-[color:var(--primary-700)]' : 'text-[color:var(--text-primary)]'}\">{category.name}</span>\r\n                  </div>\r\n                  \r\n                  {#if hasSubcategories}\r\n                    <svg \r\n                      class=\"w-3.5 h-3.5 text-[color:var(--text-tertiary)] group-hover:text-[color:var(--text-secondary)] transition-colors duration-[var(--duration-base)]\" \r\n                      fill=\"none\" \r\n                      stroke=\"currentColor\" \r\n                      viewBox=\"0 0 24 24\"\r\n                      aria-hidden=\"true\"\r\n                    >\r\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\" />\r\n                    </svg>\r\n                  {/if}\r\n                {/if}\r\n              </button>\r\n            {/each}\r\n          </div>\r\n        </div>\r\n      {/if}\r\n      \r\n      <!-- Level 2: Subcategories -->\r\n      {#if currentLevel === 2 && selectedCategory && categoryHierarchy.subcategories[selectedCategory]}\r\n        <div class=\"p-2\">\r\n          <button\r\n            onclick={navigateBack}\r\n            class=\"flex items-center gap-2 px-3 py-1.5 text-xs font-medium text-[color:var(--text-secondary)] \r\n                   hover:text-[color:var(--text-primary)] hover:bg-[color:var(--surface-subtle)] \r\n                   rounded-[var(--radius-md)] transition-colors duration-[var(--duration-base)] mb-1\r\n                   focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)]\"\r\n            tabindex=\"-1\"\r\n          >\r\n            <svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 19l-7-7 7-7\" />\r\n            </svg>\r\n{i18n.category_dropdown_backToCategories()}\r\n          </button>\r\n          \r\n          <div class=\"text-xs font-semibold text-[color:var(--text-tertiary)] uppercase tracking-wide px-3 py-2 border-b border-[color:var(--border-subtle)] mb-1\">\r\n            {categoryHierarchy.categories.find(cat => cat.key === selectedCategory)?.name}\r\n          </div>\r\n          \r\n          <div class=\"space-y-0.5 overflow-y-auto max-h-72\">\r\n            <button\r\n              onclick={() => handleSubcategorySelect(null)}\r\n              class=\"w-full flex items-center gap-2.5 px-3 py-2 rounded-[var(--radius-md)] \r\n                     hover:bg-[color:var(--surface-subtle)] text-left transition-colors duration-[var(--duration-base)]\r\n                     min-h-[var(--touch-standard)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)]\r\n                     {focusedIndex === 0 ? 'bg-[color:var(--surface-emphasis)]' : ''}\r\n                     {!selectedSubcategory ? 'bg-[color:var(--surface-emphasis)]' : ''}\"\r\n              role=\"option\"\r\n              aria-selected={!selectedSubcategory}\r\n              tabindex=\"-1\"\r\n            >\r\n              <span class=\"text-base\" aria-hidden=\"true\">📦</span>\r\n              <span class=\"text-sm font-medium text-[color:var(--text-primary)]\">\r\n                All {categoryHierarchy.categories.find(cat => cat.key === selectedCategory)?.name}\r\n              </span>\r\n            </button>\r\n            \r\n            {#each categoryHierarchy.subcategories[selectedCategory] as subcategory, index (subcategory.key)}\r\n              {@const isSelected = selectedSubcategory === subcategory.key}\r\n              {@const hasSpecifics = categoryHierarchy.specifics[`${selectedCategory}-${subcategory.key}`]?.length > 0}\r\n              {@const isFocused = focusedIndex === index + 1}\r\n              \r\n              <button\r\n                onclick={() => handleSubcategorySelect(subcategory.key)}\r\n                class=\"w-full flex items-center justify-between px-3 py-2 rounded-[var(--radius-md)] \r\n                       hover:bg-[color:var(--surface-subtle)] text-left transition-colors duration-[var(--duration-base)] group\r\n                       min-h-[var(--touch-standard)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)]\r\n                       {isFocused ? 'bg-[color:var(--surface-emphasis)]' : ''}\r\n                       {isSelected ? 'bg-[color:var(--primary-50)] text-[color:var(--primary-700)]' : ''}\"\r\n                role=\"option\"\r\n                aria-selected={isSelected}\r\n                tabindex=\"-1\"\r\n              >\r\n                {#if categoryItem}\r\n                  {@render categoryItem(subcategory, { level: 2, isSelected })}\r\n                {:else}\r\n                  <div class=\"flex items-center gap-2.5\">\r\n                    <span class=\"text-base\" aria-hidden=\"true\">{subcategory.icon}</span>\r\n                    <span class=\"text-sm font-medium {isSelected ? 'text-[color:var(--primary-700)]' : 'text-[color:var(--text-primary)]'}\">{subcategory.name}</span>\r\n                  </div>\r\n                  \r\n                  {#if hasSpecifics}\r\n                    <svg \r\n                      class=\"w-3.5 h-3.5 text-[color:var(--text-tertiary)] group-hover:text-[color:var(--text-secondary)] transition-colors duration-[var(--duration-base)]\" \r\n                      fill=\"none\" \r\n                      stroke=\"currentColor\" \r\n                      viewBox=\"0 0 24 24\"\r\n                      aria-hidden=\"true\"\r\n                    >\r\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\" />\r\n                    </svg>\r\n                  {/if}\r\n                {/if}\r\n              </button>\r\n            {/each}\r\n          </div>\r\n        </div>\r\n      {/if}\r\n      \r\n      <!-- Level 3: Specific Items -->\r\n      {#if currentLevel === 3 && selectedCategory && selectedSubcategory && categoryHierarchy.specifics[`${selectedCategory}-${selectedSubcategory}`]}\r\n        <div class=\"p-2\">\r\n          <button\r\n            onclick={navigateBack}\r\n            class=\"flex items-center gap-2 px-3 py-1.5 text-xs font-medium text-[color:var(--text-secondary)] \r\n                   hover:text-[color:var(--text-primary)] hover:bg-[color:var(--surface-subtle)] \r\n                   rounded-[var(--radius-md)] transition-colors duration-[var(--duration-base)] mb-1\r\n                   focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)]\"\r\n            tabindex=\"-1\"\r\n          >\r\n            <svg class=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 19l-7-7 7-7\" />\r\n            </svg>\r\n            Back to {categoryHierarchy.subcategories[selectedCategory]?.find(cat => cat.key === selectedSubcategory)?.name}\r\n          </button>\r\n          \r\n          <div class=\"text-xs font-semibold text-[color:var(--text-tertiary)] uppercase tracking-wide px-3 py-2 border-b border-[color:var(--border-subtle)] mb-1\">\r\n            {categoryHierarchy.subcategories[selectedCategory]?.find(cat => cat.key === selectedSubcategory)?.name}\r\n          </div>\r\n          \r\n          <div class=\"space-y-0.5 overflow-y-auto max-h-72\">\r\n            <button\r\n              onclick={() => handleSpecificSelect(null)}\r\n              class=\"w-full flex items-center gap-2.5 px-3 py-2 rounded-[var(--radius-md)] \r\n                     hover:bg-[color:var(--surface-subtle)] text-left transition-colors duration-[var(--duration-base)]\r\n                     min-h-[var(--touch-standard)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)]\r\n                     {focusedIndex === 0 ? 'bg-[color:var(--surface-emphasis)]' : ''}\r\n                     {!selectedSpecific ? 'bg-[color:var(--surface-emphasis)]' : ''}\"\r\n              role=\"option\"\r\n              aria-selected={!selectedSpecific}\r\n              tabindex=\"-1\"\r\n            >\r\n              <span class=\"text-base\" aria-hidden=\"true\">📄</span>\r\n              <span class=\"text-sm font-medium text-[color:var(--text-primary)]\">\r\n                All {categoryHierarchy.subcategories[selectedCategory]?.find(cat => cat.key === selectedSubcategory)?.name}\r\n              </span>\r\n            </button>\r\n            \r\n            {#each categoryHierarchy.specifics[`${selectedCategory}-${selectedSubcategory}`] as specific, index (specific.key)}\r\n              {@const isSelected = selectedSpecific === specific.key}\r\n              {@const isFocused = focusedIndex === index + 1}\r\n              \r\n              <button\r\n                onclick={() => handleSpecificSelect(specific.key)}\r\n                class=\"w-full flex items-center gap-2.5 px-3 py-2 rounded-[var(--radius-md)] \r\n                       hover:bg-[color:var(--surface-subtle)] text-left transition-colors duration-[var(--duration-base)] group\r\n                       min-h-[var(--touch-standard)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)]\r\n                       {isFocused ? 'bg-[color:var(--surface-emphasis)]' : ''}\r\n                       {isSelected ? 'bg-[color:var(--primary-50)] text-[color:var(--primary-700)]' : ''}\"\r\n                role=\"option\"\r\n                aria-selected={isSelected}\r\n                tabindex=\"-1\"\r\n              >\r\n                {#if categoryItem}\r\n                  {@render categoryItem(specific, { level: 3, isSelected })}\r\n                {:else}\r\n                  <span class=\"text-base\" aria-hidden=\"true\">{specific.icon}</span>\r\n                  <span class=\"text-sm font-medium {isSelected ? 'text-[color:var(--primary-700)]' : 'text-[color:var(--text-primary)]'}\">{specific.name}</span>\r\n                {/if}\r\n              </button>\r\n            {/each}\r\n          </div>\r\n        </div>\r\n      {/if}\r\n    </div>\r\n  {/if}\r\n</div>\r\n\r\n<!-- Live region for announcements -->\r\n{#if announcement}\r\n  <div \r\n    role=\"status\" \r\n    aria-live=\"polite\" \r\n    aria-atomic=\"true\"\r\n    class=\"sr-only\"\r\n  >\r\n    {announcement}\r\n  </div>\r\n{/if}\r\n\r\n<style>\r\n  /* Screen reader only text */\r\n  .sr-only {\r\n    position: absolute;\r\n    width: 1px;\r\n    height: 1px;\r\n    padding: 0;\r\n    margin: -1px;\r\n    overflow: hidden;\r\n    clip: rect(0, 0, 0, 0);\r\n    white-space: nowrap;\r\n    border: 0;\r\n  }\r\n  \r\n  /* Ensure smooth animations and proper z-indexing */\r\n  .category-dropdown {\r\n    position: relative;\r\n  }\r\n  \r\n  /* Enhanced mobile touch targets */\r\n  @media (hover: none) and (pointer: coarse) {\r\n    button:active {\r\n      transform: scale(0.98);\r\n    }\r\n  }\r\n  \r\n  /* Improve scrolling on mobile */\r\n  .overflow-y-auto {\r\n    -webkit-overflow-scrolling: touch;\r\n    scroll-behavior: smooth;\r\n  }\r\n  \r\n  /* High contrast mode support */\r\n  @media (prefers-contrast: high) {\r\n    button:focus-visible {\r\n      outline: 3px solid currentColor;\r\n      outline-offset: 2px;\r\n    }\r\n    \r\n    [aria-selected=\"true\"] {\r\n      outline: 2px solid currentColor;\r\n    }\r\n  }\r\n  \r\n  /* Reduced motion support */\r\n  @media (prefers-reduced-motion: reduce) {\r\n    button {\r\n      transition: none;\r\n    }\r\n    \r\n    button:active {\r\n      transform: none;\r\n    }\r\n    \r\n    .overflow-y-auto {\r\n      scroll-behavior: auto;\r\n    }\r\n  }\r\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\CategoryGrid.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'compact' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":15,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  interface Props {\n    onCategoryClick: (category: string) => void;\n    compact?: boolean;\n    translations?: {\n      women?: string;\n      men?: string;\n      kids?: string;\n      pets?: string;\n    };\n  }\n\n  let { \n    onCategoryClick, \n    compact = false,\n    translations = {\n      women: '',\n      men: '',\n      kids: '',\n      pets: ''\n    }\n  }: Props = $props();\n\n  const categories = $derived([\n    { key: 'women', label: translations.women, emoji: '👗' },\n    { key: 'men', label: translations.men, emoji: '👔' },\n    { key: 'kids', label: translations.kids, emoji: '👶' },\n    { key: 'pets', label: translations.pets, emoji: '🐕' }\n  ]);\n\n  // Professional neutral styling for all categories\n  const buttonClasses = 'bg-gray-50 hover:bg-gray-100 border-gray-200 hover:border-gray-300';\n</script>\n\n<div class=\"grid grid-cols-4 gap-2\">\n  {#each categories as category}\n    <a\n      href=\"/category/{category.key}\"\n      class=\"{buttonClasses} rounded-lg p-2 transition-colors min-h-11 flex flex-col items-center justify-center border\"\n      onclick={() => onCategoryClick(category.key)}\n    >\n      <span class=\"text-lg mb-0.5\">{category.emoji}</span>\n      <span class=\"text-xs font-medium text-gray-900\">{category.label}</span>\n    </a>\n  {/each}\n</div>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\FeaturedProducts.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1394,1397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1394,1397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'i' is defined but never used. Allowed unused args must match /^_/u.","line":107,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":107,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import ProductCard from '../cards/ProductCard.svelte';\r\n  import Button from '../ui/Button.svelte';\r\n  import NewestListingsBanner from '../banners/home/NewestListingsBanner.svelte';\r\n  import ProductCardSkeleton from '../skeleton/ProductCardSkeleton.svelte';\r\n  import type { Product } from '../../types/product';\r\n\r\n  interface Translations {\r\n    empty_noProducts: string;\r\n    empty_startBrowsing: string;\r\n    nav_sell: string;\r\n    home_browseAll: string;\r\n    home_itemCount: string;\r\n    home_updatedMomentsAgo: string;\r\n    product_size: string;\r\n    trending_newSeller: string;\r\n    seller_unknown: string;\r\n    common_currency: string;\r\n    product_addToFavorites: string;\r\n    condition_brandNewWithTags?: string;\r\n    condition_newWithoutTags?: string;\r\n    condition_new: string;\r\n    condition_likeNew: string;\r\n    condition_good: string;\r\n    condition_worn?: string;\r\n    condition_fair: string;\r\n    categoryTranslation?: (category: string) => string;\r\n  }\r\n\r\n  interface Props {\r\n    products: Product[];\r\n    errors?: { products?: string };\r\n    loading?: boolean;\r\n    onProductClick: (product: Product) => void;\r\n    onFavorite: (productId: string) => void;\r\n    onBrowseAll?: () => void;\r\n    onSellClick?: () => void;\r\n    formatPrice?: (price: number) => string;\r\n    translations: Translations;\r\n    sectionTitle?: string;\r\n    favoritesState?: any;\r\n    showCategoryTabs?: boolean;\r\n    activeCategory?: 'fresh' | 'recent';\r\n    onCategoryChange?: (category: 'fresh' | 'recent') => void;\r\n    showViewAllButton?: boolean;\r\n    onViewAll?: () => void;\r\n    class?: string;\r\n  }\r\n\r\n  let { \r\n    products = [], \r\n    errors, \r\n    loading = false, \r\n    onProductClick, \r\n    onFavorite, \r\n    onBrowseAll,\r\n    onSellClick,\r\n    formatPrice = (price: number) => `$${price.toFixed(2)}`,\r\n    translations,\r\n    sectionTitle = 'Newest listings', // Will be overridden by parent with proper translation\r\n    favoritesState,\r\n    showCategoryTabs = false,\r\n    activeCategory = 'fresh',\r\n    onCategoryChange,\r\n    showViewAllButton = false,\r\n    onViewAll,\r\n    class: className = ''\r\n  }: Props = $props();\r\n  \r\n  // Derived states\r\n  const hasProducts = $derived(products.length > 0);\r\n  const hasErrors = $derived(!!errors?.products);\r\n  const gridId = $derived(() => {\r\n    const firstProductId = products[0]?.id;\r\n    return firstProductId ? `product-grid-${firstProductId}` : 'product-grid';\r\n  });\r\n</script>\r\n\r\n<!-- Product Grid Section with standardized spacing (tokens) -->\r\n<section\r\n  class=\"pb-2 sm:pb-3 {className}\"\r\n  aria-label={sectionTitle}\r\n>\r\n  <!-- Section Banner with proper container -->\r\n  <div class=\"px-2 sm:px-4 lg:px-6 mb-3 sm:mb-4\">\r\n    <NewestListingsBanner\r\n      heading={sectionTitle}\r\n      copy={hasProducts ? `${products.length} ${translations.home_itemCount} • ${translations.home_updatedMomentsAgo}` : undefined}\r\n      itemCount={hasProducts ? products.length : undefined}\r\n      cta={showViewAllButton && hasProducts && onViewAll ? { label: 'View All', action: onViewAll } : undefined}\r\n      showCategoryTabs={showCategoryTabs && hasProducts}\r\n      {activeCategory}\r\n      onCategoryChange={onCategoryChange}\r\n    />\r\n  </div>\r\n  \r\n  \r\n  <!-- Loading State -->\r\n  {#if loading}\r\n    <div\r\n      class=\"px-2 sm:px-4 lg:px-6 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3\"\r\n      role=\"status\"\r\n      aria-busy=\"true\"\r\n      aria-live=\"polite\"\r\n      aria-label=\"Loading products\"\r\n    >\r\n      {#each Array(10) as _, i}\r\n        <ProductCardSkeleton />\r\n      {/each}\r\n      <span class=\"sr-only\">Loading products, please wait...</span>\r\n    </div>\r\n  <!-- Featured Products Grid - Mobile-First Responsive -->\r\n  {:else if hasProducts}\r\n    <div\r\n      id={gridId}\r\n      class=\"px-2 sm:px-4 lg:px-6 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 sm:gap-4\"\r\n      role=\"list\"\r\n      aria-label=\"Product grid with {products.length} items\"\r\n    >\r\n      {#each products as product, index}\r\n        <article\r\n          role=\"listitem\"\r\n          aria-setsize={products.length}\r\n          aria-posinset={index + 1}\r\n        >\r\n          <ProductCard \r\n            {product}\r\n            onclick={() => onProductClick(product)}\r\n            onFavorite={() => onFavorite(product.id)}\r\n            favorited={favoritesState?.favorites[product.id] || false}\r\n            {favoritesState}\r\n            priority={index < 6}\r\n            {index}\r\n            totalCount={products.length}\r\n            translations={{\r\n              size: translations.product_size,\r\n              currency: translations.common_currency,\r\n              addToFavorites: translations.product_addToFavorites,\r\n              brandNewWithTags: translations.condition_brandNewWithTags,\r\n              newWithoutTags: translations.condition_newWithoutTags,\r\n              new: translations.condition_new,\r\n              likeNew: translations.condition_likeNew,\r\n              good: translations.condition_good,\r\n              worn: translations.condition_worn,\r\n              fair: translations.condition_fair,\r\n              formatPrice: formatPrice,\r\n              categoryTranslation: translations.categoryTranslation\r\n            }}\r\n          />\r\n        </article>\r\n      {/each}\r\n    </div>\r\n  {:else}\r\n    <div\r\n      class=\"px-2 sm:px-4 lg:px-6 text-center py-12\"\r\n      role=\"status\"\r\n      aria-label=\"No products available\"\r\n    >\r\n      <svg class=\"mx-auto h-12 w-12 text-[color:var(--text-muted)]\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" aria-hidden=\"true\">\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14-7H5m14 14H5\" />\r\n      </svg>\r\n      <h3 class=\"mt-2 text-sm font-medium text-[color:var(--text-primary)]\">{translations.empty_noProducts}</h3>\r\n      <p class=\"mt-1 text-sm text-[color:var(--text-secondary)]\">{translations.empty_startBrowsing}</p>\r\n      <div class=\"mt-6\">\r\n        <Button \r\n          variant=\"primary\" \r\n          onclick={onSellClick}\r\n        >\r\n          {translations.nav_sell}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  {/if}\r\n\r\n  <!-- Load More -->\r\n  {#if hasProducts}\r\n    <nav class=\"text-center mt-[var(--gutter-md)] sm:mt-[var(--gutter-lg)]\" aria-label=\"Load more products\">\r\n      <Button\r\n        variant=\"ghost\"\r\n        size=\"lg\"\r\n        class=\"text-[color:var(--text-secondary)]\"\r\n        onclick={onBrowseAll}\r\n      >\r\n        {translations.home_browseAll}\r\n      </Button>\r\n    </nav>\r\n  {/if}\r\n  \r\n  <!-- Error Messages -->\r\n  {#if hasErrors}\r\n    <div \r\n      class=\"mt-4 p-4 rounded-md bg-[color:var(--status-error-bg)] border border-[color:var(--status-error-border)]\"\r\n      role=\"alert\"\r\n      aria-live=\"assertive\"\r\n    >\r\n      <p class=\"text-sm\" style=\"color: var(--status-error-text)\">\r\n        <span class=\"sr-only\">Error: </span>\r\n        {errors?.products}\r\n      </p>\r\n    </div>\r\n  {/if}\r\n</section>\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\FilterModal.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Snippet' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tick' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FilterSection' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":48},{"ruleId":"svelte/valid-compile","severity":1,"message":"Visible, non-interactive elements with a click event must be accompanied by a keyboard event handler. Consider whether an interactive element such as `<button type=\"button\">` or `<a>` might be more appropriate\nhttps://svelte.dev/e/a11y_click_events_have_key_events(a11y_click_events_have_key_events)","line":273,"column":3,"nodeType":null,"endLine":277,"endColumn":10},{"ruleId":"svelte/valid-compile","severity":1,"message":"`<div>` with a click handler must have an ARIA role\nhttps://svelte.dev/e/a11y_no_static_element_interactions(a11y_no_static_element_interactions)","line":273,"column":3,"nodeType":null,"endLine":277,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import type { Snippet } from 'svelte';\r\n  import { tick, untrack } from 'svelte';\r\n  import FilterPillGroup from './FilterPillGroup.svelte';\r\n  import * as i18n from '@repo/i18n';\r\n  import type { FilterModalProps, FilterSection, FilterValue } from '@repo/ui/types';\r\n\r\n  let {\r\n    open = $bindable(false),\r\n    sections,\r\n    activeFilterCount = 0,\r\n    class: className = '',\r\n    title = i18n.filter_modal_title(),\r\n    applyLabel = i18n.filter_modal_applyFilters(),\r\n    clearLabel = i18n.filter_modal_clearAll(),\r\n    closeLabel = i18n.filter_modal_close(),\r\n    minPriceLabel = i18n.filter_modal_minPrice(),\r\n    maxPriceLabel = i18n.filter_modal_maxPrice(),\r\n    onApply,\r\n    onClear,\r\n    onFilterChange,\r\n    trigger,\r\n    customSection,\r\n    announceChanges = true,\r\n    announcementTemplate\r\n  }: FilterModalProps = $props();\r\n\r\n  // Focus management\r\n  let triggerElement: HTMLElement | null = null;\r\n  let firstFocusableElement: HTMLElement | null = null;\r\n  let lastFocusableElement: HTMLElement | null = null;\r\n  let modalContentRef = $state<HTMLDivElement>();\r\n  let announcement = $state('');\r\n\r\n  // Track dialog open state\r\n  let isOpen = $state(false);\r\n  \r\n  // Sync external open state with internal state\r\n  $effect(() => {\r\n    if (open !== isOpen) {\r\n      isOpen = open;\r\n      if (open) {\r\n        // Store current focus before opening\r\n        triggerElement = document.activeElement as HTMLElement;\r\n      } else {\r\n        // Restore focus when closing\r\n        restoreFocus();\r\n      }\r\n    }\r\n  });\r\n  \r\n  // Focus management functions\r\n  function getFocusableElements(container: HTMLElement): HTMLElement[] {\r\n    const focusableSelectors = [\r\n      'button:not([disabled])',\r\n      'input:not([disabled])',\r\n      'select:not([disabled])',\r\n      'textarea:not([disabled])',\r\n      'a[href]',\r\n      '[tabindex]:not([tabindex=\"-1\"])'\r\n    ].join(', ');\r\n    \r\n    return Array.from(container.querySelectorAll(focusableSelectors));\r\n  }\r\n  \r\n  function setupFocusTrap() {\r\n    if (!modalContentRef) return;\r\n    \r\n    const focusableElements = getFocusableElements(modalContentRef);\r\n    if (focusableElements.length === 0) return;\r\n    \r\n    firstFocusableElement = focusableElements[0];\r\n    lastFocusableElement = focusableElements[focusableElements.length - 1];\r\n    \r\n    // Focus the first element\r\n    setTimeout(() => {\r\n      firstFocusableElement?.focus();\r\n    }, 100);\r\n  }\r\n  \r\n  function handleKeydown(event: KeyboardEvent) {\r\n    if (!isOpen) return;\r\n    \r\n    const { key, shiftKey } = event;\r\n    \r\n    if (key === 'Escape') {\r\n      event.preventDefault();\r\n      open = false;\r\n      return;\r\n    }\r\n    \r\n    if (key === 'Tab') {\r\n      if (!firstFocusableElement || !lastFocusableElement) return;\r\n      \r\n      if (shiftKey) {\r\n        // Shift + Tab\r\n        if (document.activeElement === firstFocusableElement) {\r\n          event.preventDefault();\r\n          lastFocusableElement.focus();\r\n        }\r\n      } else {\r\n        // Tab\r\n        if (document.activeElement === lastFocusableElement) {\r\n          event.preventDefault();\r\n          firstFocusableElement.focus();\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  function restoreFocus() {\r\n    if (triggerElement) {\r\n      setTimeout(() => {\r\n        triggerElement?.focus();\r\n        triggerElement = null;\r\n      }, 100);\r\n    }\r\n  }\r\n  \r\n  // Setup focus trap when modal opens\r\n  $effect(() => {\r\n    if (isOpen && modalContentRef) {\r\n      setupFocusTrap();\r\n      document.addEventListener('keydown', handleKeydown);\r\n      \r\n      return () => {\r\n        document.removeEventListener('keydown', handleKeydown);\r\n      };\r\n    }\r\n  });\r\n\r\n  // Local filter state for the modal\r\n  let localFilters = $state<Record<string, FilterValue>>({});\r\n\r\n  // Initialize local filters from sections using derived value\r\n  const initialFilters = $derived(() => {\r\n    const initial: Record<string, FilterValue> = {};\r\n    sections.forEach(section => {\r\n      if (section.type === 'range') {\r\n        initial[`${section.key}_min`] = section.minValue || '';\r\n        initial[`${section.key}_max`] = section.maxValue || '';\r\n      } else {\r\n        initial[section.key] = section.value || (section.type === 'pills' ? 'all' : null);\r\n      }\r\n    });\r\n    return initial;\r\n  });\r\n\r\n  // Check if local filters need initialization\r\n  const needsInitialization = $derived(() =>\r\n    Object.keys(localFilters).length === 0\r\n  );\r\n\r\n  // Sync derived filters to state\r\n  $effect(() => {\r\n    if (needsInitialization()) {\r\n      untrack(() => {\r\n        localFilters = initialFilters();\r\n      });\r\n    }\r\n  });\r\n\r\n  // Handle individual filter changes\r\n  function handleFilterChange(key: string, value: FilterValue) {\r\n    const section = sections.find(s => s.key === key || key.startsWith(s.key));\r\n    \r\n    localFilters[key] = value;\r\n    onFilterChange?.(key, value);\r\n    \r\n    // Announce filter changes\r\n    if (announceChanges && section) {\r\n      if (announcementTemplate) {\r\n        announcement = announcementTemplate(key, value, section.label);\r\n      } else {\r\n        if (key.includes('_min') || key.includes('_max')) {\r\n          const type = key.includes('_min') ? 'minimum' : 'maximum';\r\n          const displayValue = value || 'not set';\r\n          announcement = `${section.label} ${type} set to ${displayValue}`;\r\n        } else {\r\n          const displayValue = value === 'all' ? 'all options' : value;\r\n          announcement = `${section.label} filter set to ${displayValue}`;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Handle price range input\r\n  function handlePriceInput(key: string, type: 'min' | 'max', event: Event) {\r\n    const target = event.target as HTMLInputElement;\r\n    const rangeKey = `${key}_${type}`;\r\n    localFilters[rangeKey] = target.value;\r\n    onFilterChange?.(rangeKey, target.value);\r\n  }\r\n\r\n  // Apply all filters and close modal\r\n  function handleApply() {\r\n    const activeCount = Object.values(localFilters).filter(value => \r\n      value !== '' && value !== 'all' && value !== null\r\n    ).length;\r\n    \r\n    onApply?.(localFilters);\r\n    \r\n    // Announce application\r\n    if (announceChanges) {\r\n      const filterText = activeCount === 1 ? i18n.filter_modal_filter() : i18n.filter_modal_filters();\r\n      announcement = `${i18n.filter_modal_applied()} ${activeCount} ${filterText}`;\r\n    }\r\n    \r\n    open = false;\r\n  }\r\n\r\n  // Clear all filters\r\n  function handleClear() {\r\n    // Reset all filter values\r\n    Object.keys(localFilters).forEach(key => {\r\n      if (key.includes('_min') || key.includes('_max')) {\r\n        localFilters[key] = '';\r\n      } else {\r\n        localFilters[key] = 'all';\r\n      }\r\n    });\r\n    \r\n    // Announce clearing\r\n    if (announceChanges) {\r\n      announcement = i18n.filter_ui_allFiltersCleared();\r\n    }\r\n    \r\n    onClear?.();\r\n  }\r\n  \r\n  // Clear announcement after it's been read\r\n  $effect(() => {\r\n    if (announcement) {\r\n      const timer = setTimeout(() => {\r\n        untrack(() => {\r\n          announcement = '';\r\n        });\r\n      }, 1000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  });\r\n\r\n  // Check if any filters are active\r\n  const hasActiveFilters = $derived.by(() => {\r\n    return Object.entries(localFilters).some(([key, value]) => {\r\n      if (key.includes('_min') || key.includes('_max')) {\r\n        return value !== '';\r\n      }\r\n      return value !== 'all' && value !== null;\r\n    });\r\n  });\r\n</script>\r\n\r\n<!-- Trigger Button (if provided) -->\r\n{#if trigger}\r\n  <button\r\n    onclick={() => open = true}\r\n    class=\"relative flex items-center gap-1.5 h-8 px-3 rounded-[var(--radius-lg)] text-xs font-medium\r\n           transition-colors duration-[var(--duration-base)]\r\n           min-h-[var(--touch-standard)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)] focus-visible:ring-offset-2\r\n           {activeFilterCount > 0\r\n             ? 'bg-[color:var(--primary)] text-[color:var(--primary-fg)]'\r\n             : 'bg-[color:var(--primary)] text-[color:var(--primary-fg)] hover:bg-[color:var(--primary-600)]'}\"\r\n    aria-label=\"Open filters\"\r\n  >\r\n    {@render trigger()}\r\n  </button>\r\n{/if}\r\n\r\n<!-- Modal Dialog -->\r\n{#if isOpen}\r\n  <!-- Backdrop -->\r\n  <div\r\n    onclick={() => open = false}\r\n    class=\"fixed inset-0 z-50 bg-[color:var(--modal-overlay)] backdrop-blur-sm\"\r\n    style=\"z-index: 9999;\"\r\n  ></div>\r\n\r\n  <!-- Dialog Content - Mobile-first responsive -->\r\n  <div\r\n    bind:this={modalContentRef}\r\n    class=\"fixed inset-x-0 bottom-0 z-50 sm:left-1/2 sm:top-1/2 sm:bottom-auto sm:w-full sm:max-w-lg sm:-translate-x-1/2 sm:-translate-y-1/2 sm:inset-x-auto\r\n           bg-[color:var(--modal-bg)] sm:rounded-[var(--modal-radius)] shadow-[var(--modal-shadow)] border-t border-[color:var(--border-subtle)] sm:border\r\n           max-h-[85vh] overflow-hidden flex flex-col {className}\"\r\n    style=\"z-index: 10000;\"\r\n    role=\"dialog\"\r\n    aria-labelledby=\"filter-modal-title\"\r\n    aria-describedby=\"filter-modal-description\"\r\n    aria-modal=\"true\"\r\n  >\r\n    <!-- Header -->\r\n    <div class=\"flex items-center justify-between p-4 border-b border-[color:var(--border-subtle)] bg-[color:var(--surface-base)]\">\r\n      <div>\r\n        <h2\r\n          id=\"filter-modal-title\"\r\n          class=\"text-lg font-semibold text-[color:var(--text-primary)] leading-6\"\r\n        >\r\n          {title}\r\n        </h2>\r\n        <p id=\"filter-modal-description\" class=\"text-sm text-[color:var(--text-secondary)] mt-1\">\r\n          {i18n.filter_modal_modalDescription()}\r\n        </p>\r\n      </div>\r\n      \r\n      <button\r\n        onclick={() => open = false}\r\n        class=\"p-2 rounded-[var(--radius-md)] hover:bg-[color:var(--surface-subtle)]\r\n               transition-colors duration-[var(--duration-base)]\r\n               focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)]\"\r\n        aria-label={closeLabel}\r\n      >\r\n        <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\r\n        </svg>\r\n      </button>\r\n    </div>\r\n\r\n    <!-- Scrollable Content -->\r\n    <div class=\"flex-1 overflow-y-auto py-1\">\r\n      {#each sections as section (section.key)}\r\n        <div class=\"border-b border-[color:var(--border-subtle)] py-4 last:border-b-0\">\r\n          <h3 class=\"text-xs font-semibold text-[color:var(--text-tertiary)] uppercase tracking-wide px-4 mb-3\">\r\n            {section.label}\r\n          </h3>\r\n          \r\n          {#if section.type === 'pills' && section.options}\r\n            <div class=\"px-4\">\r\n              <FilterPillGroup\r\n                bind:value={localFilters[section.key] as string | null}\r\n                options={[{ value: 'all', label: `All ${section.label}` }, ...section.options]}\r\n                onValueChange={(value) => handleFilterChange(section.key, value)}\r\n                announceChanges={false}\r\n                class=\"flex-wrap gap-2\"\r\n                pillClass=\"min-h-8\"\r\n              />\r\n            </div>\r\n          {:else if section.type === 'range'}\r\n            <div class=\"px-4\">\r\n              <div class=\"flex gap-2 items-center\">\r\n                <div class=\"flex-1\">\r\n                  <input\r\n                    type=\"number\"\r\n                    placeholder={section.placeholder?.min || minPriceLabel}\r\n                    value={localFilters[`${section.key}_min`] || ''}\r\n                    oninput={(e) => handlePriceInput(section.key, 'min', e)}\r\n                    class=\"w-full px-3 py-2 border border-[color:var(--border-default)] rounded-[var(--radius-md)] \r\n                           text-sm text-center min-h-[var(--touch-standard)]\r\n                           bg-[color:var(--surface-base)] text-[color:var(--text-primary)]\r\n                           focus:outline-none focus:ring-2 focus:ring-[color:var(--state-focus)] focus:border-transparent\r\n                           transition-colors duration-[var(--duration-base)]\"\r\n                    aria-label=\"{section.label} minimum value\"\r\n                  />\r\n                </div>\r\n                \r\n                <span class=\"text-[color:var(--text-tertiary)] text-sm\" aria-hidden=\"true\">-</span>\r\n                \r\n                <div class=\"flex-1\">\r\n                  <input\r\n                    type=\"number\"\r\n                    placeholder={section.placeholder?.max || maxPriceLabel}\r\n                    value={localFilters[`${section.key}_max`] || ''}\r\n                    oninput={(e) => handlePriceInput(section.key, 'max', e)}\r\n                    class=\"w-full px-3 py-2 border border-[color:var(--border-default)] rounded-[var(--radius-md)] \r\n                           text-sm text-center min-h-[var(--touch-standard)]\r\n                           bg-[color:var(--surface-base)] text-[color:var(--text-primary)]\r\n                           focus:outline-none focus:ring-2 focus:ring-[color:var(--state-focus)] focus:border-transparent\r\n                           transition-colors duration-[var(--duration-base)]\"\r\n                    aria-label=\"{section.label} maximum value\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          {:else if section.type === 'custom' && customSection}\r\n            <div class=\"px-4\">\r\n              {@render customSection(section)}\r\n            </div>\r\n          {/if}\r\n        </div>\r\n      {/each}\r\n    </div>\r\n\r\n    <!-- Footer Actions -->\r\n    <div class=\"border-t border-[color:var(--border-subtle)] p-4 bg-[color:var(--surface-subtle)] flex flex-col gap-3 sm:flex-row-reverse sm:gap-2\">\r\n      <!-- Apply Button -->\r\n      <button\r\n        onclick={handleApply}\r\n        class=\"flex items-center justify-center gap-2 w-full sm:w-auto px-6 py-3 \r\n               bg-[color:var(--primary)] text-[color:var(--primary-fg)] \r\n               rounded-[var(--radius-md)] font-medium text-sm\r\n               min-h-[var(--touch-primary)] \r\n               hover:bg-[color:var(--primary-600)] active:scale-98\r\n               focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[color:var(--state-focus)]\r\n               transition-all duration-[var(--duration-base)]\r\n               disabled:opacity-50 disabled:cursor-not-allowed\"\r\n      >\r\n        <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\r\n        </svg>\r\n        {applyLabel}\r\n      </button>\r\n      \r\n      <!-- Clear Button -->\r\n      {#if hasActiveFilters}\r\n        <button\r\n          onclick={handleClear}\r\n          class=\"flex items-center justify-center gap-2 w-full sm:w-auto px-4 py-3 \r\n                 text-[color:var(--text-secondary)] hover:text-[color:var(--text-primary)] hover:bg-[color:var(--surface-muted)]\r\n                 rounded-[var(--radius-md)] font-medium text-sm\r\n                 min-h-[var(--touch-standard)]\r\n                 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[color:var(--state-focus)]\r\n                 transition-colors duration-[var(--duration-base)]\"\r\n        >\r\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n          </svg>\r\n          {clearLabel}\r\n        </button>\r\n      {/if}\r\n      \r\n      <!-- Close Button (Mobile) -->\r\n      <button\r\n        onclick={() => open = false}\r\n        class=\"sm:hidden w-full px-4 py-3 text-[color:var(--text-secondary)] hover:text-[color:var(--text-primary)] hover:bg-[color:var(--surface-muted)]\r\n               rounded-[var(--radius-md)] font-medium text-sm\r\n               min-h-[var(--touch-primary)]\r\n               focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[color:var(--state-focus)]\r\n               transition-colors duration-[var(--duration-base)]\"\r\n      >\r\n        {closeLabel}\r\n      </button>\r\n    </div>\r\n  </div>\r\n{/if}\r\n\r\n<!-- Live region for announcements -->\r\n{#if announcement}\r\n  <div \r\n    role=\"status\" \r\n    aria-live=\"polite\" \r\n    aria-atomic=\"true\"\r\n    class=\"sr-only\"\r\n  >\r\n    {announcement}\r\n  </div>\r\n{/if}\r\n\r\n<style>\r\n  /* Screen reader only text */\r\n  .sr-only {\r\n    position: absolute;\r\n    width: 1px;\r\n    height: 1px;\r\n    padding: 0;\r\n    margin: -1px;\r\n    overflow: hidden;\r\n    clip: rect(0, 0, 0, 0);\r\n    white-space: nowrap;\r\n    border: 0;\r\n  }\r\n  /* Smooth modal animations */\r\n  :global([data-dialog-overlay]) {\r\n    animation: fade-in var(--duration-base) var(--ease-out);\r\n  }\r\n  \r\n  :global([data-dialog-content]) {\r\n    animation: modal-in var(--duration-base) var(--ease-out);\r\n  }\r\n  \r\n  @keyframes fade-in {\r\n    from {\r\n      opacity: 0;\r\n    }\r\n    to {\r\n      opacity: 1;\r\n    }\r\n  }\r\n  \r\n  @keyframes modal-in {\r\n    from {\r\n      opacity: 0;\r\n      transform: translateY(100%);\r\n    }\r\n    to {\r\n      opacity: 1;\r\n      transform: translateY(0%);\r\n    }\r\n  }\r\n  \r\n  /* Desktop modal animation */\r\n  @media (min-width: 640px) {\r\n    @keyframes modal-in {\r\n      from {\r\n        opacity: 0;\r\n        transform: translate(-50%, -50%) scale(0.95);\r\n      }\r\n      to {\r\n        opacity: 1;\r\n        transform: translate(-50%, -50%) scale(1);\r\n      }\r\n    }\r\n  }\r\n  \r\n  /* Enhanced scrolling */\r\n  .overflow-y-auto {\r\n    -webkit-overflow-scrolling: touch;\r\n    scroll-behavior: smooth;\r\n  }\r\n  \r\n  /* Button press feedback */\r\n  .active\\:scale-98:active {\r\n    transform: scale(0.98);\r\n  }\r\n  \r\n  /* High contrast mode support */\r\n  @media (prefers-contrast: high) {\r\n    [role=\"dialog\"] {\r\n      outline: 3px solid currentColor;\r\n    }\r\n    \r\n    button:focus-visible {\r\n      outline: 3px solid currentColor;\r\n      outline-offset: 2px;\r\n    }\r\n  }\r\n  \r\n  /* Reduced motion support */\r\n  @media (prefers-reduced-motion: reduce) {\r\n    :global([data-dialog-overlay]),\r\n    :global([data-dialog-content]) {\r\n      animation: none;\r\n    }\r\n    \r\n    button {\r\n      transition: none;\r\n    }\r\n    \r\n    button:active {\r\n      transform: none;\r\n    }\r\n    \r\n    .overflow-y-auto {\r\n      scroll-behavior: auto;\r\n    }\r\n  }\r\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\FilterPill.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[165,168],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[165,168],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  interface Props {\n    active?: boolean;\n    onClick?: () => void;\n    variant?: 'default' | 'category' | 'condition' | 'primary';\n    children: any;\n    class?: string;\n  }\n\n  let {\n    active = false,\n    onClick,\n    variant = 'default',\n    children,\n    class: className = ''\n  }: Props = $props();\n\n  function getVariantClasses(variant: string, active: boolean): string {\n    const baseClasses = 'shrink-0 px-3 py-2 min-h-[44px] rounded-full text-sm font-medium transition-all duration-200 cursor-pointer hover:scale-105 flex items-center gap-1.5 touch-manipulation';\n    \n    switch (variant) {\n      case 'primary':\n        return active\n          ? `${baseClasses} bg-black text-white shadow-md`\n          : `${baseClasses} bg-white text-gray-900 border border-gray-300 hover:border-gray-400 hover:bg-gray-50 shadow-sm font-semibold`;\n      \n      case 'category':\n        return active\n          ? `${baseClasses} bg-black text-white shadow-sm`\n          : `${baseClasses} bg-gray-100 text-gray-700 hover:bg-gray-200`;\n      \n      case 'condition':\n        return active\n          ? `${baseClasses} bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-md`\n          : `${baseClasses} bg-white text-gray-700 border border-gray-300 hover:border-gray-400 hover:bg-gray-50`;\n      \n      default:\n        return active\n          ? `${baseClasses} bg-blue-600 text-white shadow-sm`\n          : `${baseClasses} bg-gray-100 text-gray-700 hover:bg-gray-200`;\n    }\n  }\n</script>\n\n<button\n  onclick={onClick}\n  class=\"{getVariantClasses(variant, active)} {className}\"\n  type=\"button\"\n>\n  {@render children()}\n</button>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\FilterPillGroup.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Snippet' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FilterOption' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'item' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":37,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1525,1528],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1525,1528],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import type { Snippet } from 'svelte';\r\n  import { tick } from 'svelte';\r\n  import { filter_ui_applied, filter_ui_removed, filter_modal_filter } from '@repo/i18n';\r\n  import { filter_ui_filterOptionsAriaLabel, filter_ui_keyboardNavHelp } from '@repo/i18n';\r\n  import type { FilterPillGroupProps, FilterOption } from '@repo/ui/types';\r\n\r\n  let {\r\n    value = $bindable(null),\r\n    options,\r\n    multiple = false,\r\n    disabled = false,\r\n    label,\r\n    class: className = '',\r\n    pillClass = '',\r\n    activePillClass = '',\r\n    onValueChange,\r\n    children,\r\n    announceChanges = true,\r\n    announcementTemplate\r\n  }: FilterPillGroupProps = $props();\r\n\r\n  // Track current focused index for keyboard navigation\r\n  let focusedIndex = $state(-1);\r\n  let containerRef: HTMLDivElement;\r\n  let announcement = $state('');\r\n\r\n  // Simple toggle group placeholder implementation\r\n  let toggleValue = $state(value ?? undefined);\r\n\r\n  // Create dummy elements to match melt-ui interface\r\n  const root = $derived({\r\n    'data-melt-toggle-group-root': '',\r\n    role: 'group'\r\n  });\r\n\r\n  const item = $derived({\r\n    'data-melt-toggle-group-item': '',\r\n    role: 'button'\r\n  });\r\n\r\n  // Helper function to check if a value is pressed\r\n  function isPressed(itemValue: string) {\r\n    return multiple ?\r\n      (Array.isArray(toggleValue) ? toggleValue.includes(itemValue) : false) :\r\n      toggleValue === itemValue;\r\n  }\r\n\r\n  // Simple toggle function\r\n  function handleToggle(itemValue: string) {\r\n    let newValue: any;\r\n    const changedOption = options.find(opt => opt.value === itemValue);\r\n\r\n    if (multiple) {\r\n      const currentValues = Array.isArray(toggleValue) ? toggleValue : [];\r\n      if (currentValues.includes(itemValue)) {\r\n        newValue = currentValues.filter(v => v !== itemValue);\r\n      } else {\r\n        newValue = [...currentValues, itemValue];\r\n      }\r\n    } else {\r\n      newValue = toggleValue === itemValue ? undefined : itemValue;\r\n    }\r\n\r\n    toggleValue = newValue;\r\n    value = multiple ? (Array.isArray(newValue) ? newValue[0] || null : null) : (newValue || null);\r\n    onValueChange?.(value);\r\n\r\n    // Announce changes to screen readers\r\n    if (announceChanges && changedOption) {\r\n      const isActive = value !== null;\r\n      if (announcementTemplate) {\r\n        announcement = announcementTemplate(changedOption, isActive);\r\n      } else {\r\n        const statusText = isActive ? filter_ui_applied() : filter_ui_removed();\r\n        announcement = `${changedOption.label} ${filter_modal_filter()} ${statusText}`;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Sync external value with internal state\r\n  $effect(() => {\r\n    if (toggleValue !== value) {\r\n      toggleValue = value ?? undefined;\r\n    }\r\n  });\r\n\r\n  // Enhanced keyboard navigation\r\n  function handleKeydown(event: KeyboardEvent) {\r\n    if (disabled) return;\r\n    \r\n    const { key } = event;\r\n    const currentIndex = focusedIndex;\r\n    \r\n    switch (key) {\r\n      case 'ArrowRight':\r\n      case 'ArrowDown':\r\n        event.preventDefault();\r\n        focusedIndex = currentIndex < options.length - 1 ? currentIndex + 1 : 0;\r\n        focusItemAtIndex(focusedIndex);\r\n        break;\r\n        \r\n      case 'ArrowLeft':\r\n      case 'ArrowUp':\r\n        event.preventDefault();\r\n        focusedIndex = currentIndex > 0 ? currentIndex - 1 : options.length - 1;\r\n        focusItemAtIndex(focusedIndex);\r\n        break;\r\n        \r\n      case 'Home':\r\n        event.preventDefault();\r\n        focusedIndex = 0;\r\n        focusItemAtIndex(0);\r\n        break;\r\n        \r\n      case 'End':\r\n        event.preventDefault();\r\n        focusedIndex = options.length - 1;\r\n        focusItemAtIndex(options.length - 1);\r\n        break;\r\n        \r\n      case 'Enter':\r\n      case ' ':\r\n        if (currentIndex >= 0 && currentIndex < options.length) {\r\n          event.preventDefault();\r\n          const option = options[currentIndex];\r\n          handleToggle(option.value);\r\n        }\r\n        break;\r\n    }\r\n  }\r\n  \r\n  // Focus management helper\r\n  async function focusItemAtIndex(index: number) {\r\n    await tick();\r\n    if (containerRef) {\r\n      const buttons = containerRef.querySelectorAll('[role=\"button\"]');\r\n      const targetButton = buttons[index] as HTMLButtonElement;\r\n      if (targetButton) {\r\n        targetButton.focus();\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Handle individual button focus\r\n  function handleButtonFocus(index: number) {\r\n    focusedIndex = index;\r\n  }\r\n  \r\n  // Clear announcement after it's been read\r\n  $effect(() => {\r\n    if (announcement) {\r\n      const timer = setTimeout(() => {\r\n        announcement = '';\r\n      }, 1000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  });\r\n\r\n  // Base classes following design tokens\r\n  const basePillClasses = $derived(`\r\n    shrink-0 inline-flex items-center justify-center gap-1.5 px-3 py-2 \r\n    min-h-[var(--touch-standard)] rounded-full text-xs font-semibold \r\n    transition-all duration-[var(--duration-base)] \r\n    focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)] focus-visible:ring-offset-2\r\n    disabled:opacity-50 disabled:cursor-not-allowed\r\n    hover:shadow-sm active:scale-95\r\n    ${pillClass}\r\n  `);\r\n</script>\r\n\r\n{#if label}\r\n  <div class=\"mb-3\">\r\n    <h3 class=\"text-xs font-semibold text-[color:var(--text-tertiary)] uppercase tracking-wide px-1\">\r\n      {label}\r\n    </h3>\r\n  </div>\r\n{/if}\r\n\r\n<div \r\n  bind:this={containerRef}\r\n  use:root \r\n  class=\"flex items-center gap-2 overflow-x-auto scrollbarhide pb-1 {className}\"\r\n  role=\"toolbar\"\r\n  aria-label={label || filter_ui_filterOptionsAriaLabel()}\r\n  aria-orientation=\"horizontal\"\r\n  tabindex=\"-1\"\r\n  onkeydown={handleKeydown}\r\n>\r\n  {#each options as option, index (option.value)}\r\n    {@const isActive = isPressed(option.value)}\r\n    {@const activeClasses = isActive \r\n      ? (option.bgGradient \r\n          ? `${option.bgGradient} text-white shadow-md border-transparent ${activePillClass}` \r\n          : `bg-[color:var(--primary)] text-[color:var(--primary-fg)] shadow-md border-transparent ${activePillClass}`)\r\n      : `bg-[color:var(--surface-base)] text-[color:var(--text-primary)] border border-[color:var(--border-default)] hover:border-[color:var(--border-emphasis)] hover:bg-[color:var(--surface-subtle)]`\r\n    }\r\n    \r\n    <button\r\n      data-value={option.value}\r\n      class=\"{basePillClasses} {activeClasses}\"\r\n      tabindex={focusedIndex === index ? 0 : -1}\r\n      aria-pressed={isActive}\r\n      aria-label=\"{option.label} {filter_modal_filter()} {isActive ? filter_ui_applied() : filter_ui_removed()}\"\r\n      aria-describedby={`filter-help-${option.value}`}\r\n      onfocus={() => handleButtonFocus(index)}\r\n      onclick={() => handleToggle(option.value)}\r\n    >\r\n      {#if children}\r\n        {@render children(option)}\r\n      {:else}\r\n        {#if option.icon}\r\n          <span class=\"text-sm\" aria-hidden=\"true\">{option.icon}</span>\r\n        {/if}\r\n        {#if option.color && isActive}\r\n          <span \r\n            class=\"w-1.5 h-1.5 rounded-full bg-current\" \r\n            aria-hidden=\"true\"\r\n          ></span>\r\n        {:else if option.color}\r\n          <span \r\n            class=\"w-1.5 h-1.5 rounded-full\"\r\n            style=\"background-color: {option.color}\"\r\n            aria-hidden=\"true\"\r\n          ></span>\r\n        {/if}\r\n        <span>{option.shortLabel || option.label}</span>\r\n      {/if}\r\n    </button>\r\n    \r\n    <!-- Hidden help text for each filter -->\r\n    <span \r\n      id=\"filter-help-{option.value}\"\r\n      class=\"sr-only\"\r\n    >\r\n{filter_ui_keyboardNavHelp()}\r\n    </span>\r\n  {/each}\r\n</div>\r\n\r\n<!-- Live region for announcements -->\r\n{#if announcement}\r\n  <div \r\n    role=\"status\" \r\n    aria-live=\"polite\" \r\n    aria-atomic=\"true\"\r\n    class=\"sr-only\"\r\n  >\r\n    {announcement}\r\n  </div>\r\n{/if}\r\n\r\n<style>\r\n  /* Smooth scroll behavior for horizontal scrolling */\r\n  .overflow-x-auto {\r\n    scroll-behavior: smooth;\r\n  }\r\n  \r\n  /* Screen reader only text */\r\n  .sr-only {\r\n    position: absolute;\r\n    width: 1px;\r\n    height: 1px;\r\n    padding: 0;\r\n    margin: -1px;\r\n    overflow: hidden;\r\n    clip: rect(0, 0, 0, 0);\r\n    white-space: nowrap;\r\n    border: 0;\r\n  }\r\n  \r\n  /* Enhanced touch feedback for mobile */\r\n  @media (hover: none) and (pointer: coarse) {\r\n    button:active {\r\n      transform: scale(0.95);\r\n    }\r\n  }\r\n  \r\n  /* High contrast mode support */\r\n  @media (prefers-contrast: high) {\r\n    button:focus-visible {\r\n      outline: 3px solid currentColor;\r\n      outline-offset: 2px;\r\n    }\r\n    \r\n    button[aria-pressed=\"true\"] {\r\n      outline: 2px solid currentColor;\r\n    }\r\n  }\r\n  \r\n  /* Reduced motion support */\r\n  @media (prefers-reduced-motion: reduce) {\r\n    button {\r\n      transition: none;\r\n    }\r\n    \r\n    button:active {\r\n      transform: none;\r\n    }\r\n    \r\n    .overflow-x-auto {\r\n      scroll-behavior: auto;\r\n    }\r\n  }\r\n</style>\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\FilterResultsAnnouncer.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tick' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  import { tick } from 'svelte';\n\n  interface Props {\n    /** Number of results found */\n    resultCount?: number;\n    /** Total number of items before filtering */\n    totalItems?: number;\n    /** Whether filtering is in progress */\n    loading?: boolean;\n    /** Custom announcement template */\n    announcementTemplate?: (count: number, total: number, loading: boolean) => string;\n    /** Delay before announcing changes (ms) */\n    announcementDelay?: number;\n    /** Custom class for container */\n    class?: string;\n  }\n\n  let {\n    resultCount = 0,\n    totalItems = 0,\n    loading = false,\n    announcementTemplate,\n    announcementDelay = 500,\n    class: className = ''\n  }: Props = $props();\n\n  let announcement = $state('');\n  let timeoutId: ReturnType<typeof setTimeout> | null = null;\n  \n  // Create announcements when result count changes\n  $effect(() => {\n    // Clear existing timeout\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n      timeoutId = null;\n    }\n\n    // Don't announce during loading or if no meaningful change\n    if (loading) {\n      return;\n    }\n\n    // Debounce announcements to avoid spam\n    timeoutId = setTimeout(() => {\n      if (announcementTemplate) {\n        announcement = announcementTemplate(resultCount, totalItems, loading);\n      } else {\n        // Generate default announcement\n        if (resultCount === 0) {\n          announcement = 'No results found. Try adjusting your filters.';\n        } else if (resultCount === 1) {\n          announcement = '1 result found';\n        } else if (resultCount === totalItems && totalItems > 0) {\n          announcement = `Showing all ${totalItems} results`;\n        } else {\n          announcement = `${resultCount} results found`;\n          if (totalItems > 0) {\n            announcement += ` out of ${totalItems} total items`;\n          }\n        }\n      }\n    }, announcementDelay);\n  });\n\n  // Clear announcement after it's been read\n  $effect(() => {\n    if (announcement) {\n      const timer = setTimeout(() => {\n        announcement = '';\n      }, 3000); // Longer duration for result announcements\n      \n      return () => clearTimeout(timer);\n    }\n  });\n\n  // Cleanup timeout on unmount\n  $effect(() => {\n    return () => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n    };\n  });\n</script>\n\n<!-- Live region for filter result announcements -->\n{#if announcement}\n  <div \n    role=\"status\" \n    aria-live=\"polite\" \n    aria-atomic=\"true\"\n    class=\"sr-only {className}\"\n  >\n    {announcement}\n  </div>\n{/if}\n\n<style>\n  /* Screen reader only text */\n  .sr-only {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    white-space: nowrap;\n    border: 0;\n  }\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\ProductActions.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":53,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'canMakeOffer' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":63,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import * as m from '@repo/i18n';\r\n\r\n  interface Seller {\r\n    username?: string;\r\n    avatar_url?: string;\r\n    rating?: number;\r\n    full_name?: string;\r\n  }\r\n\r\n  interface Props {\r\n    price?: number;\r\n    currency?: string;\r\n    isOwner?: boolean;\r\n    isSold?: boolean;\r\n    onBuyNow?: () => void;\r\n    onMessage?: () => void;\r\n    onMakeOffer?: () => void;\r\n    className?: string;\r\n    // New props for compact layout\r\n    seller?: Seller;\r\n    productTitle?: string;\r\n    productDescription?: string;\r\n    showSellerInfo?: boolean;\r\n  }\r\n\r\n  let {\r\n    price,\r\n    currency = '€',\r\n    isOwner = false,\r\n    isSold = false,\r\n    onBuyNow,\r\n    onMessage,\r\n    onMakeOffer,\r\n    className = '',\r\n    seller,\r\n    productTitle,\r\n    productDescription,\r\n    showSellerInfo = true\r\n  }: Props = $props();\r\n\r\n  // State for loading actions\r\n  let isLoading = $state(false);\r\n  let loadingAction = $state<string | null>(null);\r\n\r\n  async function handleAction(action: string, handler?: () => void | Promise<void>) {\r\n    if (!handler || isLoading) return;\r\n    \r\n    try {\r\n      isLoading = true;\r\n      loadingAction = action;\r\n      await handler();\r\n    } catch (error) {\r\n      \r\n    } finally {\r\n      isLoading = false;\r\n      loadingAction = null;\r\n    }\r\n  }\r\n\r\n  const canBuy = $derived(!isOwner && !isSold);\r\n  const canMessage = $derived(!isOwner);\r\n  const canMakeOffer = $derived(!isOwner && !isSold && onMakeOffer);\r\n\r\n  // Truncate text helper\r\n  function truncateText(text: string, maxLength: number): string {\r\n    if (text.length <= maxLength) return text;\r\n    return text.substring(0, maxLength) + '…';\r\n  }\r\n</script>\r\n\r\n<!-- Compact bottom sheet with seller info and action buttons -->\r\n<div class=\"{className}\" class:opacity-75={isLoading}>\r\n{#if showSellerInfo && (seller || productTitle)}\r\n    <!-- Seller Info Section -->\r\n    <div class=\"bg-white/95 backdrop-blur-sm border-b border-[color:var(--gray-200)] p-4 mb-4\">\r\n      <!-- Grid layout so thumbnail matches text stack height (3 rows) -->\r\n      <div class=\"grid grid-cols-[auto_1fr] grid-rows-[auto_auto_auto] gap-x-3 gap-y-1 items-start\">\r\n        <!-- Product Thumbnail (row-span to match 3 lines) -->\r\n        {#if seller?.avatar_url}\r\n          <img \r\n            src={seller.avatar_url} \r\n            alt={seller.full_name || seller.username || 'Seller'}\r\n            class=\"row-span-3 w-16 self-stretch rounded-md object-cover bg-[color:var(--gray-100)] border border-[color:var(--gray-200)]\"\r\n            loading=\"lazy\"\r\n          />\r\n        {:else}\r\n          <div class=\"row-span-3 w-16 self-stretch rounded-md bg-[color:var(--gray-200)] border border-[color:var(--gray-300)] flex items-center justify-center\">\r\n            <svg class=\"w-5 h-5 text-[color:var(--gray-500)]\" viewBox=\"0 0 24 24\" fill=\"currentColor\" aria-hidden=\"true\">\r\n              <path d=\"M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z\"/>\r\n            </svg>\r\n          </div>\r\n        {/if}\r\n\r\n        <!-- Row 1: Title (single line) -->\r\n        {#if productTitle}\r\n          <h3 class=\"col-start-2 row-start-1 text-sm font-semibold text-[color:var(--gray-900)] leading-tight truncate\">\r\n            {truncateText(productTitle, 60)}\r\n          </h3>\r\n        {/if}\r\n\r\n        <!-- Row 2: Seller meta (single line) -->\r\n        <div class=\"col-start-2 row-start-2 min-w-0 flex items-center gap-2\">\r\n          <span class=\"text-xs font-medium text-[color:var(--gray-700)] truncate\">\r\n            {seller?.full_name || seller?.username || 'Seller'}\r\n          </span>\r\n          {#if seller?.rating}\r\n            <div class=\"flex items-center gap-1\">\r\n              <svg class=\"w-3 h-3 text-yellow-400\" viewBox=\"0 0 24 24\" fill=\"currentColor\" aria-hidden=\"true\">\r\n                <path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\"/>\r\n              </svg>\r\n              <span class=\"text-xs font-medium text-[color:var(--gray-600)]\">{seller.rating.toFixed(1)}</span>\r\n            </div>\r\n          {/if}\r\n        </div>\r\n\r\n        <!-- Row 3: Description (single line) -->\r\n        {#if productDescription}\r\n          <p class=\"col-start-2 row-start-3 text-xs text-[color:var(--gray-600)] leading-relaxed truncate\">\r\n            {truncateText(productDescription, 80)}\r\n          </p>\r\n        {/if}\r\n      </div>\r\n    </div>\r\n  {/if}\r\n\r\n  <!-- Action Buttons Row -->\r\n  <div class=\"px-4 pb-4\">\r\n    {#if isSold}\r\n      <!-- Sold State -->\r\n      <div class=\"flex items-center justify-center gap-2.5 w-full h-10 px-4 \r\n                  bg-[color:var(--status-success-bg)] \r\n                  border border-[color:var(--status-success-border)] \r\n                  text-[color:var(--status-success-text)] \r\n                  font-semibold rounded-lg shadow-xs\" \r\n           role=\"status\" \r\n           aria-label=\"Item sold\">\r\n        <svg class=\"w-4 h-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\">\r\n          <path d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\"/>\r\n        </svg>\r\n        <span class=\"text-sm font-semibold\">{m.pdp_sold()}</span>\r\n      </div>\r\n    {:else if isOwner}\r\n      <!-- Owner State -->\r\n      <div class=\"flex items-center justify-center gap-2.5 w-full h-10 px-4 \r\n                  bg-[color:var(--surface-subtle)] \r\n                  border border-[color:var(--border-default)] \r\n                  text-[color:var(--text-secondary)] \r\n                  font-semibold rounded-lg shadow-xs\" \r\n           role=\"status\" \r\n           aria-label=\"Your item\">\r\n        <svg class=\"w-4 h-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\">\r\n          <path d=\"M10 2L3 7v11a1 1 0 001 1h3a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1h3a1 1 0 001-1V7l-7-5z\"/>\r\n        </svg>\r\n        <span class=\"text-sm font-semibold\">{m.pdp_yourItem()}</span>\r\n      </div>\r\n    {:else}\r\n      <!-- Active Actions Row -->\r\n      <div class=\"flex gap-3\">\r\n        <!-- Message Button -->\r\n        <button \r\n          type=\"button\" \r\n          class=\"group relative flex items-center justify-center gap-2.5 h-10 px-5 \r\n                 bg-[color:var(--surface-base)] \r\n                 border border-[color:var(--border-default)] \r\n                 text-[color:var(--text-secondary)] \r\n                 rounded-lg font-medium\r\n                 hover:bg-[color:var(--surface-subtle)] hover:border-[color:var(--border-emphasis)] hover:text-[color:var(--text-primary)]\r\n                 focus:outline-none focus:ring-2 focus:ring-[color:var(--primary)] focus:ring-offset-1 focus:bg-[color:var(--surface-subtle)]\r\n                 active:scale-95 active:bg-[color:var(--surface-muted)]\r\n                 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100\r\n                 transition-all duration-[--duration-fast] ease-[--ease-out]\r\n                 shadow-xs hover:shadow-sm\"\r\n          onclick={() => handleAction('message', onMessage)}\r\n          disabled={!canMessage || isLoading}\r\n          aria-label={m.pdp_messageSeller()}\r\n        >\r\n          {#if loadingAction === 'message'}\r\n            <div class=\"w-4 h-4 border-2 border-[color:var(--text-muted)] border-t-transparent rounded-full animate-spin\" aria-hidden=\"true\"></div>\r\n          {:else}\r\n            <svg class=\"w-4 h-4 transition-transform duration-[--duration-fast] group-hover:scale-110\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" aria-hidden=\"true\">\r\n              <path d=\"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z\"/>\r\n            </svg>\r\n          {/if}\r\n          <span class=\"text-sm font-medium\">{m.message()}</span>\r\n        </button>\r\n        \r\n        <!-- Buy Button -->\r\n        <button \r\n          type=\"button\" \r\n          class=\"group relative flex-1 flex items-center justify-center gap-2.5 h-10 px-6\r\n                 bg-[color:var(--primary)] \r\n                 text-[color:var(--primary-fg)] \r\n                 rounded-lg font-semibold\r\n                 hover:bg-[color:var(--primary-600)] hover:shadow-md\r\n                 focus:outline-none focus:ring-2 focus:ring-[color:var(--primary)] focus:ring-offset-2\r\n                 active:scale-95 active:bg-[color:var(--primary-700)]\r\n                 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100\r\n                 transition-all duration-[--duration-fast] ease-[--ease-out]\r\n                 shadow-sm\"\r\n          onclick={() => handleAction('buy', onBuyNow)}\r\n          disabled={!canBuy || isLoading}\r\n          aria-label={m.pdp_buyNow() + ` ${currency}${price}`}\r\n        >\r\n          {#if loadingAction === 'buy'}\r\n            <div class=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" aria-hidden=\"true\"></div>\r\n          {:else}\r\n            <svg class=\"w-4 h-4 transition-transform duration-[--duration-fast] group-hover:scale-110\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" aria-hidden=\"true\">\r\n              <circle cx=\"8\" cy=\"21\" r=\"1\"/>\r\n              <circle cx=\"19\" cy=\"21\" r=\"1\"/>\r\n              <path d=\"m2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12\"/>\r\n            </svg>\r\n          {/if}\r\n          <span class=\"text-sm font-semibold tracking-wide\">\r\n            {#if typeof price === 'number'}\r\n              {m.buyNow()} • {currency}{price}\r\n            {:else}\r\n              {m.pdp_buyNow()}\r\n            {/if}\r\n          </span>\r\n        </button>\r\n      </div>\r\n    {/if}\r\n  </div>\r\n</div>\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\ProductBuyBox.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'m' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":3,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":10},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[70,73],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[70,73],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":61,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import * as i18n from '@repo/i18n';\r\n  const m: any = i18n;\r\n  import Badge from '../badges/Badge.svelte';\r\n  // No lifecycle imports needed - using $effect\r\n\r\n  interface Product {\r\n    price: number;\r\n    originalPrice?: number;\r\n    currency?: string;\r\n    isOwner?: boolean;\r\n    isSold?: boolean;\r\n    acceptsOffers?: boolean;\r\n  }\r\n\r\n  interface Props {\r\n    product: Product;\r\n    isOwner?: boolean;\r\n    isAuthenticated?: boolean;\r\n    onBuyNow?: () => void;\r\n    onMessage?: () => void;\r\n    onMakeOffer?: () => void;\r\n    className?: string;\r\n    variant?: 'default' | 'compact' | 'floating';\r\n  }\r\n\r\n  let { \r\n    product,\r\n    isOwner = false,\r\n    isAuthenticated = false,\r\n    onBuyNow,\r\n    onMessage,\r\n    onMakeOffer,\r\n    className = '',\r\n    variant = 'default'\r\n  }: Props = $props();\r\n\r\n  // State management\r\n  let isLoading = $state(false);\r\n  let loadingAction = $state<string | null>(null);\r\n  let showPriceAnimation = $state(false);\r\n\r\n  const currency = $derived(product.currency || '€');\r\n  const hasDiscount = $derived(product.originalPrice && product.originalPrice > product.price);\r\n  const discountPercentage = $derived(() => {\r\n    if (!hasDiscount || !product.originalPrice) return 0;\r\n    return Math.round((1 - product.price / product.originalPrice) * 100);\r\n  });\r\n\r\n  const canBuy = $derived(!isOwner && !product.isSold && isAuthenticated);\r\n  const canMessage = $derived(!isOwner && isAuthenticated);\r\n  const canMakeOffer = $derived(!isOwner && !product.isSold && product.acceptsOffers && isAuthenticated);\r\n\r\n  async function handleAction(action: string, handler?: () => void | Promise<void>) {\r\n    if (!handler || isLoading) return;\r\n    \r\n    try {\r\n      isLoading = true;\r\n      loadingAction = action;\r\n      await handler();\r\n    } catch (error) {\r\n      \r\n    } finally {\r\n      isLoading = false;\r\n      loadingAction = null;\r\n    }\r\n  }\r\n\r\n  function formatPrice(price: number) {\r\n    return price.toLocaleString('en-US', { \r\n      minimumFractionDigits: 2, \r\n      maximumFractionDigits: 2 \r\n    });\r\n  }\r\n\r\n  $effect(() => {\r\n    // Trigger price animation after mount\r\n    setTimeout(() => showPriceAnimation = true, 100);\r\n  });\r\n</script>\r\n\r\n<div class=\"buy-box {className} buy-box--{variant}\" class:buy-box--loading={isLoading}>\r\n  <!-- Price Section -->\r\n  <div class=\"price-section\">\r\n    <div class=\"price-main\" class:price-animated={showPriceAnimation}>\r\n      <div class=\"price-current\">\r\n        <span class=\"currency\">{currency}</span>\r\n        <span class=\"price-amount\">{formatPrice(product.price)}</span>\r\n        \r\n        {#if product.isSold}\r\n          <Badge variant=\"subtle\" class=\"sold-indicator\">\r\n            <svg viewBox=\"0 0 16 16\" class=\"sold-icon\">\r\n              <path d=\"M8 0a8 8 0 100 16A8 8 0 008 0zM6.5 5a.5.5 0 01.5-.5h2a.5.5 0 010 1H7a.5.5 0 00-.5.5v2.5a.5.5 0 01-1 0V5z\"/>\r\n              <path d=\"M8 10.5a.75.75 0 100 1.5.75.75 0 000-1.5z\"/>\r\n            </svg>\r\n            Sold\r\n          </Badge>\r\n        {/if}\r\n      </div>\r\n      \r\n      {#if hasDiscount && product.originalPrice != null}\r\n        <div class=\"price-original\">\r\n          <span class=\"original-amount\">{currency}{formatPrice(product.originalPrice)}</span>\r\n          <Badge variant=\"success\" size=\"sm\" class=\"discount-badge\">\r\n            -{discountPercentage()}%\r\n          </Badge>\r\n        </div>\r\n      {/if}\r\n    </div>\r\n    \r\n    {#if variant === 'default'}\r\n      <div class=\"price-details\">\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Price</span>\r\n          <span class=\"detail-value\">{currency}{formatPrice(product.price)}</span>\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Shipping</span>\r\n          <span class=\"detail-value detail-value--free\">Free</span>\r\n        </div>\r\n        <div class=\"detail-separator\"></div>\r\n        <div class=\"detail-row detail-row--total\">\r\n          <span class=\"detail-label\">Total</span>\r\n          <span class=\"detail-value\">{currency}{formatPrice(product.price)}</span>\r\n        </div>\r\n      </div>\r\n    {/if}\r\n  </div>\r\n\r\n  <!-- Action Buttons -->\r\n  <div class=\"actions-section\">\r\n    {#if isOwner}\r\n      <!-- Owner Actions -->\r\n      <div class=\"owner-state\">\r\n        <div class=\"state-message\">\r\n          <svg viewBox=\"0 0 20 20\" class=\"state-icon\">\r\n            <path fill=\"currentColor\" d=\"M10 2L3 7v11a1 1 0 001 1h3a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1h3a1 1 0 001-1V7l-7-5z\"/>\r\n          </svg>\r\n          <span>This is your listing</span>\r\n        </div>\r\n        <button \r\n          class=\"action-btn action-btn--secondary\"\r\n          onclick={() => handleAction('edit', () => {})}\r\n          disabled={isLoading}\r\n        >\r\n          {#if loadingAction === 'edit'}\r\n            <div class=\"loading-spinner\"></div>\r\n          {:else}\r\n            <svg viewBox=\"0 0 20 20\" class=\"btn-icon\">\r\n              <path fill=\"currentColor\" d=\"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z\"/>\r\n            </svg>\r\n          {/if}\r\n          Edit Listing\r\n        </button>\r\n      </div>\r\n    {:else if product.isSold}\r\n      <!-- Sold State -->\r\n      <div class=\"sold-state\">\r\n        <div class=\"state-message\">\r\n          <svg viewBox=\"0 0 20 20\" class=\"state-icon\">\r\n            <path fill=\"currentColor\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\"/>\r\n          </svg>\r\n          <span>This item has been sold</span>\r\n        </div>\r\n        {#if canMessage}\r\n          <button \r\n            class=\"action-btn action-btn--secondary\"\r\n            onclick={() => handleAction('message', onMessage)}\r\n            disabled={isLoading}\r\n          >\r\n            {#if loadingAction === 'message'}\r\n              <div class=\"loading-spinner\"></div>\r\n            {:else}\r\n              <svg viewBox=\"0 0 20 20\" class=\"btn-icon\">\r\n                <path fill=\"currentColor\" d=\"M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z\"/>\r\n                <path fill=\"currentColor\" d=\"M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z\"/>\r\n              </svg>\r\n            {/if}\r\n            Ask About Similar Items\r\n          </button>\r\n        {/if}\r\n      </div>\r\n    {:else if !isAuthenticated}\r\n      <!-- Auth Required -->\r\n      <div class=\"auth-state\">\r\n        <div class=\"state-message\">\r\n          <svg viewBox=\"0 0 20 20\" class=\"state-icon\">\r\n            <path fill=\"currentColor\" d=\"M10 2L3 7v11a1 1 0 001 1h12a1 1 0 001-1V7l-7-5zM10 12a3 3 0 100-6 3 3 0 000 6z\"/>\r\n          </svg>\r\n          <span>Sign in to purchase this item</span>\r\n        </div>\r\n        <button class=\"action-btn action-btn--primary action-btn--large\">\r\n          <svg viewBox=\"0 0 20 20\" class=\"btn-icon\">\r\n            <path fill=\"currentColor\" d=\"M10 2L3 7v11a1 1 0 001 1h12a1 1 0 001-1V7l-7-5zM10 12a3 3 0 100-6 3 3 0 000 6z\"/>\r\n          </svg>\r\n          Sign In to Buy\r\n        </button>\r\n      </div>\r\n    {:else}\r\n      <!-- Purchase Actions -->\r\n      <div class=\"purchase-actions\">\r\n        <button \r\n          class=\"action-btn action-btn--primary action-btn--large buy-now-btn\"\r\n          onclick={() => handleAction('buy', onBuyNow)}\r\n          disabled={!canBuy || isLoading}\r\n        >\r\n          {#if loadingAction === 'buy'}\r\n            <div class=\"loading-spinner\"></div>\r\n          {:else}\r\n            <svg viewBox=\"0 0 20 20\" class=\"btn-icon\">\r\n              <path fill=\"currentColor\" d=\"M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z\"/>\r\n            </svg>\r\n          {/if}\r\n          <span class=\"btn-text\">Buy Now</span>\r\n        </button>\r\n        \r\n        <div class=\"secondary-actions\">\r\n          {#if canMakeOffer}\r\n            <button \r\n              class=\"action-btn action-btn--secondary\"\r\n              onclick={() => handleAction('offer', onMakeOffer)}\r\n              disabled={isLoading}\r\n            >\r\n              {#if loadingAction === 'offer'}\r\n                <div class=\"loading-spinner\"></div>\r\n              {:else}\r\n                <svg viewBox=\"0 0 20 20\" class=\"btn-icon\">\r\n                  <path fill=\"currentColor\" d=\"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z\"/>\r\n                  <path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M4 5a2 2 0 012-2h8a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 1a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 3a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z\" clip-rule=\"evenodd\"/>\r\n                </svg>\r\n              {/if}\r\n              Make Offer\r\n            </button>\r\n          {/if}\r\n          \r\n          <button \r\n            class=\"action-btn action-btn--secondary\"\r\n            onclick={() => handleAction('message', onMessage)}\r\n            disabled={!canMessage || isLoading}\r\n          >\r\n            {#if loadingAction === 'message'}\r\n              <div class=\"loading-spinner\"></div>\r\n            {:else}\r\n              <svg viewBox=\"0 0 20 20\" class=\"btn-icon\">\r\n                <path fill=\"currentColor\" d=\"M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z\"/>\r\n                <path fill=\"currentColor\" d=\"M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z\"/>\r\n              </svg>\r\n            {/if}\r\n            Message\r\n          </button>\r\n        </div>\r\n      </div>\r\n    {/if}\r\n  </div>\r\n\r\n  <!-- Trust & Security (only show in default variant) -->\r\n  {#if variant === 'default'}\r\n    <div class=\"trust-section\">\r\n      <div class=\"trust-item\">\r\n        <div class=\"trust-icon\">\r\n          <svg viewBox=\"0 0 20 20\">\r\n            <path fill=\"currentColor\" d=\"M10 2L3 7v3c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-7-5z\"/>\r\n            <path fill=\"currentColor\" d=\"M8 11l2 2 4-4\" stroke=\"#fff\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n          </svg>\r\n        </div>\r\n        <div class=\"trust-content\">\r\n          <div class=\"trust-title\">Buyer Protection</div>\r\n          <div class=\"trust-desc\">Secure payments & money-back guarantee</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"trust-item\">\r\n        <div class=\"trust-icon\">\r\n          <svg viewBox=\"0 0 20 20\">\r\n            <path fill=\"currentColor\" d=\"M13 8V5a3 3 0 10-6 0v3H5a2 2 0 00-2 2v5a2 2 0 002 2h10a2 2 0 002-2v-5a2 2 0 00-2-2h-2zM9 5a1 1 0 112 0v3H9V5z\"/>\r\n          </svg>\r\n        </div>\r\n        <div class=\"trust-content\">\r\n          <div class=\"trust-title\">Fast & Secure</div>\r\n          <div class=\"trust-desc\">Ships within 1-2 business days</div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"trust-item\">\r\n        <div class=\"trust-icon\">\r\n          <svg viewBox=\"0 0 20 20\">\r\n            <path fill=\"currentColor\" d=\"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z\"/>\r\n          </svg>\r\n        </div>\r\n        <div class=\"trust-content\">\r\n          <div class=\"trust-title\">30-Day Returns</div>\r\n          <div class=\"trust-desc\">Easy returns & exchanges policy</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  {/if}\r\n</div>\r\n\r\n<style>\r\n  .buy-box {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-4);\r\n    background: var(--surface-base);\r\n    border: 1px solid var(--border-subtle);\r\n    border-radius: var(--radius-xl);\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .buy-box--default {\r\n    padding: var(--space-5);\r\n    position: sticky;\r\n    top: var(--space-4);\r\n  }\r\n\r\n  .buy-box--compact {\r\n    padding: var(--space-4);\r\n  }\r\n\r\n  /* Compact variant typography adjustments */\r\n  .buy-box--compact .currency {\r\n    font-size: var(--font-size-base);\r\n  }\r\n  .buy-box--compact .price-amount {\r\n    font-size: var(--font-size-2xl);\r\n  }\r\n  .buy-box--compact .price-details {\r\n    padding: var(--space-2);\r\n  }\r\n  .buy-box--compact .action-btn {\r\n    padding: var(--space-2-5) var(--space-3-5);\r\n    font-size: var(--font-size-sm);\r\n  }\r\n  .buy-box--compact .action-btn--large {\r\n    min-height: var(--touch-standard);\r\n    font-size: var(--font-size-base);\r\n  }\r\n  .buy-box--compact .trust-section {\r\n    padding: var(--space-2);\r\n  }\r\n\r\n  .buy-box--floating {\r\n    position: fixed;\r\n    bottom: 0;\r\n    left: 0;\r\n    right: 0;\r\n    z-index: 50;\r\n    padding: var(--space-4);\r\n    border-radius: var(--radius-xl) var(--radius-xl) 0 0;\r\n    box-shadow: var(--shadow-2xl);\r\n    backdrop-filter: blur(10px);\r\n    background: color-mix(in oklch, var(--surface-base) 95%, transparent);\r\n  }\r\n\r\n  .buy-box--loading {\r\n    pointer-events: none;\r\n    opacity: 0.8;\r\n  }\r\n\r\n  /* Price Section */\r\n  .price-section {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-3);\r\n  }\r\n\r\n  .price-main {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-2);\r\n  }\r\n\r\n  .price-current {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-3);\r\n    flex-wrap: wrap;\r\n  }\r\n\r\n  .currency {\r\n    font-size: var(--font-size-lg);\r\n    font-weight: var(--font-weight-medium);\r\n    color: var(--text-subtle);\r\n    align-self: flex-start;\r\n    margin-top: var(--space-1);\r\n  }\r\n\r\n  .price-amount {\r\n    font-size: var(--font-size-3xl);\r\n    font-weight: var(--font-weight-bold);\r\n    color: var(--text-strong);\r\n    line-height: 1;\r\n    letter-spacing: -0.02em;\r\n  }\r\n\r\n  .price-animated {\r\n    animation: priceReveal 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;\r\n  }\r\n\r\n  @keyframes priceReveal {\r\n    from {\r\n      opacity: 0;\r\n      transform: translateY(10px) scale(0.95);\r\n    }\r\n    to {\r\n      opacity: 1;\r\n      transform: translateY(0) scale(1);\r\n    }\r\n  }\r\n\r\n  .sold-indicator {\r\n    margin-left: auto;\r\n  }\r\n\r\n  .sold-icon {\r\n    width: 12px;\r\n    height: 12px;\r\n    margin-right: var(--space-1);\r\n  }\r\n\r\n  .price-original {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-2);\r\n  }\r\n\r\n  .original-amount {\r\n    font-size: var(--font-size-lg);\r\n    color: var(--text-subtle);\r\n    text-decoration: line-through;\r\n    text-decoration-color: var(--text-subtle);\r\n  }\r\n\r\n  .discount-badge {\r\n    animation: discountPulse 2s ease-in-out infinite;\r\n  }\r\n\r\n  @keyframes discountPulse {\r\n    0%, 100% { transform: scale(1); }\r\n    50% { transform: scale(1.05); }\r\n  }\r\n\r\n  /* Price Details */\r\n  .price-details {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-2);\r\n    padding: var(--space-3);\r\n    background: var(--surface-subtle);\r\n    border-radius: var(--radius-lg);\r\n    font-size: var(--font-size-sm);\r\n  }\r\n\r\n  .detail-row {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n  }\r\n\r\n  .detail-row--total {\r\n    font-weight: var(--font-weight-semibold);\r\n    color: var(--text-strong);\r\n    font-size: var(--font-size-base);\r\n  }\r\n\r\n  .detail-label {\r\n    color: var(--text-subtle);\r\n  }\r\n\r\n  .detail-value {\r\n    color: var(--text-strong);\r\n    font-weight: var(--font-weight-medium);\r\n  }\r\n\r\n  .detail-value--free {\r\n    color: var(--success);\r\n  }\r\n\r\n  .detail-separator {\r\n    height: 1px;\r\n    background: var(--border-subtle);\r\n    margin: var(--space-2) 0;\r\n  }\r\n\r\n  /* Actions Section */\r\n  .actions-section {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-3);\r\n  }\r\n\r\n  .action-btn {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    gap: var(--space-2);\r\n    padding: var(--space-3) var(--space-4);\r\n    border-radius: var(--radius-lg);\r\n    font-weight: var(--font-weight-semibold);\r\n    font-size: var(--font-size-base);\r\n    cursor: pointer;\r\n    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\r\n    border: none;\r\n    min-height: var(--touch-standard);\r\n    position: relative;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .action-btn:focus-visible {\r\n    outline: 2px solid var(--state-focus);\r\n    outline-offset: 2px;\r\n  }\r\n\r\n  .action-btn:disabled {\r\n    opacity: 0.6;\r\n    cursor: not-allowed;\r\n    transform: none !important;\r\n  }\r\n\r\n  .action-btn--primary {\r\n    background: var(--primary);\r\n    color: var(--primary-fg);\r\n  }\r\n\r\n  .action-btn--primary:hover:not(:disabled) {\r\n    background: var(--primary-hover);\r\n    transform: translateY(-1px);\r\n    box-shadow: var(--shadow-lg);\r\n  }\r\n\r\n  .action-btn--primary:active:not(:disabled) {\r\n    transform: translateY(0);\r\n  }\r\n\r\n  .action-btn--secondary {\r\n    background: var(--surface-base);\r\n    color: var(--text-strong);\r\n    border: 1px solid var(--border-subtle);\r\n  }\r\n\r\n  .action-btn--secondary:hover:not(:disabled) {\r\n    background: var(--surface-hover);\r\n    border-color: var(--border-strong);\r\n    transform: translateY(-1px);\r\n  }\r\n\r\n  .action-btn--large {\r\n    padding: var(--space-4) var(--space-6);\r\n    font-size: var(--font-size-lg);\r\n    min-height: var(--touch-primary);\r\n  }\r\n\r\n  .btn-icon {\r\n    width: 20px;\r\n    height: 20px;\r\n    flex-shrink: 0;\r\n  }\r\n\r\n  .btn-text {\r\n    font-weight: var(--font-weight-bold);\r\n  }\r\n\r\n  /* Loading Spinner */\r\n  .loading-spinner {\r\n    width: 20px;\r\n    height: 20px;\r\n    border: 2px solid currentColor;\r\n    border-top: 2px solid transparent;\r\n    border-radius: 50%;\r\n    animation: spin 1s linear infinite;\r\n  }\r\n\r\n  @keyframes spin {\r\n    to { transform: rotate(360deg); }\r\n  }\r\n\r\n  /* Purchase Actions */\r\n  .purchase-actions {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-3);\r\n  }\r\n\r\n  .buy-now-btn {\r\n    position: relative;\r\n  }\r\n\r\n  .buy-now-btn::before {\r\n    content: '';\r\n    position: absolute;\r\n    inset: 0;\r\n    background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.2) 50%, transparent 70%);\r\n    transform: translateX(-100%);\r\n    transition: transform 0.6s;\r\n  }\r\n\r\n  .buy-now-btn:hover::before {\r\n    transform: translateX(100%);\r\n  }\r\n\r\n  .secondary-actions {\r\n    display: grid;\r\n    grid-template-columns: 1fr 1fr;\r\n    gap: var(--space-2);\r\n  }\r\n\r\n  /* State Messages */\r\n  .owner-state,\r\n  .sold-state,\r\n  .auth-state {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-3);\r\n    text-align: center;\r\n    align-items: center;\r\n  }\r\n\r\n  .state-message {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-2);\r\n    padding: var(--space-3);\r\n    background: var(--surface-subtle);\r\n    border-radius: var(--radius-lg);\r\n    color: var(--text-subtle);\r\n    font-size: var(--font-size-sm);\r\n    font-weight: var(--font-weight-medium);\r\n  }\r\n\r\n  .state-icon {\r\n    width: 18px;\r\n    height: 18px;\r\n    flex-shrink: 0;\r\n    color: var(--text-strong);\r\n  }\r\n\r\n  /* Trust Section */\r\n  .trust-section {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-3);\r\n    padding: var(--space-3);\r\n    background: var(--surface-subtle);\r\n    border-radius: var(--radius-lg);\r\n  }\r\n\r\n  .trust-item {\r\n    display: flex;\r\n    align-items: flex-start;\r\n    gap: var(--space-3);\r\n  }\r\n\r\n  .trust-icon {\r\n    width: var(--space-8);\r\n    height: var(--space-8);\r\n    background: var(--success);\r\n    border-radius: var(--radius-md);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    flex-shrink: 0;\r\n  }\r\n\r\n  .trust-icon svg {\r\n    width: 18px;\r\n    height: 18px;\r\n    color: var(--surface-base);\r\n  }\r\n\r\n  .trust-content {\r\n    flex: 1;\r\n    min-width: 0;\r\n  }\r\n\r\n  .trust-title {\r\n    font-weight: var(--font-weight-semibold);\r\n    color: var(--text-strong);\r\n    font-size: var(--font-size-sm);\r\n    margin-bottom: var(--space-1);\r\n  }\r\n\r\n  .trust-desc {\r\n    color: var(--text-subtle);\r\n    font-size: var(--font-size-xs);\r\n    line-height: var(--line-height-relaxed);\r\n  }\r\n\r\n  /* Responsive Design */\r\n  @media (max-width: 768px) {\r\n    .buy-box--default {\r\n      position: static;\r\n      padding: var(--space-4);\r\n    }\r\n\r\n    .price-amount {\r\n      font-size: var(--font-size-2xl);\r\n    }\r\n\r\n    .secondary-actions {\r\n      grid-template-columns: 1fr;\r\n    }\r\n\r\n    .trust-section {\r\n      padding: var(--space-2);\r\n    }\r\n\r\n    .trust-item {\r\n      gap: var(--space-2);\r\n    }\r\n\r\n    .trust-icon {\r\n      width: var(--space-6);\r\n      height: var(--space-6);\r\n    }\r\n\r\n    .trust-icon svg {\r\n      width: 14px;\r\n      height: 14px;\r\n    }\r\n  }\r\n\r\n  /* Dark mode adjustments */\r\n  @media (prefers-color-scheme: dark) {\r\n    .buy-box--floating {\r\n      background: color-mix(in oklch, var(--surface-base) 90%, transparent);\r\n    }\r\n  }\r\n\r\n  /* High contrast support */\r\n  @media (prefers-contrast: high) {\r\n    .action-btn {\r\n      border-width: 2px;\r\n    }\r\n\r\n    .trust-icon {\r\n      border: 2px solid var(--success);\r\n    }\r\n  }\r\n\r\n  /* Reduced motion support */\r\n  @media (prefers-reduced-motion: reduce) {\r\n    .price-animated,\r\n    .discount-badge,\r\n    .action-btn,\r\n    .buy-now-btn::before,\r\n    .loading-spinner {\r\n      animation: none;\r\n      transition: none;\r\n    }\r\n  }\r\n</style>\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\ProductGallery.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[70,73],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[70,73],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'lastTouchCenter' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":47,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'velocity' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":48,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import * as i18n from '@repo/i18n';\r\n  const m: any = i18n;\r\n  import ConditionBadge from '../badges/ConditionBadge.svelte';\r\n  import Tooltip from '../../primitives/tooltip/Tooltip.svelte';\r\n  // No lifecycle imports needed - using $effect\r\n  \r\n  type ConditionType = 'brand_new_with_tags' | 'new_without_tags' | 'like_new' | 'good' | 'worn' | 'fair';\r\n  \r\n  interface Props {\r\n    images: string[];\r\n    title?: string;\r\n    isSold?: boolean;\r\n    onImageSelect?: (index: number) => void;\r\n    condition?: ConditionType;\r\n    translations?: {\r\n      brandNewWithTags?: string;\r\n      newWithoutTags?: string;\r\n      likeNew?: string;\r\n      good?: string;\r\n      worn?: string;\r\n      fair?: string;\r\n    };\r\n  }\r\n\r\n  let { \r\n    images = [], \r\n    title = '',\r\n    isSold = false,\r\n    onImageSelect,\r\n    condition,\r\n    translations = {}\r\n  }: Props = $props();\r\n\r\n  let selectedImage = $state(0);\r\n  let isFullscreen = $state(false);\r\n  let isZoomed = $state(false);\r\n  let scale = $state(1);\r\n  let translateX = $state(0);\r\n  let translateY = $state(0);\r\n  let isDragging = $state(false);\r\n  \r\n  // Touch and gesture handling\r\n  let touchStartX = 0;\r\n  let touchStartY = 0;\r\n  let lastTouchDistance = 0;\r\n  let lastTouchCenter = { x: 0, y: 0 };\r\n  let velocity = 0;\r\n  let lastTouchTime = 0;\r\n  \r\n  let mainImageRef: HTMLElement;\r\n  let fullscreenRef = $state<HTMLElement>();\r\n  let thumbnailsRef = $state<HTMLElement>();\r\n\r\n  function selectImage(index: number) {\r\n    if (index === selectedImage || index < 0 || index >= images.length) return;\r\n    selectedImage = index;\r\n    resetTransform();\r\n    onImageSelect?.(index);\r\n    \r\n    // Scroll thumbnail into view\r\n    if (thumbnailsRef && images.length > 1) {\r\n      const thumbElement = thumbnailsRef.children[index] as HTMLElement;\r\n      if (thumbElement) {\r\n        thumbElement.scrollIntoView({ behavior: 'smooth', inline: 'center' });\r\n      }\r\n    }\r\n  }\r\n\r\n  function resetTransform() {\r\n    scale = 1;\r\n    translateX = 0;\r\n    translateY = 0;\r\n    isZoomed = false;\r\n    isDragging = false;\r\n  }\r\n\r\n  function getTouchDistance(touches: TouchList) {\r\n    if (touches.length < 2) return 0;\r\n    const touch1 = touches[0];\r\n    const touch2 = touches[1];\r\n    return Math.sqrt(\r\n      Math.pow(touch2.clientX - touch1.clientX, 2) + \r\n      Math.pow(touch2.clientY - touch1.clientY, 2)\r\n    );\r\n  }\r\n\r\n  function getTouchCenter(touches: TouchList) {\r\n    if (touches.length === 1) {\r\n      return { x: touches[0].clientX, y: touches[0].clientY };\r\n    } else if (touches.length === 2) {\r\n      return {\r\n        x: (touches[0].clientX + touches[1].clientX) / 2,\r\n        y: (touches[0].clientY + touches[1].clientY) / 2\r\n      };\r\n    }\r\n    return { x: 0, y: 0 };\r\n  }\r\n\r\n  function handleTouchStart(e: TouchEvent) {\r\n    e.preventDefault();\r\n    const touch = e.touches[0];\r\n    touchStartX = touch.clientX;\r\n    touchStartY = touch.clientY;\r\n    lastTouchTime = Date.now();\r\n    velocity = 0;\r\n\r\n    if (e.touches.length === 2) {\r\n      lastTouchDistance = getTouchDistance(e.touches);\r\n      lastTouchCenter = getTouchCenter(e.touches);\r\n    }\r\n\r\n    if (isZoomed && e.touches.length === 1) {\r\n      isDragging = true;\r\n    }\r\n  }\r\n\r\n  function handleTouchMove(e: TouchEvent) {\r\n    e.preventDefault();\r\n    \r\n    if (e.touches.length === 2) {\r\n      // Pinch zoom\r\n      const distance = getTouchDistance(e.touches);\r\n      const center = getTouchCenter(e.touches);\r\n      \r\n      if (lastTouchDistance > 0) {\r\n        const scaleChange = distance / lastTouchDistance;\r\n        const newScale = Math.min(Math.max(scale * scaleChange, 1), 4);\r\n        \r\n        if (newScale !== scale) {\r\n          scale = newScale;\r\n          isZoomed = scale > 1;\r\n        }\r\n      }\r\n      \r\n      lastTouchDistance = distance;\r\n      lastTouchCenter = center;\r\n    } else if (e.touches.length === 1) {\r\n      const touch = e.touches[0];\r\n      const deltaX = touch.clientX - touchStartX;\r\n      const deltaY = touch.clientY - touchStartY;\r\n      \r\n      if (isZoomed && isDragging) {\r\n        // Pan when zoomed\r\n        translateX = Math.min(Math.max(translateX + deltaX, -100), 100);\r\n        translateY = Math.min(Math.max(translateY + deltaY, -100), 100);\r\n        touchStartX = touch.clientX;\r\n        touchStartY = touch.clientY;\r\n      } else if (!isZoomed && Math.abs(deltaX) > Math.abs(deltaY)) {\r\n        // Swipe to change image (only when not zoomed)\r\n        const now = Date.now();\r\n        const timeDelta = now - lastTouchTime;\r\n        if (timeDelta > 0) {\r\n          velocity = deltaX / timeDelta;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  function handleTouchEnd(e: TouchEvent) {\r\n    e.preventDefault();\r\n    \r\n    if (e.touches.length === 0) {\r\n      const deltaX = e.changedTouches[0].clientX - touchStartX;\r\n      const deltaY = e.changedTouches[0].clientY - touchStartY;\r\n      const absDeltaX = Math.abs(deltaX);\r\n      const absDeltaY = Math.abs(deltaY);\r\n      \r\n      if (!isZoomed && absDeltaX > 50 && absDeltaX > absDeltaY) {\r\n        // Swipe to change image\r\n        if (deltaX > 0 && selectedImage > 0) {\r\n          selectImage(selectedImage - 1);\r\n        } else if (deltaX < 0 && selectedImage < images.length - 1) {\r\n          selectImage(selectedImage + 1);\r\n        }\r\n      } else if (!isZoomed && absDeltaX < 10 && absDeltaY < 10) {\r\n        // Tap to toggle fullscreen\r\n        if (isFullscreen) {\r\n          exitFullscreen();\r\n        } else {\r\n          enterFullscreen();\r\n        }\r\n      }\r\n      \r\n      isDragging = false;\r\n      lastTouchDistance = 0;\r\n    }\r\n  }\r\n\r\n  function handleKeyDown(e: KeyboardEvent) {\r\n    if (isFullscreen) {\r\n      switch (e.key) {\r\n        case 'Escape':\r\n          exitFullscreen();\r\n          break;\r\n        case 'ArrowLeft':\r\n          if (selectedImage > 0) selectImage(selectedImage - 1);\r\n          break;\r\n        case 'ArrowRight':\r\n          if (selectedImage < images.length - 1) selectImage(selectedImage + 1);\r\n          break;\r\n        case 'r':\r\n          resetTransform();\r\n          break;\r\n      }\r\n    } else {\r\n      switch (e.key) {\r\n        case 'ArrowLeft':\r\n          if (selectedImage > 0) selectImage(selectedImage - 1);\r\n          break;\r\n        case 'ArrowRight':\r\n          if (selectedImage < images.length - 1) selectImage(selectedImage + 1);\r\n          break;\r\n        case 'Enter':\r\n        case ' ':\r\n          enterFullscreen();\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  function enterFullscreen() {\r\n    isFullscreen = true;\r\n    resetTransform();\r\n    document.body.style.overflow = 'hidden';\r\n    \r\n    // Focus fullscreen element for keyboard navigation\r\n    if (fullscreenRef) {\r\n      fullscreenRef.focus();\r\n    }\r\n  }\r\n\r\n  function exitFullscreen() {\r\n    isFullscreen = false;\r\n    resetTransform();\r\n    document.body.style.overflow = '';\r\n  }\r\n\r\n  function handleDoubleTap(e: Event) {\r\n    e.preventDefault();\r\n    if (isZoomed) {\r\n      resetTransform();\r\n    } else {\r\n      scale = 2;\r\n      isZoomed = true;\r\n    }\r\n  }\r\n\r\n  // Condition tooltip content\r\n  const getConditionTooltip = (condition: ConditionType) => {\r\n    const tooltipMap: Record<ConditionType, string> = {\r\n      'brand_new_with_tags': m.condition_newWithTags?.() || 'Brand new with tags',\r\n      'new_without_tags': m.sell_condition_newWithoutTags?.() || 'New without tags',\r\n      'like_new': m.product_likeNew?.() || 'Like new',\r\n      'good': m.sell_condition_good_desc?.() || 'Good condition',\r\n      'worn': m.sell_condition_worn?.() || 'Worn but good',\r\n      'fair': 'Fair condition'\r\n    };\r\n    return tooltipMap[condition] || `Condition: ${condition}`;\r\n  };\r\n\r\n  // Cleanup on unmount\r\n  $effect(() => {\r\n    return () => {\r\n      document.body.style.overflow = '';\r\n    };\r\n  });\r\n</script>\r\n\r\n<!-- Main Gallery Container -->\r\n<div\r\n  class=\"gallery-container\"\r\n  role=\"region\"\r\n  aria-label=\"Product images\"\r\n>\r\n  <!-- Main Image Display Container -->\r\n  <div class=\"main-image-wrapper\">\r\n    <button\r\n      class=\"main-image-container\"\r\n      bind:this={mainImageRef}\r\n      ontouchstart={handleTouchStart}\r\n      ontouchmove={handleTouchMove}\r\n      ontouchend={handleTouchEnd}\r\n      ondblclick={handleDoubleTap}\r\n      onclick={enterFullscreen}\r\n      onkeydown={handleKeyDown}\r\n      type=\"button\"\r\n      aria-label={m.pdp_a11y_productImage?.({ index: selectedImage + 1, total: images.length }) || `Product image ${selectedImage + 1} of ${images.length}. Click to view fullscreen`}\r\n    >\r\n      {#if images.length > 0}\r\n        <img\r\n          src={images[selectedImage]}\r\n          alt={title || `Product image ${selectedImage + 1}`}\r\n          class=\"main-image\"\r\n          loading={selectedImage === 0 ? \"eager\" : \"lazy\"}\r\n          decoding=\"async\"\r\n          fetchpriority={selectedImage === 0 ? \"high\" : \"low\"}\r\n          sizes=\"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 600px\"\r\n          style=\"transform: scale({scale}) translate({translateX}px, {translateY}px);\"\r\n        />\r\n\r\n        <!-- Overlay Elements -->\r\n        <div class=\"image-overlay\">\r\n          <!-- Condition Badge -->\r\n          {#if condition}\r\n            <div class=\"condition-badge-container\">\r\n              <Tooltip\r\n                content={getConditionTooltip(condition)}\r\n                positioning={{ side: 'bottom', align: 'start' }}\r\n                openDelay={600}\r\n                closeDelay={200}\r\n              >\r\n                {#snippet trigger()}\r\n                  <ConditionBadge {condition} {translations} />\r\n                {/snippet}\r\n              </Tooltip>\r\n            </div>\r\n          {/if}\r\n\r\n          <!-- Sold Badge -->\r\n          {#if isSold}\r\n            <div class=\"sold-badge\">\r\n              <span class=\"sold-text\">{m.pdp_sold?.() || 'SOLD'}</span>\r\n            </div>\r\n          {/if}\r\n\r\n          <!-- Image Counter -->\r\n          {#if images.length > 1}\r\n            <div class=\"image-counter\">\r\n              <span>{selectedImage + 1} / {images.length}</span>\r\n            </div>\r\n          {/if}\r\n\r\n          <!-- Zoom Indicator -->\r\n          {#if images.length > 0}\r\n            <div class=\"zoom-indicator\">\r\n              <svg viewBox=\"0 0 24 24\" class=\"zoom-icon\">\r\n                <circle cx=\"11\" cy=\"11\" r=\"8\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                <path d=\"m21 21-4.35-4.35\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n                <line x1=\"11\" y1=\"8\" x2=\"11\" y2=\"14\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                <line x1=\"8\" y1=\"11\" x2=\"14\" y2=\"11\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n              </svg>\r\n            </div>\r\n          {/if}\r\n        </div>\r\n\r\n      {:else}\r\n        <!-- No Images State -->\r\n        <div class=\"no-images\">\r\n          <svg class=\"no-images-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\">\r\n            <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"/>\r\n            <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"/>\r\n            <polyline points=\"21,15 16,10 5,21\"/>\r\n          </svg>\r\n          <p class=\"no-images-text\">{m.orders_noImage?.() || 'No image available'}</p>\r\n        </div>\r\n      {/if}\r\n    </button>\r\n\r\n    <!-- Navigation Arrows (Desktop) - Outside the main button -->\r\n    {#if images.length > 1}\r\n      <div class=\"nav-arrows\">\r\n        <button\r\n          class=\"nav-arrow nav-arrow-left\"\r\n          onclick={() => selectImage(selectedImage - 1)}\r\n          disabled={selectedImage === 0}\r\n          aria-label=\"Previous image\"\r\n        >\r\n          <svg viewBox=\"0 0 24 24\" class=\"arrow-icon\">\r\n            <path d=\"M15 18l-6-6 6-6\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n          </svg>\r\n        </button>\r\n\r\n        <button\r\n          class=\"nav-arrow nav-arrow-right\"\r\n          onclick={() => selectImage(selectedImage + 1)}\r\n          disabled={selectedImage === images.length - 1}\r\n          aria-label=\"Next image\"\r\n        >\r\n          <svg viewBox=\"0 0 24 24\" class=\"arrow-icon\">\r\n            <path d=\"M9 18l6-6-6-6\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n    {/if}\r\n  </div>\r\n\r\n  <!-- Thumbnail Strip -->\r\n  {#if images.length > 1}\r\n    <div class=\"thumbnails-container\">\r\n      <div class=\"thumbnails-strip\" bind:this={thumbnailsRef}>\r\n        {#each images as image, index}\r\n          <button \r\n            class=\"thumbnail\"\r\n            class:thumbnail-active={selectedImage === index}\r\n            onclick={() => selectImage(index)}\r\n            aria-label={`View image ${index + 1}`}\r\n          >\r\n            <img \r\n              src={image}\r\n              alt={`Thumbnail ${index + 1}`}\r\n              class=\"thumbnail-image\"\r\n              loading=\"lazy\"\r\n            />\r\n            <div class=\"thumbnail-overlay\"></div>\r\n          </button>\r\n        {/each}\r\n      </div>\r\n    </div>\r\n  {/if}\r\n</div>\r\n\r\n<!-- Fullscreen Modal -->\r\n{#if isFullscreen}\r\n  <!-- Backdrop -->\r\n  <button\r\n    class=\"fullscreen-backdrop\"\r\n    onclick={exitFullscreen}\r\n    type=\"button\"\r\n    aria-label=\"Close fullscreen view\"\r\n  ></button>\r\n  \r\n  <!-- Fullscreen Content -->\r\n  <div \r\n    class=\"fullscreen-content\"\r\n    bind:this={fullscreenRef}\r\n    tabindex=\"0\"\r\n    role=\"dialog\"\r\n    aria-modal=\"true\"\r\n    aria-label=\"Fullscreen product image view\"\r\n  >\r\n    <!-- Close Button -->\r\n    <button class=\"fullscreen-close\" onclick={exitFullscreen} aria-label=\"Close fullscreen\">\r\n      <svg viewBox=\"0 0 24 24\" class=\"close-icon\">\r\n        <path d=\"M18 6l-12 12M6 6l12 12\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n      </svg>\r\n    </button>\r\n    \r\n    <!-- Fullscreen Image -->\r\n    <div\r\n      class=\"fullscreen-image-container\"\r\n      ontouchstart={handleTouchStart}\r\n      ontouchmove={handleTouchMove}\r\n      ontouchend={handleTouchEnd}\r\n      ondblclick={handleDoubleTap}\r\n      role=\"img\"\r\n      aria-label=\"Fullscreen product image - double-tap to zoom\"\r\n    >\r\n      <img \r\n        src={images[selectedImage]}\r\n        alt={title || `Product image ${selectedImage + 1}`}\r\n        class=\"fullscreen-image\"\r\n        style=\"transform: scale({scale}) translate({translateX}px, {translateY}px);\"\r\n      />\r\n    </div>\r\n    \r\n    <!-- Fullscreen Controls -->\r\n    <div class=\"fullscreen-controls\">\r\n      <div class=\"fullscreen-counter\">\r\n        {selectedImage + 1} of {images.length}\r\n      </div>\r\n      \r\n      {#if images.length > 1}\r\n        <div class=\"fullscreen-nav\">\r\n          <button \r\n            class=\"fullscreen-nav-btn\"\r\n            onclick={() => selectImage(selectedImage - 1)}\r\n            disabled={selectedImage === 0}\r\n            aria-label=\"Previous image\"\r\n          >\r\n            <svg viewBox=\"0 0 24 24\" class=\"nav-icon\">\r\n              <path d=\"M15 18l-6-6 6-6\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n            </svg>\r\n          </button>\r\n          \r\n          <button \r\n            class=\"fullscreen-nav-btn\"\r\n            onclick={() => selectImage(selectedImage + 1)}\r\n            disabled={selectedImage === images.length - 1}\r\n            aria-label=\"Next image\"\r\n          >\r\n            <svg viewBox=\"0 0 24 24\" class=\"nav-icon\">\r\n              <path d=\"M9 18l6-6-6-6\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n            </svg>\r\n          </button>\r\n        </div>\r\n      {/if}\r\n      \r\n      <button class=\"zoom-reset-btn\" onclick={resetTransform} disabled={!isZoomed}>\r\n        Reset Zoom\r\n      </button>\r\n    </div>\r\n  </div>\r\n{/if}\r\n\r\n<style>\r\n  .gallery-container {\r\n    width: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-3);\r\n    outline: none;\r\n  }\r\n\r\n  .main-image-wrapper {\r\n    position: relative;\r\n    width: 100%;\r\n  }\r\n\r\n  .main-image-container {\r\n    position: relative;\r\n    aspect-ratio: 4/5;\r\n    overflow: hidden;\r\n    border-radius: var(--radius-xl);\r\n    background: var(--surface-subtle);\r\n    cursor: pointer;\r\n    user-select: none;\r\n    -webkit-user-select: none;\r\n    touch-action: none;\r\n    border: none;\r\n    width: 100%;\r\n    padding: 0;\r\n    display: block;\r\n  }\r\n\r\n  .main-image {\r\n    width: 100%;\r\n    height: 100%;\r\n    object-fit: cover;\r\n    object-position: center;\r\n    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\r\n    will-change: transform;\r\n  }\r\n\r\n  .image-overlay {\r\n    position: absolute;\r\n    inset: 0;\r\n    pointer-events: none;\r\n  }\r\n\r\n  .condition-badge-container {\r\n    position: absolute;\r\n    top: var(--space-3);\r\n    left: var(--space-3);\r\n    z-index: 20;\r\n    pointer-events: auto;\r\n  }\r\n\r\n  .sold-badge {\r\n    position: absolute;\r\n    top: var(--space-3);\r\n    left: var(--space-3);\r\n    z-index: 30;\r\n    background: var(--red-600);\r\n    color: var(--red-50);\r\n    padding: var(--space-2) var(--space-4);\r\n    border-radius: var(--radius-full);\r\n    backdrop-filter: blur(8px);\r\n    box-shadow: var(--shadow-lg);\r\n  }\r\n\r\n  .sold-text {\r\n    font-size: var(--font-size-sm);\r\n    font-weight: var(--font-weight-bold);\r\n    text-transform: uppercase;\r\n    letter-spacing: 0.05em;\r\n  }\r\n\r\n  .image-counter {\r\n    position: absolute;\r\n    bottom: var(--space-3);\r\n    right: var(--space-3);\r\n    background: var(--gray-900);\r\n    color: var(--gray-0);\r\n    padding: var(--space-2) var(--space-3);\r\n    border-radius: var(--radius-full);\r\n    backdrop-filter: blur(8px);\r\n    font-size: var(--font-size-sm);\r\n    font-weight: var(--font-weight-medium);\r\n  }\r\n\r\n  .zoom-indicator {\r\n    position: absolute;\r\n    bottom: var(--space-3);\r\n    left: var(--space-3);\r\n    background: var(--gray-900);\r\n    color: var(--gray-0);\r\n    padding: var(--space-2);\r\n    border-radius: var(--radius-full);\r\n    backdrop-filter: blur(8px);\r\n    opacity: 0.7;\r\n  }\r\n\r\n  .zoom-icon {\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n\r\n  .nav-arrows {\r\n    position: absolute;\r\n    inset: 0;\r\n    display: none;\r\n    pointer-events: none;\r\n  }\r\n\r\n  .nav-arrow {\r\n    position: absolute;\r\n    top: 50%;\r\n    transform: translateY(-50%);\r\n    width: var(--touch-icon);\r\n    height: var(--touch-icon);\r\n    background: var(--surface-base);\r\n    border: 1px solid var(--border-subtle);\r\n    border-radius: var(--radius-full);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n    pointer-events: auto;\r\n    box-shadow: var(--shadow-lg);\r\n    backdrop-filter: blur(8px);\r\n  }\r\n\r\n  .nav-arrow:hover:not(:disabled) {\r\n    background: var(--surface-hover);\r\n    border-color: var(--border-strong);\r\n    transform: translateY(-50%) scale(1.05);\r\n  }\r\n\r\n  .nav-arrow:disabled {\r\n    opacity: 0.3;\r\n    cursor: not-allowed;\r\n  }\r\n\r\n  .nav-arrow-left {\r\n    left: var(--space-4);\r\n  }\r\n\r\n  .nav-arrow-right {\r\n    right: var(--space-4);\r\n  }\r\n\r\n  .arrow-icon {\r\n    width: 20px;\r\n    height: 20px;\r\n    color: var(--text-strong);\r\n  }\r\n\r\n  .no-images {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n    height: 100%;\r\n    gap: var(--space-3);\r\n    color: var(--text-subtle);\r\n  }\r\n\r\n  .no-images-icon {\r\n    width: var(--space-12);\r\n    height: var(--space-12);\r\n  }\r\n\r\n  .no-images-text {\r\n    font-size: var(--font-size-sm);\r\n    font-weight: var(--font-weight-medium);\r\n  }\r\n\r\n  /* Thumbnails */\r\n  .thumbnails-container {\r\n    display: flex;\r\n    gap: var(--space-2);\r\n  }\r\n\r\n  .thumbnails-strip {\r\n    display: flex;\r\n    gap: var(--space-2);\r\n    overflow-x: auto;\r\n    scroll-behavior: smooth;\r\n    padding: var(--space-1) 0;\r\n  }\r\n\r\n\r\n  .thumbnail {\r\n    position: relative;\r\n    flex-shrink: 0;\r\n    width: 64px;\r\n    height: 64px;\r\n    border-radius: var(--radius-lg);\r\n    border: 2px solid var(--border-subtle);\r\n    overflow: hidden;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n    background: var(--surface-base);\r\n  }\r\n\r\n  .thumbnail:hover {\r\n    border-color: var(--border-strong);\r\n    transform: scale(1.05);\r\n  }\r\n\r\n  .thumbnail-active {\r\n    border-color: var(--primary);\r\n    box-shadow: 0 0 0 1px var(--primary);\r\n  }\r\n\r\n  .thumbnail-image {\r\n    width: 100%;\r\n    height: 100%;\r\n    object-fit: cover;\r\n  }\r\n\r\n  .thumbnail-overlay {\r\n    position: absolute;\r\n    inset: 0;\r\n    background: transparent;\r\n    transition: background 0.2s;\r\n  }\r\n\r\n  .thumbnail:not(.thumbnail-active) .thumbnail-overlay {\r\n    background: color-mix(in oklch, var(--gray-900) 20%, transparent);\r\n  }\r\n\r\n  /* Fullscreen Modal */\r\n  .fullscreen-backdrop {\r\n    position: fixed;\r\n    inset: 0;\r\n    background: var(--gray-900);\r\n    z-index: 100;\r\n    cursor: pointer;\r\n    border: none;\r\n    padding: 0;\r\n  }\r\n\r\n  .fullscreen-content {\r\n    position: fixed;\r\n    inset: 0;\r\n    z-index: 101;\r\n    display: flex;\r\n    flex-direction: column;\r\n    outline: none;\r\n  }\r\n\r\n  .fullscreen-close {\r\n    position: absolute;\r\n    top: var(--space-4);\r\n    right: var(--space-4);\r\n    z-index: 102;\r\n    width: var(--touch-icon);\r\n    height: var(--touch-icon);\r\n    background: var(--gray-900);\r\n    color: var(--gray-0);\r\n    border: none;\r\n    border-radius: var(--radius-full);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n    backdrop-filter: blur(8px);\r\n  }\r\n\r\n  .fullscreen-close:hover {\r\n    background: var(--gray-800);\r\n    transform: scale(1.05);\r\n  }\r\n\r\n  .close-icon {\r\n    width: 20px;\r\n    height: 20px;\r\n  }\r\n\r\n  .fullscreen-image-container {\r\n    flex: 1;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    overflow: hidden;\r\n    touch-action: none;\r\n  }\r\n\r\n  .fullscreen-image {\r\n    max-width: 100%;\r\n    max-height: 100%;\r\n    object-fit: contain;\r\n    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\r\n    will-change: transform;\r\n  }\r\n\r\n  .fullscreen-controls {\r\n    position: absolute;\r\n    bottom: var(--space-6);\r\n    left: 50%;\r\n    transform: translateX(-50%);\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-4);\r\n    padding: var(--space-3) var(--space-6);\r\n    background: var(--gray-900);\r\n    color: var(--gray-0);\r\n    border-radius: var(--radius-full);\r\n    backdrop-filter: blur(8px);\r\n  }\r\n\r\n  .fullscreen-counter {\r\n    font-size: var(--font-size-sm);\r\n    font-weight: var(--font-weight-medium);\r\n  }\r\n\r\n  .fullscreen-nav {\r\n    display: flex;\r\n    gap: var(--space-2);\r\n  }\r\n\r\n  .fullscreen-nav-btn {\r\n    width: var(--touch-standard);\r\n    height: var(--touch-standard);\r\n    background: transparent;\r\n    border: 1px solid var(--gray-600);\r\n    border-radius: var(--radius-md);\r\n    color: var(--gray-0);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .fullscreen-nav-btn:hover:not(:disabled) {\r\n    background: var(--gray-800);\r\n    border-color: var(--gray-500);\r\n  }\r\n\r\n  .fullscreen-nav-btn:disabled {\r\n    opacity: 0.3;\r\n    cursor: not-allowed;\r\n  }\r\n\r\n  .nav-icon {\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n\r\n  .zoom-reset-btn {\r\n    padding: var(--space-2) var(--space-4);\r\n    background: transparent;\r\n    border: 1px solid var(--gray-600);\r\n    border-radius: var(--radius-md);\r\n    color: var(--gray-0);\r\n    font-size: var(--font-size-sm);\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .zoom-reset-btn:hover:not(:disabled) {\r\n    background: var(--gray-800);\r\n    border-color: var(--gray-500);\r\n  }\r\n\r\n  .zoom-reset-btn:disabled {\r\n    opacity: 0.3;\r\n    cursor: not-allowed;\r\n  }\r\n\r\n  /* Responsive Design */\r\n  @media (min-width: 640px) {\r\n    .main-image-container {\r\n      aspect-ratio: 3/4;\r\n    }\r\n\r\n    .thumbnail {\r\n      width: 80px;\r\n      height: 80px;\r\n    }\r\n\r\n    .nav-arrows {\r\n      display: block;\r\n    }\r\n\r\n    .main-image-wrapper:hover .nav-arrows {\r\n      opacity: 1;\r\n    }\r\n  }\r\n\r\n  @media (max-width: 480px) {\r\n    /* Tighter spacing on compact mobile to maximize image area */\r\n    .gallery-container {\r\n      gap: var(--space-2);\r\n    }\r\n\r\n    .thumbnails-container {\r\n      gap: var(--space-1);\r\n    }\r\n\r\n    .thumbnails-strip {\r\n      gap: var(--space-1);\r\n      padding: 0;\r\n    }\r\n\r\n    .thumbnail {\r\n      width: 56px;\r\n      height: 56px;\r\n    }\r\n\r\n    .fullscreen-controls {\r\n      bottom: var(--space-4);\r\n      padding: var(--space-2) var(--space-4);\r\n    }\r\n\r\n    .fullscreen-counter {\r\n      font-size: var(--font-size-xs);\r\n    }\r\n  }\r\n\r\n  /* On small screens, move badges out of overlay to page content */\r\n  @media (max-width: 640px) {\r\n    .condition-badge-container,\r\n    .sold-badge {\r\n      display: none;\r\n    }\r\n  }\r\n\r\n  /* High contrast support */\r\n  @media (prefers-contrast: high) {\r\n    .nav-arrow {\r\n      border-width: 2px;\r\n    }\r\n\r\n    .thumbnail {\r\n      border-width: 3px;\r\n    }\r\n  }\r\n\r\n  /* Reduced motion support */\r\n  @media (prefers-reduced-motion: reduce) {\r\n    .main-image,\r\n    .fullscreen-image,\r\n    .nav-arrow,\r\n    .thumbnail {\r\n      transition: none;\r\n    }\r\n  }\r\n</style>\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\ProductHighlight.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onBuy' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isLoadingFavorite' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sellerInitial' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":40,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5702,5705],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5702,5705],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5729,5732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5729,5732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":168,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5787,5790],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5787,5790],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  import type { Product } from '../../types/product';\n  import FavoriteButton from '../ui/FavoriteButton.svelte';\n  \n  interface Props {\n    product: Product;\n    onProductClick?: (product: Product) => void;\n    onBuy?: (productId: string, selectedSize?: string) => void;\n    onToggleFavorite?: (productId: string) => void;\n    isFavorite?: boolean;\n    isLoadingFavorite?: boolean;\n    currency?: string;\n    formatPrice?: (price: number) => string;\n    index?: number;\n    totalCount?: number;\n    categoryTranslation?: (category: string) => string;\n  }\n\n  let { \n    product, \n    onProductClick,\n    onBuy,\n    onToggleFavorite,\n    isFavorite = false,\n    isLoadingFavorite = false,\n    currency = '$', \n    formatPrice = (price: number) => `${currency}${price.toFixed(2)}`,\n    index = 0,\n    totalCount = 1,\n    categoryTranslation = (category: string) => category\n  }: Props = $props();\n  \n  // Derived states\n  const imageUrl = $derived(\n    (product.product_images && product.product_images[0]?.image_url) ||\n    product.images?.[0] ||\n    '/placeholder-product.svg'\n  );\n  \n  const sellerInitial = $derived(\n    (product.sellerName || 'S').charAt(0).toUpperCase()\n  );\n  \n  const formattedPrice = $derived(\n    formatPrice(product.price)\n  );\n  \n  function handleClick() {\n    onProductClick?.(product);\n  }\n  \n  function handleKeyDown(e: KeyboardEvent) {\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      handleClick();\n    }\n  }\n</script>\n\n<article \n  class=\"relative shrink-0 group\"\n  aria-label=\"Product: {product.title}\"\n>\n  <!-- Product Card -->\n  <div class=\"shrink-0\" style=\"width: calc(50vw - 8px);\"><!-- Exactly 2 cards visible, 3rd partially hidden -->\n    <!-- Main Card Container -->\n    <div class=\"product-card cursor-pointer w-full\">\n      \n      <!-- Main Product Button -->\n      <button \n        onclick={handleClick}\n        onkeydown={handleKeyDown}\n        class=\"absolute inset-0 w-full h-full focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-1 z-10 min-h-[44px]\"\n        aria-label=\"View {product.title} - {formattedPrice}\"\n        aria-describedby=\"product-{product.id}-info\"\n        tabindex={index === 0 ? 0 : -1}\n      >\n        <span class=\"sr-only\">View product details</span>\n      </button>\n      \n      <!-- Image Container with overlays -->\n      <div class=\"relative w-full\">\n        <!-- Product Image -->\n        <div class=\"aspect-square w-full overflow-hidden rounded-[var(--card-radius)]\" style=\"background-color: oklch(0.96 0.005 270);\">\n          <img\n            src={imageUrl}\n            alt=\"{product.title} product image\"\n            class=\"w-full h-full object-cover\"\n            loading=\"lazy\"\n            decoding=\"async\"\n          />\n        </div>\n        \n        <!-- Overlay row: subtle PRO badge and favorite (right) -->\n        <div class=\"absolute top-2 left-2 right-2 z-20 flex items-center justify-between\">\n          <div class=\"flex items-center gap-1.5\">\n            {#if product.is_featured}\n              <span class=\"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold uppercase tracking-wide shadow-sm backdrop-blur-sm bg-white/85 text-gray-900 border border-gray-200\">PRO</span>\n            {/if}\n          </div>\n          <div>\n            <FavoriteButton\n              {product}\n              favorited={isFavorite}\n              onFavorite={() => onToggleFavorite?.(product.id)}\n              absolute={false}\n              showCount={true}\n            />\n          </div>\n        </div>\n      </div>\n      \n      <!-- Content - EXACT copy from ProductCard -->\n      <div class=\"px-1 pt-1.5 pb-1.5 relative\">\n        \n        <!-- Main Category (always show) -->\n        <div class=\"flex items-center justify-between gap-1.5 min-h-3.5 mb-0.5 pr-12\">\n          {#if product.main_category_name || product.category_name}\n            <p class=\"text-xs font-medium text-gray-500 uppercase tracking-wider leading-none flex-1 truncate\">\n              {categoryTranslation(product.main_category_name || product.category_name || '')}\n            </p>\n          {/if}\n        </div>\n        \n        <!-- Title -->\n        <h3 class=\"text-sm font-medium text-gray-900 line-clamp-1 leading-none mb-0.5 pr-12\">\n          {product.title}\n        </h3>\n        \n        <!-- Subcategory • Brand • Size -->\n        {#if product.subcategory_name || product.brand || product.size}\n          <p class=\"text-xs text-gray-500 line-clamp-1 leading-none mb-1\">\n            {#if product.subcategory_name}\n              <span class=\"font-medium text-gray-500\">{categoryTranslation(product.subcategory_name)}</span>\n            {/if}\n            {#if product.subcategory_name && product.brand} • {/if}\n            {#if product.brand}\n              <span class=\"text-gray-500\">{product.brand}</span>\n            {/if}\n            {#if (product.subcategory_name || product.brand) && product.size} • {/if}\n            {#if product.size}\n              <span class=\"text-gray-500\">Size {product.size}</span>\n            {/if}\n          </p>\n        {/if}\n        \n        <!-- Price -->\n        <div class=\"-mt-0.5\">\n          <div class=\"text-base font-semibold text-gray-900 leading-none\">\n            {formattedPrice}\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n  <!-- Screen reader info -->\n  <div id=\"product-{product.id}-info\" class=\"sr-only\">\n    <p>Product {index + 1} of {totalCount}</p>\n    <p>Price: {formattedPrice}</p>\n    {#if product.sellerName}\n      <p>Sold by {product.sellerName}</p>\n    {/if}\n    {#if product.condition}\n      <p>Condition: {product.condition}</p>\n    {/if}\n    {#if Array.isArray((product as any).sizes) && (product as any).sizes.length}\n      <p>Available sizes: {(product as any).sizes.join(', ')}</p>\n    {/if}\n  </div>\n</article>\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\ProductImage.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\ProductInfo.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'i18n' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showFacts' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":38,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hasDescription' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":66,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":66,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import * as i18n from '@repo/i18n';\r\n  import Badge from '../badges/Badge.svelte';\r\n  import FavoriteButton from '../ui/FavoriteButton.svelte';\r\n  import ConditionBadge from '../badges/ConditionBadge.svelte';\r\n  import DescriptionList from '../description-list/DescriptionList.svelte';\r\n  import DescriptionTerm from '../description-list/DescriptionTerm.svelte';\r\n  import DescriptionDetails from '../description-list/DescriptionDetails.svelte';\r\n  import type { ProductInfoProps, ProductAttribute, TabConfiguration } from '../../types/panels';\r\n\r\n  type ConditionType = 'brand_new_with_tags' | 'new_without_tags' | 'like_new' | 'good' | 'worn' | 'fair';\r\n\r\n  function isValidCondition(condition: string): condition is ConditionType {\r\n    return ['brand_new_with_tags', 'new_without_tags', 'like_new', 'good', 'worn', 'fair'].includes(condition);\r\n  }\r\n\r\n  let {\r\n    title,\r\n    brand,\r\n    size,\r\n    color,\r\n    material,\r\n    condition,\r\n    description,\r\n    favoriteCount,\r\n    isFavorited,\r\n    onFavorite,\r\n    showQuickFacts = true,\r\n    category,\r\n    productId,\r\n    seller,\r\n    showSellerRow = false\r\n  }: ProductInfoProps = $props();\r\n\r\n  // State management\r\n  let activeTab = $state('shipping');\r\n  let showSizeGuide = $state(false);\r\n  let showFacts = $state(true);\r\n\r\n  // Computed properties\r\n  const attributes = $derived.by(() => {\r\n    const list: ProductAttribute[] = [];\r\n\r\n    if (condition) {\r\n      list.push({ key: 'condition', label: 'Condition', value: condition, type: 'badge' });\r\n    }\r\n    if (brand) {\r\n      list.push({ key: 'brand', label: 'Brand', value: brand, type: 'badge' });\r\n    }\r\n    if (size) {\r\n      list.push({ key: 'size', label: 'Size', value: size, type: 'text' });\r\n    }\r\n    if (color) {\r\n      list.push({ key: 'color', label: 'Color', value: color, type: 'text' });\r\n    }\r\n    if (material) {\r\n      list.push({ key: 'material', label: 'Material', value: material, type: 'text' });\r\n    }\r\n    if (category) {\r\n      list.push({ key: 'category', label: 'Category', value: category, type: 'text' });\r\n    }\r\n\r\n    return list;\r\n  });\r\n\r\n  const hasDescription = $derived(description && description.trim().length > 0);\r\n  const hasAttributes = $derived(showQuickFacts && attributes.length > 0);\r\n  const showSizeGuideButton = $derived.by(() => {\r\n    if (!category || !size) return false;\r\n    const normalized = category.toLowerCase();\r\n    return ['clothing', 'shoes', 'accessories'].some(cat => normalized.includes(cat));\r\n  });\r\n\r\n  // Seller info\r\n  const joinedYear = $derived(seller?.joinedAt ? new Date(seller.joinedAt).getFullYear() : null);\r\n  const sellerDisplayName = $derived(seller?.username ? `@${seller.username}` : null);\r\n\r\n  // Tab configuration (move description out of tabs into its own container)\r\n  const tabs = $derived.by(() => {\r\n    const base: TabConfiguration[] = [\r\n      { id: 'shipping', label: 'Shipping', count: 3, show: true },\r\n      { id: 'details', label: 'Details', count: attributes.length, show: hasAttributes },\r\n      { id: 'returns', label: 'Returns', count: 1, show: true }\r\n    ];\r\n\r\n    return base.filter(tab => tab.show);\r\n  });\r\n\r\n  function handleSizeGuide() {\r\n    showSizeGuide = true;\r\n    // In a real app, this would open a modal or navigate to size guide\r\n    \r\n  }\r\n\r\n  // Show details by default on all screens for now\r\n</script>\r\n\r\n<div class=\"product-info\">\r\n  <!-- Title inside summary card -->\r\n  <!-- Seller Info moved below description and attributes -->\r\n\r\n  <!-- Summary Card: Title + Description (single column) -->\r\n  <section class=\"summary-card\" aria-labelledby=\"summary-heading\">\r\n    <h2 id=\"summary-heading\" class=\"visually-hidden\">Product summary</h2>\r\n    {#if condition || brand || size}\r\n      <div class=\"meta-inline\" aria-label=\"Quick facts\">\r\n        {#if condition}\r\n          <ConditionBadge condition={condition} />\r\n        {/if}\r\n        {#if brand}\r\n          <span class=\"meta-sep\">•</span>\r\n          <Badge variant=\"secondary\" size=\"sm\">{brand}</Badge>\r\n        {/if}\r\n        {#if size}\r\n          <span class=\"meta-sep\">•</span>\r\n          <span class=\"meta-size\">Size {size}</span>\r\n        {/if}\r\n      </div>\r\n    {/if}\r\n\r\n    <h1 class=\"title\">{title}</h1>\r\n    {#if description && description.trim().length > 0}\r\n      <p class=\"summary-desc\">{description}</p>\r\n    {/if}\r\n\r\n    {#if !seller}\r\n      <div class=\"summary-actions\">\r\n        <FavoriteButton \r\n          product={{ favorite_count: favoriteCount, id: productId }}\r\n          favorited={isFavorited}\r\n          onFavorite={onFavorite}\r\n          absolute={false}\r\n        />\r\n      </div>\r\n    {/if}\r\n  </section>\r\n\r\n  <!-- Facts Card: Condition, Size, Color, Brand, Material, Category -->\r\n  {#if attributes.length > 0}\r\n    <section class=\"facts-card\" aria-labelledby=\"facts-heading\">\r\n      <h2 id=\"facts-heading\" class=\"visually-hidden\">Product details</h2>\r\n      <DescriptionList>\r\n        {#each attributes as attr}\r\n          <DescriptionTerm>{attr.label}</DescriptionTerm>\r\n          <DescriptionDetails>\r\n            {#if attr.key === 'condition' && isValidCondition(attr.value)}\r\n              <ConditionBadge condition={attr.value} />\r\n            {:else}\r\n              {attr.value}\r\n            {/if}\r\n          </DescriptionDetails>\r\n        {/each}\r\n      </DescriptionList>\r\n    </section>\r\n  {/if}\r\n\r\n  <!-- Seller Info (optional; disabled by default to avoid duplication) -->\r\n  {#if showSellerRow && seller}\r\n    <div class=\"seller-row seller-card\">\r\n      <div class=\"seller-info\">\r\n        <div class=\"seller-avatar\">\r\n          {#if seller.avatar}\r\n            <img src={seller.avatar} alt={seller.username} class=\"avatar-image\" />\r\n          {:else}\r\n            <div class=\"avatar-placeholder\">\r\n              <svg viewBox=\"0 0 20 20\" class=\"avatar-icon\">\r\n                <path fill=\"currentColor\" d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\"/>\r\n              </svg>\r\n            </div>\r\n          {/if}\r\n        </div>\r\n        <div class=\"seller-details\">\r\n          <div class=\"seller-name\">{sellerDisplayName}</div>\r\n          {#if joinedYear}\r\n            <div class=\"seller-joined\">Joined {joinedYear}</div>\r\n          {/if}\r\n        </div>\r\n      </div>\r\n      <FavoriteButton \r\n        product={{ favorite_count: favoriteCount, id: productId }}\r\n        favorited={isFavorited}\r\n        onFavorite={onFavorite}\r\n        absolute={false}\r\n      />\r\n    </div>\r\n  {/if}\r\n\r\n  <!-- Tab Navigation -->\r\n  {#if tabs.length > 0}\r\n    <div class=\"tabs-section\">\r\n      <div class=\"tab-nav\" role=\"tablist\">\r\n        {#each tabs as tab}\r\n          <button \r\n            class=\"tab-button\"\r\n            class:tab-button--active={activeTab === tab.id}\r\n            onclick={() => activeTab = tab.id}\r\n            role=\"tab\"\r\n            aria-selected={activeTab === tab.id}\r\n            aria-controls=\"panel-{tab.id}\"\r\n            id=\"tab-{tab.id}\"\r\n          >\r\n            <span class=\"tab-label\">{tab.label}</span>\r\n            {#if tab.count > 0}\r\n              <Badge variant=\"subtle\" size=\"xs\" class=\"tab-count\">{tab.count}</Badge>\r\n            {/if}\r\n          </button>\r\n        {/each}\r\n      </div>\r\n\r\n      <div class=\"tab-content\">\r\n        <!-- Details Panel -->\r\n        {#if activeTab === 'details' && hasAttributes}\r\n          <div \r\n            class=\"tab-panel\"\r\n            id=\"panel-details\"\r\n            role=\"tabpanel\"\r\n            aria-labelledby=\"tab-details\"\r\n          >\r\n            <div class=\"details-content\">\r\n              <div class=\"details-list\">\r\n                {#each attributes as attr}\r\n                  <div class=\"detail-row\">\r\n                    <span class=\"detail-label\">{attr.label}</span>\r\n                    <span class=\"detail-value\">{attr.value}</span>\r\n                  </div>\r\n                {/each}\r\n              </div>\r\n              \r\n              {#if showSizeGuideButton}\r\n                <button class=\"size-guide-button\" onclick={handleSizeGuide}>\r\n                  <svg viewBox=\"0 0 20 20\" class=\"size-guide-icon\">\r\n                    <path fill=\"currentColor\" d=\"M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a1 1 0 011-1h14a1 1 0 110 2H3a1 1 0 01-1-1zM2 15a1 1 0 011-1h14a1 1 0 110 2H3a1 1 0 01-1-1z\"/>\r\n                  </svg>\r\n                  <span>Size Guide</span>\r\n                  <svg viewBox=\"0 0 20 20\" class=\"external-icon\">\r\n                    <path fill=\"currentColor\" d=\"M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z\"/>\r\n                    <path fill=\"currentColor\" d=\"M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z\"/>\r\n                  </svg>\r\n                </button>\r\n              {/if}\r\n            </div>\r\n          </div>\r\n        {/if}\r\n\r\n        <!-- Description panel removed: description is shown in its own card above -->\r\n\r\n        <!-- Shipping Panel -->\r\n        {#if activeTab === 'shipping'}\r\n          <div \r\n            class=\"tab-panel\"\r\n            id=\"panel-shipping\"\r\n            role=\"tabpanel\"\r\n            aria-labelledby=\"tab-shipping\"\r\n          >\r\n            <div class=\"shipping-content\">\r\n              <div class=\"shipping-options\">\r\n                <div class=\"shipping-option\">\r\n                  <div class=\"shipping-icon\">\r\n                    <svg viewBox=\"0 0 20 20\">\r\n                      <path fill=\"currentColor\" d=\"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z\"/>\r\n                      <path fill=\"currentColor\" d=\"M3 4a1 1 0 00-1 1v1a1 1 0 001 1h1a1 1 0 001-1V5a1 1 0 00-1-1H3zM6 4a1 1 0 011-1h8a1 1 0 011 1v5H6V4z\"/>\r\n                      <path fill=\"currentColor\" d=\"M16 10h1a1 1 0 011 1v3a1 1 0 01-1 1h-1v-5zM1 10h2v5H2a1 1 0 01-1-1v-3a1 1 0 011-1z\"/>\r\n                    </svg>\r\n                  </div>\r\n                  <div class=\"shipping-details\">\r\n                    <div class=\"shipping-title\">Free Standard Shipping</div>\r\n                    <div class=\"shipping-desc\">Orders over €50 • 3-5 business days</div>\r\n                  </div>\r\n                  <div class=\"shipping-price\">Free</div>\r\n                </div>\r\n\r\n                <div class=\"shipping-option\">\r\n                  <div class=\"shipping-icon\">\r\n                    <svg viewBox=\"0 0 20 20\">\r\n                      <path fill=\"currentColor\" d=\"M13 7H7v6h6V7z\"/>\r\n                      <path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M7 2a1 1 0 012 0v1h2V2a1 1 0 112 0v1h2a2 2 0 012 2v2H3V5a2 2 0 012-2h2V2zM3 9v6a2 2 0 002 2h10a2 2 0 002-2V9H3z\" clip-rule=\"evenodd\"/>\r\n                    </svg>\r\n                  </div>\r\n                  <div class=\"shipping-details\">\r\n                    <div class=\"shipping-title\">Express Delivery</div>\r\n                    <div class=\"shipping-desc\">Next business day • Order before 2 PM</div>\r\n                  </div>\r\n                  <div class=\"shipping-price\">€9.99</div>\r\n                </div>\r\n\r\n                <div class=\"shipping-option\">\r\n                  <div class=\"shipping-icon\">\r\n                    <svg viewBox=\"0 0 20 20\">\r\n                      <path fill=\"currentColor\" d=\"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z\"/>\r\n                      <path fill=\"currentColor\" d=\"M9 12l2 2 4-4\"/>\r\n                    </svg>\r\n                  </div>\r\n                  <div class=\"shipping-details\">\r\n                    <div class=\"shipping-title\">30-Day Returns</div>\r\n                    <div class=\"shipping-desc\">Free returns & exchanges</div>\r\n                  </div>\r\n                  <div class=\"shipping-badge\">\r\n                    <Badge variant=\"success\" size=\"xs\">Included</Badge>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"shipping-note\">\r\n                <svg viewBox=\"0 0 20 20\" class=\"note-icon\">\r\n                  <path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clip-rule=\"evenodd\"/>\r\n                </svg>\r\n                <p class=\"note-text\">\r\n                  All items are shipped securely with tracking information. \r\n                  Delivery times may vary based on location and availability.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        {/if}\r\n      </div>\r\n    </div>\r\n  {/if}\r\n</div>\r\n\r\n<!-- Size Guide Modal (placeholder) -->\r\n{#if showSizeGuide}\r\n  <div\r\n    class=\"modal-backdrop\"\r\n    onclick={(e) => e.target === e.currentTarget && (showSizeGuide = false)}\r\n    role=\"presentation\"\r\n  >\r\n    <div\r\n      class=\"modal-content\"\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      aria-labelledby=\"size-guide-title\"\r\n      tabindex=\"-1\"\r\n    >\r\n      <div class=\"modal-header\">\r\n        <h2 id=\"size-guide-title\" class=\"modal-title\">Size Guide</h2>\r\n        <button class=\"modal-close\" onclick={() => showSizeGuide = false} type=\"button\" aria-label=\"Close size guide\">\r\n          <svg viewBox=\"0 0 20 20\" aria-hidden=\"true\">\r\n            <path fill=\"currentColor\" d=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"/>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n        <p>Size guide content would go here for {category} items.</p>\r\n        <p>Selected size: {size}</p>\r\n      </div>\r\n    </div>\r\n  </div>\r\n{/if}\r\n\r\n<style>\r\n  .product-info {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-4);\r\n  }\r\n\r\n  .title {\r\n    font-size: var(--font-size-lg);\r\n    font-weight: var(--font-weight-semibold);\r\n    line-height: var(--line-height-tight);\r\n    color: var(--text-strong);\r\n    margin: 0;\r\n    flex: 1;\r\n  }\r\n\r\n\r\n  /* Seller Row - Beautiful Styling */\r\n  .seller-row {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    gap: var(--space-4);\r\n    padding: var(--space-3) var(--space-4);\r\n    background: var(--surface-subtle);\r\n    border: 1px solid var(--border-subtle);\r\n    border-radius: var(--radius-lg);\r\n    transition: all 0.2s ease;\r\n  }\r\n\r\n  .seller-row:hover {\r\n    border-color: var(--border-strong);\r\n  }\r\n\r\n  .seller-info {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-3);\r\n    flex: 1;\r\n    min-width: 0;\r\n  }\r\n\r\n  .seller-avatar {\r\n    width: 40px;\r\n    height: 40px;\r\n    border-radius: var(--radius-full);\r\n    overflow: hidden;\r\n    flex-shrink: 0;\r\n    box-shadow: 0 2px 8px color-mix(in oklch, var(--shadow) 12%, transparent);\r\n    border: 2px solid var(--surface-base);\r\n    transition: transform 0.2s ease;\r\n  }\r\n\r\n  .seller-avatar:hover {\r\n    transform: scale(1.05);\r\n  }\r\n\r\n  .avatar-image {\r\n    width: 100%;\r\n    height: 100%;\r\n    object-fit: cover;\r\n  }\r\n\r\n  .avatar-placeholder {\r\n    width: 100%;\r\n    height: 100%;\r\n    background: linear-gradient(135deg, var(--primary) 0%, color-mix(in oklch, var(--primary) 80%, var(--secondary)) 100%);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    color: var(--primary-fg);\r\n  }\r\n\r\n  .avatar-icon {\r\n    width: 20px;\r\n    height: 20px;\r\n  }\r\n\r\n  .seller-details {\r\n    flex: 1;\r\n    min-width: 0;\r\n  }\r\n\r\n  .seller-name {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-1-5);\r\n    font-size: var(--font-size-sm);\r\n    font-weight: var(--font-weight-medium);\r\n    color: var(--text-strong);\r\n    margin-bottom: var(--space-0-5);\r\n    line-height: 1.3;\r\n  }\r\n\r\n\r\n  .seller-joined {\r\n    font-size: var(--font-size-xs);\r\n    color: var(--text-subtle);\r\n    font-weight: var(--font-weight-normal);\r\n  }\r\n\r\n\r\n\r\n  .summary-actions { margin-top: var(--space-3); }\r\n\r\n  /* Summary (title + description) */\r\n  .summary-card {\r\n    background: var(--surface-base);\r\n    border: 1px solid var(--border-subtle);\r\n    border-radius: var(--radius-xl);\r\n    padding: var(--space-4);\r\n  }\r\n  .summary-card .title { margin: 0 0 var(--space-2) 0; color: var(--text-strong); }\r\n  .summary-desc {\r\n    margin: 0;\r\n    font-size: var(--font-size-sm);\r\n    line-height: var(--line-height-relaxed);\r\n    color: var(--text-base);\r\n    font-weight: var(--font-weight-normal);\r\n  }\r\n\r\n  .meta-inline {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-2);\r\n    flex-wrap: wrap;\r\n    margin-bottom: var(--space-2);\r\n  }\r\n  .meta-sep { color: var(--text-subtle); }\r\n  .meta-size { font-size: var(--font-size-sm); color: var(--text-strong); }\r\n\r\n  .visually-hidden {\r\n    position: absolute !important;\r\n    height: 1px; width: 1px;\r\n    overflow: hidden;\r\n    clip: rect(1px, 1px, 1px, 1px);\r\n    white-space: nowrap;\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n  /* Removed separate desc-card: description now in summary-card */\r\n\r\n  .facts-card {\r\n    background: var(--surface-base);\r\n    border: 1px solid var(--border-subtle);\r\n    border-radius: var(--radius-xl);\r\n    padding: var(--space-5);\r\n  }\r\n  /* facts use DescriptionList with Tailwind utilities */\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  /* Tabs Section */\r\n  .tabs-section {\r\n    background: var(--surface-base);\r\n    border: 1px solid var(--border-subtle);\r\n    border-radius: var(--radius-xl);\r\n    overflow: hidden;\r\n  }\r\n\r\n  .tab-nav {\r\n    display: flex;\r\n    background: var(--surface-subtle);\r\n    border-bottom: 1px solid var(--border-subtle);\r\n    overflow-x: auto;\r\n  }\r\n\r\n\r\n  .tab-button {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-2);\r\n    padding: var(--space-3) var(--space-4);\r\n    background: transparent;\r\n    border: none;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n    color: var(--text-subtle);\r\n    font-weight: var(--font-weight-medium);\r\n    white-space: nowrap;\r\n    position: relative;\r\n    min-height: var(--touch-standard);\r\n  }\r\n\r\n  .tab-button:hover {\r\n    color: var(--text-strong);\r\n    background: var(--surface-hover);\r\n  }\r\n\r\n  .tab-button--active {\r\n    color: var(--primary);\r\n    background: var(--surface-base);\r\n  }\r\n\r\n  .tab-button--active::after {\r\n    content: '';\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 0;\r\n    right: 0;\r\n    height: 2px;\r\n    background: var(--primary);\r\n  }\r\n\r\n  .tab-label {\r\n    font-size: var(--font-size-sm);\r\n  }\r\n\r\n\r\n  .tab-content {\r\n    padding: var(--space-4);\r\n  }\r\n\r\n  .tab-panel {\r\n    animation: fadeIn 0.2s ease-out;\r\n  }\r\n\r\n  @keyframes fadeIn {\r\n    from { opacity: 0; transform: translateY(8px); }\r\n    to { opacity: 1; transform: translateY(0); }\r\n  }\r\n\r\n  /* Details Content */\r\n  .details-content {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-4);\r\n  }\r\n\r\n  .details-list {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-3);\r\n  }\r\n\r\n  .detail-row {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    padding: var(--space-2) 0;\r\n    border-bottom: 1px solid var(--border-subtle);\r\n  }\r\n\r\n  .detail-row:last-child {\r\n    border-bottom: none;\r\n    padding-bottom: 0;\r\n  }\r\n\r\n  .detail-label {\r\n    color: var(--text-subtle);\r\n    font-weight: var(--font-weight-medium);\r\n    font-size: var(--font-size-sm);\r\n  }\r\n\r\n  .detail-value {\r\n    color: var(--text-strong);\r\n    font-weight: var(--font-weight-semibold);\r\n    font-size: var(--font-size-sm);\r\n  }\r\n\r\n  .size-guide-button {\r\n    display: inline-flex;\r\n    align-items: center;\r\n    gap: var(--space-2);\r\n    padding: var(--space-2) var(--space-3);\r\n    background: var(--surface-subtle);\r\n    border: 1px solid var(--border-subtle);\r\n    border-radius: var(--radius-lg);\r\n    color: var(--text-strong);\r\n    font-size: var(--font-size-sm);\r\n    font-weight: var(--font-weight-medium);\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .size-guide-button:hover {\r\n    background: var(--surface-hover);\r\n    border-color: var(--border-strong);\r\n    color: var(--primary);\r\n  }\r\n\r\n  .size-guide-icon,\r\n  .external-icon {\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n\r\n\r\n\r\n  /* Shipping Content */\r\n  .shipping-content {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-4);\r\n  }\r\n\r\n  .shipping-options {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-3);\r\n  }\r\n\r\n  .shipping-option {\r\n    display: flex;\r\n    align-items: flex-start;\r\n    gap: var(--space-3);\r\n    padding: var(--space-3);\r\n    background: var(--surface-subtle);\r\n    border-radius: var(--radius-lg);\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .shipping-option:hover {\r\n    background: var(--surface-hover);\r\n  }\r\n\r\n  .shipping-icon {\r\n    width: var(--space-8);\r\n    height: var(--space-8);\r\n    background: var(--primary);\r\n    border-radius: var(--radius-md);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    flex-shrink: 0;\r\n  }\r\n\r\n  .shipping-icon svg {\r\n    width: 18px;\r\n    height: 18px;\r\n    color: var(--primary-fg);\r\n  }\r\n\r\n  .shipping-details {\r\n    flex: 1;\r\n    min-width: 0;\r\n  }\r\n\r\n  .shipping-title {\r\n    font-weight: var(--font-weight-semibold);\r\n    color: var(--text-strong);\r\n    font-size: var(--font-size-sm);\r\n    margin-bottom: var(--space-1);\r\n  }\r\n\r\n  .shipping-desc {\r\n    color: var(--text-subtle);\r\n    font-size: var(--font-size-xs);\r\n    line-height: var(--line-height-relaxed);\r\n  }\r\n\r\n  .shipping-price {\r\n    font-weight: var(--font-weight-bold);\r\n    color: var(--success);\r\n    font-size: var(--font-size-sm);\r\n    align-self: center;\r\n  }\r\n\r\n  .shipping-badge {\r\n    align-self: center;\r\n  }\r\n\r\n  .shipping-note {\r\n    display: flex;\r\n    gap: var(--space-2);\r\n    padding: var(--space-3);\r\n    background: var(--surface-subtle);\r\n    border-radius: var(--radius-lg);\r\n    border: 1px solid var(--border-subtle);\r\n  }\r\n\r\n  .note-icon {\r\n    width: 18px;\r\n    height: 18px;\r\n    color: var(--text-subtle);\r\n    flex-shrink: 0;\r\n    margin-top: 2px;\r\n  }\r\n\r\n  .note-text {\r\n    margin: 0;\r\n    font-size: var(--font-size-xs);\r\n    color: var(--text-subtle);\r\n    line-height: var(--line-height-relaxed);\r\n  }\r\n\r\n  /* Modal Styles */\r\n  .modal-backdrop {\r\n    position: fixed;\r\n    inset: 0;\r\n    background: color-mix(in oklch, var(--gray-900) 50%, transparent);\r\n    z-index: 100;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    padding: var(--space-4);\r\n    border: none;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .modal-content {\r\n    background: var(--surface-base);\r\n    border-radius: var(--radius-xl);\r\n    border: 1px solid var(--border-subtle);\r\n    box-shadow: var(--shadow-2xl);\r\n    max-width: 500px;\r\n    width: 100%;\r\n    max-height: 80vh;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .modal-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    padding: var(--space-4) var(--space-5);\r\n    border-bottom: 1px solid var(--border-subtle);\r\n  }\r\n\r\n  .modal-title {\r\n    font-size: var(--font-size-lg);\r\n    font-weight: var(--font-weight-semibold);\r\n    color: var(--text-strong);\r\n    margin: 0;\r\n  }\r\n\r\n  .modal-close {\r\n    width: var(--touch-standard);\r\n    height: var(--touch-standard);\r\n    background: none;\r\n    border: none;\r\n    border-radius: var(--radius-md);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n    color: var(--text-subtle);\r\n  }\r\n\r\n  .modal-close:hover {\r\n    background: var(--surface-hover);\r\n    color: var(--text-strong);\r\n  }\r\n\r\n  .modal-close svg {\r\n    width: 18px;\r\n    height: 18px;\r\n  }\r\n\r\n  .modal-body {\r\n    padding: var(--space-5);\r\n    color: var(--text-base);\r\n    line-height: var(--line-height-relaxed);\r\n  }\r\n\r\n  /* Responsive Design */\r\n  @media (max-width: 768px) {\r\n\r\n    .seller-row {\r\n      gap: var(--space-3);\r\n    }\r\n\r\n    .seller-avatar {\r\n      width: var(--space-7);\r\n      height: var(--space-7);\r\n    }\r\n\r\n    .seller-name {\r\n      font-size: var(--font-size-xs);\r\n    }\r\n\r\n    .seller-joined {\r\n      font-size: var(--font-size-xs);\r\n    }\r\n\r\n\r\n    .summary-card { padding: var(--space-4); }\r\n    \r\n    \r\n    .tab-nav {\r\n      padding: 0 var(--space-2);\r\n    }\r\n    \r\n    .tab-button {\r\n      padding: var(--space-2) var(--space-3);\r\n    }\r\n    \r\n    .tab-content {\r\n      padding: var(--space-3);\r\n    }\r\n\r\n    .shipping-option {\r\n      flex-direction: column;\r\n      text-align: center;\r\n      gap: var(--space-2);\r\n    }\r\n\r\n    .shipping-icon {\r\n      align-self: center;\r\n    }\r\n  }\r\n\r\n  /* Small Mobile: tighten rhythm further */\r\n  @media (max-width: 480px) {\r\n    .product-info { gap: var(--space-3); }\r\n    .summary-card,\r\n    .facts-card { padding: var(--space-3); }\r\n  }\r\n\r\n  /* Reduced motion support */\r\n  @media (prefers-reduced-motion: reduce) {\r\n    .tab-panel {\r\n      animation: none;\r\n    }\r\n    \r\n    .tab-button,\r\n    .shipping-option,\r\n    .size-guide-button {\r\n      transition: none;\r\n    }\r\n  }\r\n</style>\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\ProductMeta.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\ProductPrice.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\ProductReviews.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[70,73],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[70,73],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'productId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":44,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sellerId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":45,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":52,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hasImages' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":66,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":66,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":151,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":151,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import * as i18n from '@repo/i18n';\r\n  const m: any = i18n;\r\n  import Avatar from '../ui/Avatar.svelte';\r\n  import Badge from '../badges/Badge.svelte';\r\n  // No lifecycle imports needed - using $effect\r\n\r\n  interface Review {\r\n    id: string;\r\n    rating: number;\r\n    comment: string;\r\n    createdAt: string;\r\n    reviewer: {\r\n      username: string;\r\n      avatar?: string;\r\n      verified?: boolean;\r\n    };\r\n    helpful?: boolean;\r\n    helpfulCount?: number;\r\n    images?: string[];\r\n  }\r\n\r\n  interface ReviewSummary {\r\n    averageRating: number;\r\n    totalReviews: number;\r\n    breakdown: Record<number, number>;\r\n  }\r\n\r\n  interface Props {\r\n    productId: string;\r\n    sellerId: string;\r\n    reviews?: Review[];\r\n    summary?: ReviewSummary;\r\n    canReview?: boolean;\r\n    onWriteReview?: () => void;\r\n    onLoadMore?: () => Promise<Review[]>;\r\n    className?: string;\r\n    loading?: boolean;\r\n    hasMore?: boolean;\r\n    variant?: 'default' | 'compact';\r\n  }\r\n\r\n  let { \r\n    productId,\r\n    sellerId,\r\n    reviews = [],\r\n    summary,\r\n    canReview = false,\r\n    onWriteReview,\r\n    onLoadMore,\r\n    className = '',\r\n    loading = false,\r\n    hasMore = false,\r\n    variant = 'default'\r\n  }: Props = $props();\r\n\r\n  // State management\r\n  let expandedReviews = $state(new Set<string>());\r\n  let sortBy = $state<'recent' | 'helpful' | 'rating'>('recent');\r\n  let filterRating = $state<number | null>(null);\r\n  let selectedImageModal = $state<{ images: string[], index: number } | null>(null);\r\n  let isLoadingMore = $state(false);\r\n\r\n  // Computed properties\r\n  const hasReviews = $derived(reviews.length > 0);\r\n  const hasImages = $derived(reviews.some(review => review.images && review.images.length > 0));\r\n\r\n  const sortedAndFilteredReviews = $derived(() => {\r\n    let filtered = reviews;\r\n\r\n    // Filter by rating if selected\r\n    if (filterRating !== null) {\r\n      filtered = filtered.filter(review => review.rating === filterRating);\r\n    }\r\n\r\n    // Sort reviews\r\n    const sorted = [...filtered].sort((a, b) => {\r\n      switch (sortBy) {\r\n        case 'helpful':\r\n          return (b.helpfulCount || 0) - (a.helpfulCount || 0);\r\n        case 'rating':\r\n          return b.rating - a.rating;\r\n        case 'recent':\r\n        default:\r\n          return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();\r\n      }\r\n    });\r\n\r\n    return sorted;\r\n  });\r\n\r\n  // Generate star array for rating display\r\n  function generateStars(rating: number) {\r\n    const stars = [];\r\n    const fullStars = Math.floor(rating);\r\n    const hasHalfStar = rating % 1 >= 0.5;\r\n    \r\n    for (let i = 0; i < 5; i++) {\r\n      if (i < fullStars) {\r\n        stars.push('full');\r\n      } else if (i === fullStars && hasHalfStar) {\r\n        stars.push('half');\r\n      } else {\r\n        stars.push('empty');\r\n      }\r\n    }\r\n    \r\n    return stars;\r\n  }\r\n\r\n  function formatTimeAgo(dateString: string) {\r\n    const date = new Date(dateString);\r\n    const now = new Date();\r\n    const diffInDays = Math.floor((now.getTime() - date.getTime()) / (1000 * 60 * 60 * 24));\r\n    \r\n    if (diffInDays === 0) return m.reviews_today?.() || 'Today';\r\n    if (diffInDays === 1) return m.reviews_yesterday?.() || 'Yesterday';\r\n    if (diffInDays < 7) return `${diffInDays} days ago`;\r\n    if (diffInDays < 30) return `${Math.floor(diffInDays / 7)} weeks ago`;\r\n    if (diffInDays < 365) return `${Math.floor(diffInDays / 30)} months ago`;\r\n    return `${Math.floor(diffInDays / 365)} years ago`;\r\n  }\r\n\r\n  function getProgressWidth(count: number, total: number) {\r\n    return total > 0 ? (count / total) * 100 : 0;\r\n  }\r\n\r\n  function toggleReviewExpansion(reviewId: string) {\r\n    if (expandedReviews.has(reviewId)) {\r\n      expandedReviews.delete(reviewId);\r\n    } else {\r\n      expandedReviews.add(reviewId);\r\n    }\r\n    expandedReviews = new Set(expandedReviews);\r\n  }\r\n\r\n  function openImageModal(images: string[], index: number) {\r\n    selectedImageModal = { images, index };\r\n  }\r\n\r\n  function closeImageModal() {\r\n    selectedImageModal = null;\r\n  }\r\n\r\n  async function handleLoadMore() {\r\n    if (!onLoadMore || isLoadingMore || !hasMore) return;\r\n    \r\n    try {\r\n      isLoadingMore = true;\r\n      await onLoadMore();\r\n    } catch (error) {\r\n      \r\n    } finally {\r\n      isLoadingMore = false;\r\n    }\r\n  }\r\n\r\n  // Keyboard handler for image modal\r\n  function handleKeydown(e: KeyboardEvent) {\r\n    if (!selectedImageModal) return;\r\n\r\n    switch (e.key) {\r\n      case 'Escape':\r\n        closeImageModal();\r\n        break;\r\n      case 'ArrowLeft':\r\n        if (selectedImageModal.index > 0) {\r\n          selectedImageModal = {\r\n            ...selectedImageModal,\r\n            index: selectedImageModal.index - 1\r\n          };\r\n        }\r\n        break;\r\n      case 'ArrowRight':\r\n        if (selectedImageModal.index < selectedImageModal.images.length - 1) {\r\n          selectedImageModal = {\r\n            ...selectedImageModal,\r\n            index: selectedImageModal.index + 1\r\n          };\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  $effect(() => {\r\n    document.addEventListener('keydown', handleKeydown);\r\n    return () => {\r\n      document.removeEventListener('keydown', handleKeydown);\r\n    };\r\n  });\r\n</script>\r\n\r\n<div class=\"reviews-container reviews--{variant} {className}\">\r\n  {#if summary && hasReviews}\r\n    <!-- Reviews Summary -->\r\n    <div class=\"reviews-summary\">\r\n      <div class=\"summary-header\">\r\n        <h3 class=\"section-title\">Customer Reviews</h3>\r\n        {#if canReview}\r\n          <button class=\"write-review-btn\" onclick={onWriteReview}>\r\n            <svg class=\"btn-icon\" viewBox=\"0 0 20 20\">\r\n              <path fill=\"currentColor\" d=\"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z\"/>\r\n            </svg>\r\n            Write Review\r\n          </button>\r\n        {/if}\r\n      </div>\r\n\r\n      <div class=\"summary-content\">\r\n        <div class=\"rating-overview\">\r\n          <div class=\"average-rating\">\r\n            <span class=\"rating-number\">{summary.averageRating.toFixed(1)}</span>\r\n            <div class=\"rating-stars large\">\r\n              {#each generateStars(summary.averageRating) as star}\r\n                <svg class=\"star star--{star}\" viewBox=\"0 0 20 20\">\r\n                  {#if star === 'full'}\r\n                    <path fill=\"currentColor\" d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/>\r\n                  {:else if star === 'half'}\r\n                    <defs>\r\n                      <linearGradient id=\"half-star-summary\">\r\n                        <stop offset=\"50%\" stop-color=\"currentColor\"/>\r\n                        <stop offset=\"50%\" stop-color=\"transparent\"/>\r\n                      </linearGradient>\r\n                    </defs>\r\n                    <path fill=\"url(#half-star-summary)\" d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/>\r\n                  {:else}\r\n                    <path fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\" d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/>\r\n                  {/if}\r\n                </svg>\r\n              {/each}\r\n            </div>\r\n            <span class=\"review-count\">{summary.totalReviews} review{summary.totalReviews !== 1 ? 's' : ''}</span>\r\n          </div>\r\n\r\n          <div class=\"rating-breakdown\">\r\n            {#each [5, 4, 3, 2, 1] as rating}\r\n              <button\r\n                class=\"breakdown-row\"\r\n                class:breakdown-row--active={filterRating === rating}\r\n                onclick={() => filterRating = filterRating === rating ? null : rating}\r\n                type=\"button\"\r\n                aria-label={filterRating === rating ? `Clear ${rating} star filter` : `Filter by ${rating} star reviews`}\r\n              >\r\n                <span class=\"rating-label\">{rating} star{rating !== 1 ? 's' : ''}</span>\r\n                <div class=\"progress-bar\">\r\n                  <div\r\n                    class=\"progress-fill\"\r\n                    style=\"width: {getProgressWidth(summary.breakdown[rating], summary.totalReviews)}%\"\r\n                ></div>\r\n                </div>\r\n                <span class=\"count-label\">{summary.breakdown[rating]}</span>\r\n              </button>\r\n            {/each}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  {/if}\r\n\r\n  <!-- Controls -->\r\n  {#if hasReviews}\r\n    <div class=\"reviews-controls\">\r\n      <div class=\"control-group\">\r\n        <label class=\"control-label\" for=\"sort-select\">Sort by:</label>\r\n        <select \r\n          id=\"sort-select\"\r\n          class=\"sort-select\"\r\n          bind:value={sortBy}\r\n        >\r\n          <option value=\"recent\">Most recent</option>\r\n          <option value=\"helpful\">Most helpful</option>\r\n          <option value=\"rating\">Highest rated</option>\r\n        </select>\r\n      </div>\r\n\r\n      {#if filterRating !== null}\r\n        <button \r\n          class=\"clear-filter-btn\"\r\n          onclick={() => filterRating = null}\r\n        >\r\n          <svg class=\"clear-icon\" viewBox=\"0 0 20 20\">\r\n            <path fill=\"currentColor\" d=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"/>\r\n          </svg>\r\n          Clear {filterRating}-star filter\r\n        </button>\r\n      {/if}\r\n    </div>\r\n\r\n    <!-- Reviews List -->\r\n    <div class=\"reviews-list\">\r\n      {#each sortedAndFilteredReviews() as review (review.id)}\r\n        <article class=\"review-card\">\r\n          <div class=\"review-header\">\r\n            <div class=\"reviewer-info\">\r\n              <Avatar \r\n                src={review.reviewer.avatar} \r\n                alt={`${review.reviewer.username}'s avatar`}\r\n                size=\"sm\"\r\n              />\r\n              <div class=\"reviewer-details\">\r\n                <div class=\"reviewer-name-row\">\r\n                  <span class=\"reviewer-name\">{review.reviewer.username}</span>\r\n                  {#if review.reviewer.verified}\r\n                    <Badge variant=\"success\" size=\"sm\">\r\n                      <svg class=\"verified-icon\" viewBox=\"0 0 16 16\">\r\n                        <path fill=\"currentColor\" d=\"M16 8A8 8 0 11-1.83e-06 8 8 8 0 0116 8zm-3.97-3.03a.75.75 0 00-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 00-1.06 1.061L6.97 11.03a.75.75 0 001.079-.02l3.992-4.99a.75.75 0 00-.01-1.05z\"/>\r\n                      </svg>\r\n                      Verified\r\n                    </Badge>\r\n                  {/if}\r\n                </div>\r\n                \r\n                <div class=\"review-meta\">\r\n                  <div class=\"rating-stars small\">\r\n                    {#each generateStars(review.rating) as star}\r\n                      <svg class=\"star star--{star}\" viewBox=\"0 0 20 20\">\r\n                        {#if star === 'full'}\r\n                          <path fill=\"currentColor\" d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/>\r\n                        {:else}\r\n                          <path fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\" d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/>\r\n                        {/if}\r\n                      </svg>\r\n                    {/each}\r\n                  </div>\r\n                  <span class=\"review-date\">{formatTimeAgo(review.createdAt)}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"review-content\">\r\n            <!-- Review Text -->\r\n            <div class=\"review-text-container\">\r\n              <p \r\n                class=\"review-text\"\r\n                class:review-text--expanded={expandedReviews.has(review.id)}\r\n              >\r\n                {review.comment}\r\n              </p>\r\n              \r\n              {#if review.comment.length > 200}\r\n                <button \r\n                  class=\"expand-btn\"\r\n                  onclick={() => toggleReviewExpansion(review.id)}\r\n                >\r\n                  {expandedReviews.has(review.id) ? 'Show less' : 'Show more'}\r\n                </button>\r\n              {/if}\r\n            </div>\r\n            \r\n            <!-- Review Images -->\r\n            {#if review.images && review.images.length > 0}\r\n              <div class=\"review-images\">\r\n                {#each review.images as image, index}\r\n                  <button \r\n                    class=\"review-image-btn\"\r\n                    onclick={() => openImageModal(review.images || [], index)}\r\n                  >\r\n                    <img \r\n                      src={image} \r\n                      alt=\"Review image {index + 1}\"\r\n                      class=\"review-image\"\r\n                      loading=\"lazy\"\r\n                    />\r\n                    <div class=\"image-overlay\">\r\n                      <svg class=\"expand-icon\" viewBox=\"0 0 20 20\">\r\n                        <path fill=\"currentColor\" d=\"M3 4a1 1 0 011-1h3a1 1 0 000 2H6.414l1.793 1.793a1 1 0 01-1.414 1.414L5 6.414V8a1 1 0 01-2 0V4zM3 16a1 1 0 01-1-1v-3a1 1 0 112 0v1.586l1.793-1.793a1 1 0 011.414 1.414L5 13.586H7a1 1 0 110 2H4a1 1 0 01-1 0zM17 4a1 1 0 00-1-1h-3a1 1 0 100 2h1.586l-1.793 1.793a1 1 0 001.414 1.414L15 6.414V8a1 1 0 102 0V4zM17 16a1 1 0 001-1v-3a1 1 0 10-2 0v1.586l-1.793-1.793a1 1 0 00-1.414 1.414L15 13.586H13a1 1 0 100 2h3a1 1 0 001 0z\"/>\r\n                      </svg>\r\n                    </div>\r\n                  </button>\r\n                {/each}\r\n              </div>\r\n            {/if}\r\n          </div>\r\n\r\n          <!-- Review Actions -->\r\n          <div class=\"review-actions\">\r\n            <button \r\n              class=\"helpful-btn\"\r\n              class:helpful-btn--active={review.helpful}\r\n            >\r\n              <svg class=\"helpful-icon\" viewBox=\"0 0 20 20\">\r\n                <path fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" d=\"M7 10v12l4-1.5 4 1.5V10M7 10L6.5 7.7c-.2-.6-.3-1.3-.3-2C6.2 3.5 8 1.8 9.8 1.8c1 0 1.8.9 1.8 2v3.4h4.5c1.2 0 2.2 1 2 2.2l-1 5.5c-.1.8-.8 1.4-1.6 1.4H7\"/>\r\n              </svg>\r\n              <span>Helpful</span>\r\n              {#if review.helpfulCount && review.helpfulCount > 0}\r\n                <Badge variant=\"secondary\" size=\"sm\">{review.helpfulCount}</Badge>\r\n              {/if}\r\n            </button>\r\n          </div>\r\n        </article>\r\n      {/each}\r\n\r\n      <!-- Load More Button -->\r\n      {#if hasMore}\r\n        <div class=\"load-more-container\">\r\n          <button \r\n            class=\"load-more-btn\"\r\n            onclick={handleLoadMore}\r\n            disabled={isLoadingMore}\r\n          >\r\n            {#if isLoadingMore}\r\n              <svg class=\"loading-spinner\" viewBox=\"0 0 20 20\">\r\n                <circle cx=\"10\" cy=\"10\" r=\"8\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-dasharray=\"50.27\" stroke-dashoffset=\"50.27\" opacity=\"0.3\"/>\r\n                <circle cx=\"10\" cy=\"10\" r=\"8\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-dasharray=\"25.13\" stroke-dashoffset=\"25.13\"/>\r\n              </svg>\r\n              Loading...\r\n            {:else}\r\n              Load More Reviews\r\n            {/if}\r\n          </button>\r\n        </div>\r\n      {/if}\r\n    </div>\r\n  {:else}\r\n    <!-- No Reviews State -->\r\n    <div class=\"no-reviews\">\r\n      <div class=\"no-reviews-content\">\r\n        <div class=\"no-reviews-icon\">\r\n          <svg viewBox=\"0 0 64 64\">\r\n            <circle cx=\"32\" cy=\"32\" r=\"24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n            <path d=\"M22 34c0-5.5 4.5-10 10-10s10 4.5 10 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n            <circle cx=\"25\" cy=\"28\" r=\"2\" fill=\"currentColor\"/>\r\n            <circle cx=\"39\" cy=\"28\" r=\"2\" fill=\"currentColor\"/>\r\n          </svg>\r\n        </div>\r\n        <h3 class=\"no-reviews-title\">No reviews yet</h3>\r\n        <p class=\"no-reviews-text\">Be the first to share your thoughts about this product.</p>\r\n        {#if canReview}\r\n          <button class=\"write-review-btn primary\" onclick={onWriteReview}>\r\n            Write First Review\r\n          </button>\r\n        {/if}\r\n      </div>\r\n    </div>\r\n  {/if}\r\n</div>\r\n\r\n<!-- Image Modal -->\r\n{#if selectedImageModal}\r\n  <div\r\n    class=\"image-modal-backdrop\"\r\n    onclick={closeImageModal}\r\n    role=\"dialog\"\r\n    aria-modal=\"true\"\r\n    aria-label=\"Review image viewer\"\r\n    tabindex=\"0\"\r\n    onkeydown={(e) => {\r\n        if (e.key === 'Escape') {\r\n          e.stopPropagation();\r\n          closeImageModal();\r\n              }\r\n      }}\r\n    >\r\n      <section\r\n        class=\"image-modal-content\"\r\n        role=\"document\"\r\n      >\r\n        <button class=\"modal-close\" onclick={closeImageModal} aria-label=\"Close image modal\">\r\n          <svg viewBox=\"0 0 20 20\" aria-hidden=\"true\">\r\n            <path fill=\"currentColor\" d=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"/>\r\n          </svg>\r\n        </button>\r\n\r\n        <img\r\n          src={selectedImageModal.images[selectedImageModal.index]}\r\n          alt=\"Review image {selectedImageModal.index + 1}\"\r\n          class=\"modal-image\"\r\n        />\r\n\r\n        {#if selectedImageModal.images.length > 1}\r\n          <div class=\"modal-nav\">\r\n            <button\r\n              class=\"modal-nav-btn modal-nav-btn--prev\"\r\n              onclick={() => selectedImageModal && selectedImageModal.index > 0 && (selectedImageModal = { ...selectedImageModal, index: selectedImageModal.index - 1 })}\r\n              disabled={selectedImageModal.index === 0}\r\n              aria-label=\"Previous image\"\r\n            >\r\n              <svg viewBox=\"0 0 20 20\" aria-hidden=\"true\">\r\n                <path fill=\"currentColor\" d=\"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z\"/>\r\n              </svg>\r\n            </button>\r\n\r\n            <span class=\"modal-counter\">\r\n              {selectedImageModal.index + 1} of {selectedImageModal.images.length}\r\n            </span>\r\n\r\n            <button\r\n              class=\"modal-nav-btn modal-nav-btn--next\"\r\n              onclick={() => selectedImageModal && selectedImageModal.index < selectedImageModal.images.length - 1 && (selectedImageModal = { ...selectedImageModal, index: selectedImageModal.index + 1 })}\r\n              disabled={selectedImageModal.index === selectedImageModal.images.length - 1}\r\n              aria-label=\"Next image\"\r\n            >\r\n              <svg viewBox=\"0 0 20 20\" aria-hidden=\"true\">\r\n                <path fill=\"currentColor\" d=\"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z\"/>\r\n              </svg>\r\n            </button>\r\n          </div>\r\n        {/if}\r\n      </section>\r\n    </div>\r\n{/if}\r\n\r\n<style>\r\n  .reviews-container {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-6);\r\n  }\r\n\r\n  /* Compact variant adjustments */\r\n  .reviews--compact .reviews-summary {\r\n    padding: var(--space-4);\r\n  }\r\n  .reviews--compact .section-title {\r\n    font-size: var(--font-size-lg);\r\n  }\r\n  .reviews--compact .rating-number {\r\n    font-size: var(--font-size-2xl);\r\n  }\r\n  .reviews--compact .rating-overview {\r\n    gap: var(--space-4);\r\n  }\r\n  .reviews--compact .rating-stars.large .star {\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n  .reviews--compact .write-review-btn {\r\n    padding: var(--space-2) var(--space-3);\r\n    font-size: var(--font-size-sm);\r\n  }\r\n  .reviews--compact .review-text {\r\n    font-size: var(--font-size-sm);\r\n  }\r\n\r\n  /* Reviews Summary */\r\n  .reviews-summary {\r\n    background: var(--surface-base);\r\n    border: 1px solid var(--border-subtle);\r\n    border-radius: var(--radius-xl);\r\n    padding: var(--space-5);\r\n  }\r\n\r\n  .summary-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin-bottom: var(--space-4);\r\n  }\r\n\r\n  .section-title {\r\n    font-size: var(--font-size-xl);\r\n    font-weight: var(--font-weight-semibold);\r\n    color: var(--text-strong);\r\n    margin: 0;\r\n  }\r\n\r\n  .write-review-btn {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-2);\r\n    padding: var(--space-3) var(--space-4);\r\n    background: var(--primary);\r\n    color: var(--primary-fg);\r\n    border: none;\r\n    border-radius: var(--radius-lg);\r\n    font-size: var(--font-size-sm);\r\n    font-weight: var(--font-weight-medium);\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .write-review-btn:hover {\r\n    background: var(--primary-hover);\r\n    transform: translateY(-1px);\r\n  }\r\n\r\n  .write-review-btn.primary {\r\n    padding: var(--space-4) var(--space-6);\r\n    font-size: var(--font-size-base);\r\n  }\r\n\r\n  .btn-icon {\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n\r\n  .rating-overview {\r\n    display: grid;\r\n    grid-template-columns: auto 1fr;\r\n    gap: var(--space-6);\r\n    align-items: start;\r\n  }\r\n\r\n  .average-rating {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    gap: var(--space-2);\r\n    text-align: center;\r\n  }\r\n\r\n  .rating-number {\r\n    font-size: var(--font-size-3xl);\r\n    font-weight: var(--font-weight-bold);\r\n    color: var(--text-strong);\r\n  }\r\n\r\n  .review-count {\r\n    font-size: var(--font-size-sm);\r\n    color: var(--text-subtle);\r\n  }\r\n\r\n  /* Stars */\r\n  .rating-stars {\r\n    display: flex;\r\n    gap: var(--space-1);\r\n  }\r\n\r\n  .rating-stars.large {\r\n    gap: var(--space-2);\r\n  }\r\n\r\n  .rating-stars.small {\r\n    gap: 2px;\r\n  }\r\n\r\n  .star {\r\n    fill: var(--border-subtle);\r\n    transition: fill 0.2s;\r\n  }\r\n\r\n  .star--full {\r\n    fill: var(--warning);\r\n  }\r\n\r\n  .star--half {\r\n    fill: var(--warning);\r\n  }\r\n\r\n  .rating-stars.large .star {\r\n    width: 20px;\r\n    height: 20px;\r\n  }\r\n\r\n  .rating-stars.small .star {\r\n    width: 14px;\r\n    height: 14px;\r\n  }\r\n\r\n  /* Rating Breakdown */\r\n  .rating-breakdown {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-2);\r\n  }\r\n\r\n  .breakdown-row {\r\n    display: grid;\r\n    grid-template-columns: auto 1fr auto;\r\n    gap: var(--space-3);\r\n    align-items: center;\r\n    background: none;\r\n    border: none;\r\n    cursor: pointer;\r\n    padding: var(--space-2);\r\n    border-radius: var(--radius-md);\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .breakdown-row:hover {\r\n    background: var(--surface-hover);\r\n  }\r\n\r\n  .breakdown-row--active {\r\n    background: var(--primary);\r\n    color: var(--primary-fg);\r\n  }\r\n\r\n  .rating-label {\r\n    font-size: var(--font-size-sm);\r\n    color: var(--text-subtle);\r\n    white-space: nowrap;\r\n  }\r\n\r\n  .breakdown-row--active .rating-label,\r\n  .breakdown-row--active .count-label {\r\n    color: var(--primary-fg);\r\n  }\r\n\r\n  .progress-bar {\r\n    height: 8px;\r\n    background: var(--surface-subtle);\r\n    border-radius: var(--radius-full);\r\n    overflow: hidden;\r\n  }\r\n\r\n  .progress-fill {\r\n    height: 100%;\r\n    background: var(--warning);\r\n    transition: width 0.3s;\r\n  }\r\n\r\n  .count-label {\r\n    font-size: var(--font-size-sm);\r\n    color: var(--text-subtle);\r\n    min-width: 20px;\r\n    text-align: right;\r\n  }\r\n\r\n  /* Controls */\r\n  .reviews-controls {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-4);\r\n    flex-wrap: wrap;\r\n  }\r\n\r\n  .control-group {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-2);\r\n  }\r\n\r\n  .control-label {\r\n    font-size: var(--font-size-sm);\r\n    font-weight: var(--font-weight-medium);\r\n    color: var(--text-strong);\r\n  }\r\n\r\n  .sort-select {\r\n    padding: var(--space-2) var(--space-3);\r\n    border: 1px solid var(--border-subtle);\r\n    border-radius: var(--radius-md);\r\n    background: var(--surface-base);\r\n    color: var(--text-strong);\r\n    font-size: var(--font-size-sm);\r\n    cursor: pointer;\r\n  }\r\n\r\n  .clear-filter-btn {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-2);\r\n    padding: var(--space-2) var(--space-3);\r\n    background: var(--surface-subtle);\r\n    border: 1px solid var(--border-subtle);\r\n    border-radius: var(--radius-md);\r\n    color: var(--text-strong);\r\n    font-size: var(--font-size-sm);\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .clear-filter-btn:hover {\r\n    background: var(--surface-hover);\r\n  }\r\n\r\n  .clear-icon {\r\n    width: 14px;\r\n    height: 14px;\r\n  }\r\n\r\n  /* Reviews List */\r\n  .reviews-list {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-4);\r\n  }\r\n\r\n  .review-card {\r\n    background: var(--surface-base);\r\n    border: 1px solid var(--border-subtle);\r\n    border-radius: var(--radius-xl);\r\n    padding: var(--space-4);\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .review-card:hover {\r\n    border-color: var(--border-strong);\r\n    box-shadow: var(--shadow-sm);\r\n  }\r\n\r\n  .review-header {\r\n    margin-bottom: var(--space-3);\r\n  }\r\n\r\n  .reviewer-info {\r\n    display: flex;\r\n    align-items: flex-start;\r\n    gap: var(--space-3);\r\n  }\r\n\r\n  .reviewer-details {\r\n    flex: 1;\r\n    min-width: 0;\r\n  }\r\n\r\n  .reviewer-name-row {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-2);\r\n    margin-bottom: var(--space-1);\r\n  }\r\n\r\n  .reviewer-name {\r\n    font-weight: var(--font-weight-semibold);\r\n    color: var(--text-strong);\r\n    font-size: var(--font-size-sm);\r\n  }\r\n\r\n  .verified-icon {\r\n    width: 12px;\r\n    height: 12px;\r\n  }\r\n\r\n  .review-meta {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-2);\r\n  }\r\n\r\n  .review-date {\r\n    font-size: var(--font-size-xs);\r\n    color: var(--text-subtle);\r\n  }\r\n\r\n  /* Review Content */\r\n  .review-content {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-3);\r\n  }\r\n\r\n  .review-text-container {\r\n    position: relative;\r\n  }\r\n\r\n  .review-text {\r\n    margin: 0;\r\n    line-height: var(--line-height-relaxed);\r\n    color: var(--text-base);\r\n    display: -webkit-box;\r\n    -webkit-line-clamp: 4;\r\n    line-clamp: 4;\r\n    -webkit-box-orient: vertical;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .review-text--expanded {\r\n    display: block;\r\n    -webkit-line-clamp: none;\r\n    line-clamp: none;\r\n  }\r\n\r\n  .expand-btn {\r\n    background: none;\r\n    border: none;\r\n    color: var(--primary);\r\n    font-size: var(--font-size-sm);\r\n    font-weight: var(--font-weight-medium);\r\n    cursor: pointer;\r\n    margin-top: var(--space-2);\r\n    transition: color 0.2s;\r\n  }\r\n\r\n  .expand-btn:hover {\r\n    color: var(--primary-hover);\r\n  }\r\n\r\n  /* Review Images */\r\n  .review-images {\r\n    display: grid;\r\n    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));\r\n    gap: var(--space-2);\r\n    max-width: 400px;\r\n  }\r\n\r\n  .review-image-btn {\r\n    position: relative;\r\n    background: none;\r\n    border: none;\r\n    cursor: pointer;\r\n    border-radius: var(--radius-lg);\r\n    overflow: hidden;\r\n    aspect-ratio: 1;\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .review-image-btn:hover {\r\n    transform: scale(1.05);\r\n  }\r\n\r\n  .review-image {\r\n    width: 100%;\r\n    height: 100%;\r\n    object-fit: cover;\r\n  }\r\n\r\n  .image-overlay {\r\n    position: absolute;\r\n    inset: 0;\r\n    background: color-mix(in oklch, var(--gray-900) 0%, transparent);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    transition: all 0.2s;\r\n    opacity: 0;\r\n  }\r\n\r\n  .review-image-btn:hover .image-overlay {\r\n    background: color-mix(in oklch, var(--gray-900) 20%, transparent);\r\n    opacity: 1;\r\n  }\r\n\r\n  .expand-icon {\r\n    width: 20px;\r\n    height: 20px;\r\n    color: var(--gray-0);\r\n  }\r\n\r\n  /* Review Actions */\r\n  .review-actions {\r\n    display: flex;\r\n    gap: var(--space-2);\r\n    padding-top: var(--space-2);\r\n    border-top: 1px solid var(--border-subtle);\r\n  }\r\n\r\n  .helpful-btn {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-2);\r\n    padding: var(--space-2) var(--space-3);\r\n    background: var(--surface-subtle);\r\n    border: 1px solid var(--border-subtle);\r\n    border-radius: var(--radius-md);\r\n    color: var(--text-subtle);\r\n    font-size: var(--font-size-xs);\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .helpful-btn:hover {\r\n    background: var(--surface-hover);\r\n    border-color: var(--border-strong);\r\n  }\r\n\r\n  .helpful-btn--active {\r\n    background: var(--primary);\r\n    color: var(--primary-fg);\r\n    border-color: var(--primary);\r\n  }\r\n\r\n  .helpful-icon {\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n\r\n  /* Load More */\r\n  .load-more-container {\r\n    display: flex;\r\n    justify-content: center;\r\n    padding-top: var(--space-4);\r\n  }\r\n\r\n  .load-more-btn {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-2);\r\n    padding: var(--space-3) var(--space-6);\r\n    background: var(--surface-subtle);\r\n    border: 1px solid var(--border-subtle);\r\n    border-radius: var(--radius-lg);\r\n    color: var(--text-strong);\r\n    font-weight: var(--font-weight-medium);\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .load-more-btn:hover:not(:disabled) {\r\n    background: var(--surface-hover);\r\n  }\r\n\r\n  .load-more-btn:disabled {\r\n    opacity: 0.6;\r\n    cursor: not-allowed;\r\n  }\r\n\r\n  .loading-spinner {\r\n    width: 16px;\r\n    height: 16px;\r\n    animation: spin 1s linear infinite;\r\n  }\r\n\r\n  @keyframes spin {\r\n    to { transform: rotate(360deg); }\r\n  }\r\n\r\n  /* No Reviews State */\r\n  .no-reviews {\r\n    padding: var(--space-8) var(--space-6);\r\n    background: var(--surface-base);\r\n    border: 1px solid var(--border-subtle);\r\n    border-radius: var(--radius-xl);\r\n  }\r\n\r\n  .no-reviews-content {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    text-align: center;\r\n    gap: var(--space-3);\r\n  }\r\n\r\n  .no-reviews-icon {\r\n    width: var(--space-16);\r\n    height: var(--space-16);\r\n    color: var(--text-subtle);\r\n  }\r\n\r\n  .no-reviews-title {\r\n    font-size: var(--font-size-lg);\r\n    font-weight: var(--font-weight-semibold);\r\n    color: var(--text-strong);\r\n    margin: 0;\r\n  }\r\n\r\n  .no-reviews-text {\r\n    color: var(--text-subtle);\r\n    margin: 0;\r\n  }\r\n\r\n  /* Image Modal */\r\n  .image-modal-backdrop {\r\n    position: fixed;\r\n    inset: 0;\r\n    background: var(--gray-900);\r\n    z-index: 100;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    cursor: pointer;\r\n    border: none;\r\n    padding: 0;\r\n  }\r\n\r\n  .image-modal-content {\r\n    position: relative;\r\n    max-width: 90vw;\r\n    max-height: 90vh;\r\n    cursor: default;\r\n  }\r\n\r\n  .modal-close {\r\n    position: absolute;\r\n    top: var(--space-4);\r\n    right: var(--space-4);\r\n    z-index: 101;\r\n    width: var(--touch-icon);\r\n    height: var(--touch-icon);\r\n    background: var(--gray-900);\r\n    color: var(--gray-0);\r\n    border: none;\r\n    border-radius: var(--radius-full);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n    backdrop-filter: blur(8px);\r\n  }\r\n\r\n  .modal-close:hover {\r\n    background: var(--gray-800);\r\n    transform: scale(1.05);\r\n  }\r\n\r\n  .modal-close svg {\r\n    width: 20px;\r\n    height: 20px;\r\n  }\r\n\r\n  .modal-image {\r\n    max-width: 100%;\r\n    max-height: 100%;\r\n    object-fit: contain;\r\n    border-radius: var(--radius-xl);\r\n  }\r\n\r\n  .modal-nav {\r\n    position: absolute;\r\n    bottom: var(--space-6);\r\n    left: 50%;\r\n    transform: translateX(-50%);\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-4);\r\n    padding: var(--space-3) var(--space-6);\r\n    background: var(--gray-900);\r\n    color: var(--gray-0);\r\n    border-radius: var(--radius-full);\r\n    backdrop-filter: blur(8px);\r\n  }\r\n\r\n  .modal-nav-btn {\r\n    width: var(--touch-standard);\r\n    height: var(--touch-standard);\r\n    background: transparent;\r\n    border: 1px solid var(--gray-600);\r\n    border-radius: var(--radius-md);\r\n    color: var(--gray-0);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .modal-nav-btn:hover:not(:disabled) {\r\n    background: var(--gray-800);\r\n    border-color: var(--gray-500);\r\n  }\r\n\r\n  .modal-nav-btn:disabled {\r\n    opacity: 0.3;\r\n    cursor: not-allowed;\r\n  }\r\n\r\n  .modal-nav-btn svg {\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n\r\n  .modal-counter {\r\n    font-size: var(--font-size-sm);\r\n    font-weight: var(--font-weight-medium);\r\n  }\r\n\r\n  /* Responsive Design */\r\n  @media (max-width: 768px) {\r\n    .rating-overview {\r\n      grid-template-columns: 1fr;\r\n      gap: var(--space-4);\r\n    }\r\n\r\n    .summary-header {\r\n      flex-direction: column;\r\n      align-items: flex-start;\r\n      gap: var(--space-3);\r\n    }\r\n\r\n    .write-review-btn {\r\n      align-self: stretch;\r\n      justify-content: center;\r\n    }\r\n\r\n    .review-images {\r\n      grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));\r\n    }\r\n\r\n    .reviews-controls {\r\n      flex-direction: column;\r\n      align-items: stretch;\r\n      gap: var(--space-2);\r\n    }\r\n\r\n    .control-group {\r\n      justify-content: space-between;\r\n    }\r\n  }\r\n\r\n  /* Reduced motion support */\r\n  @media (prefers-reduced-motion: reduce) {\r\n    .review-card,\r\n    .write-review-btn,\r\n    .helpful-btn,\r\n    .review-image-btn {\r\n      transition: none;\r\n    }\r\n\r\n    .loading-spinner {\r\n      animation: none;\r\n    }\r\n  }\r\n</style>\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\ProductSeller.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'m' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":3,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":10},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[70,73],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[70,73],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import * as i18n from '@repo/i18n';\r\n  const m: any = i18n;\r\n  import Avatar from '../ui/Avatar.svelte';\r\n  import Badge from '../badges/Badge.svelte';\r\n\r\n  interface Seller {\r\n    id: string;\r\n    username: string;\r\n    avatar?: string;\r\n    verified?: boolean;\r\n    rating: number;\r\n    salesCount: number;\r\n    joinedAt: string;\r\n  }\r\n\r\n  interface Props {\r\n    seller: Seller;\r\n    isOwner?: boolean;\r\n    onMessage?: () => void;\r\n    onNavigate?: (url: string) => void;\r\n    className?: string;\r\n    variant?: 'default' | 'compact';\r\n  }\r\n\r\n  let { \r\n    seller,\r\n    isOwner = false,\r\n    onMessage,\r\n    onNavigate,\r\n    className = '',\r\n    variant = 'default'\r\n  }: Props = $props();\r\n\r\n  // Computed properties\r\n  const memberDuration = $derived(() => {\r\n    const joinedDate = new Date(seller.joinedAt);\r\n    const now = new Date();\r\n    const diffInMonths = (now.getFullYear() - joinedDate.getFullYear()) * 12 + \r\n                        (now.getMonth() - joinedDate.getMonth());\r\n    \r\n    if (diffInMonths < 1) return 'New member';\r\n    if (diffInMonths < 12) return `${diffInMonths}mo`;\r\n    const years = Math.floor(diffInMonths / 12);\r\n    return `${years}y`;\r\n  });\r\n\r\n  const ratingDisplay = $derived(() => {\r\n    if (seller.rating === 0) return { stars: 0, text: 'No ratings' };\r\n    return {\r\n      stars: seller.rating,\r\n      text: `${seller.rating.toFixed(1)} ★`\r\n    };\r\n  });\r\n\r\n  const salesDisplay = $derived(() => {\r\n    if (seller.salesCount === 0) return 'New seller';\r\n    if (seller.salesCount === 1) return '1 sale';\r\n    if (seller.salesCount < 100) return `${seller.salesCount} sales`;\r\n    if (seller.salesCount < 1000) return `${Math.floor(seller.salesCount / 10) * 10}+ sales`;\r\n    return `${Math.floor(seller.salesCount / 100)}K+ sales`;\r\n  });\r\n\r\n  function handleProfileClick() {\r\n    onNavigate?.(`/seller/${seller.username}`);\r\n  }\r\n\r\n  function handleMessageClick() {\r\n    onMessage?.();\r\n  }\r\n\r\n  // Generate star array for rating display\r\n  const stars = $derived(() => {\r\n    const starArray = [];\r\n    const fullStars = Math.floor(seller.rating);\r\n    const hasHalfStar = seller.rating % 1 >= 0.5;\r\n    \r\n    for (let i = 0; i < 5; i++) {\r\n      if (i < fullStars) {\r\n        starArray.push('full');\r\n      } else if (i === fullStars && hasHalfStar) {\r\n        starArray.push('half');\r\n      } else {\r\n        starArray.push('empty');\r\n      }\r\n    }\r\n    \r\n    return starArray;\r\n  });\r\n</script>\r\n\r\n<div class=\"seller-card {className} seller-card--{variant}\" class:seller-card--owner={isOwner}>\r\n  <!-- Header with Avatar and Basic Info -->\r\n  <div class=\"seller-header\">\r\n    <button \r\n      class=\"seller-profile-button\"\r\n      onclick={handleProfileClick}\r\n      type=\"button\"\r\n    >\r\n      <Avatar \r\n        src={seller.avatar} \r\n        alt={`${seller.username}'s profile`}\r\n        size={variant === 'compact' ? 'md' : 'lg'}\r\n        class=\"seller-avatar\"\r\n      />\r\n      \r\n      <div class=\"seller-info\">\r\n        <div class=\"seller-name-row\">\r\n          <span class=\"seller-name\">{seller.username}</span>\r\n          {#if seller.verified}\r\n            <div class=\"verified-badge\">\r\n              <svg class=\"verified-icon\" viewBox=\"0 0 20 20\">\r\n                <path fill=\"currentColor\" d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/>\r\n              </svg>\r\n            </div>\r\n          {/if}\r\n        </div>\r\n        \r\n        <!-- Rating Stars (visible only if has rating) -->\r\n        {#if seller.rating > 0}\r\n          <div class=\"rating-display\">\r\n            <div class=\"stars\">\r\n              {#each stars() as star}\r\n                <svg class=\"star star--{star}\" viewBox=\"0 0 20 20\">\r\n                  {#if star === 'full'}\r\n                    <path fill=\"currentColor\" d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/>\r\n                  {:else if star === 'half'}\r\n                    <defs>\r\n                      <linearGradient id=\"half-star-{seller.id}\">\r\n                        <stop offset=\"50%\" stop-color=\"currentColor\"/>\r\n                        <stop offset=\"50%\" stop-color=\"transparent\"/>\r\n                      </linearGradient>\r\n                    </defs>\r\n                    <path fill=\"url(#half-star-{seller.id})\" d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/>\r\n                  {:else}\r\n                    <path fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\" d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/>\r\n                  {/if}\r\n                </svg>\r\n              {/each}\r\n            </div>\r\n            <span class=\"rating-text\">{ratingDisplay().text}</span>\r\n          </div>\r\n        {/if}\r\n      </div>\r\n    </button>\r\n\r\n    <!-- Message Button -->\r\n    {#if !isOwner}\r\n      <button \r\n        class=\"message-button\"\r\n        onclick={handleMessageClick}\r\n        type=\"button\"\r\n      >\r\n        <svg class=\"message-icon\" viewBox=\"0 0 20 20\">\r\n          <path fill=\"currentColor\" d=\"M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z\"/>\r\n          <path fill=\"currentColor\" d=\"M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z\"/>\r\n        </svg>\r\n        <span class=\"message-text\">Message</span>\r\n      </button>\r\n    {/if}\r\n  </div>\r\n\r\n  <!-- Stats Section (only in default variant) -->\r\n  {#if variant === 'default'}\r\n    <div class=\"seller-stats\">\r\n      <div class=\"stat-item\">\r\n        <span class=\"stat-label\">Sales</span>\r\n        <span class=\"stat-value\">{salesDisplay()}</span>\r\n      </div>\r\n      \r\n      <div class=\"stat-item\">\r\n        <span class=\"stat-label\">Member</span>\r\n        <span class=\"stat-value\">{memberDuration()}</span>\r\n      </div>\r\n      \r\n      {#if seller.rating > 0}\r\n        <div class=\"stat-item\">\r\n          <span class=\"stat-label\">Rating</span>\r\n          <span class=\"stat-value\">{seller.rating.toFixed(1)} ★</span>\r\n        </div>\r\n      {/if}\r\n    </div>\r\n\r\n    <!-- Trust Indicators -->\r\n    <div class=\"trust-section\">\r\n      <div class=\"trust-item\">\r\n        <div class=\"trust-icon trust-icon--secure\">\r\n          <svg viewBox=\"0 0 20 20\">\r\n            <path fill=\"currentColor\" d=\"M10 2L3 7v3c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-7-5z\"/>\r\n          </svg>\r\n        </div>\r\n        <div class=\"trust-content\">\r\n          <div class=\"trust-title\">Secure messaging</div>\r\n          <div class=\"trust-desc\">Chat safely through Driplo</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"trust-item\">\r\n        <div class=\"trust-icon trust-icon--fast\">\r\n          <svg viewBox=\"0 0 20 20\">\r\n            <path fill=\"currentColor\" d=\"M10 12a2 2 0 100-4 2 2 0 000 4z\"/>\r\n            <path fill=\"currentColor\" fill-rule=\"evenodd\" d=\"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z\" clip-rule=\"evenodd\"/>\r\n          </svg>\r\n        </div>\r\n        <div class=\"trust-content\">\r\n          <div class=\"trust-title\">Fast response</div>\r\n          <div class=\"trust-desc\">Usually responds within hours</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  {/if}\r\n</div>\r\n\r\n<style>\r\n  .seller-card {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-3);\r\n    padding: var(--space-4);\r\n    background: var(--surface-base);\r\n    border: 1px solid var(--border-subtle);\r\n    border-radius: var(--radius-xl);\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .seller-card:hover:not(.seller-card--owner) {\r\n    border-color: var(--border-strong);\r\n    box-shadow: var(--shadow-sm);\r\n  }\r\n\r\n  .seller-card--compact {\r\n    padding: var(--space-3);\r\n    gap: var(--space-2);\r\n  }\r\n\r\n  .seller-card--owner {\r\n    background: var(--surface-subtle);\r\n    border-color: var(--border-subtle);\r\n  }\r\n\r\n  /* Header */\r\n  .seller-header {\r\n    display: flex;\r\n    align-items: flex-start;\r\n    gap: var(--space-3);\r\n    justify-content: space-between;\r\n  }\r\n\r\n  .seller-profile-button {\r\n    display: flex;\r\n    align-items: flex-start;\r\n    gap: var(--space-3);\r\n    background: none;\r\n    border: none;\r\n    cursor: pointer;\r\n    text-align: left;\r\n    padding: var(--space-1);\r\n    border-radius: var(--radius-lg);\r\n    transition: all 0.2s;\r\n    flex: 1;\r\n    min-width: 0;\r\n  }\r\n\r\n  .seller-profile-button:hover {\r\n    background: var(--surface-hover);\r\n  }\r\n\r\n  .seller-profile-button:focus-visible {\r\n    outline: 2px solid var(--state-focus);\r\n    outline-offset: 2px;\r\n  }\r\n\r\n  .seller-info {\r\n    flex: 1;\r\n    min-width: 0;\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-1);\r\n  }\r\n\r\n  .seller-name-row {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-2);\r\n  }\r\n\r\n  .seller-name {\r\n    font-weight: var(--font-weight-semibold);\r\n    color: var(--text-strong);\r\n    font-size: var(--font-size-base);\r\n    line-height: var(--line-height-tight);\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    white-space: nowrap;\r\n  }\r\n\r\n  .verified-badge {\r\n    flex-shrink: 0;\r\n    color: var(--primary);\r\n  }\r\n\r\n  .verified-icon {\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n\r\n  /* Rating Display */\r\n  .rating-display {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-2);\r\n  }\r\n\r\n  .stars {\r\n    display: flex;\r\n    gap: 1px;\r\n  }\r\n\r\n  .star {\r\n    width: 12px;\r\n    height: 12px;\r\n    color: var(--border-subtle);\r\n  }\r\n\r\n  .star--full {\r\n    color: var(--warning);\r\n  }\r\n\r\n  .star--half {\r\n    color: var(--warning);\r\n  }\r\n\r\n  .rating-text {\r\n    font-size: var(--font-size-xs);\r\n    color: var(--text-subtle);\r\n    font-weight: var(--font-weight-medium);\r\n  }\r\n\r\n  /* Message Button */\r\n  .message-button {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: var(--space-2);\r\n    padding: var(--space-2) var(--space-3);\r\n    background: var(--primary);\r\n    color: var(--primary-fg);\r\n    border: none;\r\n    border-radius: var(--radius-lg);\r\n    font-size: var(--font-size-sm);\r\n    font-weight: var(--font-weight-medium);\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n    flex-shrink: 0;\r\n    min-height: var(--touch-compact);\r\n  }\r\n\r\n  .message-button:hover {\r\n    background: var(--primary-hover);\r\n    transform: translateY(-1px);\r\n  }\r\n\r\n  .message-button:focus-visible {\r\n    outline: 2px solid var(--state-focus);\r\n    outline-offset: 2px;\r\n  }\r\n\r\n  .message-icon {\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n\r\n  .message-text {\r\n    font-size: var(--font-size-sm);\r\n  }\r\n\r\n  /* Stats Section */\r\n  .seller-stats {\r\n    display: grid;\r\n    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));\r\n    gap: var(--space-2);\r\n    padding: var(--space-3);\r\n    background: var(--surface-subtle);\r\n    border-radius: var(--radius-lg);\r\n    border: 1px solid var(--border-subtle);\r\n  }\r\n\r\n  .stat-item {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-1);\r\n    text-align: center;\r\n  }\r\n\r\n  .stat-label {\r\n    font-size: var(--font-size-xs);\r\n    color: var(--text-subtle);\r\n    font-weight: var(--font-weight-medium);\r\n    text-transform: uppercase;\r\n    letter-spacing: 0.05em;\r\n  }\r\n\r\n  .stat-value {\r\n    font-size: var(--font-size-sm);\r\n    font-weight: var(--font-weight-semibold);\r\n    color: var(--text-strong);\r\n  }\r\n\r\n  /* Trust Section */\r\n  .trust-section {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--space-3);\r\n  }\r\n\r\n  .trust-item {\r\n    display: flex;\r\n    align-items: flex-start;\r\n    gap: var(--space-2);\r\n  }\r\n\r\n  .trust-icon {\r\n    width: var(--space-6);\r\n    height: var(--space-6);\r\n    border-radius: var(--radius-md);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    flex-shrink: 0;\r\n  }\r\n\r\n  .trust-icon--secure {\r\n    background: var(--success);\r\n    color: var(--surface-base);\r\n  }\r\n\r\n  .trust-icon--fast {\r\n    background: var(--blue-600);\r\n    color: var(--surface-base);\r\n  }\r\n\r\n  .trust-icon svg {\r\n    width: 14px;\r\n    height: 14px;\r\n  }\r\n\r\n  .trust-content {\r\n    flex: 1;\r\n    min-width: 0;\r\n  }\r\n\r\n  .trust-title {\r\n    font-weight: var(--font-weight-medium);\r\n    color: var(--text-strong);\r\n    font-size: var(--font-size-xs);\r\n    margin-bottom: 2px;\r\n  }\r\n\r\n  .trust-desc {\r\n    color: var(--text-subtle);\r\n    font-size: var(--font-size-xs);\r\n    line-height: var(--line-height-relaxed);\r\n  }\r\n\r\n  /* Responsive Design */\r\n  @media (max-width: 768px) {\r\n    .seller-header {\r\n      flex-direction: column;\r\n      align-items: stretch;\r\n      gap: var(--space-2);\r\n    }\r\n\r\n    .seller-profile-button {\r\n      padding: 0;\r\n    }\r\n\r\n    .message-button {\r\n      width: 100%;\r\n      justify-content: center;\r\n    }\r\n\r\n    .seller-stats {\r\n      grid-template-columns: repeat(2, 1fr);\r\n    }\r\n\r\n    .trust-item {\r\n      gap: var(--space-2);\r\n    }\r\n\r\n    .trust-icon {\r\n      width: var(--space-5);\r\n      height: var(--space-5);\r\n    }\r\n\r\n    .trust-icon svg {\r\n      width: 12px;\r\n      height: 12px;\r\n    }\r\n  }\r\n\r\n  @media (max-width: 480px) {\r\n    .seller-card {\r\n      padding: var(--space-3);\r\n    }\r\n\r\n    .seller-stats {\r\n      padding: var(--space-2);\r\n    }\r\n\r\n    .stat-item {\r\n      gap: 2px;\r\n    }\r\n  }\r\n\r\n  /* High contrast support */\r\n  @media (prefers-contrast: high) {\r\n    .seller-card {\r\n      border-width: 2px;\r\n    }\r\n\r\n    .verified-badge {\r\n      border: 1px solid var(--primary);\r\n      border-radius: var(--radius-sm);\r\n      padding: 1px;\r\n    }\r\n\r\n    .trust-icon {\r\n      border: 2px solid currentColor;\r\n    }\r\n  }\r\n\r\n  /* Reduced motion support */\r\n  @media (prefers-reduced-motion: reduce) {\r\n    .seller-card,\r\n    .seller-profile-button,\r\n    .message-button {\r\n      transition: none;\r\n    }\r\n\r\n    .message-button:hover {\r\n      transform: none;\r\n    }\r\n  }\r\n\r\n  /* Print styles */\r\n  @media print {\r\n    .seller-card {\r\n      background: transparent;\r\n      border: 1px solid #ccc;\r\n    }\r\n\r\n    .message-button,\r\n    .trust-section {\r\n      display: none;\r\n    }\r\n  }\r\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\ProductSoldManager.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\PromotedListingsSection.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[474,477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[474,477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onBuy' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":39,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'scrollLeft' is defined but never used. Allowed unused vars must match /^_/u.","line":57,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'scrollRight' is defined but never used. Allowed unused vars must match /^_/u.","line":64,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"﻿<script lang=\"ts\">\r\n  import type { Product as UIProduct } from '../../types/product';\r\n  import ProductCard from '../cards/ProductCard.svelte';\r\n  import PromotedListingsBanner from '../banners/home/PromotedListingsBanner.svelte';\r\n\r\n  interface Props {\r\n    promotedProducts: UIProduct[];\r\n    onProductClick: (product: UIProduct) => void;\r\n    onFavorite: (productId: string) => void;\r\n    onBuy?: (productId: string, selectedSize?: string) => void;\r\n    favoritesState: any;\r\n    formatPrice: (price: number) => string;\r\n    translations: {\r\n      promoted_listings: string;\r\n      promoted_description: string;\r\n      common_currency: string;\r\n      product_addToFavorites: string;\r\n      seller_unknown: string;\r\n      condition_brandNewWithTags: string;\r\n      condition_newWithoutTags: string;\r\n      condition_new: string;\r\n      condition_likeNew: string;\r\n      condition_good: string;\r\n      condition_worn: string;\r\n      condition_fair: string;\r\n      categoryTranslation: (categoryName: string) => string;\r\n    };\r\n    showToggle?: boolean;\r\n    activeTab?: 'sellers' | 'brands';\r\n    onToggle?: (tab: 'sellers' | 'brands') => void;\r\n    onViewAll?: () => void;\r\n    class?: string;\r\n  }\r\n\r\n  let {\r\n    promotedProducts,\r\n    onProductClick,\r\n    onFavorite,\r\n    onBuy,\r\n    favoritesState,\r\n    formatPrice,\r\n    translations,\r\n    showToggle = false,\r\n    activeTab = 'sellers',\r\n    onToggle,\r\n    onViewAll,\r\n    class: className = ''\r\n  }: Props = $props();\r\n\r\n  // Use provided list (homepage already filters/chooses boosted); limit to 8\r\n  const activePromotedProducts: UIProduct[] = $derived(\r\n    (promotedProducts || []).slice(0, 8)\r\n  );\r\n\r\n  let promotedScrollContainer = $state<HTMLElement | null>(null);\r\n\r\n  function scrollLeft() {\r\n    if (promotedScrollContainer) {\r\n      const cardWidth = promotedScrollContainer.querySelector('[data-promoted-card]')?.clientWidth || 280;\r\n      promotedScrollContainer.scrollBy({ left: -cardWidth, behavior: 'smooth' });\r\n    }\r\n  }\r\n\r\n  function scrollRight() {\r\n    if (promotedScrollContainer) {\r\n      const cardWidth = promotedScrollContainer.querySelector('[data-promoted-card]')?.clientWidth || 280;\r\n      promotedScrollContainer.scrollBy({ left: cardWidth, behavior: 'smooth' });\r\n    }\r\n  }\r\n</script>\r\n\r\n{#if activePromotedProducts.length > 0}\r\n\t<!-- Enhanced section with separator banner -->\r\n\t<section class=\"pb-2 sm:pb-3 {className}\">\r\n\t\t<!-- Section Banner with proper container -->\r\n\t\t<div class=\"px-2 sm:px-4 lg:px-6 mb-3 sm:mb-4\">\r\n\t\t\t<PromotedListingsBanner\r\n\t\t\t\theading={translations.promoted_listings}\r\n\t\t\t\tcopy=\"Featured listings from top sellers. Premium visibility for standout products.\"\r\n\t\t\t\titemCount={activePromotedProducts.length}\r\n\t\t\t\tshowNavigation={false}\r\n\t\t\t\t{showToggle}\r\n\t\t\t\t{activeTab}\r\n\t\t\t\t{onToggle}\r\n\t\t\t\tcta={onViewAll ? { label: \"View All\", action: onViewAll } : undefined}\r\n\t\t\t/>\r\n\t\t</div>\r\n\r\n\t\t<!-- Horizontal Scrollable Cards matching grid card sizes -->\r\n\t\t<div class=\"relative px-2 sm:px-4 lg:px-6\">\r\n\t\t\t<div class=\"flex gap-3 sm:gap-4 overflow-x-auto scrollbarhide promoted-cards-container\" style=\"scroll-snap-type: x mandatory;\" data-promoted-scroll bind:this={promotedScrollContainer}>\r\n\t\t\t\t{#each activePromotedProducts as product (product.id)}\r\n\t\t\t\t\t<div class=\"flex-shrink-0 snap-start basis-1/2 sm:basis-1/3 lg:basis-1/4 xl:basis-1/5\" data-promoted-card>\r\n\t\t\t\t\t\t<ProductCard\r\n\t\t\t\t\t\t\t{product}\r\n\t\t\t\t\t\t\tonclick={onProductClick}\r\n\t\t\t\t\t\t\tonFavorite={onFavorite}\r\n\t\t\t\t\t\t\tfavorited={favoritesState.favorites?.[product.id] || false}\r\n\t\t\t\t\t\t\tfavoritesState={favoritesState}\r\n\t\t\t\t\t\t\tshowBoostBadge={false}\r\n\t\t\t\t\t\t\tshowSellerBadges={false}\r\n\t\t\t\t\t\t\ttranslations={{\r\n\t\t\t\t\t\t\t\taddToFavorites: translations.product_addToFavorites,\r\n\t\t\t\t\t\t\t\tcurrency: translations.common_currency,\r\n\t\t\t\t\t\t\t\tbrandNewWithTags: translations.condition_brandNewWithTags,\r\n\t\t\t\t\t\t\t\tnewWithoutTags: translations.condition_newWithoutTags,\r\n\t\t\t\t\t\t\t\tnew: translations.condition_new,\r\n\t\t\t\t\t\t\t\tlikeNew: translations.condition_likeNew,\r\n\t\t\t\t\t\t\t\tgood: translations.condition_good,\r\n\t\t\t\t\t\t\t\tworn: translations.condition_worn,\r\n\t\t\t\t\t\t\t\tfair: translations.condition_fair,\r\n\t\t\t\t\t\t\t\tformatPrice: formatPrice,\r\n\t\t\t\t\t\t\t\tcategoryTranslation: translations.categoryTranslation\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t{/each}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</section>\r\n{/if}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\StickyFilterModal.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tick' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[746,749],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[746,749],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[788,791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[788,791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1105,1108],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1105,1108],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1225,1228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1225,1228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1517,1520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1517,1520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'overlay' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":98,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":98,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'content' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":106,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":106,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'titleEl' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":112,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":112,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'close' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":116,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":116,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":212,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5547,5550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5547,5550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":220,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5773,5776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5773,5776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import type { Snippet } from 'svelte';\r\n  import { tick } from 'svelte';\r\n  import FilterPillGroup from './FilterPillGroup.svelte';\r\n  import * as i18n from '@repo/i18n';\r\n\r\n  interface FilterOption {\r\n    value: string;\r\n    label: string;\r\n    icon?: string;\r\n    shortLabel?: string;\r\n    color?: string;\r\n    bgGradient?: string;\r\n  }\r\n\r\n  interface FilterSection {\r\n    key: string;\r\n    label: string;\r\n    type: 'pills' | 'range' | 'custom';\r\n    options?: FilterOption[];\r\n    value?: string | null;\r\n    minValue?: string;\r\n    maxValue?: string;\r\n    placeholder?: { min?: string; max?: string };\r\n  }\r\n\r\n  interface Props {\r\n    open?: boolean;\r\n    sections: FilterSection[];\r\n    appliedFilters: Record<string, any>;\r\n    pendingFilters: Record<string, any>;\r\n    previewResultCount?: number;\r\n    totalResultCount?: number;\r\n    class?: string;\r\n    title?: string;\r\n    applyLabel?: string;\r\n    cancelLabel?: string;\r\n    clearLabel?: string;\r\n    closeLabel?: string;\r\n    minPriceLabel?: string;\r\n    maxPriceLabel?: string;\r\n    onApply?: (filters: Record<string, any>) => void;\r\n    onCancel?: () => void;\r\n    onClear?: () => void;\r\n    onPendingFilterChange?: (key: string, value: any) => void;\r\n    trigger?: Snippet;\r\n    customSection?: Snippet<[FilterSection]>;\r\n    /** Announce filter changes to screen readers */\r\n    announceChanges?: boolean;\r\n    /** Custom announcement template for filter changes */\r\n    announcementTemplate?: (filterKey: string, filterValue: any, sectionLabel: string) => string;\r\n  }\r\n\r\n  let {\r\n    open = $bindable(false),\r\n    sections,\r\n    appliedFilters,\r\n    pendingFilters,\r\n    previewResultCount,\r\n    totalResultCount,\r\n    class: className = '',\r\n    title = 'Filter Products',\r\n    applyLabel = 'Apply Filters',\r\n    cancelLabel = 'Cancel',\r\n    clearLabel = 'Clear All',\r\n    closeLabel = 'Close',\r\n    minPriceLabel = 'Min',\r\n    maxPriceLabel = 'Max',\r\n    onApply,\r\n    onCancel,\r\n    onClear,\r\n    onPendingFilterChange,\r\n    trigger,\r\n    customSection,\r\n    announceChanges = true,\r\n    announcementTemplate\r\n  }: Props = $props();\r\n\r\n  // Focus management\r\n  let triggerElement: HTMLElement | null = null;\r\n  let firstFocusableElement: HTMLElement | null = null;\r\n  let lastFocusableElement: HTMLElement | null = null;\r\n  let modalContentRef = $state<HTMLDivElement>();\r\n  let announcement = $state('');\r\n\r\n  // Simple dialog placeholder implementation\r\n  let isOpen = $state(open);\r\n\r\n  // Create dummy elements to match melt-ui interface\r\n  const triggerEl = $derived({\r\n    'data-melt-dialog-trigger': '',\r\n    onclick: () => {\r\n      isOpen = true;\r\n      triggerElement = document.activeElement as HTMLElement;\r\n    }\r\n  });\r\n\r\n  const overlay = $derived({\r\n    'data-melt-dialog-overlay': '',\r\n    onclick: () => {\r\n      isOpen = false;\r\n      restoreFocus();\r\n    }\r\n  });\r\n\r\n  const content = $derived({\r\n    'data-melt-dialog-content': '',\r\n    role: 'dialog',\r\n    'aria-modal': true\r\n  });\r\n\r\n  const titleEl = $derived({\r\n    'data-melt-dialog-title': ''\r\n  });\r\n\r\n  const close = $derived({\r\n    'data-melt-dialog-close': '',\r\n    onclick: () => {\r\n      isOpen = false;\r\n      restoreFocus();\r\n    }\r\n  });\r\n\r\n  // Sync external open state with internal state\r\n  $effect(() => {\r\n    if (open !== isOpen) {\r\n      isOpen = open;\r\n    }\r\n  });\r\n  \r\n  // Focus management functions\r\n  function getFocusableElements(container: HTMLElement): HTMLElement[] {\r\n    const focusableSelectors = [\r\n      'button:not([disabled])',\r\n      'input:not([disabled])',\r\n      'select:not([disabled])',\r\n      'textarea:not([disabled])',\r\n      'a[href]',\r\n      '[tabindex]:not([tabindex=\"-1\"])'\r\n    ].join(', ');\r\n    \r\n    return Array.from(container.querySelectorAll(focusableSelectors));\r\n  }\r\n  \r\n  function setupFocusTrap() {\r\n    if (!modalContentRef) return;\r\n    \r\n    const focusableElements = getFocusableElements(modalContentRef);\r\n    if (focusableElements.length === 0) return;\r\n    \r\n    firstFocusableElement = focusableElements[0];\r\n    lastFocusableElement = focusableElements[focusableElements.length - 1];\r\n    \r\n    // Focus the first element\r\n    setTimeout(() => {\r\n      firstFocusableElement?.focus();\r\n    }, 100);\r\n  }\r\n  \r\n  function handleKeydown(event: KeyboardEvent) {\r\n    if (!isOpen) return;\r\n\r\n    const { key, shiftKey } = event;\r\n\r\n    if (key === 'Escape') {\r\n      event.preventDefault();\r\n      handleCancel();\r\n      return;\r\n    }\r\n\r\n    if (key === 'Tab') {\r\n      if (!firstFocusableElement || !lastFocusableElement) return;\r\n\r\n      if (shiftKey) {\r\n        // Shift + Tab\r\n        if (document.activeElement === firstFocusableElement) {\r\n          event.preventDefault();\r\n          lastFocusableElement.focus();\r\n        }\r\n      } else {\r\n        // Tab\r\n        if (document.activeElement === lastFocusableElement) {\r\n          event.preventDefault();\r\n          firstFocusableElement.focus();\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  function restoreFocus() {\r\n    if (triggerElement) {\r\n      setTimeout(() => {\r\n        triggerElement?.focus();\r\n        triggerElement = null;\r\n      }, 100);\r\n    }\r\n  }\r\n  \r\n  // Setup focus trap when modal opens\r\n  $effect(() => {\r\n    if (isOpen && modalContentRef) {\r\n      setupFocusTrap();\r\n      document.addEventListener('keydown', handleKeydown);\r\n\r\n      return () => {\r\n        document.removeEventListener('keydown', handleKeydown);\r\n      };\r\n    }\r\n  });\r\n\r\n  // Local filter state tracking pending changes\r\n  let localFilters = $state<Record<string, any>>({});\r\n\r\n  // Initialize local filters from pending filters\r\n  $effect(() => {\r\n    localFilters = { ...pendingFilters };\r\n  });\r\n\r\n  // Handle individual filter changes\r\n  function handleFilterChange(key: string, value: any) {\r\n    const section = sections.find(s => s.key === key || key.startsWith(s.key));\r\n    \r\n    localFilters[key] = value;\r\n    onPendingFilterChange?.(key, value);\r\n    \r\n    // Announce filter changes\r\n    if (announceChanges && section) {\r\n      if (announcementTemplate) {\r\n        announcement = announcementTemplate(key, value, section.label);\r\n      } else {\r\n        if (key.includes('_min') || key.includes('_max')) {\r\n          const type = key.includes('_min') ? 'minimum' : 'maximum';\r\n          const displayValue = value || 'not set';\r\n          announcement = `${section.label} ${type} set to ${displayValue}`;\r\n        } else {\r\n          const displayValue = value === 'all' ? 'all options' : value;\r\n          announcement = `${section.label} filter set to ${displayValue}. Preview shows ${previewResultCount || 0} results`;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Handle price range input\r\n  function handlePriceInput(key: string, type: 'min' | 'max', event: Event) {\r\n    const target = event.target as HTMLInputElement;\r\n    const rangeKey = `${key}_${type}`;\r\n    localFilters[rangeKey] = target.value;\r\n    onPendingFilterChange?.(rangeKey, target.value);\r\n  }\r\n\r\n  // Apply all filters and close modal\r\n  function handleApply() {\r\n    onApply?.(localFilters);\r\n    \r\n    // Announce application\r\n    if (announceChanges) {\r\n      announcement = `Applied filters. Showing ${previewResultCount || 0} results`;\r\n    }\r\n    \r\n    open = false;\r\n  }\r\n\r\n  // Cancel changes and close modal\r\n  function handleCancel() {\r\n    // Reset local filters to applied state\r\n    localFilters = { ...appliedFilters };\r\n    onCancel?.();\r\n    open = false;\r\n  }\r\n\r\n  // Clear all filters\r\n  function handleClear() {\r\n    // Reset all filter values to defaults\r\n    Object.keys(localFilters).forEach(key => {\r\n      if (key.includes('_min') || key.includes('_max')) {\r\n        localFilters[key] = '';\r\n      } else {\r\n        localFilters[key] = key === 'sortBy' ? 'relevance' : 'all';\r\n      }\r\n    });\r\n    \r\n    // Update pending filters\r\n    Object.keys(localFilters).forEach(key => {\r\n      onPendingFilterChange?.(key, localFilters[key]);\r\n    });\r\n    \r\n    // Announce clearing\r\n    if (announceChanges) {\r\n      announcement = `All filters cleared. Preview shows ${totalResultCount || 0} results`;\r\n    }\r\n    \r\n    onClear?.();\r\n  }\r\n  \r\n  // Clear announcement after it's been read\r\n  $effect(() => {\r\n    if (announcement) {\r\n      const timer = setTimeout(() => {\r\n        announcement = '';\r\n      }, 1000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  });\r\n\r\n  // Check if any filters have pending changes\r\n  const hasPendingChanges = $derived.by(() => {\r\n    return Object.keys(localFilters).some(key => {\r\n      const applied = appliedFilters[key];\r\n      const pending = localFilters[key];\r\n      return applied !== pending;\r\n    });\r\n  });\r\n\r\n  // Check if any filters are active\r\n  const hasActiveFilters = $derived.by(() => {\r\n    return Object.entries(localFilters).some(([key, value]) => {\r\n      if (key.includes('_min') || key.includes('_max')) {\r\n        return value !== '';\r\n      }\r\n      if (key === 'sortBy') {\r\n        return value !== 'relevance';\r\n      }\r\n      return value !== 'all' && value !== null;\r\n    });\r\n  });\r\n\r\n  // Active filter count for display\r\n  const activeFilterCount = $derived.by(() => {\r\n    return Object.entries(appliedFilters).reduce((count, [key, value]) => {\r\n      if (key.includes('_min') || key.includes('_max')) {\r\n        return count; // Price range counts as 1 filter, handled elsewhere\r\n      }\r\n      if (key === 'sortBy') {\r\n        return value !== 'relevance' ? count + 1 : count;\r\n      }\r\n      return value !== 'all' && value !== null && value !== '' ? count + 1 : count;\r\n    }, 0) + (appliedFilters.minPrice || appliedFilters.maxPrice ? 1 : 0);\r\n  });\r\n</script>\r\n\r\n<!-- Trigger Button (if provided) -->\r\n{#if trigger}\r\n  <button \r\n    use:triggerEl\r\n    class=\"relative flex items-center gap-1.5 h-9 px-3 rounded-[var(--radius-lg)] text-sm font-medium \r\n           transition-colors duration-[var(--duration-base)]\r\n           min-h-[var(--touch-standard)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)] focus-visible:ring-offset-2\r\n           {activeFilterCount > 0 \r\n             ? 'bg-[color:var(--primary)] text-[color:var(--primary-fg)]' \r\n             : 'bg-[color:var(--surface-subtle)] text-[color:var(--text-secondary)] hover:bg-[color:var(--surface-muted)] hover:text-[color:var(--text-primary)]'}\"\r\n    aria-label=\"Open filters\"\r\n    aria-describedby={activeFilterCount > 0 ? 'filter-count-description' : undefined}\r\n  >\r\n    {@render trigger()}\r\n    {#if activeFilterCount > 0}\r\n      <span \r\n        id=\"filter-count-description\"\r\n        class=\"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 \r\n               bg-[color:var(--danger-500)] text-[color:var(--danger-50)] \r\n               rounded-full text-xs font-semibold flex items-center justify-center\"\r\n        aria-label=\"{activeFilterCount} filters applied\"\r\n      >\r\n        {activeFilterCount}\r\n      </span>\r\n    {/if}\r\n  </button>\r\n{/if}\r\n\r\n<!-- Modal Dialog -->\r\n{#if isOpen}\r\n  <!-- Backdrop -->\r\n  <button\r\n    class=\"fixed inset-0 z-50 bg-[color:var(--modal-overlay)] backdrop-blur-sm cursor-default\"\r\n    style=\"z-index: 9999;\"\r\n    onclick={() => {\r\n      isOpen = false;\r\n      restoreFocus();\r\n    }}\r\n    onkeydown={(e) => e.key === 'Enter' && (() => {\r\n      isOpen = false;\r\n      restoreFocus();\r\n    })()}\r\n    aria-label=\"Close filter modal\"\r\n  ></button>\r\n\r\n  <!-- Dialog Content - Mobile-first responsive -->\r\n  <div\r\n    bind:this={modalContentRef}\r\n    class=\"fixed inset-x-0 bottom-0 z-50 sm:left-1/2 sm:top-1/2 sm:bottom-auto sm:w-full sm:max-w-lg sm:-translate-x-1/2 sm:-translate-y-1/2 sm:inset-x-auto\r\n           bg-[color:var(--modal-bg)] sm:rounded-[var(--modal-radius)] shadow-[var(--modal-shadow)] border-t border-[color:var(--border-subtle)] sm:border\r\n           max-h-[90vh] overflow-hidden flex flex-col {className}\"\r\n    style=\"z-index: 10000;\"\r\n    role=\"dialog\"\r\n    aria-labelledby=\"filter-modal-title\"\r\n    aria-describedby=\"filter-modal-description\"\r\n    aria-modal=\"true\"\r\n  >\r\n    <!-- Header -->\r\n    <div class=\"flex items-center justify-between p-4 border-b border-[color:var(--border-subtle)] bg-[color:var(--surface-base)]\">\r\n      <div class=\"flex-1\">\r\n        <h2\r\n          id=\"filter-modal-title\"\r\n          class=\"text-lg font-semibold text-[color:var(--text-primary)] leading-6\"\r\n        >\r\n          {title}\r\n        </h2>\r\n        <p id=\"filter-modal-description\" class=\"text-sm text-[color:var(--text-secondary)] mt-0.5\">\r\n          {#if previewResultCount !== undefined}\r\n            Preview: {previewResultCount.toLocaleString()} results\r\n            {#if hasPendingChanges}\r\n              <span class=\"text-[color:var(--warning-600)]\">(unsaved changes)</span>\r\n            {/if}\r\n          {:else}\r\n            Use filters to find exactly what you're looking for\r\n          {/if}\r\n        </p>\r\n      </div>\r\n      \r\n      <button\r\n        onclick={() => {\r\n          isOpen = false;\r\n          restoreFocus();\r\n        }}\r\n        class=\"p-2 rounded-[var(--radius-md)] hover:bg-[color:var(--surface-subtle)]\r\n               transition-colors duration-[var(--duration-base)]\r\n               focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)]\"\r\n        aria-label={closeLabel}\r\n      >\r\n        <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\r\n        </svg>\r\n      </button>\r\n    </div>\r\n\r\n    <!-- Scrollable Content -->\r\n    <div class=\"flex-1 overflow-y-auto py-1\">\r\n      {#each sections as section (section.key)}\r\n        <div class=\"border-b border-[color:var(--border-subtle)] py-4 last:border-b-0\">\r\n          <h3 class=\"text-xs font-semibold text-[color:var(--text-tertiary)] uppercase tracking-wide px-4 mb-3\">\r\n            {section.label}\r\n          </h3>\r\n          \r\n          {#if section.type === 'pills' && section.options}\r\n            <div class=\"px-4\">\r\n              <FilterPillGroup\r\n                bind:value={localFilters[section.key]}\r\n                options={[{ value: 'all', label: i18n.category_all() }, ...section.options]}\r\n                onValueChange={(value) => handleFilterChange(section.key, value)}\r\n                announceChanges={false}\r\n                class=\"flex-wrap gap-2\"\r\n                pillClass=\"min-h-8\"\r\n              />\r\n            </div>\r\n          {:else if section.type === 'range'}\r\n            <div class=\"px-4\">\r\n              <div class=\"flex gap-2 items-center\">\r\n                <div class=\"flex-1\">\r\n                  <input\r\n                    type=\"number\"\r\n                    placeholder={section.placeholder?.min || minPriceLabel}\r\n                    value={localFilters[`${section.key}_min`] || ''}\r\n                    oninput={(e) => handlePriceInput(section.key, 'min', e)}\r\n                    class=\"w-full px-3 py-2 border border-[color:var(--border-default)] rounded-[var(--radius-md)] \r\n                           text-sm text-center min-h-[var(--touch-standard)]\r\n                           bg-[color:var(--surface-base)] text-[color:var(--text-primary)]\r\n                           focus:outline-none focus:ring-2 focus:ring-[color:var(--state-focus)] focus:border-transparent\r\n                           transition-colors duration-[var(--duration-base)]\"\r\n                    aria-label=\"{section.label} minimum value\"\r\n                  />\r\n                </div>\r\n                \r\n                <span class=\"text-[color:var(--text-tertiary)] text-sm\" aria-hidden=\"true\">-</span>\r\n                \r\n                <div class=\"flex-1\">\r\n                  <input\r\n                    type=\"number\"\r\n                    placeholder={section.placeholder?.max || maxPriceLabel}\r\n                    value={localFilters[`${section.key}_max`] || ''}\r\n                    oninput={(e) => handlePriceInput(section.key, 'max', e)}\r\n                    class=\"w-full px-3 py-2 border border-[color:var(--border-default)] rounded-[var(--radius-md)] \r\n                           text-sm text-center min-h-[var(--touch-standard)]\r\n                           bg-[color:var(--surface-base)] text-[color:var(--text-primary)]\r\n                           focus:outline-none focus:ring-2 focus:ring-[color:var(--state-focus)] focus:border-transparent\r\n                           transition-colors duration-[var(--duration-base)]\"\r\n                    aria-label=\"{section.label} maximum value\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          {:else if section.type === 'custom' && customSection}\r\n            <div class=\"px-4\">\r\n              {@render customSection(section)}\r\n            </div>\r\n          {/if}\r\n        </div>\r\n      {/each}\r\n    </div>\r\n\r\n    <!-- Footer Actions -->\r\n    <div class=\"border-t border-[color:var(--border-subtle)] p-4 bg-[color:var(--surface-subtle)] flex flex-col gap-3 sm:flex-row-reverse sm:gap-2\">\r\n      <!-- Apply Button -->\r\n      <button\r\n        onclick={handleApply}\r\n        class=\"flex items-center justify-center gap-2 w-full sm:w-auto px-6 py-3 \r\n               bg-[color:var(--primary)] text-[color:var(--primary-fg)] \r\n               rounded-[var(--radius-md)] font-medium text-sm\r\n               min-h-[var(--touch-primary)] \r\n               hover:bg-[color:var(--primary-600)] active:scale-98\r\n               focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[color:var(--state-focus)]\r\n               transition-all duration-[var(--duration-base)]\r\n               {hasPendingChanges ? 'ring-2 ring-[color:var(--primary-200)]' : ''}\r\n               disabled:opacity-50 disabled:cursor-not-allowed\"\r\n        aria-describedby=\"apply-button-description\"\r\n      >\r\n        <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\r\n        </svg>\r\n        {applyLabel}\r\n        {#if hasPendingChanges}\r\n          <span class=\"w-1.5 h-1.5 bg-[color:var(--primary-200)] rounded-full\" aria-hidden=\"true\"></span>\r\n        {/if}\r\n      </button>\r\n      <p id=\"apply-button-description\" class=\"sr-only\">\r\n        {#if hasPendingChanges}\r\n          You have unsaved filter changes. Click to apply them.\r\n        {:else}\r\n          Apply current filter settings\r\n        {/if}\r\n      </p>\r\n      \r\n      <!-- Cancel Button -->\r\n      <button\r\n        onclick={handleCancel}\r\n        class=\"flex items-center justify-center gap-2 w-full sm:w-auto px-4 py-3 \r\n               text-[color:var(--text-secondary)] hover:text-[color:var(--text-primary)] hover:bg-[color:var(--surface-muted)]\r\n               rounded-[var(--radius-md)] font-medium text-sm\r\n               min-h-[var(--touch-standard)]\r\n               focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[color:var(--state-focus)]\r\n               transition-colors duration-[var(--duration-base)]\"\r\n      >\r\n        <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\r\n        </svg>\r\n        {cancelLabel}\r\n      </button>\r\n      \r\n      <!-- Clear Button -->\r\n      {#if hasActiveFilters}\r\n        <button\r\n          onclick={handleClear}\r\n          class=\"flex items-center justify-center gap-2 w-full sm:w-auto px-4 py-3 \r\n                 text-[color:var(--text-secondary)] hover:text-[color:var(--danger-600)] hover:bg-[color:var(--danger-50)]\r\n                 rounded-[var(--radius-md)] font-medium text-sm\r\n                 min-h-[var(--touch-standard)]\r\n                 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[color:var(--state-focus)]\r\n                 transition-colors duration-[var(--duration-base)]\"\r\n        >\r\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n          </svg>\r\n          {clearLabel}\r\n        </button>\r\n      {/if}\r\n    </div>\r\n  </div>\r\n{/if}\r\n\r\n<!-- Live region for announcements -->\r\n{#if announcement}\r\n  <div \r\n    role=\"status\" \r\n    aria-live=\"polite\" \r\n    aria-atomic=\"true\"\r\n    class=\"sr-only\"\r\n  >\r\n    {announcement}\r\n  </div>\r\n{/if}\r\n\r\n<style>\r\n  /* Screen reader only text */\r\n  .sr-only {\r\n    position: absolute;\r\n    width: 1px;\r\n    height: 1px;\r\n    padding: 0;\r\n    margin: -1px;\r\n    overflow: hidden;\r\n    clip: rect(0, 0, 0, 0);\r\n    white-space: nowrap;\r\n    border: 0;\r\n  }\r\n\r\n  /* Smooth modal animations */\r\n  :global([data-dialog-overlay]) {\r\n    animation: fade-in var(--duration-base) var(--ease-out);\r\n  }\r\n  \r\n  :global([data-dialog-content]) {\r\n    animation: modal-in var(--duration-base) var(--ease-out);\r\n  }\r\n  \r\n  @keyframes fade-in {\r\n    from {\r\n      opacity: 0;\r\n    }\r\n    to {\r\n      opacity: 1;\r\n    }\r\n  }\r\n  \r\n  @keyframes modal-in {\r\n    from {\r\n      opacity: 0;\r\n      transform: translateY(100%);\r\n    }\r\n    to {\r\n      opacity: 1;\r\n      transform: translateY(0%);\r\n    }\r\n  }\r\n  \r\n  /* Desktop modal animation */\r\n  @media (min-width: 640px) {\r\n    @keyframes modal-in {\r\n      from {\r\n        opacity: 0;\r\n        transform: translate(-50%, -50%) scale(0.95);\r\n      }\r\n      to {\r\n        opacity: 1;\r\n        transform: translate(-50%, -50%) scale(1);\r\n      }\r\n    }\r\n  }\r\n  \r\n  /* Enhanced scrolling */\r\n  .overflow-y-auto {\r\n    -webkit-overflow-scrolling: touch;\r\n    scroll-behavior: smooth;\r\n  }\r\n  \r\n  /* Button press feedback */\r\n  .active\\:scale-98:active {\r\n    transform: scale(0.98);\r\n  }\r\n  \r\n  /* High contrast mode support */\r\n  @media (prefers-contrast: high) {\r\n    [role=\"dialog\"] {\r\n      outline: 3px solid currentColor;\r\n    }\r\n    \r\n    button:focus-visible {\r\n      outline: 3px solid currentColor;\r\n      outline-offset: 2px;\r\n    }\r\n  }\r\n  \r\n  /* Reduced motion support */\r\n  @media (prefers-reduced-motion: reduce) {\r\n    :global([data-dialog-overlay]),\r\n    :global([data-dialog-content]) {\r\n      animation: none;\r\n    }\r\n    \r\n    button {\r\n      transition: none;\r\n    }\r\n    \r\n    button:active {\r\n      transform: none;\r\n    }\r\n    \r\n    .overflow-y-auto {\r\n      scroll-behavior: auto;\r\n    }\r\n  }\r\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\product\\VirtualProductGrid.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[930,933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[930,933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'previousViewportHeight' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":64,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'previousContainerWidth' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":65,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'perf' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":73,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":215,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6903,6906],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6903,6906],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"﻿<script lang=\"ts\">\r\n  import { isBrowser } from '../../utils/runtime.js';\r\n  import ProductCard from '../cards/ProductCard.svelte';\r\n  import ProductCardSkeleton from '../skeleton/ProductCardSkeleton.svelte';\r\n  import type { Product } from '../../types/product';\r\n  // Simple throttle implementation\r\n  function throttle<T extends unknown[]>(fn: (...args: T) => void, limit: number) {\r\n    let inThrottle: boolean;\r\n    return function(...args: T) {\r\n      if (!inThrottle) {\r\n        fn(...args);\r\n        inThrottle = true;\r\n        setTimeout(() => inThrottle = false, limit);\r\n      }\r\n    };\r\n  }\r\n\r\n\r\n  interface Props {\r\n    items: Product[];\r\n    itemHeight?: number;\r\n    containerHeight?: number;\r\n    gap?: number;\r\n    itemsPerRow?: number;\r\n    onProductClick?: (product: Product) => void;\r\n    onFavorite?: (product: Product) => void;\r\n    class?: string;\r\n    loading?: boolean;\r\n    translations?: Record<string, any>;\r\n    onEndReached?: () => void;\r\n    endThreshold?: number;\r\n    scrollParent?: 'self' | 'window';\r\n    topOffset?: number;\r\n    bottomOffset?: number;\r\n  }\r\n\r\n  let {\r\n    items,\r\n    itemHeight = 300,\r\n    containerHeight = 600,\r\n    gap = 16,\r\n    itemsPerRow = 2, // Default for mobile\r\n    onProductClick,\r\n    onFavorite,\r\n    class: className = '',\r\n    loading = false,\r\n    translations = {},\r\n    onEndReached,\r\n    endThreshold = 200,\r\n    scrollParent = 'self',\r\n    topOffset = 0,\r\n    bottomOffset = 0\r\n  }: Props = $props();\r\n\r\n  let containerElement: HTMLDivElement;\r\n  let sentinelElement = $state<HTMLDivElement>();\r\n  let scrollTop = $state(0);\r\n  let containerWidth = $state(0);\r\n  let mounted = $state(false);\r\n  let viewportHeightState = $state(containerHeight);\r\n  \r\n  // Pre-DOM measurement state\r\n  let previousScrollHeight = $state(0);\r\n  let previousViewportHeight = $state(0);\r\n  let previousContainerWidth = $state(0);\r\n  \r\n  // Simple performance monitoring (optional)\r\n  type PerformanceTimers = {\r\n    startTiming: (label: string) => void;\r\n    endTiming: (label: string) => void;\r\n  };\r\n\r\n  const perf: PerformanceTimers | null = null;\r\n\r\n  // Calculate responsive items per row\r\n  const responsiveItemsPerRow = $derived(() => {\r\n    if (!mounted) return itemsPerRow;\r\n    \r\n    const width = containerWidth || (isBrowser ? window.innerWidth : 768);\r\n    if (width >= 1280) return 5; // xl\r\n    if (width >= 1024) return 4; // lg\r\n    if (width >= 768) return 3;  // md\r\n    if (width >= 640) return 2;  // sm\r\n    return 2; // mobile\r\n  });\r\n\r\n  // Calculate visible range\r\n  const visibleRange = $derived(() => {\r\n    const itemsInRow = responsiveItemsPerRow();\r\n    const totalRows = Math.ceil(items.length / itemsInRow);\r\n    const rowHeight = itemHeight + gap;\r\n    const vpHeight = scrollParent === 'self' ? containerHeight : viewportHeightState;\r\n\r\n    const startRow = Math.floor(scrollTop / rowHeight);\r\n    const endRow = Math.min(\r\n      totalRows - 1,\r\n      startRow + Math.ceil(vpHeight / rowHeight) + 1 // Buffer\r\n    );\r\n\r\n    const startIndex = startRow * itemsInRow;\r\n    const endIndex = Math.min(items.length - 1, (endRow + 1) * itemsInRow - 1);\r\n\r\n    return {\r\n      startIndex: Math.max(0, startIndex),\r\n      endIndex: Math.max(0, endIndex),\r\n      startRow,\r\n      endRow,\r\n      totalRows,\r\n      rowHeight\r\n    };\r\n  });\r\n\r\n  // Get visible items\r\n  const visibleItems = $derived(() => {\r\n    const { startIndex, endIndex } = visibleRange();\r\n    return items.slice(startIndex, endIndex + 1).map((item, index) => ({\r\n      ...item,\r\n      virtualIndex: startIndex + index\r\n    })) as (Product & { virtualIndex: number })[];\r\n  });\r\n\r\n  // Calculate total height\r\n  const totalHeight = $derived(() => {\r\n    const { totalRows, rowHeight } = visibleRange();\r\n    return totalRows * rowHeight;\r\n  });\r\n\r\n  // Calculate offset for visible items\r\n  const offsetY = $derived(() => {\r\n    const { startRow, rowHeight } = visibleRange();\r\n    return startRow * rowHeight;\r\n  });\r\n\r\n  // Throttled scroll handler for better performance\r\n  const handleScroll = throttle((event: Event) => {\r\n    if (scrollParent === 'self') {\r\n      const target = event.target as HTMLDivElement;\r\n      scrollTop = target.scrollTop;\r\n    } else {\r\n      updateScrollTopFromWindow();\r\n    }\r\n  }, 16); // ~60fps\r\n\r\n  function handleResize() {\r\n    if (containerElement) {\r\n      containerWidth = containerElement.clientWidth;\r\n    }\r\n  }\r\n\r\n  function updateScrollTopFromWindow() {\r\n    if (!containerElement) return;\r\n    const rect = containerElement.getBoundingClientRect();\r\n    const viewportStart = topOffset; // px from viewport top where content is visible\r\n    const y = (viewportStart - rect.top);\r\n    // scrollTop within container space\r\n    scrollTop = Math.max(0, y);\r\n  }\r\n\r\n  // $effect.pre() for DOM measurements before updates\r\n  $effect.pre(() => {\r\n    // Capture dimensions before any DOM changes from reactive updates\r\n    if (containerElement) {\r\n      previousScrollHeight = containerElement.scrollHeight;\r\n      previousContainerWidth = containerElement.clientWidth;\r\n    }\r\n    \r\n    // Capture viewport height before window resize effects\r\n    if (isBrowser && scrollParent === 'window') {\r\n      previousViewportHeight = window.innerHeight;\r\n    }\r\n  });\r\n\r\n  // Use $effect for lifecycle management\r\n  $effect(() => {\r\n    if (!isBrowser || !containerElement) return;\r\n    mounted = true;\r\n    \r\n    // Check if we need to preserve scroll position after layout changes\r\n    if (previousScrollHeight > 0 && containerElement.scrollHeight !== previousScrollHeight) {\r\n      // Maintain relative scroll position when content height changes\r\n      const scrollRatio = scrollTop / previousScrollHeight;\r\n      const newScrollTop = scrollRatio * containerElement.scrollHeight;\r\n      if (Math.abs(newScrollTop - scrollTop) > 10) { // Only adjust if significant change\r\n        requestAnimationFrame(() => {\r\n          if (containerElement) {\r\n            containerElement.scrollTop = newScrollTop;\r\n            scrollTop = newScrollTop;\r\n          }\r\n        });\r\n      }\r\n    }\r\n    \r\n    handleResize();\r\n    const resizeObserver = new ResizeObserver(throttle(handleResize, 100));\r\n    resizeObserver.observe(containerElement);\r\n\r\n    const onWindowResize = throttle(() => {\r\n      if (scrollParent === 'window') {\r\n        // Compute viewport height minus offsets\r\n        viewportHeightState = Math.max(0, window.innerHeight - topOffset - bottomOffset);\r\n        updateScrollTopFromWindow();\r\n      }\r\n    }, 16);\r\n\r\n\r\n    if (scrollParent === 'window') {\r\n      viewportHeightState = Math.max(0, window.innerHeight - topOffset - bottomOffset);\r\n      updateScrollTopFromWindow();\r\n      window.addEventListener('resize', onWindowResize);\r\n    }\r\n\r\n    return () => {\r\n      resizeObserver.disconnect();\r\n      if (scrollParent === 'window') {\r\n        window.removeEventListener('resize', onWindowResize as any);\r\n      }\r\n    };\r\n  });\r\n\r\n  // IntersectionObserver for end-reached detection\r\n  $effect(() => {\r\n    if (!isBrowser || !sentinelElement || !onEndReached || loading) return;\r\n\r\n    const observer = new IntersectionObserver(\r\n      (entries) => {\r\n        const entry = entries[0];\r\n        if (entry?.isIntersecting) {\r\n          onEndReached();\r\n        }\r\n      },\r\n      {\r\n        root: scrollParent === 'self' ? containerElement : null,\r\n        rootMargin: `0px 0px ${endThreshold}px 0px`,\r\n        threshold: 0\r\n      }\r\n    );\r\n\r\n    observer.observe(sentinelElement);\r\n\r\n    return () => {\r\n      observer.disconnect();\r\n    };\r\n  });\r\n\r\n  // Grid positioning for items\r\n  function getItemPosition(index: number) {\r\n    const itemsInRow = responsiveItemsPerRow();\r\n    const row = Math.floor(index / itemsInRow);\r\n    const col = index % itemsInRow;\r\n    const itemWidth = (containerWidth - (itemsInRow - 1) * gap) / itemsInRow;\r\n    \r\n    return {\r\n      x: col * (itemWidth + gap),\r\n      y: row * (itemHeight + gap),\r\n      width: itemWidth\r\n    };\r\n  }\r\n</script>\r\n\r\n{#snippet loadingState()}\r\n  <div class=\"absolute inset-0 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 p-4\">\r\n    {#each Array(20) as _}\r\n      <ProductCardSkeleton />\r\n    {/each}\r\n  </div>\r\n{/snippet}\r\n\r\n{#snippet visibleItemsGrid()}\r\n  <div \r\n    class=\"absolute w-full\"\r\n    style=\"transform: translateY({offsetY}px);\"\r\n  >\r\n    {#each visibleItems() as item (item.id)}\r\n      {@render virtualizedProductItem(item)}\r\n    {/each}\r\n  </div>\r\n{/snippet}\r\n\r\n{#snippet virtualizedProductItem(item: Product & { virtualIndex: number })}\r\n  {@const position = getItemPosition(item.virtualIndex % responsiveItemsPerRow())}\r\n  <div\r\n    class=\"absolute\"\r\n    style=\"\r\n      left: {position.x}px;\r\n      top: {(Math.floor(item.virtualIndex / responsiveItemsPerRow()) - visibleRange().startRow) * (itemHeight + gap)}px;\r\n      width: {position.width}px;\r\n      height: {itemHeight}px;\r\n    \"\r\n  >\r\n    <ProductCard\r\n      product={item}\r\n      onclick={() => onProductClick?.(item)}\r\n      onFavorite={() => onFavorite?.(item)}\r\n      {translations}\r\n      class=\"h-full\"\r\n    />\r\n  </div>\r\n{/snippet}\r\n\r\n{#snippet emptyState()}\r\n  <div class=\"absolute inset-0 flex items-center justify-center\">\r\n    <div class=\"text-center\">\r\n      <svg class=\"w-16 h-16 mx-auto text-gray-300 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n      </svg>\r\n      <h3 class=\"text-lg font-medium text-gray-900 mb-2\">No products found</h3>\r\n      <p class=\"text-gray-500\">Try adjusting your search or filters</p>\r\n    </div>\r\n  </div>\r\n{/snippet}\r\n\r\n<div \r\n  bind:this={containerElement}\r\n  class=\"virtual-grid-container {className}\"\r\n  style={scrollParent === 'self' ? `height: ${containerHeight}px; overflow-y:auto;` : `min-height: ${viewportHeightState}px; overflow: visible;`}\r\n  onscroll={scrollParent === 'self' ? handleScroll : undefined}\r\n>\r\n  <!-- Total height spacer -->\r\n  <div style=\"height: {totalHeight}px; position: relative;\">\r\n    \r\n    <!-- Grid Content States -->\r\n    {#if loading}\r\n      {@render loadingState()}\r\n    {:else if visibleItems().length > 0}\r\n      {@render visibleItemsGrid()}\r\n    {:else}\r\n      {@render emptyState()}\r\n    {/if}\r\n    \r\n    <!-- Sentinel element for end-reached detection -->\r\n    {#if items.length > 0 && onEndReached}\r\n      <div\r\n        bind:this={sentinelElement}\r\n        class=\"absolute bottom-0 left-0 w-full h-px\"\r\n        style=\"transform: translateY(-{endThreshold}px);\"\r\n        aria-hidden=\"true\"\r\n      ></div>\r\n    {/if}\r\n  </div>\r\n</div>\r\n\r\n<style>\r\n  .virtual-grid-container { position: relative; contain: strict; overflow-anchor: none; }\r\n\r\n  /* Smooth scrolling */\r\n  .virtual-grid-container { scroll-behavior: auto; scrollbar-width: thin; scrollbar-color: #cbd5e0 #f7fafc; }\r\n\r\n  .virtual-grid-container::-webkit-scrollbar {\r\n    width: 6px;\r\n  }\r\n\r\n  .virtual-grid-container::-webkit-scrollbar-track {\r\n    background: #f7fafc;\r\n  }\r\n\r\n  .virtual-grid-container::-webkit-scrollbar-thumb {\r\n    background: #cbd5e0;\r\n    border-radius: 3px;\r\n  }\r\n\r\n  .virtual-grid-container::-webkit-scrollbar-thumb:hover {\r\n    background: #a0aec0;\r\n  }\r\n\r\n  /* Performance optimizations - container-level containment only */\r\n\r\n  /* Reduced motion support */\r\n  @media (prefers-reduced-motion: reduce) {\r\n    .virtual-grid-container {\r\n      scroll-behavior: auto;\r\n    }\r\n  }\r\n</style>\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\skeleton\\CategoryCardSkeleton.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\skeleton\\ImageSkeleton.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\skeleton\\ListItemSkeleton.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\skeleton\\ProductCardSkeleton.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\skeleton\\ProductDetailSkeleton.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\skeleton\\SellerCardSkeleton.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\skeleton\\TextSkeleton.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\skeleton\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\ui\\Accordion.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[421,424],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[421,424],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<!--\r\n  Enhanced Accordion Component - Uses Melt UI Primitives\r\n  Provides a simple interface for creating accordions with multiple items\r\n  Based on the existing primitive in primitives/accordion/\r\n-->\r\n<script lang=\"ts\">\r\n  import MeltAccordion from '../../primitives/accordion/Accordion.svelte';\r\n  \r\n  interface Props {\r\n    items: Array<{\r\n      title: string;\r\n      content?: string;\r\n      contentSnippet?: () => any;\r\n      id?: string;\r\n    }>;\r\n    allowMultiple?: boolean;\r\n    class?: string;\r\n    variant?: 'default' | 'outline' | 'ghost';\r\n  }\r\n\r\n  let {\r\n    items = [],\r\n    allowMultiple = false,\r\n    class: className = '',\r\n    variant = 'default'\r\n  }: Props = $props();\r\n\r\n  // Transform items to match the primitive's expected format\r\n  const accordionItems = $derived(items.map((item, index) => ({\r\n    id: item.id || `item-${index}`,\r\n    title: item.title,\r\n    content: item.content,\r\n    contentSnippet: item.contentSnippet\r\n  })));\r\n\r\n  function getVariantClasses(variant: string) {\r\n    switch (variant) {\r\n      case 'outline':\r\n        return 'border-2 border-[color:var(--border-emphasis)] bg-transparent';\r\n      case 'ghost':\r\n        return 'border-0 bg-transparent shadow-none';\r\n      default:\r\n        return '';\r\n    }\r\n  }\r\n</script>\r\n\r\n<MeltAccordion\r\n  items={accordionItems}\r\n  multiple={allowMultiple}\r\n  class=\"{getVariantClasses(variant)} {className}\"\r\n/>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\ui\\Avatar.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":29,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import type { AvatarSize, AvatarVariant } from '../../types';\r\n\r\n  interface Props {\r\n    src?: string;\r\n    alt?: string;\r\n    name?: string;\r\n    size?: AvatarSize;\r\n    premium?: boolean;\r\n    variant?: AvatarVariant;\r\n    fallback?: string;\r\n    onclick?: () => void;\r\n    class?: string;\r\n  }\r\n\r\n  let { \r\n    src,\r\n    alt = '',\r\n    name = '',\r\n    size = 'md',\r\n    premium = false,\r\n    variant = 'circle',\r\n    fallback = '',\r\n    onclick,\r\n    class: className = ''\r\n  }: Props = $props();\r\n\r\n  let imageError = $state(false);\r\n  let isLoading = $state(false);\r\n\r\n  const sizeClasses = {\r\n    xs: 'w-8 h-8',\r\n    sm: 'w-10 h-10',\r\n    md: 'w-12 h-12',\r\n    lg: 'w-16 h-16',\r\n    xl: 'w-20 h-20'\r\n  };\r\n\r\n  const textSizes = {\r\n    xs: 'text-xs',\r\n    sm: 'text-sm',\r\n    md: 'text-base',\r\n    lg: 'text-lg',\r\n    xl: 'text-xl'\r\n  };\r\n\r\n  const initial = $derived(() => {\r\n    // Use fallback if provided and not empty\r\n    if (fallback && fallback.trim() && fallback !== '?') {\r\n      return fallback;\r\n    }\r\n    // Use name if available - handle various undefined/null/empty cases\r\n    if (name && typeof name === 'string' && name.trim() && name !== 'Anonymous' && name !== 'User' && name !== 'Unknown User') {\r\n      return name.charAt(0).toUpperCase();\r\n    }\r\n    // Default fallback\r\n    return '?';\r\n  });\r\n  \r\n  function handleImageError() {\r\n    imageError = true;\r\n    isLoading = false;\r\n  }\r\n  \r\n  function handleImageLoad() {\r\n    isLoading = false;\r\n    imageError = false;\r\n  }\r\n  \r\n  // Reset error state when src changes\r\n  $effect(() => {\r\n    if (src) {\r\n      imageError = false;\r\n      isLoading = true;\r\n    }\r\n  });\r\n  \r\n  const shapeClass = $derived(\r\n    variant === 'square' ? 'rounded-xl' : 'rounded-full'\r\n  );\r\n  \r\n  // Clean up - removed unused premium classes\r\n</script>\r\n\r\n{#if onclick}\r\n<button\r\n  type=\"button\"\r\n  onclick={onclick}\r\n  class=\"relative block {sizeClasses[size]} {shapeClass} {premium ? 'ring-1 ring-violet-500' : ''} cursor-pointer focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary {className} overflow-hidden\"\r\n>\r\n  {#if src && !imageError}\r\n    <img\r\n      {src}\r\n      {alt}\r\n      onerror={handleImageError}\r\n      onload={handleImageLoad}\r\n      class=\"w-full h-full object-cover\"\r\n      loading=\"lazy\"\r\n    />\r\n  {:else}\r\n    <div class=\"flex items-center justify-center w-full h-full bg-[color:var(--surface-muted)]\">\r\n      <span class=\"font-semibold text-[color:var(--text-muted)] {textSizes[size]}\">{initial()}</span>\r\n    </div>\r\n  {/if}\r\n</button>\r\n{:else}\r\n<div\r\n  class=\"relative block {sizeClasses[size]} {shapeClass} {premium ? 'ring-1 ring-violet-500' : ''} cursor-default {className} overflow-hidden\"\r\n>\r\n  {#if src && !imageError}\r\n    <img\r\n      {src}\r\n      {alt}\r\n      onerror={handleImageError}\r\n      onload={handleImageLoad}\r\n      class=\"w-full h-full object-cover\"\r\n      loading=\"lazy\"\r\n    />\r\n  {:else}\r\n    <div class=\"flex items-center justify-center w-full h-full bg-[color:var(--surface-muted)]\">\r\n      <span class=\"font-semibold text-[color:var(--text-muted)] {textSizes[size]}\">{initial()}</span>\r\n    </div>\r\n  {/if}\r\n</div>\r\n{/if}","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\ui\\AvatarUploader.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'errorText' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":28,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1731,1734],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1731,1734],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  interface Props {\n    currentAvatar?: string;\n    onUpload?: (avatarUrl: string) => void;\n    onError?: (error: string) => void;\n    uploadFunction: (file: File) => Promise<string>;\n    disabled?: boolean;\n    // Translation props\n    uploadingText?: string;\n    uploadText?: string;\n    changePhotoText?: string;\n    dropHereText?: string;\n    errorText?: string;\n    selectFileText?: string;\n  }\n\n  let { \n    currentAvatar = '',\n    onUpload,\n    onError,\n    uploadFunction,\n    disabled = false,\n    // Translation defaults\n    uploadingText = 'Uploading...',\n    uploadText = 'Upload Photo',\n    changePhotoText = 'Change Photo',\n    dropHereText = 'Drop Here',\n    errorText = 'Upload failed',\n    selectFileText = 'Select a photo'\n  }: Props = $props();\n\n\n  let fileInput: HTMLInputElement;\n  let uploading = $state(false);\n  let isDragging = $state(false);\n  let error = $state('');\n\n  // File validation\n  function validateFile(file: File): string | null {\n    if (!file.type.startsWith('image/')) {\n      return 'Please select an image file (JPG, PNG, or WEBP)';\n    }\n    \n    // 10MB limit\n    if (file.size > 10 * 1024 * 1024) {\n      const sizeMB = Math.round(file.size / (1024 * 1024) * 10) / 10;\n      return `Image is ${sizeMB}MB. Please use an image smaller than 10MB.`;\n    }\n    \n    return null;\n  }\n\n  // Process file upload\n  async function processUpload(file: File) {\n    const validationError = validateFile(file);\n    if (validationError) {\n      error = validationError;\n      onError?.(validationError);\n      return;\n    }\n\n    uploading = true;\n    error = '';\n\n    try {\n      const avatarUrl = await uploadFunction(file);\n      onUpload?.(avatarUrl);\n    } catch (uploadError: any) {\n      const errorMsg = uploadError?.message || 'Failed to upload avatar';\n      error = errorMsg;\n      onError?.(errorMsg);\n    } finally {\n      uploading = false;\n    }\n  }\n\n  // File input handler\n  async function handleFileSelect(event: Event) {\n    const input = event.target as HTMLInputElement;\n    if (input.files?.[0]) {\n      await processUpload(input.files[0]);\n      // Reset input\n      input.value = '';\n    }\n  }\n\n  // Drag and drop handlers\n  function handleDragOver(event: DragEvent) {\n    event.preventDefault();\n    if (!disabled && !uploading) {\n      isDragging = true;\n    }\n  }\n\n  function handleDragLeave(event: DragEvent) {\n    event.preventDefault();\n    if (!(event.currentTarget as HTMLElement)?.contains?.(event.relatedTarget as Node)) {\n      isDragging = false;\n    }\n  }\n\n  async function handleDrop(event: DragEvent) {\n    event.preventDefault();\n    isDragging = false;\n    \n    if (disabled || uploading || !event.dataTransfer?.files?.[0]) {\n      return;\n    }\n    \n    await processUpload(event.dataTransfer.files[0]);\n  }\n\n  // Trigger file input\n  function triggerFileInput() {\n    if (!disabled && !uploading) {\n      error = '';\n      fileInput?.click();\n    }\n  }\n\n  // Handle keyboard interaction\n  function handleKeyDown(event: KeyboardEvent) {\n    if ((event.key === 'Enter' || event.key === ' ') && !disabled && !uploading) {\n      event.preventDefault();\n      triggerFileInput();\n    }\n  }\n</script>\n\n<div class=\"space-y-4\">\n  <!-- Upload Area -->\n  <div\n    class=\"relative border-2 border-dashed rounded-xl p-6 text-center cursor-pointer transition-colors duration-200 {isDragging \n      ? 'border-blue-500 bg-blue-50' \n      : 'border-gray-300 hover:border-gray-400 hover:bg-gray-50'} {disabled || uploading \n      ? 'opacity-50 cursor-not-allowed' \n      : ''}\"\n    onclick={triggerFileInput}\n    ondrop={handleDrop}\n    ondragover={handleDragOver}\n    ondragleave={handleDragLeave}\n    onkeydown={handleKeyDown}\n    role=\"button\"\n    tabindex=\"0\"\n    aria-label={currentAvatar ? changePhotoText : uploadText}\n    aria-disabled={disabled || uploading}\n  >\n    {#if uploading}\n      <div class=\"flex flex-col items-center space-y-2\">\n        <div class=\"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin\"></div>\n        <span class=\"text-sm text-blue-600 font-medium\">{uploadingText}</span>\n      </div>\n    {:else if isDragging}\n      <div class=\"flex flex-col items-center space-y-2\">\n        <svg class=\"h-8 w-8 text-blue-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" \n            d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\" />\n        </svg>\n        <span class=\"text-sm text-blue-600 font-medium\">{dropHereText}</span>\n      </div>\n    {:else}\n      <div class=\"flex flex-col items-center space-y-2\">\n        <svg class=\"h-8 w-8 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" \n            d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\n        </svg>\n        <div class=\"space-y-1\">\n          <span class=\"text-sm font-medium text-gray-900\">\n            {currentAvatar ? changePhotoText : uploadText}\n          </span>\n          <p class=\"text-xs text-gray-500\">{selectFileText}</p>\n        </div>\n      </div>\n    {/if}\n  </div>\n\n  <!-- Hidden file input -->\n  <input\n    bind:this={fileInput}\n    type=\"file\"\n    accept=\"image/*\"\n    class=\"sr-only\"\n    onchange={handleFileSelect}\n    disabled={disabled || uploading}\n  />\n\n  <!-- Error display -->\n  {#if error}\n    <div class=\"p-3 bg-red-50 border border-red-200 rounded-lg\">\n      <div class=\"flex\">\n        <svg class=\"h-4 w-4 text-red-400 mt-0.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" \n            d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n        </svg>\n        <div class=\"ml-2\">\n          <p class=\"text-sm text-red-700\">{error}</p>\n        </div>\n        <button\n          type=\"button\"\n          onclick={() => error = ''}\n          class=\"ml-auto pl-2 text-red-400 hover:text-red-500\"\n          aria-label=\"Dismiss error\"\n        >\n          <svg class=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\n          </svg>\n        </button>\n      </div>\n    </div>\n  {/if}\n\n  <!-- Help text -->\n  <div class=\"flex items-start space-x-2\">\n    <svg class=\"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n    </svg>\n    <p class=\"text-xs text-gray-500\">\n      Upload JPG, PNG, or WEBP images. Photos will be automatically optimized and converted to WebP format.\n    </p>\n  </div>\n</div>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\ui\\Button.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\ui\\CategoryPill.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\ui\\FavoriteButton.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":83,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":83,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import type { Product, ProductPreview } from '../../types/product';\r\n  import { Tooltip } from '../../primitives/tooltip';\r\n\r\n  interface Props {\r\n    product: Product | ProductPreview;\r\n    favorited?: boolean;\r\n    onFavorite?: () => void;\r\n    addToFavoritesText?: string;\r\n    removeFromFavoritesText?: string;\r\n    showCount?: boolean;\r\n    favoritesState?: { favoriteCounts: Record<string, number> };\r\n    absolute?: boolean;\r\n    customPosition?: string;\r\n    size?: 'sm' | 'md';\r\n  }\r\n\r\n  let { \r\n    product,\r\n    favorited = false,\r\n    onFavorite,\r\n    addToFavoritesText = 'Add to favorites',\r\n    removeFromFavoritesText = 'Remove from favorites',\r\n    showCount = true,\r\n    favoritesState,\r\n    absolute = true,\r\n    customPosition = '',\r\n    size = 'md'\r\n  }: Props = $props();\r\n\r\n  let isLoading = $state(false);\r\n  let currentFavorited = $derived(favorited);\r\n  let favoriteCount = $derived(favoritesState?.favoriteCounts[product.id] ?? product.favorite_count ?? 0);\r\n\r\n  // Compute tooltip content based on state\r\n  const tooltipContent = $derived(() => {\r\n    if (product.is_sold) {\r\n      return 'Sold – likes frozen';\r\n    }\r\n    if (isLoading) {\r\n      return 'Updating favorites...';\r\n    }\r\n    return currentFavorited ? removeFromFavoritesText : addToFavoritesText;\r\n  });\r\n\r\n  async function handleFavorite(event: MouseEvent) {\r\n    event.stopPropagation();\r\n    event.preventDefault();\r\n    \r\n    if (isLoading || typeof window === 'undefined' || product.is_sold) return;\r\n\r\n    // If parent provided a handler, delegate to it to avoid duplicate requests\r\n    if (onFavorite) {\r\n      try {\r\n        isLoading = true;\r\n        await onFavorite();\r\n      } finally {\r\n        isLoading = false;\r\n      }\r\n      return;\r\n    }\r\n    \r\n    isLoading = true;\r\n    \r\n    try {\r\n      const response = await fetch(`/api/favorites/${product.id}`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        if (response.status === 401) {\r\n          window.location.href = '/login';\r\n          return;\r\n        }\r\n        throw new Error(`HTTP ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json();\r\n      currentFavorited = result.favorited;\r\n      favoriteCount = result.favoriteCount || 0;\r\n      \r\n    } catch (error) {\r\n      // Error handling for failed favorite toggle\r\n    } finally {\r\n      isLoading = false;\r\n    }\r\n  }\r\n</script>\r\n\r\n<div class=\"{absolute ? (customPosition || 'absolute top-2 right-2 z-10') : 'shrink-0'}\">\r\n  <Tooltip \r\n    content={tooltipContent()}\r\n    positioning={{ side: 'bottom', align: 'center' }}\r\n    openDelay={500}\r\n    closeDelay={200}\r\n    disabled={isLoading}\r\n    forceTouch={true}\r\n  >\r\n    {#snippet trigger()}\r\n      <button\r\n        onclick={handleFavorite}\r\n        disabled={isLoading || product.is_sold}\r\n        class=\"group flex items-center justify-center gap-1 {size === 'sm' ? 'p-2 min-h-[36px] min-w-[36px]' : 'p-3 min-h-[44px] min-w-[44px]'} bg-[color:var(--surface-brand)]/20 backdrop-blur-sm shadow-sm rounded-full focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)] transition-all duration-[var(--duration-fast)] {(isLoading || product.is_sold) ? 'opacity-50 cursor-not-allowed' : 'hover:bg-[color:var(--surface-brand)]/30 hover:scale-105 active:scale-95'}\"\r\n        aria-label={product.is_sold ? 'Sold – likes frozen' : (currentFavorited ? removeFromFavoritesText : addToFavoritesText)}\r\n      >\r\n        <svg \r\n          class=\"{size === 'sm' ? 'w-3 h-3' : 'w-3.5 h-3.5'} transition-all duration-[var(--duration-fast)] {product.is_sold ? 'text-[color:var(--text-disabled)]' : (currentFavorited ? 'text-[color:var(--favorite-solid)] fill-[color:var(--favorite-solid)] scale-110' : 'text-white group-hover:text-[color:var(--favorite-solid)] group-hover:scale-110')}\"\r\n          aria-hidden=\"true\" \r\n          viewBox=\"0 0 24 24\"\r\n          stroke=\"currentColor\"\r\n          stroke-width=\"1.5\"\r\n          fill={currentFavorited ? 'currentColor' : 'none'}\r\n        >\r\n          <path \r\n            stroke-linecap=\"round\"\r\n            stroke-linejoin=\"round\"\r\n            d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"\r\n          />\r\n        </svg>\r\n        {#if showCount && favoriteCount > 0}\r\n          <span class=\"text-xs font-medium transition-colors duration-[var(--duration-fast)] {currentFavorited ? 'text-[color:var(--favorite-solid)]' : 'text-white/90'}\">\r\n            {favoriteCount > 999 ? `${Math.floor(favoriteCount/1000)}k` : favoriteCount}\r\n          </span>\r\n        {/if}\r\n      </button>\r\n    {/snippet}\r\n  </Tooltip>\r\n</div>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\ui\\FollowButton.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":150,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":150,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<!--\r\n  Follow Button with real-time updates\r\n  Handles user following/unfollowing with optimistic updates and real-time count updates\r\n-->\r\n<script lang=\"ts\">\r\n  import { Tooltip } from '../../primitives/tooltip';\r\n  // Note: These imports need to be passed as props since UI package cannot import from apps\r\n  interface FollowActions {\r\n    toggleFollow: (userId: string) => Promise<boolean>;\r\n  }\r\n\r\n  interface RealtimeStore {\r\n    metrics: {\r\n      userMetrics: Record<string, { follower_count: number; following_count: number }>;\r\n    };\r\n  }\r\n\r\n  interface RealtimeService {\r\n    subscribeToUser: (userId: string) => void;\r\n    unsubscribeFromUser: (userId: string) => void;\r\n  }\r\n\r\n  interface Props {\r\n    userId: string;\r\n    username?: string;\r\n    following?: boolean;\r\n    onFollow?: () => void;\r\n    followText?: string;\r\n    unfollowText?: string;\r\n    showCount?: boolean;\r\n    variant?: 'default' | 'compact' | 'text';\r\n    disabled?: boolean;\r\n    // Services passed from parent\r\n    followActions?: FollowActions;\r\n    realtimeService?: RealtimeService;\r\n    realtimeStore?: RealtimeStore;\r\n    followerCount?: number; // Fallback if no realtime\r\n  }\r\n\r\n  let {\r\n    userId,\r\n    username,\r\n    following = false,\r\n    onFollow,\r\n    followText = 'Follow',\r\n    unfollowText = 'Following',\r\n    showCount = true,\r\n    variant = 'default',\r\n    disabled = false,\r\n    followActions,\r\n    realtimeService,\r\n    realtimeStore,\r\n    followerCount = 0\r\n  }: Props = $props();\r\n\r\n  let isLoading = $state(false);\r\n  let currentFollowing = $derived(following);\r\n\r\n  // Get follower count from real-time store or fallback\r\n  let currentFollowerCount = $derived(() => {\r\n    if (realtimeStore) {\r\n      const metrics = realtimeStore.metrics.userMetrics[userId];\r\n      return metrics?.follower_count ?? followerCount;\r\n    }\r\n    return followerCount;\r\n  });\r\n\r\n  // Compute tooltip content based on state\r\n  const tooltipContent = $derived(() => {\r\n    if (disabled) {\r\n      return 'Cannot follow this user';\r\n    }\r\n    if (isLoading) {\r\n      return 'Updating...';\r\n    }\r\n    return currentFollowing ? unfollowText : followText;\r\n  });\r\n\r\n  // Get button classes based on variant\r\n  const buttonClasses = $derived(() => {\r\n    const base = 'inline-flex items-center gap-2 font-medium transition-all duration-[var(--duration-fast)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--state-focus)]';\r\n\r\n    if (isLoading || disabled) {\r\n      return `${base} opacity-50 cursor-not-allowed`;\r\n    }\r\n\r\n    if (variant === 'compact') {\r\n      return `${base} px-3 py-1.5 text-sm rounded-md ${\r\n        currentFollowing\r\n          ? 'bg-[color:var(--gray-100)] text-[color:var(--text-secondary)] hover:bg-[color:var(--gray-200)]'\r\n          : 'bg-[color:var(--primary)] text-[color:var(--primary-fg)] hover:bg-[color:var(--primary-hover)]'\r\n      }`;\r\n    }\r\n\r\n    if (variant === 'text') {\r\n      return `${base} text-sm ${\r\n        currentFollowing\r\n          ? 'text-[color:var(--text-secondary)] hover:text-[color:var(--text-primary)]'\r\n          : 'text-[color:var(--primary)] hover:text-[color:var(--primary-hover)]'\r\n      }`;\r\n    }\r\n\r\n    // Default variant\r\n    return `${base} px-4 py-2 rounded-lg ${\r\n      currentFollowing\r\n        ? 'bg-[color:var(--gray-100)] text-[color:var(--text-secondary)] hover:bg-[color:var(--gray-200)]'\r\n        : 'bg-[color:var(--primary)] text-[color:var(--primary-fg)] hover:bg-[color:var(--primary-hover)]'\r\n    }`;\r\n  });\r\n\r\n  // Initialize real-time subscription\r\n  $effect(() => {\r\n    if (realtimeService) {\r\n      realtimeService.subscribeToUser(userId);\r\n    }\r\n\r\n    return () => {\r\n      if (realtimeService) {\r\n        realtimeService.unsubscribeFromUser(userId);\r\n      }\r\n    };\r\n  });\r\n\r\n  async function handleFollow(event: MouseEvent) {\r\n    event.stopPropagation();\r\n    event.preventDefault();\r\n\r\n    if (isLoading || disabled || typeof window === 'undefined') return;\r\n\r\n    // If parent provided a handler, delegate to it\r\n    if (onFollow) {\r\n      try {\r\n        isLoading = true;\r\n        await onFollow();\r\n      } finally {\r\n        isLoading = false;\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (!followActions) {\r\n      return;\r\n    }\r\n\r\n    isLoading = true;\r\n\r\n    try {\r\n      const newFollowingState = await followActions.toggleFollow(userId);\r\n      currentFollowing = newFollowingState;\r\n    } catch (error) {\r\n      // Error handling is delegated to parent component\r\n    } finally {\r\n      isLoading = false;\r\n    }\r\n  }\r\n</script>\r\n\r\n<Tooltip\r\n  content={tooltipContent()}\r\n  positioning={{ side: 'bottom', align: 'center' }}\r\n  openDelay={500}\r\n  closeDelay={200}\r\n  disabled={isLoading}\r\n  forceTouch={true}\r\n>\r\n  {#snippet trigger()}\r\n    <button\r\n      onclick={handleFollow}\r\n      disabled={isLoading || disabled}\r\n      class={buttonClasses()}\r\n      aria-label={`${currentFollowing ? unfollowText : followText} ${username || 'user'}`}\r\n    >\r\n      <!-- Follow/Following Icon -->\r\n      {#if variant !== 'text'}\r\n        <svg\r\n          class=\"w-4 h-4\"\r\n          aria-hidden=\"true\"\r\n          viewBox=\"0 0 24 24\"\r\n          stroke=\"currentColor\"\r\n          stroke-width=\"1.5\"\r\n          fill=\"none\"\r\n        >\r\n          {#if currentFollowing}\r\n            <!-- Following (check icon) -->\r\n            <path\r\n              stroke-linecap=\"round\"\r\n              stroke-linejoin=\"round\"\r\n              d=\"M20.285 2l-11.285 11.567-5.286-5.011-3.714 3.716 9 8.728 15-15.285z\"\r\n            />\r\n          {:else}\r\n            <!-- Not following (plus icon) -->\r\n            <path\r\n              stroke-linecap=\"round\"\r\n              stroke-linejoin=\"round\"\r\n              d=\"M12 4.5v15m7.5-7.5h-15\"\r\n            />\r\n          {/if}\r\n        </svg>\r\n      {/if}\r\n\r\n      <!-- Text -->\r\n      <span>\r\n        {currentFollowing ? unfollowText : followText}\r\n      </span>\r\n\r\n      <!-- Follower count -->\r\n      {#if showCount && currentFollowerCount() > 0}\r\n        <span class=\"text-xs opacity-75\">\r\n          {currentFollowerCount() > 999 ? `${Math.floor(currentFollowerCount()/1000)}k` : currentFollowerCount()}\r\n        </span>\r\n      {/if}\r\n    </button>\r\n  {/snippet}\r\n</Tooltip>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\ui\\SoldOverlay.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\ui\\TabGroup.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\ui\\ThemeToggle.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\ui\\TopProgress.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[262,265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[262,265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import { isBrowser } from '../../utils/runtime.js';\r\n\r\n  interface Props {\r\n    isNavigating?: boolean;\r\n  }\r\n\r\n  let { isNavigating = false }: Props = $props();\r\n\r\n  let isActive = $state(false);\r\n  let progress = $state(0);\r\n  let timer: any = null;\r\n\r\n  function start() {\r\n    isActive = true;\r\n    progress = 0;\r\n    clearInterval(timer);\r\n    // Ease towards 80% while navigating\r\n    timer = setInterval(() => {\r\n      progress = Math.min(progress + Math.max(1, (80 - progress) * 0.1), 80);\r\n    }, 100);\r\n  }\r\n\r\n  function finish() {\r\n    // Complete, then hide after a short delay\r\n    progress = 100;\r\n    clearInterval(timer);\r\n    \r\n    // Only set timeout if we're currently active to avoid multiple timeouts\r\n    if (isActive) {\r\n      setTimeout(() => {\r\n        isActive = false;\r\n        progress = 0;\r\n      }, 200);\r\n    }\r\n  }\r\n\r\n  $effect(() => {\r\n    if (!isBrowser) return;\r\n\r\n    if (isNavigating) {\r\n      start();\r\n    } else {\r\n      finish();\r\n    }\r\n  });\r\n</script>\r\n\r\n{#if isActive}\r\n  <div class=\"fixed left-0 right-0 z-[60] pointer-events-none\" style=\"top: var(--app-header-offset, 0px);\">\r\n    <div \r\n      class=\"h-0.5 bg-gradient-to-r from-[color:var(--primary)] via-[color:var(--primary-400)] to-[color:var(--primary-300)] shadow-sm transition-[width] duration-150 ease-out\"\r\n      style={`width:${progress}%;`}\r\n    ></div>\r\n  </div>\r\n{/if}\r\n\r\n<style>\r\n  /* Avoid repaints by isolating the progress element */\r\n  div > div {\r\n    will-change: width;\r\n  }\r\n  @media (prefers-reduced-motion: reduce) {\r\n    .transition-\\[width\\] {\r\n      transition: none !important;\r\n    }\r\n  }\r\n  /* Ensure safe overlap with sticky headers */\r\n  :global(.sticky) + .fixed {\r\n    top: 0;\r\n  }\r\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\ui\\TrustBadges.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\ui\\TypingIndicator.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\utilities\\ErrorStates.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\utilities\\LanguageSwitcher.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":35,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n\tinterface Props {\n\t\tcurrentLanguage?: string;\n\t\tlanguages?: Array<{ code: string; name: string; flag?: string }>;\n\t\tonLanguageChange?: (lang: string) => void;\n\t\tvariant?: 'dropdown' | 'inline' | 'compact';\n\t\tclass?: string;\n\t}\n\n\tlet {\n\t\tcurrentLanguage = 'en',\n\t\tlanguages = [\n\t\t\t{ code: 'en', name: 'English', flag: '🇬🇧' },\n\t\t\t{ code: 'bg', name: 'Български', flag: '🇧🇬' }\n\t\t],\n\t\tonLanguageChange = () => {},\n\t\tvariant = 'dropdown',\n\t\tclass: className = ''\n\t}: Props = $props();\n\n\tlet showDropdown = $state(false);\n\n\tconst currentLang = $derived(\n\t\tlanguages.find(l => l.code === currentLanguage) || languages[0]\n\t);\n\n\tfunction selectLanguage(lang: string) {\n\t\t\n\t\tshowDropdown = false;\n\t\t\n\t\t// Call the callback immediately\n\t\tif (onLanguageChange) {\n\t\t\ttry {\n\t\t\t\tonLanguageChange(lang);\n\t\t\t} catch (error) {\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n{#if variant === 'inline'}\n\t<div class=\"flex gap-2 {className}\">\n\t\t{#each languages as lang}\n\t\t\t<button\n\t\t\t\tonclick={() => selectLanguage(lang.code)}\n\t\t\t\tclass=\"px-3 py-1.5 text-sm font-medium rounded-lg transition-colors duration-200 hover:scale-105 active:scale-95\n\t\t\t\t\t{currentLanguage === lang.code \n\t\t\t\t\t\t? 'bg-blue-600 text-white shadow-md' \n\t\t\t\t\t\t: 'bg-white text-gray-900 hover:bg-blue-50 border border-gray-200 hover:border-blue-200'}\"\n\t\t\t>\n\t\t\t\t{#if lang.flag}\n\t\t\t\t\t<span class=\"mr-1.5\">{lang.flag}</span>\n\t\t\t\t{/if}\n\t\t\t\t{lang.name}\n\t\t\t</button>\n\t\t{/each}\n\t</div>\n{:else if variant === 'compact'}\n\t<div class=\"flex gap-1 {className}\">\n\t\t{#each languages as lang}\n\t\t\t<button\n\t\t\t\tonclick={() => selectLanguage(lang.code)}\n\t\t\t\tclass=\"w-10 h-10 flex items-center justify-center text-lg font-medium rounded-full transition-colors duration-200 hover:scale-110 active:scale-95\n\t\t\t\t\t{currentLanguage === lang.code \n\t\t\t\t\t\t? 'bg-blue-600 text-white shadow-sm md:shadow-lg ring-2 ring-blue-300' \n\t\t\t\t\t\t: 'bg-white text-gray-900 hover:bg-blue-50 border border-gray-200 hover:border-blue-200 hover:shadow-md'}\"\n\t\t\t\ttitle={lang.name}\n\t\t\t>\n\t\t\t\t{lang.flag || lang.code.toUpperCase().slice(0, 2)}\n\t\t\t</button>\n\t\t{/each}\n\t</div>\n{:else}\n\t<div class=\"relative {className}\">\n\t\t<button\n\t\t\tonclick={() => showDropdown = !showDropdown}\n\t\t\tclass=\"flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-200 transition-colors duration-200 hover:shadow-md active:scale-98\"\n\t\t\taria-haspopup=\"menu\"\n\t\t\taria-expanded={showDropdown}\n\t\t\taria-label=\"Change language\"\n\t\t>\n\t\t\t{#if currentLang.flag}\n\t\t\t\t<span>{currentLang.flag}</span>\n\t\t\t{/if}\n\t\t\t<span>{currentLang.name}</span>\n\t\t\t<svg class=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\" />\n\t\t\t</svg>\n\t\t</button>\n\n\t\t{#if showDropdown}\n\t\t\t<div class=\"absolute right-0 z-50 mt-2 w-48 origin-top-right rounded-lg bg-white shadow-sm md:shadow-lg ring-1 ring-black ring-opacity-5\">\n\t\t\t\t<div class=\"py-1\">\n\t\t\t\t\t{#each languages as lang}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonclick={() => selectLanguage(lang.code)}\n\t\t\t\t\t\t\tclass=\"flex items-center gap-2 w-full px-4 py-2 text-sm text-gray-900 hover:bg-blue-50 transition-colors duration-150 hover:translate-x-1\n\t\t\t\t\t\t\t\t{currentLanguage === lang.code ? 'bg-blue-50 font-semibold text-blue-700 border-l-2 border-blue-500' : ''}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if lang.flag}\n\t\t\t\t\t\t\t\t<span>{lang.flag}</span>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t<span>{lang.name}</span>\n\t\t\t\t\t\t\t{#if currentLanguage === lang.code}\n\t\t\t\t\t\t\t\t<svg class=\"w-4 h-4 ml-auto text-gray-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n{/if}\n\n{#if showDropdown}\n\t<button\n\t\tonclick={() => showDropdown = false}\n\t\tclass=\"fixed inset-0 z-40\"\n\t\taria-label=\"Close dropdown\"\n\t></button>\n{/if}\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\utilities\\LoadingSpinner.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\utilities\\LoadingStates.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\utilities\\OnboardingStep.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\utilities\\Overlay.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\utilities\\SEOMetaTags.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2481,2484],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2481,2484],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3557,3560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3557,3560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":132,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":132,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":144,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":144,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'organizationJsonLd' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":259,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":259,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"﻿<script lang=\"ts\">\r\n\timport type { Product, Profile } from '@repo/ui/types';\r\n\timport * as i18n from '@repo/i18n';\r\n\t\r\n\tinterface Props {\r\n\t\ttitle: string;\r\n\t\tdescription: string;\r\n\t\turl?: string;\r\n\t\timage?: string;\r\n\t\ttype?: 'website' | 'article' | 'product';\r\n\t\tproduct?: Product;\r\n\t\tseller?: Profile;\r\n\t\tkeywords?: string[];\r\n\t\tnoindex?: boolean;\r\n\t\tcanonical?: string;\r\n\t\tpreloadImages?: string[];\r\n\t\tenableImageOptimization?: boolean;\r\n\t}\r\n\t\r\n\tlet {\r\n\t\ttitle,\r\n\t\tdescription,\r\n\t\turl = '',\r\n\t\timage = '/og-default.jpg',\r\n\t\ttype = 'website',\r\n\t\tproduct,\r\n\t\tseller,\r\n\t\tkeywords = [],\r\n\t\tnoindex = false,\r\n\t\tcanonical,\r\n\t\tpreloadImages = [],\r\n\t\tenableImageOptimization = true\r\n\t}: Props = $props();\r\n\t\r\n\t// Get current locale\r\n\tconst currentLocale = i18n.getLocale();\r\n\t\r\n\t// Generate locale-aware URLs for hreflang\r\n\tconst getLocaleUrl = (locale: string, path: string = url) => {\r\n\t\t// For Bulgarian (default), no prefix\r\n\t\tif (locale === 'bg') {\r\n\t\t\treturn `https://driplo.xyz${path}`;\r\n\t\t}\r\n\t\t// For English, use /uk prefix\r\n\t\tif (locale === 'en') {\r\n\t\t\treturn `https://driplo.xyz/uk${path}`;\r\n\t\t}\r\n\t\treturn `https://driplo.xyz${path}`;\r\n\t};\r\n\t\r\n\t// Generate full URL with locale prefix if needed\r\n\tconst fullUrl = $derived(() => {\r\n\t\tif (url) {\r\n\t\t\treturn getLocaleUrl(currentLocale, url);\r\n\t\t}\r\n\t\treturn getLocaleUrl(currentLocale, '');\r\n\t});\r\n\tconst fullImageUrl = $derived(() =>\r\n\t\timage && typeof image === 'string' && image.startsWith('http') \r\n\t\t\t? image \r\n\t\t\t: `https://driplo.xyz${image || '/default-og-image.jpg'}`\r\n\t);\r\n\r\n\t// Generate optimized image sources for preloading\r\n\tfunction generateOptimizedImageUrl(imageUrl: string, width: number, quality: number = 85): string {\r\n\t\tif (!enableImageOptimization) return imageUrl;\r\n\t\t\r\n\t\t// For storage CDNs that support query params, generate optimized variants\r\n\t\tif (imageUrl.includes('supabase') || imageUrl.includes('cloudinary') || imageUrl.includes('imagekit')) {\r\n\t\t\tconst baseUrl = imageUrl.split('?')[0];\r\n\t\t\treturn `${baseUrl}?width=${width}&quality=${quality}`;\r\n\t\t}\r\n\t\t\r\n\t\t// For other sources, return as-is\r\n\t\treturn imageUrl;\r\n\t}\r\n\r\n\t// Get critical images for preloading (first product image + hero images)\r\n\tconst criticalImages = $derived(() => {\r\n\t\tconst images = [];\r\n\t\t\r\n\t\t// Add main product image (optimized for mobile and desktop)\r\n\t\tif (product?.images?.[0]) {\r\n\t\t\tconst firstImage = product.images[0];\r\n\t\t\tconst mainImage = typeof firstImage === 'string'\r\n\t\t\t\t? firstImage\r\n\t\t\t\t: (firstImage as any)?.image_url || firstImage;\r\n\t\t\t\t\t\r\n\t\t\tif (typeof mainImage === 'string') {\r\n\t\t\t\t// Mobile-first: preload smaller version\r\n\t\t\t\timages.push({\r\n\t\t\t\t\turl: generateOptimizedImageUrl(mainImage, 600, 80),\r\n\t\t\t\t\tmedia: '(max-width: 768px)',\r\n\t\t\t\t\tas: 'image' as const,\r\n\t\t\t\t\tfetchpriority: 'high' as const\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t// Desktop: preload larger version\r\n\t\t\t\timages.push({\r\n\t\t\t\t\turl: generateOptimizedImageUrl(mainImage, 1200, 85),\r\n\t\t\t\t\tmedia: '(min-width: 769px)',\r\n\t\t\t\t\tas: 'image' as const,\r\n\t\t\t\t\tfetchpriority: 'high' as const\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Add any additional preload images passed in\r\n\t\tpreloadImages.forEach(img => {\r\n\t\t\timages.push({\r\n\t\t\t\turl: img,\r\n\t\t\t\tas: 'image' as const,\r\n\t\t\t\tfetchpriority: 'high' as const\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\treturn images;\r\n\t});\r\n\r\n\t// Generate preconnect hints for image domains\r\n\tconst preconnectDomains = $derived(() => {\r\n\t\tconst domains = new Set<string>();\r\n\t\t\r\n\t\t// Add product image domains\r\n\t\tif (product?.images) {\r\n\t\t\tproduct.images.forEach(img => {\r\n\t\t\t\tconst imageUrl = typeof img === 'string' ? img : (img as any)?.image_url;\r\n\t\t\t\tif (imageUrl && typeof imageUrl === 'string') {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tconst url = new URL(imageUrl);\r\n\t\t\t\t\t\tdomains.add(url.origin);\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t// Skip invalid URLs\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\t// Add seller avatar domain\r\n\t\tif (seller?.avatar_url) {\r\n\t\t\ttry {\r\n\t\t\t\tconst url = new URL(seller.avatar_url);\r\n\t\t\t\tdomains.add(url.origin);\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// Skip invalid URLs  \r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn Array.from(domains);\r\n\t});\r\n\t\r\n\t// Generate product-specific meta tags\r\n\tconst productPrice = $derived(product ? `${product.currency || '€'}${product.price}` : '');\r\n\tconst availability = $derived(product?.is_sold ? 'out of stock' : 'in stock');\r\n\t\r\n\t// Generate JSON-LD structured data for product\r\n\tconst jsonLd = $derived(() => {\r\n\t\tif (!product) return null;\r\n\t\t\r\n\t\treturn {\r\n\t\t\t'@context': 'https://schema.org/',\r\n\t\t\t'@type': 'Product',\r\n\t\t\tname: product.title,\r\n\t\t\tdescription: product.description || description,\r\n\t\t\timage: product.images?.map(img => \r\n\t\t\t\ttypeof img === 'string' && img.startsWith('http') ? img : `https://driplo.xyz${img}`\r\n\t\t\t) || [fullImageUrl()],\r\n\t\t\toffers: {\r\n\t\t\t\t'@type': 'Offer',\r\n\t\t\t\turl: fullUrl(),\r\n\t\t\t\tpriceCurrency: product.currency || 'EUR',\r\n\t\t\t\tprice: product.price,\r\n\t\t\t\tavailability: `https://schema.org/${availability === 'in stock' ? 'InStock' : 'OutOfStock'}`,\r\n\t\t\t\titemCondition: getConditionSchema(product.condition),\r\n\t\t\t\tseller: seller ? {\r\n\t\t\t\t\t'@type': 'Person',\r\n\t\t\t\t\tname: seller.full_name || seller.username\r\n\t\t\t\t} : undefined\r\n\t\t\t},\r\n\t\t\tbrand: product.brand ? {\r\n\t\t\t\t'@type': 'Brand',\r\n\t\t\t\tname: product.brand\r\n\t\t\t} : undefined,\r\n\t\t\tcategory: product.category_name,\r\n\t\t\taggregateRating: seller?.rating ? {\r\n\t\t\t\t'@type': 'AggregateRating',\r\n\t\t\t\tratingValue: seller.rating,\r\n\t\t\t\treviewCount: seller.review_count\r\n\t\t\t} : undefined\r\n\t\t};\r\n\t});\r\n\t\r\n\tfunction getConditionSchema(condition?: string) {\r\n\t\tconst conditionMap: Record<string, string> = {\r\n\t\t\t'new': 'https://schema.org/NewCondition',\r\n\t\t\t'like_new': 'https://schema.org/LikeNewCondition',\r\n\t\t\t'good': 'https://schema.org/UsedCondition',\r\n\t\t\t'fair': 'https://schema.org/UsedCondition',\r\n\t\t\t'poor': 'https://schema.org/DamagedCondition'\r\n\t\t};\r\n\t\treturn conditionMap[condition || 'good'] || 'https://schema.org/UsedCondition';\r\n\t}\r\n\t\r\n\t// Generate breadcrumb structured data\r\n\tconst breadcrumbJsonLd = $derived(() => {\r\n\t\tif (!product) return null;\r\n\t\t\r\n\t\tconst items = [\r\n\t\t\t{\r\n\t\t\t\t'@type': 'ListItem',\r\n\t\t\t\tposition: 1,\r\n\t\t\t\tname: 'Home',\r\n\t\t\t\titem: 'https://driplo.xyz'\r\n\t\t\t}\r\n\t\t];\r\n\r\n\t\t// Add seller breadcrumb if available\r\n\t\tif (seller?.username) {\r\n\t\t\titems.push({\r\n\t\t\t\t'@type': 'ListItem',\r\n\t\t\t\tposition: items.length + 1,\r\n\t\t\t\tname: seller.username,\r\n\t\t\t\titem: `https://driplo.xyz/profile/${seller.username}`\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Add category breadcrumb if available\r\n\t\tif (product.category_name) {\r\n\t\t\tconst categoryUrl = product.main_category_name && product.subcategory_name\r\n\t\t\t\t? `https://driplo.xyz/category/${product.main_category_name.toLowerCase()}/${product.subcategory_name.toLowerCase()}`\r\n\t\t\t\t: product.main_category_name\r\n\t\t\t\t\t? `https://driplo.xyz/category/${product.main_category_name.toLowerCase()}`\r\n\t\t\t\t\t: `https://driplo.xyz/category/${product.category_name.toLowerCase()}`;\r\n\t\t\t\r\n\t\t\titems.push({\r\n\t\t\t\t'@type': 'ListItem',\r\n\t\t\t\tposition: items.length + 1,\r\n\t\t\t\tname: product.category_name,\r\n\t\t\t\titem: categoryUrl\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Add current product\r\n\t\titems.push({\r\n\t\t\t'@type': 'ListItem',\r\n\t\t\tposition: items.length + 1,\r\n\t\t\tname: product.title,\r\n\t\t\titem: fullUrl()\r\n\t\t});\r\n\t\t\r\n\t\treturn {\r\n\t\t\t'@context': 'https://schema.org',\r\n\t\t\t'@type': 'BreadcrumbList',\r\n\t\t\titemListElement: items\r\n\t\t};\r\n\t});\r\n\t\r\n\t// Generate organization structured data\r\n\tconst organizationJsonLd = {\r\n\t\t'@context': 'https://schema.org',\r\n\t\t'@type': 'Organization',\r\n\t\tname: 'Driplo',\r\n\t\turl: 'https://driplo.xyz',\r\n\t\tlogo: 'https://driplo.xyz/logo.png',\r\n\t\tsameAs: [\r\n\t\t\t'https://twitter.com/driplo',\r\n\t\t\t'https://instagram.com/driplo',\r\n\t\t\t'https://facebook.com/driplo'\r\n\t\t]\r\n\t};\r\n</script>\r\n\r\n<svelte:head>\r\n\t<!-- Primary Meta Tags -->\r\n\t<title>{title} | Driplo</title>\r\n\t<meta name=\"title\" content=\"{title} | Driplo\" />\r\n\t<meta name=\"description\" content={description} />\r\n\t{#if keywords.length > 0}\r\n\t\t<meta name=\"keywords\" content={keywords.join(', ')} />\r\n\t{/if}\r\n\t\r\n\t<!-- Canonical URL -->\r\n\t{#if canonical}\r\n\t\t<link rel=\"canonical\" href={canonical} />\r\n\t{:else if url}\r\n\t\t<link rel=\"canonical\" href={fullUrl()} />\r\n\t{/if}\r\n\t\r\n\t<!-- Hreflang Links for SEO -->\r\n\t<link rel=\"alternate\" hreflang=\"bg-BG\" href={getLocaleUrl('bg', url)} />\r\n\t<link rel=\"alternate\" hreflang=\"en-GB\" href={getLocaleUrl('en', url)} />\r\n\t<link rel=\"alternate\" hreflang=\"x-default\" href={getLocaleUrl('bg', url)} />\r\n\t\r\n\t<!-- Robots -->\r\n\t{#if noindex}\r\n\t\t<meta name=\"robots\" content=\"noindex, nofollow\" />\r\n\t{:else}\r\n\t\t<meta name=\"robots\" content=\"index, follow\" />\r\n\t{/if}\r\n\t\r\n\t<!-- Open Graph / Facebook -->\r\n\t<meta property=\"og:type\" content={type} />\r\n\t<meta property=\"og:url\" content={fullUrl()} />\r\n\t<meta property=\"og:title\" content={title} />\r\n\t<meta property=\"og:description\" content={description} />\r\n\t<meta property=\"og:image\" content={fullImageUrl()} />\r\n\t<meta property=\"og:site_name\" content=\"Driplo\" />\r\n\t<meta property=\"og:locale\" content={currentLocale === 'bg' ? 'bg_BG' : 'en_GB'} />\r\n\t<meta property=\"og:locale:alternate\" content={currentLocale === 'bg' ? 'en_GB' : 'bg_BG'} />\r\n\t\r\n\t<!-- Product-specific Open Graph -->\r\n\t{#if product}\r\n\t\t<meta property=\"product:price:amount\" content={product.price.toString()} />\r\n\t\t<meta property=\"product:price:currency\" content={product.currency || 'EUR'} />\r\n\t\t<meta property=\"product:availability\" content={availability} />\r\n\t\t<meta property=\"product:condition\" content={product.condition || 'used'} />\r\n\t\t{#if product.brand}\r\n\t\t\t<meta property=\"product:brand\" content={product.brand} />\r\n\t\t{/if}\r\n\t\t{#if product.category_name}\r\n\t\t\t<meta property=\"product:category\" content={product.category_name} />\r\n\t\t{/if}\r\n\t{/if}\r\n\t\r\n\t<!-- Twitter -->\r\n\t<meta property=\"twitter:card\" content=\"summary_large_image\" />\r\n\t<meta property=\"twitter:url\" content={fullUrl()} />\r\n\t<meta property=\"twitter:title\" content={title} />\r\n\t<meta property=\"twitter:description\" content={description} />\r\n\t<meta property=\"twitter:image\" content={fullImageUrl()} />\r\n\t<meta property=\"twitter:site\" content=\"@driplo\" />\r\n\t\r\n\t<!-- Additional meta tags for e-commerce -->\r\n\t{#if product}\r\n\t\t<meta name=\"product:price\" content={productPrice} />\r\n\t\t<meta name=\"product:availability\" content={availability} />\r\n\t{/if}\r\n\t\r\n\t<!-- JSON-LD Structured Data -->\r\n\t<!-- JSON-LD Structured Data -->\r\n\t{#if jsonLd()}\r\n\t\t<script type=\"application/ld+json\">\r\n\t\t\t{JSON.stringify(jsonLd())}\r\n\t\t</script>\r\n\t{/if}\r\n\t\r\n\t{#if breadcrumbJsonLd()}\r\n\t\t<script type=\"application/ld+json\">\r\n\t\t\t{JSON.stringify(breadcrumbJsonLd())}\r\n\t\t</script>\r\n\t{/if}\r\n\t\r\n\t{#if type === 'website'}\r\n\t\t<script type=\"application/ld+json\">\r\n\t\t\t{JSON.stringify(organizationJsonLd)}\r\n\t\t</script>\r\n\t{/if}\r\n\t\r\n\t<!-- Performance hints -->\r\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n\t{#if type === 'product'}\r\n\t\t<!-- Product page specific optimizations -->\r\n\t\t<meta name=\"format-detection\" content=\"telephone=no\" />\r\n\t\t<meta name=\"theme-color\" content=\"#ffffff\" />\r\n\t{/if}\r\n\t\r\n\t<!-- Preconnect to external domains -->\r\n\t<link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\r\n\t<link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin=\"anonymous\" />\r\n\t\r\n\t<!-- Dynamic preconnect for image domains -->\r\n\t{#each preconnectDomains() as domain}\r\n\t\t<link rel=\"preconnect\" href={domain} />\r\n\t{/each}\r\n\t\r\n\t<!-- Preload critical images for LCP optimization -->\r\n\t{#each criticalImages() as image}\r\n\t\t<link \r\n\t\t\trel=\"preload\" \r\n\t\t\thref={image.url} \r\n\t\t\tas={image.as}\r\n\t\t\t{...(image.media ? { media: image.media } : {})}\r\n\t\t\t{...(image.fetchpriority ? { fetchpriority: image.fetchpriority } : {})}\r\n\t\t/>\r\n\t{/each}\r\n\t\r\n\t<!-- DNS Prefetch for performance -->\r\n\t<link rel=\"dns-prefetch\" href=\"//cdn.jsdelivr.net\" />\r\n\t<link rel=\"dns-prefetch\" href=\"//www.googletagmanager.com\" />\r\n\t<link rel=\"dns-prefetch\" href=\"//www.google-analytics.com\" />\r\n\t\r\n\t<!-- Preload critical resources -->\r\n\t{#if type === 'product'}\r\n\t\t<!-- Preload product page specific resources -->\r\n\t\t<link rel=\"prefetch\" href=\"/api/favorites/status\" />\r\n\t\t<link rel=\"prefetch\" href=\"/api/reviews\" />\r\n\t{/if}\r\n</svelte:head>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\utilities\\ToastContainer.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[745,748],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[745,748],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1975,1978],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1975,1978],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2007,2010],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2007,2010],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<!--\n  Legacy ToastContainer - Backward Compatible\n  \n  This component maintains backward compatibility while internally using the new\n  Melt UI toast system. Existing components can continue using this component\n  without any changes.\n  \n  For new code, consider using the modern ToastProvider:\n  import { ToastProvider } from '@repo/ui/primitives'\n-->\n<script lang=\"ts\">\n\t// No lifecycle imports needed - using $effect\n\timport ToastProvider from '../../primitives/toast/ToastProvider.svelte';\n\timport { setToastProvider } from '../../primitives/toast/store';\n\n\tinterface Toast {\n\t\tid: string;\n\t\tmessage: string;\n\t\ttype?: 'success' | 'error' | 'info' | 'warning';\n\t\tduration?: number;\n\t}\n\n\tlet toasts = $state<Toast[]>([]);\n\tlet toastProvider: any;\n\n\t// Global toast function that other components can call (legacy support)\n\tfunction addToast(message: string, type: Toast['type'] = 'info', duration = 3000) {\n\t\tconst id = Math.random().toString(36).substring(2, 9);\n\t\t\n\t\t// Use ONLY the modern toast provider - no local toasts to prevent duplicates\n\t\tif (toastProvider?.addToastData) {\n\t\t\treturn toastProvider.addToastData({\n\t\t\t\tid,\n\t\t\t\ttype: type || 'info',\n\t\t\t\tdescription: message,\n\t\t\t\tduration\n\t\t\t});\n\t\t}\n\t\t\n\t\t// Fallback only if no modern provider available\n\t\tconst toast: Toast = { id, message, type, duration };\n\t\ttoasts = [...toasts, toast];\n\t\t\n\t\tsetTimeout(() => {\n\t\t\tremoveToast(id);\n\t\t}, duration);\n\t\t\n\t\treturn id;\n\t}\n\n\tfunction removeToast(id: string) {\n\t\ttoasts = toasts.filter(t => t.id !== id);\n\t\t\n\t\t// Also remove from modern provider if available\n\t\tif (toastProvider?.removeToastData) {\n\t\t\ttoastProvider.removeToastData(id);\n\t\t}\n\t}\n\n\t// Expose the addToast function globally for other components (legacy support)\n\t$effect(() => {\n\t\t// Set up connection to modern toast system\n\t\tif (toastProvider) {\n\t\t\tsetToastProvider(toastProvider);\n\t\t}\n\n\t\t// Only set window.showToast if not already set by modern store\n\t\tif (typeof window !== 'undefined' && !(window as any).showToast) {\n\t\t\t(window as any).showToast = addToast;\n\t\t}\n\t});\n\n\tfunction getToastStyles(type?: Toast['type']) {\n\t\tswitch (type) {\n\t\t\tcase 'success':\n\t\t\t\treturn 'bg-green-500 text-white';\n\t\t\tcase 'error':\n\t\t\t\treturn 'bg-red-500 text-white';\n\t\t\tcase 'warning':\n\t\t\t\treturn 'bg-yellow-500 text-white';\n\t\t\tdefault:\n\t\t\t\treturn 'bg-gray-800 text-white';\n\t\t}\n\t}\n</script>\n\n<!-- Use modern ToastProvider internally -->\n<ToastProvider \n\tbind:this={toastProvider}\n\tposition=\"bottom-right\"\n\tlimit={5}\n\tduration={5000}\n\tclass=\"toast-provider\"\n/>\n\n<!-- Legacy Toast Container - Only shown for components still subscribing to legacy store -->\n{#if toasts.length > 0}\n<div class=\"fixed bottom-0 right-0 z-40 p-4 space-y-2 pointer-events-none\">\n\t{#each toasts as toast (toast.id)}\n\t\t<div\n\t\t\tclass=\"max-w-sm p-4 rounded-lg shadow-sm md:shadow-lg transform transition-colors duration-300 ease-out pointer-events-auto {getToastStyles(toast.type)}\"\n\t\t>\n\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t<p class=\"text-sm font-medium\">{toast.message}</p>\n\t\t\t\t<button\n\t\t\t\t\tonclick={() => removeToast(toast.id)}\n\t\t\t\t\tclass=\"ml-4 text-white/80 hover:text-white focus:outline-none min-h-[36px] min-w-[36px] flex items-center justify-center\"\n\t\t\t\t\taria-label=\"Close notification\"\n\t\t\t\t>\n\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t{/each}\n</div>\n{/if}","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\utilities\\ToastProvider.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1072,1075],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1072,1075],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<!--\n  ToastProvider - Context Provider for Toast System using Flowbite\n\n  This component provides toast context to child components and renders\n  the toast container. It should wrap the entire application or layout.\n-->\n<script lang=\"ts\">\n\timport { setContext } from 'svelte';\n\n\tinterface ToastData {\n\t\tid: string;\n\t\tmessage: string;\n\t\ttype?: 'success' | 'error' | 'info' | 'warning';\n\t\tduration?: number;\n\t}\n\n\tlet toasts = $state<ToastData[]>([]);\n\n\tfunction addToast(message: string, type: ToastData['type'] = 'info', duration = 3000) {\n\t\tconst id = Math.random().toString(36).substring(2, 9);\n\t\tconst toast: ToastData = { id, message, type, duration };\n\n\t\ttoasts = [...toasts, toast];\n\n\t\tsetTimeout(() => {\n\t\t\tremoveToast(id);\n\t\t}, duration);\n\n\t\treturn id;\n\t}\n\n\tfunction removeToast(id: string) {\n\t\ttoasts = toasts.filter(t => t.id !== id);\n\t}\n\n\t// Provide toast context to child components\n\tsetContext('toast', {\n\t\taddToast,\n\t\tremoveToast,\n\t\ttoasts: () => toasts\n\t});\n\n\t// Also expose globally for legacy components\n\tif (typeof window !== 'undefined') {\n\t\t(window as any).showToast = addToast;\n\t}\n\n\tlet { children } = $props();\n</script>\n\n<!-- Render children -->\n{@render children?.()}\n\n<!-- Simple toast container - we'll handle toasts manually for now -->","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\utilities\\TutorialToast.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fade' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  import { onMount } from 'svelte';\n  import { fade, fly } from 'svelte/transition';\n  \n  interface Props {\n    step: number;\n    totalSteps: number;\n    title: string;\n    description: string;\n    targetElement?: string; // CSS selector for element to point to\n    position?: 'top' | 'bottom' | 'left' | 'right';\n    onDismiss?: () => void;\n    onNext?: () => void;\n  }\n\n  let {\n    step,\n    totalSteps,\n    title,\n    description,\n    targetElement,\n    position = 'bottom',\n    onDismiss,\n    onNext\n  }: Props = $props();\n\n  let show = $state(true);\n  let targetRect = $state<DOMRect | null>(null);\n  let toastElement = $state<HTMLDivElement | null>(null);\n\n  onMount(() => {\n    if (targetElement) {\n      const element = document.querySelector(targetElement);\n      if (element) {\n        targetRect = element.getBoundingClientRect();\n        \n        // Add pulsing highlight to target element\n        element.classList.add('tutorial-highlight');\n        \n        return () => {\n          element.classList.remove('tutorial-highlight');\n        };\n      }\n    }\n  });\n\n  function handleDismiss() {\n    show = false;\n    setTimeout(() => onDismiss?.(), 300);\n  }\n\n  function handleNext() {\n    show = false;\n    setTimeout(() => onNext?.(), 300);\n  }\n\n  // Calculate toast position based on target element\n  const getToastStyles = () => {\n    if (!targetRect) return '';\n    \n    const spacing = 16;\n    let styles = '';\n    \n    switch (position) {\n      case 'top':\n        styles = `bottom: ${window.innerHeight - targetRect.top + spacing}px; left: ${targetRect.left}px;`;\n        break;\n      case 'bottom':\n        styles = `top: ${targetRect.bottom + spacing}px; left: ${targetRect.left}px;`;\n        break;\n      case 'left':\n        styles = `top: ${targetRect.top}px; right: ${window.innerWidth - targetRect.left + spacing}px;`;\n        break;\n      case 'right':\n        styles = `top: ${targetRect.top}px; left: ${targetRect.right + spacing}px;`;\n        break;\n    }\n    \n    return styles;\n  };\n</script>\n\n{#if show}\n  <div\n    bind:this={toastElement}\n    class=\"tutorial-toast {position}\"\n    style={targetRect ? getToastStyles() : ''}\n    transition:fly={{ y: 20, duration: 300 }}\n  >\n    {#if targetRect}\n      <!-- Arrow pointing to element -->\n      <div class=\"tutorial-arrow {position}\"></div>\n    {/if}\n    \n    <div class=\"flex items-start space-x-3\">\n      <!-- Step indicator -->\n      <div class=\"flex-shrink-0\">\n        <div class=\"w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-semibold\">\n          {step}\n        </div>\n      </div>\n      \n      <!-- Content -->\n      <div class=\"flex-1\">\n        <h4 class=\"font-semibold text-gray-900 mb-1\">{title}</h4>\n        <p class=\"text-sm text-gray-500\">{description}</p>\n        \n        <!-- Progress -->\n        <div class=\"flex items-center justify-between mt-3\">\n          <div class=\"flex space-x-1\">\n            {#each Array(totalSteps) as _, i}\n              <div \n                class=\"w-1.5 h-1.5 rounded-full transition-colors {i + 1 <= step ? 'bg-blue-500' : 'bg-gray-300'}\"\n              ></div>\n            {/each}\n          </div>\n          \n          <!-- Actions -->\n          <div class=\"flex space-x-2\">\n            <button\n              onclick={handleDismiss}\n              class=\"text-xs text-gray-500 hover:text-gray-900\"\n              aria-label=\"Skip tutorial\"\n              type=\"button\"\n            >\n              Skip all\n            </button>\n            {#if step < totalSteps}\n              <button\n                onclick={handleNext}\n                class=\"text-xs font-medium text-blue-600 hover:text-blue-700\"\n                aria-label={`Go to step ${step + 1} of tutorial`}\n                type=\"button\"\n              >\n                Next →\n              </button>\n            {:else}\n              <button\n                onclick={handleDismiss}\n                class=\"text-xs font-medium text-green-600 hover:text-green-700\"\n                aria-label=\"Complete tutorial\"\n                type=\"button\"\n              >\n                Got it! ✓\n              </button>\n            {/if}\n          </div>\n        </div>\n      </div>\n      \n      <!-- Close button -->\n      <button\n        onclick={handleDismiss}\n        class=\"flex-shrink-0 text-gray-400 hover:text-gray-500\"\n        aria-label=\"Close tutorial\"\n      >\n        <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\n        </svg>\n      </button>\n    </div>\n  </div>\n{/if}\n\n<style>\n  .tutorial-toast {\n    position: fixed;\n    z-index: 60;\n    background: white;\n    border-radius: 12px;\n    padding: 16px;\n    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n    max-width: 380px;\n    border: 1px solid rgba(0, 0, 0, 0.05);\n  }\n  \n  .tutorial-toast.bottom {\n    transform-origin: top center;\n  }\n  \n  .tutorial-toast.top {\n    transform-origin: bottom center;\n  }\n  \n  /* Arrow styles */\n  .tutorial-arrow {\n    position: absolute;\n    width: 12px;\n    height: 12px;\n    background: white;\n    border: 1px solid rgba(0, 0, 0, 0.05);\n    transform: rotate(45deg);\n  }\n  \n  .tutorial-arrow.top {\n    bottom: -7px;\n    left: 24px;\n    border-top: none;\n    border-left: none;\n  }\n  \n  .tutorial-arrow.bottom {\n    top: -7px;\n    left: 24px;\n    border-bottom: none;\n    border-right: none;\n  }\n  \n  .tutorial-arrow.left {\n    right: -7px;\n    top: 24px;\n    border-left: none;\n    border-bottom: none;\n  }\n  \n  .tutorial-arrow.right {\n    left: -7px;\n    top: 24px;\n    border-right: none;\n    border-top: none;\n  }\n  \n  /* Highlight animation for target elements */\n  :global(.tutorial-highlight) {\n    position: relative;\n    animation: tutorial-pulse 2s infinite;\n  }\n  \n  :global(.tutorial-highlight::before) {\n    content: '';\n    position: absolute;\n    inset: -4px;\n    border: 2px solid #3B82F6;\n    border-radius: 8px;\n    pointer-events: none;\n    animation: tutorial-pulse-border 2s infinite;\n  }\n  \n  @keyframes tutorial-pulse {\n    0%, 100% {\n      transform: scale(1);\n    }\n    50% {\n      transform: scale(1.02);\n    }\n  }\n  \n  @keyframes tutorial-pulse-border {\n    0%, 100% {\n      opacity: 0.5;\n    }\n    50% {\n      opacity: 1;\n    }\n  }\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\utilities\\UnifiedCookieConsent.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":61,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":222,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":222,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":330,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":330,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"﻿<script lang=\"ts\">\r\n  import { isBrowser } from '../../utils/runtime.js';\r\n  import * as i18n from '@repo/i18n';\r\n  \r\n  interface Props {\r\n    onConsentChange?: (consent: ConsentState) => void;\r\n    enableLocationDetection?: boolean;\r\n    initialShowBanner?: boolean;\r\n  }\r\n\r\n  let {\r\n    onConsentChange,\r\n    enableLocationDetection = true,\r\n    initialShowBanner = false\r\n  }: Props = $props();\r\n  \r\n  interface ConsentState {\r\n    necessary: boolean;\r\n    functional: boolean;\r\n    analytics: boolean;\r\n    marketing: boolean;\r\n    timestamp?: number;\r\n  }\r\n\r\n  interface RequestConsentEventDetail {\r\n    reason?: string;\r\n    pendingLanguage?: string;\r\n  }\r\n  \r\n  // Simple cookie manager for @repo/ui compatibility\r\n  class SimpleCookieManager {\r\n    private static instance: SimpleCookieManager;\r\n    \r\n    static getInstance(): SimpleCookieManager {\r\n      if (!SimpleCookieManager.instance) {\r\n        SimpleCookieManager.instance = new SimpleCookieManager();\r\n      }\r\n      return SimpleCookieManager.instance;\r\n    }\r\n    \r\n    getConsent(): ConsentState | null {\r\n      if (!isBrowser) return null;\r\n      try {\r\n        const consent = document.cookie\r\n          .split(';')\r\n          .find(row => row.trim().startsWith('driplo_consent='))\r\n          ?.split('=')[1];\r\n        return consent ? JSON.parse(decodeURIComponent(consent)) : null;\r\n      } catch {\r\n        return null;\r\n      }\r\n    }\r\n    \r\n    updateConsent(consent: ConsentState): void {\r\n      if (!isBrowser) return;\r\n      const consentWithTimestamp = { ...consent, timestamp: Date.now() };\r\n      try {\r\n        const expires = new Date();\r\n        expires.setFullYear(expires.getFullYear() + 1);\r\n        document.cookie = `driplo_consent=${encodeURIComponent(JSON.stringify(consentWithTimestamp))}; expires=${expires.toUTCString()}; path=/; SameSite=Lax${location.protocol === 'https:' ? '; Secure' : ''}`;\r\n      } catch (e) {\r\n        \r\n      }\r\n    }\r\n  }\r\n  \r\n  // Simple locale manager\r\n  class SimpleLocaleManager {\r\n    private static instance: SimpleLocaleManager;\r\n    \r\n    static getInstance(): SimpleLocaleManager {\r\n      if (!SimpleLocaleManager.instance) {\r\n        SimpleLocaleManager.instance = new SimpleLocaleManager();\r\n      }\r\n      return SimpleLocaleManager.instance;\r\n    }\r\n    \r\n    getLocale(): string {\r\n      return i18n.getLocale();\r\n    }\r\n  }\r\n  \r\n  let showBanner = $state(false);\r\n  let showPreferences = $state(false);\r\n  let showLanguageSelector = $state(false);\r\n  let consentManager: SimpleCookieManager;\r\n  let localeManager: SimpleLocaleManager;\r\n  let hasExistingConsent = $state(false);\r\n  \r\n  let preferences = $state({\r\n    necessary: true,\r\n    functional: false,\r\n    analytics: false,\r\n    marketing: false\r\n  });\r\n  \r\n  let selectedLocale = $state('en');\r\n  let detectedCountry = $state<string | null>(null);\r\n  let detectedCountryName = $state<string | null>(null);\r\n  \r\n  const languages = [\r\n    { code: 'en', name: 'English', flag: '🇬🇧' },\r\n    { code: 'bg', name: 'Български', flag: '🇧🇬' }\r\n  ];\r\n  \r\n  const countryNames: Record<string, string> = {\r\n    'GB': 'United Kingdom',\r\n    'UK': 'United Kingdom', \r\n    'BG': 'Bulgaria',\r\n    'US': 'United States',\r\n    'ES': 'Spain',\r\n    'FR': 'France',\r\n    'DE': 'Germany',\r\n    'IT': 'Italy',\r\n    'RU': 'Russia',\r\n    'UA': 'Ukraine',\r\n    'RO': 'Romania',\r\n    'PL': 'Poland',\r\n    'NL': 'Netherlands'\r\n  };\r\n  \r\n  $effect(() => {\r\n    if (!isBrowser) return;\r\n\r\n    consentManager = SimpleCookieManager.getInstance();\r\n    localeManager = SimpleLocaleManager.getInstance();\r\n\r\n    // Use server-side determination for initial banner visibility\r\n    showBanner = initialShowBanner;\r\n\r\n    // Check existing consent for UI state\r\n    const existingConsent = consentManager.getConsent();\r\n\r\n    if (existingConsent) {\r\n      hasExistingConsent = true;\r\n      preferences = {\r\n        necessary: true,\r\n        functional: existingConsent.functional,\r\n        analytics: existingConsent.analytics,\r\n        marketing: existingConsent.marketing\r\n      };\r\n    } else {\r\n      // First visit - detect location for language suggestion\r\n      if (enableLocationDetection && initialShowBanner) {\r\n        detectLocation();\r\n      }\r\n      showLanguageSelector = enableLocationDetection && initialShowBanner;\r\n    }\r\n    \r\n    // Get current locale\r\n    const currentLocale = localeManager.getLocale();\r\n    selectedLocale = currentLocale;\r\n    \r\n    // Listen for requests to show cookie consent (e.g., for language switching)\r\n    const handleCookieConsentRequest: EventListener = (event) => {\r\n      const customEvent = event as CustomEvent<RequestConsentEventDetail>;\r\n\r\n      const pendingLang = sessionStorage?.getItem('pendingLanguageSwitch');\r\n      if (pendingLang) {\r\n        selectedLocale = pendingLang;\r\n        sessionStorage?.removeItem('pendingLanguageSwitch');\r\n      }\r\n\r\n      if (customEvent.detail?.pendingLanguage && customEvent.detail.pendingLanguage !== selectedLocale) {\r\n        selectedLocale = customEvent.detail.pendingLanguage;\r\n      }\r\n\r\n      showLanguageSelector = !!(pendingLang || customEvent.detail?.pendingLanguage);\r\n      showBanner = true;\r\n      showPreferences = true;\r\n    };\r\n    \r\n    (window as EventTarget).addEventListener('requestCookieConsent', handleCookieConsentRequest);\r\n    \r\n    return () => {\r\n      (window as EventTarget).removeEventListener('requestCookieConsent', handleCookieConsentRequest);\r\n    };\r\n  });\r\n  \r\n  async function detectLocation() {\r\n    if (!enableLocationDetection) return;\r\n    \r\n    try {\r\n      const response = await fetch('https://ipapi.co/json/');\r\n      const data = await response.json();\r\n      detectedCountry = data.country_code;\r\n      \r\n      // Set the detected country name\r\n      detectedCountryName = (detectedCountry && countryNames[detectedCountry]) || data.country_name || detectedCountry || 'Unknown';\r\n      \r\n      // Map country to language\r\n      const countryToLang: Record<string, string> = {\r\n        'GB': 'en', // UK uses English\r\n        'UK': 'en', // UK uses English\r\n        'US': 'en', // US uses English\r\n        'BG': 'bg', 'ES': 'es', 'FR': 'fr', 'DE': 'de', \r\n        'IT': 'it', 'RU': 'ru', 'UA': 'ua'\r\n      };\r\n      \r\n      if (detectedCountry && countryToLang[detectedCountry]) {\r\n        selectedLocale = countryToLang[detectedCountry];\r\n      }\r\n      \r\n      // Set country cookie if detected (for UK/Bulgaria separation)\r\n      if (detectedCountry === 'GB' || detectedCountry === 'UK') {\r\n        // Set country cookie to GB for UK visitors\r\n        document.cookie = `country=GB; path=/; max-age=${365 * 24 * 60 * 60}; SameSite=Lax${!isBrowser || location.protocol === 'https:' ? '; Secure' : ''}`;\r\n      } else if (detectedCountry === 'BG') {\r\n        // Set country cookie to BG for Bulgarian visitors\r\n        document.cookie = `country=BG; path=/; max-age=${365 * 24 * 60 * 60}; SameSite=Lax${!isBrowser || location.protocol === 'https:' ? '; Secure' : ''}`;\r\n      }\r\n      \r\n      // Also check for existing country cookie to sync region\r\n      const countryCookie = document.cookie\r\n        .split('; ')\r\n        .find(row => row.startsWith('country='))\r\n        ?.split('=')[1];\r\n      \r\n      if (countryCookie && countryCookie !== detectedCountry) {\r\n        // Could handle country mismatch here\r\n      }\r\n    } catch (error) {\r\n      // Fallback to isBrowser language\r\n      const isBrowserLang = navigator.language.split('-')[0].toLowerCase();\r\n      if (languages.find(l => l.code === isBrowserLang)) {\r\n        selectedLocale = isBrowserLang;\r\n      }\r\n    }\r\n  }\r\n  \r\n  async function acceptAll() {\r\n    const consent = {\r\n      necessary: true,\r\n      functional: true,\r\n      analytics: true,\r\n      marketing: true\r\n    };\r\n    \r\n    // Update consent first\r\n    consentManager.updateConsent(consent);\r\n    onConsentChange?.(consent);\r\n    \r\n    // Check if there's a pending language switch that can now be completed\r\n    const pendingLang = sessionStorage?.getItem('pendingLanguageSwitch');\r\n    \r\n    // Save language preference if language selector was shown or there's a pending switch\r\n    if ((showLanguageSelector && selectedLocale) || pendingLang) {\r\n      const targetLang = pendingLang || selectedLocale;\r\n      saveLanguageAndRedirect(targetLang);\r\n    } else {\r\n      showBanner = false;\r\n      showLanguageSelector = false;\r\n    }\r\n  }\r\n  \r\n  async function acceptNecessary() {\r\n    const consent = {\r\n      necessary: true,\r\n      functional: false,\r\n      analytics: false,\r\n      marketing: false\r\n    };\r\n\r\n    // Update consent\r\n    consentManager.updateConsent(consent);\r\n    onConsentChange?.(consent);\r\n\r\n    showBanner = false;\r\n    showLanguageSelector = false;\r\n  }\r\n  \r\n  async function savePreferences() {\r\n    // Update consent\r\n    consentManager.updateConsent(preferences);\r\n    onConsentChange?.(preferences);\r\n    \r\n    // Check if there's a pending language switch that can now be completed\r\n    const pendingLang = sessionStorage?.getItem('pendingLanguageSwitch');\r\n    \r\n    // Save language if functional cookies enabled\r\n    if (preferences.functional && ((showLanguageSelector && selectedLocale) || pendingLang)) {\r\n      const targetLang = pendingLang || selectedLocale;\r\n      saveLanguageAndRedirect(targetLang);\r\n    } else {\r\n      showBanner = false;\r\n      showPreferences = false;\r\n      showLanguageSelector = false;\r\n    }\r\n  }\r\n  \r\n  function saveLanguageAndRedirect(targetLang: string) {\r\n    try {\r\n      // Set cookie first\r\n      document.cookie = `PARAGLIDE_LOCALE=${targetLang}; path=/; max-age=${365 * 24 * 60 * 60}; SameSite=Lax${!isBrowser || location.protocol === 'https:' ? '; Secure' : ''}`;\r\n      \r\n      // Clear the pending language switch\r\n      sessionStorage?.removeItem('pendingLanguageSwitch');\r\n      \r\n      // Close banner\r\n      showBanner = false;\r\n      showPreferences = false;\r\n      showLanguageSelector = false;\r\n      \r\n      // Wait a moment for cookies and consent to be properly set before redirecting\r\n      setTimeout(() => {\r\n        // Redirect to proper URL with language prefix\r\n        const currentUrl = new URL(window.location.href);\r\n        let newPath = currentUrl.pathname;\r\n        \r\n        // Remove existing locale prefix if any\r\n        newPath = newPath.replace(/^\\/(?:bg|uk)(?=\\/|$)/, '');\r\n        \r\n        // Use /uk for English; Bulgarian uses no prefix (root)\r\n        if (targetLang === 'bg') {\r\n          newPath = (newPath === '/' ? '/' : newPath);\r\n        } else if (targetLang === 'en') {\r\n          newPath = '/uk' + (newPath === '/' ? '' : newPath);\r\n        }\r\n        // Also include locale query to allow server to persist cookie immediately\r\n        const qs = new URLSearchParams(currentUrl.search);\r\n        qs.set('locale', targetLang);\r\n        \r\n        // Build final URL\r\n        const finalUrl = `${currentUrl.protocol}//${currentUrl.host}${newPath}${qs.toString() ? `?${qs.toString()}` : ''}${currentUrl.hash}`;\r\n        \r\n        // Navigate to the new URL\r\n        window.location.href = finalUrl;\r\n      }, 150);\r\n      \r\n    } catch (e) {\r\n      // Fallback: Set the locale cookie directly and refresh\r\n      document.cookie = `PARAGLIDE_LOCALE=${targetLang}; path=/; max-age=${365 * 24 * 60 * 60}; SameSite=Lax${!isBrowser || location.protocol === 'https:' ? '; Secure' : ''}`;\r\n      \r\n      setTimeout(() => {\r\n        window.location.reload();\r\n      }, 150);\r\n    }\r\n  }\r\n  \r\n  function togglePreferences() {\r\n    showPreferences = !showPreferences;\r\n  }\r\n</script>\r\n\r\n{#if showBanner}\r\n  <!-- Semi-transparent backdrop -->\r\n  <div class=\"fixed inset-0 bg-black/40 md:backdrop-blur-sm md:bg-black/30 z-[9998]\" aria-hidden=\"true\"></div>\r\n  \r\n  <!-- Main Banner Container -->\r\n  <div class=\"fixed inset-x-0 bottom-0 z-[9999] max-h-[90vh] overflow-y-auto\">\r\n    <div class=\"bg-[color:var(--surface-base)]/95 border-t border-[color:var(--border-subtle)] shadow-xl backdrop-blur-xl\">\r\n      <div class=\"max-w-6xl mx-auto px-2 sm:px-4\">\r\n        \r\n        {#if showLanguageSelector && !hasExistingConsent}\r\n          <!-- Language Selection (First Time Visitors) -->\r\n          <div class=\"p-6 border-b border-[color:var(--border-subtle)] bg-[color:var(--surface-secondary)]\">\r\n            <div class=\"text-center mb-4\">\r\n              <h3 class=\"text-lg font-bold text-[color:var(--text-primary)]\">Welcome to Driplo! 🌍</h3>\r\n              <p class=\"text-sm text-[color:var(--text-secondary)] mt-1\">\r\n                {#if detectedCountryName}\r\n                  <span class=\"inline-flex items-center gap-1 bg-[color:var(--status-info-bg)] text-[color:var(--status-info-fg)] px-3 py-1 rounded-full text-sm font-medium mb-2\">\r\n                    📍 We detected you're visiting from <strong>{detectedCountryName}</strong>\r\n                  </span>\r\n                  <br>\r\n                  Choose your preferred language:\r\n                {:else if detectedCountry}\r\n                  <span class=\"inline-flex items-center gap-1 bg-[color:var(--status-info-bg)] text-[color:var(--status-info-fg)] px-3 py-1 rounded-full text-sm font-medium mb-2\">\r\n                    📍 We detected you're visiting from <strong>{detectedCountry}</strong>\r\n                  </span>\r\n                  <br>\r\n                  Choose your preferred language:\r\n                {:else}\r\n                  Choose your preferred language:\r\n                {/if}\r\n              </p>\r\n            </div>\r\n            \r\n            <div class=\"flex flex-col sm:flex-row gap-4 max-w-lg mx-auto\">\r\n              {#each languages as lang}\r\n                <button\r\n                  onclick={() => selectedLocale = lang.code}\r\n                  class=\"flex-1 min-h-[64px] p-4 rounded-xl border-2 transition-all duration-200 hover:scale-[1.02] active:scale-[0.98]\r\n                    {selectedLocale === lang.code \r\n                      ? 'border-[color:var(--brand-primary)] bg-[color:var(--surface-brand-subtle)] shadow-lg ring-2 ring-[color:var(--brand-primary)]/20' \r\n                      : 'border-[color:var(--border-primary)] bg-[color:var(--surface-base)] hover:border-[color:var(--border-secondary)] hover:shadow-md'}\"\r\n                  title={`Choose ${lang.name}`}\r\n                >\r\n                  <div class=\"flex items-center justify-center gap-3\">\r\n                    <div class=\"text-3xl\">{lang.flag}</div>\r\n                    <div class=\"text-left flex-1\">\r\n                      <div class=\"text-sm font-semibold text-gray-900\">{lang.name}</div>\r\n                      <div class=\"text-xs text-gray-500\">\r\n                        {lang.code === 'en' ? 'United Kingdom' : 'България'}\r\n                      </div>\r\n                    </div>\r\n                    {#if selectedLocale === lang.code}\r\n                      <div class=\"ml-2\">\r\n                        <div class=\"w-6 h-6 bg-[color:var(--brand-primary)] rounded-full flex items-center justify-center\">\r\n                          <svg class=\"w-4 h-4 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                            <path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" />\r\n                          </svg>\r\n                        </div>\r\n                      </div>\r\n                    {/if}\r\n                  </div>\r\n                </button>\r\n              {/each}\r\n            </div>\r\n          </div>\r\n        {/if}\r\n        \r\n        <!-- Cookie Consent Section -->\r\n        <div class=\"p-4 sm:p-6\">\r\n          <div class=\"flex flex-col lg:flex-row gap-4 lg:gap-6\">\r\n            \r\n            <!-- Content -->\r\n            <div class=\"flex-1\">\r\n              <div class=\"flex items-start gap-3 sm:gap-4\">\r\n                <div class=\"flex-shrink-0\">\r\n                  <div class=\"w-10 h-10 sm:w-12 sm:h-12 bg-[color:var(--surface-strong)] rounded-xl flex items-center justify-center shadow-lg\">\r\n                    <svg class=\"w-5 h-5 sm:w-6 sm:h-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" \r\n                            d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" />\r\n                    </svg>\r\n                  </div>\r\n                </div>\r\n                \r\n                <div class=\"flex-1 min-w-0\">\r\n                  <h2 class=\"text-lg sm:text-xl font-bold text-[color:var(--text-primary)] mb-2\">\r\n                    Privacy & Cookie Settings\r\n                  </h2>\r\n                  <p class=\"text-sm text-[color:var(--text-secondary)] leading-relaxed\">\r\n                    We use cookies to provide essential features, remember your preferences, \r\n                    and analyze how you use our platform. You control what we collect.\r\n                    <a href=\"/privacy/cookies\" class=\"link ml-1 font-medium\">\r\n                      Learn more\r\n                    </a>\r\n                  </p>\r\n                  {#if detectedCountryName && (detectedCountry === 'GB' || detectedCountry === 'UK' || detectedCountry === 'BG')}\r\n                    <div class=\"mt-3 p-2 bg-[color:var(--status-warning-bg)] border border-[color:var(--status-warning)] rounded-lg\">\r\n                      <p class=\"text-xs text-[color:var(--status-warning-fg)]\">\r\n                        💡 <strong>Tip:</strong> Shopping from {detectedCountryName}? \r\n                        Visit <a href={detectedCountry === 'BG' ? 'https://bg.driplo.xyz' : 'https://uk.driplo.xyz'} \r\n                              class=\"font-medium underline\">\r\n                          {detectedCountry === 'BG' ? 'bg.driplo.xyz' : 'uk.driplo.xyz'}\r\n                        </a> to see local listings and prices in {detectedCountry === 'BG' ? 'BGN' : 'GBP'}.\r\n                      </p>\r\n                    </div>\r\n                  {/if}\r\n                </div>\r\n              </div>\r\n              \r\n              <!-- Cookie Categories (Expandable) -->\r\n              {#if showPreferences}\r\n                <div class=\"mt-6 space-y-3 bg-[color:var(--surface-secondary)] rounded-xl p-4\">\r\n                  \r\n                  <!-- Essential (Always On) -->\r\n                  <div class=\"bg-white rounded-lg p-3 border border-[color:var(--border-secondary)]\">\r\n                    <label class=\"flex items-start gap-3 cursor-not-allowed\">\r\n                      <input \r\n                        type=\"checkbox\" \r\n                        checked={true}\r\n                        disabled\r\n                        class=\"mt-0.5 w-5 h-5 rounded border-[color:var(--border-primary)] cursor-not-allowed opacity-60\"\r\n                      />\r\n                      <div class=\"flex-1\">\r\n                        <div class=\"font-semibold text-sm text-[color:var(--text-primary)]\">Essential</div>\r\n                        <p class=\"text-xs text-[color:var(--text-muted)] mt-0.5\">\r\n                          Authentication, security, basic functionality\r\n                        </p>\r\n                      </div>\r\n                      <span class=\"text-xs bg-[color:var(--surface-tertiary)] text-[color:var(--text-muted)] px-2 py-1 rounded-full\">\r\n                        Required\r\n                      </span>\r\n                    </label>\r\n                  </div>\r\n                  \r\n                  <!-- Functional -->\r\n                  <div class=\"bg-white rounded-lg p-3 border border-[color:var(--border-secondary)]\">\r\n                    <label class=\"flex items-start gap-3 cursor-pointer\">\r\n                      <input \r\n                        type=\"checkbox\" \r\n                        bind:checked={preferences.functional}\r\n                        class=\"mt-0.5 w-5 h-5 rounded border-[color:var(--border-primary)] text-[color:var(--primary)] focus:ring-[color:var(--state-focus)]\"\r\n                      />\r\n                      <div class=\"flex-1\">\r\n                        <div class=\"font-semibold text-sm text-[color:var(--text-primary)]\">Functional</div>\r\n                        <p class=\"text-xs text-[color:var(--text-muted)] mt-0.5\">\r\n                          Language, theme, saved preferences\r\n                        </p>\r\n                      </div>\r\n                    </label>\r\n                  </div>\r\n                  \r\n                  <!-- Analytics -->\r\n                  <div class=\"bg-white rounded-lg p-3 border border-[color:var(--border-secondary)]\">\r\n                    <label class=\"flex items-start gap-3 cursor-pointer\">\r\n                      <input \r\n                        type=\"checkbox\" \r\n                        bind:checked={preferences.analytics}\r\n                        class=\"mt-0.5 w-5 h-5 rounded border-[color:var(--border-primary)] text-[color:var(--primary)] focus:ring-[color:var(--state-focus)]\"\r\n                      />\r\n                      <div class=\"flex-1\">\r\n                        <div class=\"font-semibold text-sm text-[color:var(--text-primary)]\">Analytics</div>\r\n                        <p class=\"text-xs text-[color:var(--text-muted)] mt-0.5\">\r\n                          Usage statistics to improve our service\r\n                        </p>\r\n                      </div>\r\n                    </label>\r\n                  </div>\r\n                  \r\n                  <!-- Marketing -->\r\n                  <div class=\"bg-white rounded-lg p-3 border border-[color:var(--border-secondary)]\">\r\n                    <label class=\"flex items-start gap-3 cursor-pointer\">\r\n                      <input \r\n                        type=\"checkbox\" \r\n                        bind:checked={preferences.marketing}\r\n                        class=\"mt-0.5 w-5 h-5 rounded border-[color:var(--border-primary)] text-[color:var(--primary)] focus:ring-[color:var(--state-focus)]\"\r\n                      />\r\n                      <div class=\"flex-1\">\r\n                        <div class=\"font-semibold text-sm text-[color:var(--text-primary)]\">Marketing</div>\r\n                        <p class=\"text-xs text-[color:var(--text-muted)] mt-0.5\">\r\n                          Personalized ads and campaigns\r\n                        </p>\r\n                      </div>\r\n                    </label>\r\n                  </div>\r\n                  \r\n                </div>\r\n              {/if}\r\n            </div>\r\n            \r\n            <!-- Actions -->\r\n            <div class=\"flex flex-col sm:flex-row lg:flex-col gap-2 lg:w-64\">\r\n              <button\r\n                onclick={acceptAll}\r\n                class=\"min-h-[44px] px-4 py-3 bg-blue-600 text-white rounded-xl font-semibold \r\n                       hover:bg-blue-700 transition-all hover:scale-[1.02] shadow-lg text-sm\"\r\n              >\r\n                Accept All\r\n              </button>\r\n              \r\n              <button\r\n                onclick={acceptNecessary}\r\n                class=\"min-h-[44px] px-4 py-3 bg-white text-gray-700 rounded-xl font-semibold \r\n                       border-2 border-gray-200 hover:border-gray-300 hover:bg-gray-50 transition-all text-sm\"\r\n              >\r\n                Essential Only\r\n              </button>\r\n              \r\n              {#if !showPreferences}\r\n                <button\r\n                  onclick={togglePreferences}\r\n                  class=\"min-h-[44px] px-4 py-3 text-gray-500 hover:text-gray-700 \r\n                         font-semibold transition-colors text-sm hover:bg-gray-50 rounded-xl\"\r\n                >\r\n                  Customize\r\n                </button>\r\n              {:else}\r\n                <button\r\n                  onclick={savePreferences}\r\n                  class=\"min-h-[44px] px-4 py-3 bg-blue-600 \r\n                         text-white rounded-xl font-semibold hover:shadow-lg hover:bg-blue-700 transition-all text-sm\"\r\n                >\r\n                  Save My Choices\r\n                </button>\r\n              {/if}\r\n            </div>\r\n            \r\n          </div>\r\n          \r\n          <!-- GDPR Badge -->\r\n          <div class=\"mt-4 pt-4 border-t border-[color:var(--border-secondary)] flex items-center justify-between text-xs\">\r\n            <div class=\"flex items-center gap-4 text-[color:var(--text-muted)]\">\r\n              <div class=\"flex items-center gap-1\">\r\n                <svg class=\"w-4 h-4 text-[color:var(--status-success)]\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                  <path fill-rule=\"evenodd\" d=\"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\" />\r\n                </svg>\r\n                <span>GDPR Compliant</span>\r\n              </div>\r\n              <span>•</span>\r\n              <span>Your privacy matters</span>\r\n            </div>\r\n            <a href=\"/privacy\" class=\"text-[color:var(--text-muted)] hover:text-[color:var(--text-secondary)] transition-colors\">\r\n              Privacy Policy\r\n            </a>\r\n          </div>\r\n          \r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n{/if}\r\n\r\n<style>\r\n  /* Smooth entrance animation */\r\n  @keyframes slideUp {\r\n    from {\r\n      transform: translateY(100%);\r\n      opacity: 0;\r\n    }\r\n    to {\r\n      transform: translateY(0);\r\n      opacity: 1;\r\n    }\r\n  }\r\n  \r\n  div[class*=\"fixed inset-x-0 bottom-0\"] {\r\n    animation: slideUp 0.4s ease-out;\r\n  }\r\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\components\\utilities\\WelcomeTutorialFlow.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\hooks\\is-mobile.svelte.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\accordion\\Accordion.svelte","messages":[{"ruleId":"svelte/no-at-html-tags","severity":1,"message":"`{@html}` can lead to XSS attack.","line":123,"column":13,"nodeType":"SvelteMustacheTag","messageId":"unexpected","endLine":123,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  import type { Snippet } from 'svelte';\n\n  interface AccordionItem {\n    id: string;\n    title: string;\n    content?: string;\n    contentSnippet?: Snippet;\n  }\n\n  interface Props {\n    items: AccordionItem[];\n    multiple?: boolean;\n    disabled?: boolean;\n    class?: string;\n  }\n\n  let {\n    items = [],\n    multiple = false,\n    disabled = false,\n    class: className = ''\n  }: Props = $props();\n\n  // Track expanded items\n  let expandedItems = $state<string[]>([]);\n\n  // Toggle item expansion\n  function toggleItem(itemId: string) {\n    if (disabled) return;\n\n    if (multiple) {\n      // Multiple items can be expanded\n      if (expandedItems.includes(itemId)) {\n        expandedItems = expandedItems.filter(id => id !== itemId);\n      } else {\n        expandedItems = [...expandedItems, itemId];\n      }\n    } else {\n      // Only one item can be expanded at a time\n      expandedItems = expandedItems.includes(itemId) ? [] : [itemId];\n    }\n  }\n\n  // Check if an item is expanded\n  function isExpanded(itemId: string): boolean {\n    return expandedItems.includes(itemId);\n  }\n\n  // Handle keyboard navigation\n  function handleKeydown(event: KeyboardEvent, itemId: string) {\n    const currentIndex = items.findIndex(item => item.id === itemId);\n    let nextIndex = currentIndex;\n\n    switch (event.key) {\n      case 'ArrowDown':\n        event.preventDefault();\n        nextIndex = currentIndex < items.length - 1 ? currentIndex + 1 : 0;\n        break;\n      case 'ArrowUp':\n        event.preventDefault();\n        nextIndex = currentIndex > 0 ? currentIndex - 1 : items.length - 1;\n        break;\n      case 'Home':\n        event.preventDefault();\n        nextIndex = 0;\n        break;\n      case 'End':\n        event.preventDefault();\n        nextIndex = items.length - 1;\n        break;\n      default:\n        return;\n    }\n\n    const nextButton = document.querySelector(`[data-accordion-trigger=\"${items[nextIndex].id}\"]`) as HTMLButtonElement;\n    nextButton?.focus();\n  }\n</script>\n\n<div class=\"accordion {className}\">\n  {#each items as accordionItem (accordionItem.id)}\n    <div class=\"accordion-item\">\n      <button\n        data-accordion-trigger={accordionItem.id}\n        type=\"button\"\n        class=\"accordion-trigger\"\n        class:expanded={isExpanded(accordionItem.id)}\n        aria-expanded={isExpanded(accordionItem.id)}\n        aria-controls={`accordion-content-${accordionItem.id}`}\n        disabled={disabled}\n        onclick={() => toggleItem(accordionItem.id)}\n        onkeydown={(e) => handleKeydown(e, accordionItem.id)}\n      >\n        <span class=\"accordion-title\">{accordionItem.title}</span>\n        <svg\n          class=\"accordion-chevron\"\n          class:rotated={isExpanded(accordionItem.id)}\n          fill=\"none\"\n          stroke=\"currentColor\"\n          viewBox=\"0 0 24 24\"\n          stroke-width=\"1.5\"\n          width=\"20\"\n          height=\"20\"\n          aria-hidden=\"true\"\n        >\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M19.5 8.25l-7.5 7.5-7.5-7.5\" />\n        </svg>\n      </button>\n\n      <div\n        id={`accordion-content-${accordionItem.id}`}\n        class=\"accordion-content\"\n        class:expanded={isExpanded(accordionItem.id)}\n        role=\"region\"\n        aria-labelledby={accordionItem.id}\n        hidden={!isExpanded(accordionItem.id)}\n      >\n        <div class=\"accordion-content-inner\">\n          {#if accordionItem.contentSnippet}\n            {@render accordionItem.contentSnippet()}\n          {:else if accordionItem.content}\n            {@html accordionItem.content}\n          {/if}\n        </div>\n      </div>\n    </div>\n  {/each}\n</div>\n\n<style>\n  .accordion {\n    width: 100%;\n    border: 1px solid var(--border-subtle);\n    border-radius: var(--radius-lg);\n    background: var(--surface-base);\n    overflow: hidden;\n  }\n\n  .accordion-item {\n    border-bottom: 1px solid var(--border-subtle);\n  }\n\n  .accordion-item:last-child {\n    border-bottom: none;\n  }\n\n  .accordion-trigger {\n    width: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    text-align: left;\n    background: transparent;\n    border: none;\n    padding: var(--space-4);\n    cursor: pointer;\n    transition: background-color 0.2s ease;\n    min-height: var(--touch-primary);\n  }\n\n  .accordion-trigger:hover {\n    background: var(--surface-subtle);\n  }\n\n  .accordion-trigger:focus-visible {\n    outline: none;\n    background: var(--surface-subtle);\n    box-shadow: 0 0 0 2px var(--state-focus);\n  }\n\n  .accordion-trigger.expanded {\n    background: var(--surface-muted);\n  }\n\n  .accordion-title {\n    color: var(--text-primary);\n    font-size: var(--text-base);\n    font-weight: var(--font-medium);\n    line-height: 1.6;\n    margin: 0;\n  }\n\n  .accordion-chevron {\n    color: var(--text-secondary);\n    flex-shrink: 0;\n    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  .accordion-chevron.rotated {\n    transform: rotate(180deg);\n  }\n\n  .accordion-content {\n    overflow: hidden;\n    transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    max-height: 0;\n  }\n\n  .accordion-content.expanded {\n    max-height: 1000px; /* Arbitrary large value */\n  }\n\n  .accordion-content-inner {\n    color: var(--text-secondary);\n    padding: 0 var(--space-4) var(--space-4);\n    font-size: var(--text-sm);\n    line-height: 1.6;\n  }\n\n  .accordion-content-inner :global(p) {\n    margin-bottom: var(--space-3);\n  }\n\n  .accordion-content-inner :global(p:last-child) {\n    margin-bottom: 0;\n  }\n\n  .accordion-content-inner :global(ul),\n  .accordion-content-inner :global(ol) {\n    margin-bottom: var(--space-3);\n    padding-left: var(--space-5);\n  }\n\n  .accordion-content-inner :global(ul:last-child),\n  .accordion-content-inner :global(ol:last-child) {\n    margin-bottom: 0;\n  }\n\n  .accordion-content-inner :global(li) {\n    margin-bottom: var(--space-1);\n  }\n\n  .accordion-content-inner :global(strong) {\n    font-weight: var(--font-semibold);\n    color: var(--text-primary);\n  }\n\n  .accordion-content-inner :global(code) {\n    background: var(--surface-subtle);\n    padding: var(--space-1) var(--space-1);\n    border-radius: var(--radius-sm);\n    font-family: monospace;\n    font-size: var(--text-xs);\n  }\n\n  /* Respect prefers-reduced-motion for accessibility */\n  @media (prefers-reduced-motion: reduce) {\n    .accordion-content,\n    .accordion-chevron,\n    .accordion-trigger {\n      transition: none;\n    }\n  }\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\accordion\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\dialog\\Dialog.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\menu\\Menu.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loop' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":35,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'portalTarget' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":41,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'gutter' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":42,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\n  import type { Snippet } from 'svelte';\n\n  interface MenuItemData {\n    id: string;\n    label: string;\n    disabled?: boolean;\n    separator?: boolean;\n    onSelect?: () => void;\n    icon?: string;\n    shortcut?: string;\n  }\n\n  interface Props {\n    open?: boolean;\n    onOpenChange?: (open: boolean) => void;\n    items?: MenuItemData[];\n    positioning?: 'bottom-start' | 'bottom-end' | 'top-start' | 'top-end' | 'bottom' | 'top';\n    loop?: boolean;\n    trigger?: Snippet;\n    children?: Snippet;\n    class?: string;\n    triggerClass?: string;\n    menuClass?: string;\n    portal?: string | HTMLElement | null;\n    gutter?: number;\n    ariaLabel?: string;\n  }\n\n  let {\n    open = $bindable(false),\n    onOpenChange,\n    items = [],\n    positioning = 'bottom-start',\n    loop = true,\n    trigger,\n    children,\n    class: className = '',\n    triggerClass = '',\n    menuClass = '',\n    portal: portalTarget = null,\n    gutter = 8,\n    ariaLabel = ''\n  }: Props = $props();\n\n  // Simple state management\n  let triggerElement: HTMLElement | undefined = $state();\n  let menuElement: HTMLElement | undefined = $state();\n  let focusedIndex = $state(-1);\n\n  // Toggle dropdown\n  function toggleDropdown() {\n    open = !open;\n    onOpenChange?.(open);\n    if (open) {\n      focusedIndex = 0;\n    }\n  }\n\n  // Close dropdown\n  function closeDropdown() {\n    open = false;\n    onOpenChange?.(false);\n    focusedIndex = -1;\n  }\n\n  // Handle item selection\n  function handleItemSelect(item: MenuItemData) {\n    if (item.disabled) return;\n    item.onSelect?.();\n    closeDropdown();\n  }\n\n  // Handle click outside\n  function handleClickOutside(event: MouseEvent) {\n    if (!triggerElement?.contains(event.target as HTMLElement) &&\n        !menuElement?.contains(event.target as HTMLElement)) {\n      closeDropdown();\n    }\n  }\n\n  // Handle keyboard navigation\n  function handleTriggerKeydown(event: KeyboardEvent) {\n    if (event.key === 'Enter' || event.key === ' ' || event.key === 'ArrowDown') {\n      event.preventDefault();\n      if (!open) {\n        toggleDropdown();\n      }\n    }\n  }\n\n  function handleMenuKeydown(event: KeyboardEvent) {\n    const activeItems = items.filter(item => !item.disabled && !item.separator);\n\n    switch (event.key) {\n      case 'ArrowDown':\n        event.preventDefault();\n        focusedIndex = (focusedIndex + 1) % activeItems.length;\n        break;\n      case 'ArrowUp':\n        event.preventDefault();\n        focusedIndex = focusedIndex <= 0 ? activeItems.length - 1 : focusedIndex - 1;\n        break;\n      case 'Escape':\n        event.preventDefault();\n        closeDropdown();\n        triggerElement?.focus();\n        break;\n      case 'Enter':\n      case ' ':\n        event.preventDefault();\n        if (focusedIndex >= 0 && focusedIndex < activeItems.length) {\n          const item = activeItems[focusedIndex];\n          handleItemSelect(item);\n        }\n        break;\n    }\n  }\n\n  // Set up global listeners\n  $effect(() => {\n    if (open) {\n      document.addEventListener('click', handleClickOutside);\n      document.addEventListener('keydown', handleMenuKeydown);\n    }\n\n    return () => {\n      document.removeEventListener('click', handleClickOutside);\n      document.removeEventListener('keydown', handleMenuKeydown);\n    };\n  });\n\n  const defaultTriggerClasses = 'btn btn-ghost min-h-[44px] px-4 py-2 font-medium rounded-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-gray-400 transition-colors duration-200 inline-flex items-center justify-center';\n\n  const defaultMenuClasses = 'menu';\n\n  // If triggerClass is provided, use it directly without defaults to avoid btn styling conflicts\n  const triggerClasses = $derived(triggerClass ? `${triggerClass} ${className}` : `${defaultTriggerClasses} ${className}`);\n  const menuClasses = $derived(menuClass || defaultMenuClasses);\n\n  // Calculate position based on positioning prop\n  const menuStyle = $derived(() => {\n    const baseStyles = 'z-50 min-w-[8rem] rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2';\n\n    const positionClasses = {\n      'bottom-start': 'top-full left-0 mt-1',\n      'bottom-end': 'top-full right-0 mt-1',\n      'top-start': 'bottom-full left-0 mb-1',\n      'top-end': 'bottom-full right-0 mb-1',\n      'bottom': 'top-full left-1/2 transform -translate-x-1/2 mt-1',\n      'top': 'bottom-full left-1/2 transform -translate-x-1/2 mb-1'\n    };\n\n    return `${baseStyles} ${positionClasses[positioning]}`;\n  });\n</script>\n\n<!-- Trigger Button -->\n<button\n  bind:this={triggerElement}\n  class=\"{triggerClasses} focus:!outline-none active:!outline-none\"\n  aria-haspopup=\"true\"\n  aria-expanded={open}\n  aria-label={ariaLabel || undefined}\n  style=\"outline: none !important; box-shadow: none !important;\"\n  onclick={toggleDropdown}\n  onkeydown={handleTriggerKeydown}\n>\n  {#if trigger}\n    {@render trigger()}\n  {:else}\n    Menu\n    <svg class=\"w-4 h-4 ml-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/>\n    </svg>\n  {/if}\n</button>\n\n<!-- Menu Content -->\n{#if open}\n  <div\n    bind:this={menuElement}\n    class=\"{menuClasses} {menuStyle}\"\n    role=\"menu\"\n    tabindex=\"-1\"\n  >\n    <!-- Static Menu Items from Array -->\n    {#each items.filter(item => !item.separator) as item, index (item.id)}\n      <button\n        class=\"menu-item relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\"\n        disabled={item.disabled}\n        role=\"menuitem\"\n        tabindex={index === focusedIndex ? 0 : -1}\n        onclick={() => handleItemSelect(item)}\n      >\n        <div class=\"flex items-center gap-3 flex-1\">\n          {#if item.icon}\n            <span class=\"w-4 h-4 text-gray-500\">{item.icon}</span>\n          {/if}\n          <span>{item.label}</span>\n        </div>\n        {#if item.shortcut}\n          <span class=\"text-xs text-gray-400 font-mono ml-auto\">{item.shortcut}</span>\n        {/if}\n      </button>\n    {/each}\n\n    <!-- Separators -->\n    {#each items.filter(item => item.separator) as item (item.id)}\n      <div class=\"menu-separator px-1 py-1\" role=\"separator\">\n        <div class=\"h-px bg-gray-200 my-1\"></div>\n      </div>\n    {/each}\n\n    <!-- Custom Menu Items via Snippet -->\n    {#if children}\n      {#if items.length > 0}\n        <div class=\"menu-separator px-1 py-1\" role=\"separator\">\n          <div class=\"h-px bg-gray-200 my-1\"></div>\n        </div>\n      {/if}\n      {@render children()}\n    {/if}\n  </div>\n{/if}\n\n<style>\n  /* Menu item hover states */\n  .menu-item:hover:not(:disabled) {\n    background-color: oklch(98% 0.01 250);\n  }\n\n  .menu-item:focus-visible {\n    background-color: oklch(96% 0.02 250);\n    outline: 2px solid oklch(60% 0.2 250);\n    outline-offset: -2px;\n  }\n\n  /* Mobile-first responsive design */\n  @media (max-width: 640px) {\n    .menu-item {\n      min-height: 44px;\n      padding: 12px 16px;\n      font-size: 16px;\n      line-height: 1.5;\n    }\n  }\n\n  /* High contrast mode support */\n  @media (prefers-contrast: high) {\n    .menu-item:hover:not(:disabled) {\n      background-color: oklch(85% 0.05 250);\n      color: oklch(10% 0.02 250);\n    }\n\n    .menu-item:focus-visible {\n      outline-width: 3px;\n    }\n  }\n\n  /* Reduce motion for accessibility */\n  @media (prefers-reduced-motion: reduce) {\n    .menu-item {\n      transition: none;\n    }\n  }\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\menu\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\select\\Select.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\select\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\tabs\\Tabs.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\tabs\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\toast\\Toast.svelte","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":1,"message":"An interface declaring no members is equivalent to its supertype.","line":8,"column":13,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":8,"endColumn":18,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[201,238],"text":"type Props = ToastProps"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<!--\r\n  Toast Component - Svelte 5 Individual Toast\r\n  Simple toast component that receives props and renders\r\n-->\r\n<script lang=\"ts\">\r\n  import type { ToastProps, ToastAction } from './types';\r\n  \r\n  interface Props extends ToastProps {}\r\n  \r\n  let { \r\n    toast,\r\n    onDismiss,\r\n    class: className = ''\r\n  }: Props = $props();\r\n  \r\n  // Auto-dismiss logic if not persistent\r\n  let dismissTimer = $state<number | null>(null);\r\n  \r\n  $effect(() => {\r\n    if (!toast.persistent && toast.duration && toast.duration > 0) {\r\n      dismissTimer = window.setTimeout(() => {\r\n        handleDismiss();\r\n      }, toast.duration);\r\n    }\r\n    \r\n    return () => {\r\n      if (dismissTimer) {\r\n        clearTimeout(dismissTimer);\r\n      }\r\n    };\r\n  });\r\n  \r\n  function handleDismiss() {\r\n    if (dismissTimer) {\r\n      clearTimeout(dismissTimer);\r\n      dismissTimer = null;\r\n    }\r\n    onDismiss?.(toast.id);\r\n  }\r\n  \r\n  function handleAction(action?: ToastAction) {\r\n    if (!action) {\r\n      return;\r\n    }\r\n\r\n    action.onclick();\r\n    handleDismiss();\r\n  }\r\n  \r\n  // Get toast styles based on type\r\n  const toastStyles = $derived(() => {\r\n    const baseClass = 'toast';\r\n    const typeClass = `toast-${toast.type}`;\r\n    return [baseClass, typeClass, className].filter(Boolean).join(' ');\r\n  });\r\n  \r\n  // Get close button styles\r\n  const closeButtonStyles = $derived(() => {\r\n    return [\r\n      'absolute right-2 top-2 rounded-sm opacity-70 ring-offset-background transition-opacity',\r\n      'hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-[color:var(--primary)] focus:ring-offset-2',\r\n      'disabled:pointer-events-none',\r\n      'min-h-[var(--touch-standard)] min-w-[var(--touch-standard)]',\r\n      'flex items-center justify-center'\r\n    ].join(' ');\r\n  });\r\n</script>\r\n\r\n<div\r\n  class={toastStyles()}\r\n  role=\"alert\"\r\n  aria-live={toast.type === 'error' ? 'assertive' : 'polite'}\r\n  aria-labelledby={toast.title ? `toast-title-${toast.id}` : undefined}\r\n  aria-describedby={`toast-description-${toast.id}`}\r\n>\r\n  <div class=\"flex flex-1 flex-col gap-1\">\r\n    {#if toast.title}\r\n      <div\r\n        id=\"toast-title-{toast.id}\"\r\n        class=\"text-sm font-semibold leading-none tracking-tight\"\r\n      >\r\n        {toast.title}\r\n      </div>\r\n    {/if}\r\n    \r\n    <div\r\n      id=\"toast-description-{toast.id}\"\r\n      class=\"text-sm opacity-90\"\r\n    >\r\n      {toast.description}\r\n    </div>\r\n    \r\n    {#if toast.action}\r\n      <div class=\"flex gap-2 mt-2\">\r\n        <button\r\n          onclick={() => handleAction(toast.action)}\r\n          class=\"btn btn-{toast.action.variant || 'ghost'} btn-sm\"\r\n          type=\"button\"\r\n        >\r\n          {toast.action.label}\r\n        </button>\r\n      </div>\r\n    {/if}\r\n  </div>\r\n  \r\n  {#if toast.dismissible !== false}\r\n    <button\r\n      onclick={handleDismiss}\r\n      class={closeButtonStyles()}\r\n      type=\"button\"\r\n      aria-label=\"Close notification\"\r\n    >\r\n      <!-- Close icon -->\r\n      <svg \r\n        class=\"h-4 w-4\" \r\n        fill=\"none\" \r\n        stroke=\"currentColor\" \r\n        viewBox=\"0 0 24 24\"\r\n        aria-hidden=\"true\"\r\n      >\r\n        <path \r\n          stroke-linecap=\"round\" \r\n          stroke-linejoin=\"round\" \r\n          stroke-width=\"2\" \r\n          d=\"M6 18L18 6M6 6l12 12\"\r\n        />\r\n      </svg>\r\n    </button>\r\n  {/if}\r\n</div>\r\n\r\n<style>\r\n  /* Component-specific styles for better mobile touch targets */\r\n  :global(.toast) {\r\n    /* Ensure minimum touch target on mobile */\r\n    min-height: var(--touch-standard);\r\n    \r\n    /* Mobile-first: full width on small screens */\r\n    width: 100%;\r\n    max-width: 24rem; /* 384px - equivalent to max-w-sm */\r\n  }\r\n  \r\n  /* Add swipe-to-dismiss gesture hint on mobile */\r\n  @media (max-width: 640px) {\r\n    :global(.toast) {\r\n      position: relative;\r\n    }\r\n    \r\n    :global(.toast::before) {\r\n      content: '';\r\n      position: absolute;\r\n      left: 0;\r\n      top: 50%;\r\n      width: 0.25rem;\r\n      height: 1.5rem;\r\n      background-color: currentColor;\r\n      opacity: 0.2;\r\n      border-top-right-radius: 0.125rem;\r\n      border-bottom-right-radius: 0.125rem;\r\n      transform: translateY(-50%);\r\n    }\r\n  }\r\n  \r\n  /* Enhanced button styles for mobile */\r\n  :global(.toast .btn-sm) {\r\n    min-height: var(--touch-compact);\r\n    padding: 0.25rem 0.75rem;\r\n    font-size: 14px;\r\n  }\r\n  \r\n  /* Animation improvements for mobile */\r\n  @media (prefers-reduced-motion: no-preference) {\r\n    :global(.toast) {\r\n      transition-property: transform;\r\n      transition-duration: 300ms;\r\n      transition-timing-function: cubic-bezier(0, 0, 0.2, 1); /* ease-out equivalent */\r\n    }\r\n    \r\n    :global(.toast:hover) {\r\n      transform: scale(1.02);\r\n    }\r\n  }\r\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\toast\\ToastContainer.svelte","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[652,655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[652,655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<!--\n  ToastContainer - Enhanced Global Toast System\n  Svelte 5 component that replaces the old ToastContainer\n  Integrates ToastProvider with the toast store\n-->\n<script lang=\"ts\">\n  // No lifecycle imports needed - using $effect\n  import { setToastProvider } from './store';\n  import ToastProvider from './ToastProvider.svelte';\n  import type { ToastProviderProps } from './types';\n  \n  interface Props extends ToastProviderProps {\n    children?: import('svelte').Snippet;\n  }\n  \n  let {\n    limit = 5,\n    duration = 5000,\n    position = 'bottom-right',\n    gap = 8,\n    class: className = '',\n    children\n  }: Props = $props();\n  \n  let provider: any = $state(null);\n  \n  // Connect the provider to the toast store on mount\n  $effect(() => {\n    if (provider) {\n      setToastProvider(provider);\n    }\n  });\n</script>\n\n<ToastProvider\n  bind:this={provider}\n  {limit}\n  {duration}\n  {position}\n  {gap}\n  class={className}\n>\n  {#if children}\n    {@render children()}\n  {/if}\n</ToastProvider>\n\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\toast\\ToastProvider.svelte","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\toast\\__tests__\\store.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\toast\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\toast\\store.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[599,602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[599,602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[955,958],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[955,958],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Modern Toast Store - Svelte 5 Compliant Implementation\r\n * Compatible with existing toasts.success() pattern\r\n * Mobile-first with enhanced accessibility\r\n *\r\n * Note: This store bridges to a Melt UI rune provider in the container component.\r\n * The TypeScript store provides the public API while the actual reactive state\r\n * is managed by Svelte 5 runes in the ToastContainer component.\r\n */\r\n\r\nimport type { Toast, ToastType, ToastStore, ToastStoreOptions } from './types';\r\nimport { writable, type Writable } from 'svelte/store';\r\n\r\n// Global toast provider instance\r\nlet toastProvider: any = null;\r\n\r\n// Deduplication cache to prevent duplicate toasts\r\nconst activeToasts = new Map<string, string>();\r\nconst TOAST_DEDUP_WINDOW = 100; // ms - prevent rapid duplicates\r\n\r\n// Reactive toasts store using Svelte stores (compatible with Svelte 5)\r\nconst toastsStore: Writable<Toast[]> = writable([]);\r\n\r\nexport function setToastProvider(provider: any): void {\r\n  toastProvider = provider;\r\n}\r\n\r\n// Export the reactive toasts array for components to subscribe to\r\nexport { toastsStore };\r\n\r\n// Generate unique content hash for deduplication\r\nfunction getToastHash(description: string, type: ToastType): string {\r\n  return `${type}:${description.trim()}`;\r\n}\r\n\r\n// Generate unique toast ID\r\nfunction generateId(): string {\r\n  return `toast-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\n// Add toast to provider if available, otherwise fallback to store\r\nfunction addToast(toast: Toast): string {\r\n  // Deduplication check\r\n  const toastHash = getToastHash(toast.description, toast.type);\r\n  const existingToastId = activeToasts.get(toastHash);\r\n\r\n  if (existingToastId) {\r\n    // Duplicate detected - return existing ID without creating new toast\r\n    return existingToastId;\r\n  }\r\n\r\n  const scheduleCleanup = () => {\r\n    setTimeout(() => {\r\n      activeToasts.delete(toastHash);\r\n    }, TOAST_DEDUP_WINDOW);\r\n  };\r\n\r\n  if (toastProvider && typeof toastProvider.addToastData === 'function') {\r\n    const providerId = toastProvider.addToastData(toast);\r\n    activeToasts.set(toastHash, providerId);\r\n    scheduleCleanup();\r\n    return providerId;\r\n  }\r\n\r\n  // Fallback: add to store (for compatibility)\r\n  toastsStore.update((currentToasts) => {\r\n    const filtered = currentToasts.filter((t) => t.id !== toast.id);\r\n    return [...filtered, toast];\r\n  });\r\n\r\n  activeToasts.set(toastHash, toast.id);\r\n  scheduleCleanup();\r\n\r\n  return toast.id;\r\n}\r\n\r\n// Remove toast from provider or store\r\nfunction removeToast(id: string): void {\r\n  if (toastProvider && typeof toastProvider.removeToastData === 'function') {\r\n    toastProvider.removeToastData(id);\r\n    return;\r\n  }\r\n\r\n  // Fallback: remove from store\r\n  toastsStore.update((currentToasts) => currentToasts.filter((t) => t.id !== id));\r\n}\r\n\r\nfunction createToastStore(): ToastStore {\r\n  const store: ToastStore = {\r\n    show(description: string, type: ToastType = 'info', options: ToastStoreOptions = {}): string {\r\n      const id = generateId();\r\n      const toast: Toast = {\r\n        id,\r\n        type,\r\n        description,\r\n        duration: options.duration ?? 5000,\r\n        dismissible: options.dismissible ?? true,\r\n        persistent: options.persistent ?? false,\r\n        action: options.action\r\n      };\r\n\r\n      return addToast(toast);\r\n    },\r\n\r\n    success(description: string, options: ToastStoreOptions = {}): string {\r\n      return store.show(description, 'success', {\r\n        duration: 4000,\r\n        ...options\r\n      });\r\n    },\r\n\r\n    error(description: string, options: ToastStoreOptions = {}): string {\r\n      return store.show(description, 'error', {\r\n        duration: 6000,\r\n        dismissible: true,\r\n        ...options\r\n      });\r\n    },\r\n\r\n    warning(description: string, options: ToastStoreOptions = {}): string {\r\n      return store.show(description, 'warning', {\r\n        duration: 5000,\r\n        ...options\r\n      });\r\n    },\r\n\r\n    info(description: string, options: ToastStoreOptions = {}): string {\r\n      return store.show(description, 'info', {\r\n        duration: 4000,\r\n        ...options\r\n      });\r\n    },\r\n\r\n    dismiss(id: string): void {\r\n      removeToast(id);\r\n    },\r\n\r\n    dismissAll(): void {\r\n      if (toastProvider && typeof toastProvider.clearAllToasts === 'function') {\r\n        toastProvider.clearAllToasts();\r\n        return;\r\n      }\r\n\r\n      // Fallback: clear store\r\n      toastsStore.set([]);\r\n    }\r\n  };\r\n\r\n  return store;\r\n}\r\n\r\n// Create the toast store instance\r\nconst toastStoreInstance = createToastStore();\r\n\r\n// Export the store methods\r\nexport const toastStore = toastStoreInstance;\r\n\r\n// Export the toast store with methods for backward compatibility\r\nexport const toasts = toastStoreInstance;\r\n\r\n// Helper functions for advanced toast patterns\r\nexport const toastHelpers = {\r\n  /**\r\n   * Show loading toast that can be updated\r\n   */\r\n  loading(description: string, options: ToastStoreOptions = {}): string {\r\n    return toastStore.info(description, {\r\n      persistent: true,\r\n      dismissible: false,\r\n      ...options\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Update existing toast (useful for loading -> success/error)\r\n   */\r\n  update(id: string, updates: Partial<Omit<Toast, 'id'>>): string {\r\n    // Dismiss old toast and show new one\r\n    toastStore.dismiss(id);\r\n\r\n    if (updates.type && updates.description) {\r\n      return toastStore.show(updates.description, updates.type, {\r\n        duration: updates.duration,\r\n        dismissible: updates.dismissible,\r\n        persistent: updates.persistent,\r\n        action: updates.action\r\n      });\r\n    }\r\n\r\n    return id;\r\n  },\r\n\r\n  /**\r\n   * Show toast with action button\r\n   */\r\n  withAction(\r\n    description: string,\r\n    type: ToastType,\r\n    actionLabel: string,\r\n    actionCallback: () => void,\r\n    options: ToastStoreOptions = {}\r\n  ): string {\r\n    return toastStore.show(description, type, {\r\n      ...options,\r\n      action: {\r\n        label: actionLabel,\r\n        onclick: actionCallback,\r\n        variant: type === 'error' ? 'secondary' : 'primary'\r\n      }\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Show promise-based toast (loading -> success/error)\r\n   */\r\n  promise<T>(\r\n    promise: Promise<T>,\r\n    messages: {\r\n      loading: string;\r\n      success: string | ((data: T) => string);\r\n      error: string | ((error: unknown) => string);\r\n    },\r\n    options: ToastStoreOptions = {}\r\n  ): Promise<T> {\r\n    const loadingId = toastHelpers.loading(messages.loading, options);\r\n\r\n    return promise\r\n      .then((data) => {\r\n        toastStore.dismiss(loadingId);\r\n        const successMessage = typeof messages.success === 'function'\r\n          ? messages.success(data)\r\n          : messages.success;\r\n        toastStore.success(successMessage, options);\r\n        return data;\r\n      })\r\n      .catch((error) => {\r\n        toastStore.dismiss(loadingId);\r\n        const errorMessage = typeof messages.error === 'function'\r\n          ? messages.error(error)\r\n          : messages.error;\r\n        toastStore.error(errorMessage, options);\r\n        throw error;\r\n      });\r\n  }\r\n};\r\n\r\n// Legacy compatibility - extend window object for existing components\r\nif (typeof window !== 'undefined') {\r\n  // @ts-expect-error - Legacy global support\r\n  window.showToast = (message: string, type: ToastType = 'info', duration = 3000): string => {\r\n    return toastStore.show(message, type, { duration });\r\n  };\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\toast\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\tooltip\\Tooltip.svelte","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'forceTouch' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":100,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":100,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleTouchInteraction' is defined but never used. Allowed unused vars must match /^_/u.","line":139,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":139,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'event' is defined but never used. Allowed unused args must match /^_/u.","line":146,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":146,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isTouchDevice' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":162,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":162,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script lang=\"ts\">\r\n  import type { Snippet } from 'svelte';\r\n\r\n  interface TooltipPosition {\r\n    side: 'top' | 'bottom' | 'left' | 'right';\r\n    align?: 'start' | 'center' | 'end';\r\n  }\r\n\r\n  interface Props {\r\n    /**\r\n     * Whether the tooltip is open\r\n     */\r\n    open?: boolean;\r\n\r\n    /**\r\n     * Callback when open state changes\r\n     */\r\n    onOpenChange?: (open: boolean) => void;\r\n\r\n    /**\r\n     * Tooltip content text\r\n     */\r\n    content: string;\r\n\r\n    /**\r\n     * Positioning for the tooltip\r\n     * @default { side: 'top', align: 'center' }\r\n     */\r\n    positioning?: TooltipPosition;\r\n\r\n    /**\r\n     * Delay before showing tooltip on hover (ms)\r\n     * @default 700\r\n     */\r\n    openDelay?: number;\r\n\r\n    /**\r\n     * Delay before hiding tooltip after leaving (ms)\r\n     * @default 300\r\n     */\r\n    closeDelay?: number;\r\n\r\n\r\n    /**\r\n     * Whether to close when trigger loses focus\r\n     * @default true\r\n     */\r\n    closeOnPointerDown?: boolean;\r\n\r\n    /**\r\n     * Whether tooltip is disabled\r\n     * @default false\r\n     */\r\n    disabled?: boolean;\r\n\r\n    /**\r\n     * Custom CSS classes for trigger\r\n     */\r\n    triggerClass?: string;\r\n\r\n    /**\r\n     * Custom CSS classes for tooltip content\r\n     */\r\n    tooltipClass?: string;\r\n\r\n    /**\r\n     * Custom CSS classes for tooltip arrow\r\n     */\r\n    arrowClass?: string;\r\n\r\n    /**\r\n     * Whether to force mobile behavior (always show on tap)\r\n     * @default false\r\n     */\r\n    forceTouch?: boolean;\r\n\r\n    /**\r\n     * Trigger content (button, icon, etc.)\r\n     */\r\n    trigger?: Snippet;\r\n\r\n    /**\r\n     * Children content for slot-based usage\r\n     */\r\n    children?: Snippet;\r\n  }\r\n\r\n  let {\r\n    open = $bindable(false),\r\n    onOpenChange,\r\n    content,\r\n    positioning = { side: 'top', align: 'center' },\r\n    openDelay = 700,\r\n    closeDelay = 300,\r\n    closeOnPointerDown = true,\r\n    disabled = false,\r\n    triggerClass = '',\r\n    tooltipClass = '',\r\n    arrowClass = '',\r\n    forceTouch = false,\r\n    trigger,\r\n    children\r\n  }: Props = $props();\r\n\r\n  // Simple state management\r\n  let triggerElement: HTMLElement | undefined = $state();\r\n  let tooltipElement: HTMLElement | undefined = $state();\r\n  let timeoutId: number | undefined;\r\n\r\n  // Show tooltip\r\n  function showTooltip() {\r\n    if (disabled) return;\r\n    clearTimeout(timeoutId);\r\n    timeoutId = setTimeout(() => {\r\n      open = true;\r\n      onOpenChange?.(true);\r\n    }, openDelay);\r\n  }\r\n\r\n  // Hide tooltip\r\n  function hideTooltip() {\r\n    clearTimeout(timeoutId);\r\n    timeoutId = setTimeout(() => {\r\n      open = false;\r\n      onOpenChange?.(false);\r\n    }, closeDelay);\r\n  }\r\n\r\n  // Handle mouse events\r\n  function handleMouseEnter() {\r\n    showTooltip();\r\n  }\r\n\r\n  function handleMouseLeave() {\r\n    hideTooltip();\r\n  }\r\n\r\n  // Handle touch events for mobile\r\n  function handleTouchInteraction(event: Event) {\r\n    event.preventDefault();\r\n    open = !open;\r\n    onOpenChange?.(open);\r\n  }\r\n\r\n  // Handle click events\r\n  function handleClick(event: Event) {\r\n    if (closeOnPointerDown) {\r\n      open = false;\r\n      onOpenChange?.(false);\r\n    }\r\n  }\r\n\r\n  // Handle keyboard events\r\n  function handleKeydown(event: KeyboardEvent) {\r\n    if (event.key === 'Escape') {\r\n      open = false;\r\n      onOpenChange?.(false);\r\n    }\r\n  }\r\n\r\n  // Check if we're on a touch device\r\n  let isTouchDevice = $state(typeof window !== 'undefined' && ('ontouchstart' in window || navigator.maxTouchPoints > 0));\r\n\r\n  // Default styling classes\r\n  const defaultTriggerClasses = 'inline-flex items-center justify-center focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--primary)] focus-visible:ring-offset-2 transition-all duration-150';\r\n\r\n  const defaultTooltipClasses = 'tooltip z-50 px-3 py-2 text-xs font-medium text-white bg-[color:var(--gray-900)] border border-[color:var(--gray-800)] rounded-md shadow-lg max-w-xs break-words animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95';\r\n\r\n  const defaultArrowClasses = 'fill-[color:var(--gray-900)]';\r\n\r\n  const computedTriggerClasses = $derived(`${defaultTriggerClasses} ${triggerClass}`.trim());\r\n  const computedTooltipClasses = $derived(`${defaultTooltipClasses} ${tooltipClass}`.trim());\r\n  const computedArrowClasses = $derived(`${defaultArrowClasses} ${arrowClass}`.trim());\r\n\r\n  // Calculate tooltip position\r\n  const tooltipStyle = $derived(() => {\r\n    const baseClasses = 'absolute z-50 pointer-events-none';\r\n\r\n    const positionClasses = {\r\n      'top': 'bottom-full left-1/2 transform -translate-x-1/2 mb-2',\r\n      'bottom': 'top-full left-1/2 transform -translate-x-1/2 mt-2',\r\n      'left': 'right-full top-1/2 transform -translate-y-1/2 mr-2',\r\n      'right': 'left-full top-1/2 transform -translate-y-1/2 ml-2'\r\n    };\r\n\r\n    const alignClasses = {\r\n      'start': positioning.side === 'top' || positioning.side === 'bottom' ? 'left-0 transform -translate-x-0' : 'top-0 transform -translate-y-0',\r\n      'center': 'left-1/2 transform -translate-x-1/2',\r\n      'end': positioning.side === 'top' || positioning.side === 'bottom' ? 'right-0 transform -translate-x-0' : 'bottom-0 transform -translate-y-0'\r\n    };\r\n\r\n    return `${baseClasses} ${positionClasses[positioning.side]} ${positioning.align ? alignClasses[positioning.align] : ''}`;\r\n  });\r\n</script>\r\n\r\n<!-- Trigger Element -->\r\n<span\r\n  bind:this={triggerElement}\r\n  class={computedTriggerClasses}\r\n  role=\"button\"\r\n  tabindex={disabled ? -1 : 0}\r\n  aria-describedby={open ? 'tooltip-content' : undefined}\r\n  aria-expanded={open}\r\n  data-tooltip-trigger\r\n  onmouseenter={handleMouseEnter}\r\n  onmouseleave={handleMouseLeave}\r\n  onclick={handleClick}\r\n  onkeydown={handleKeydown}\r\n>\r\n  {#if trigger}\r\n    {@render trigger()}\r\n  {:else if children}\r\n    {@render children()}\r\n  {/if}\r\n</span>\r\n\r\n<!-- Tooltip Content -->\r\n{#if open && !disabled && content}\r\n  <div\r\n    bind:this={tooltipElement}\r\n    id=\"tooltip-content\"\r\n    class={computedTooltipClasses}\r\n    class:tooltip-top={positioning.side === 'top'}\r\n    class:tooltip-bottom={positioning.side === 'bottom'}\r\n    class:tooltip-left={positioning.side === 'left'}\r\n    class:tooltip-right={positioning.side === 'right'}\r\n    role=\"tooltip\"\r\n    data-tooltip-content\r\n    data-side={positioning.side}\r\n    data-align={positioning.align}\r\n    style={tooltipStyle()}\r\n  >\r\n    <!-- Arrow -->\r\n    <div\r\n      class={computedArrowClasses}\r\n      class:arrow-top={positioning.side === 'top'}\r\n      class:arrow-bottom={positioning.side === 'bottom'}\r\n      class:arrow-left={positioning.side === 'left'}\r\n      class:arrow-right={positioning.side === 'right'}\r\n      data-tooltip-arrow\r\n    ></div>\r\n\r\n    <!-- Content -->\r\n    <span class=\"relative z-10\">\r\n      {content}\r\n    </span>\r\n  </div>\r\n{/if}\r\n\r\n<style>\r\n  /* Arrow positioning */\r\n  .arrow-top {\r\n    position: absolute;\r\n    bottom: -4px;\r\n    left: 50%;\r\n    transform: translateX(-50%) rotate(45deg);\r\n  }\r\n\r\n  .arrow-bottom {\r\n    position: absolute;\r\n    top: -4px;\r\n    left: 50%;\r\n    transform: translateX(-50%) rotate(45deg);\r\n  }\r\n\r\n  .arrow-left {\r\n    position: absolute;\r\n    right: -4px;\r\n    top: 50%;\r\n    transform: translateY(-50%) rotate(45deg);\r\n  }\r\n\r\n  .arrow-right {\r\n    position: absolute;\r\n    left: -4px;\r\n    top: 50%;\r\n    transform: translateY(-50%) rotate(45deg);\r\n  }\r\n\r\n  /* Arrow base styling */\r\n  [data-tooltip-arrow] {\r\n    width: 8px;\r\n    height: 8px;\r\n    border: 1px solid var(--gray-800);\r\n    border-bottom: none;\r\n    border-right: none;\r\n    background: var(--gray-900);\r\n  }\r\n\r\n  /* Mobile-first responsive design */\r\n  @media (max-width: 640px) {\r\n    [data-tooltip-content] {\r\n      max-width: calc(100vw - 2rem);\r\n      font-size: 14px;\r\n      padding: 8px 12px;\r\n    }\r\n  }\r\n\r\n  /* Touch device optimizations */\r\n  @media (pointer: coarse) {\r\n    [data-tooltip-trigger] {\r\n      min-width: var(--touch-standard);\r\n      min-height: var(--touch-standard);\r\n    }\r\n\r\n    [data-tooltip-content] {\r\n      font-size: 16px; /* Prevent zoom on iOS */\r\n      padding: 12px 16px;\r\n    }\r\n  }\r\n\r\n  /* High contrast mode support */\r\n  @media (prefers-contrast: high) {\r\n    [data-tooltip-content] {\r\n      border: 2px solid;\r\n      border-color: var(--gray-0);\r\n    }\r\n\r\n    [data-tooltip-arrow] {\r\n      border-width: 2px;\r\n      border-color: var(--gray-0);\r\n    }\r\n  }\r\n\r\n  /* Reduce motion for accessibility */\r\n  @media (prefers-reduced-motion: reduce) {\r\n    [data-tooltip-content] {\r\n      animation: none;\r\n    }\r\n  }\r\n\r\n  /* Focus visible improvements */\r\n  @supports selector(:focus-visible) {\r\n    [data-tooltip-trigger]:focus:not(:focus-visible) {\r\n      outline: none;\r\n      box-shadow: none;\r\n    }\r\n  }\r\n\r\n  /* Dark mode support */\r\n  @media (prefers-color-scheme: dark) {\r\n    [data-tooltip-content] {\r\n      background-color: var(--gray-50);\r\n      color: var(--gray-900);\r\n      border-color: var(--gray-200);\r\n    }\r\n\r\n    [data-tooltip-arrow] {\r\n      background-color: var(--gray-50);\r\n      border-color: var(--gray-200);\r\n    }\r\n  }\r\n</style>","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\primitives\\tooltip\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\search\\types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":247,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":247,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7270,7273],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7270,7273],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Search & Navigation Shared Types\r\n *\r\n * Consolidated types for search and navigation components that replace\r\n * local interfaces with Supabase-derived types plus UI extensions.\r\n *\r\n * Following the established pattern: Database Row + UI Fields = Component Type\r\n */\r\n\r\nimport type { Tables } from '@repo/database';\r\nimport type * as I18nNamespace from '@repo/i18n';\r\nimport type { FilterOption, FilterValue } from '../types/filters';\r\nimport type { SearchBarMode } from '../types/search';\r\n\r\ntype I18nNamespaceLike = typeof I18nNamespace & Record<string, (...args: unknown[]) => string>\r\n\r\nexport type SearchAppliedFilters = Record<string, string | null | undefined>;\r\n\r\nimport type { Profile } from '../types';\r\n\r\n// === Core Database Types ===\r\n\r\nexport type CategoryRow = Tables<'categories'>;\r\nexport type ProductImageRow = Tables<'product_images'>;\r\n\r\n// === Extended Types for UI Components ===\r\n\r\n// Category with hierarchical UI fields\r\nexport interface CategoryUIFields {\r\n  children?: CategoryWithChildren[];\r\n  product_count?: number;\r\n  emoji?: string;\r\n  // Legacy compatibility (marked for removal)\r\n  /** @deprecated Use slug from database instead */\r\n  key?: string;\r\n  /** @deprecated Use parent_id from database instead */\r\n  parentKey?: string;\r\n}\r\n\r\n// Main category type for search/navigation components\r\nexport type CategoryWithChildren = CategoryRow & CategoryUIFields;\r\n\r\n// Product with images for search results\r\nexport interface ProductWithImagesUIFields {\r\n  images: ProductImageRow[];\r\n  // Seller information for search results\r\n  category_name?: string;\r\n  seller_name?: string;\r\n  seller_username?: string;\r\n  seller_rating?: number;\r\n  seller_avatar?: string;\r\n}\r\n\r\nexport type ProductWithImages = Tables<'products'> & ProductWithImagesUIFields;\r\n\r\n// === Search Context Types ===\r\n\r\n// Different search/navigation contexts\r\nexport type SearchContext = 'main' | 'search' | 'category';\r\n\r\n// Collection/filter shortcut interface\r\nexport interface Collection {\r\n  key: string;\r\n  label: string;\r\n  emoji: string;\r\n  product_count?: number;\r\n}\r\n\r\n// === Seller Types ===\r\n\r\n// Seller extended with UI fields for search/navigation\r\nexport interface SellerUIFields {\r\n  username: string;\r\n  full_name?: string;\r\n  avatar_url?: string;\r\n  total_products: number;\r\n  rating?: number;\r\n  is_verified?: boolean;\r\n}\r\n\r\nexport type SearchSeller = Profile & SellerUIFields;\r\n// Search main navigation categories for quick links\r\nexport interface SearchMainCategory {\r\n  key: string;\r\n  label: string;\r\n  icon: string;\r\n}\r\n\r\n// Shared analytics callbacks for search bars\r\nexport interface SearchAnalyticsHandlers {\r\n  onSearch: (query: string) => void;\r\n  onCategorySelect: (categorySlug: string, level?: number, path?: string[]) => void;\r\n  onFilterChange: (key: string, value: FilterValue) => void;\r\n  onFilterRemove: (key: string) => void;\r\n  onClearAllFilters: () => void;\r\n}\r\n\r\nexport interface SearchPageSearchBarProps extends SearchAnalyticsHandlers {\r\n  mode?: SearchBarMode;\r\n  searchValue?: string;\r\n  megaMenuData?: CategoryWithChildren[];\r\n  mainCategories?: SearchMainCategory[];\r\n  conditionFilters?: FilterOption[];\r\n  appliedFilters?: SearchAppliedFilters;\r\n  availableSizes?: string[];\r\n  availableColors?: string[];\r\n  availableBrands?: string[];\r\n  currentResultCount?: number;\r\n  totalResultCount?: number;\r\n  i18n: I18nNamespaceLike;\r\n}\r\n\r\nexport interface CategorySearchBarProps extends SearchAnalyticsHandlers {\r\n  searchValue?: string;\r\n  megaMenuData?: CategoryWithChildren[];\r\n  mainCategories?: SearchMainCategory[];\r\n  conditionFilters?: FilterOption[];\r\n  appliedFilters?: SearchAppliedFilters;\r\n  currentCategory?: string | null;\r\n  i18n: I18nNamespaceLike;\r\n  onQuickSearch?: (query: string) => Promise<{ data: unknown[]; error: string | null }>;\r\n  enableQuickResults?: boolean;\r\n}\r\n\r\n// === Search Component Props ===\r\n\r\n// SearchDropdown component props\r\nexport interface SearchDropdownProps {\r\n  query: string;\r\n  context?: SearchContext;\r\n  categoryContext?: string | CategoryWithChildren | null;\r\n  onSearch?: (query: string) => Promise<{ data: ProductWithImages[]; error: string | null }>;\r\n  onSelect?: (product: ProductWithImages) => void;\r\n  onClose?: () => void;\r\n  maxResults?: number;\r\n  showCategories?: boolean;\r\n  class?: string;\r\n  visible?: boolean;\r\n  listboxId?: string;\r\n  categories?: CategoryWithChildren[];\r\n  sellers?: SearchSeller[];\r\n  collections?: Collection[];\r\n  onCategorySelect?: (category: CategoryWithChildren) => void;\r\n  onSellerSelect?: (seller: SearchSeller) => void;\r\n  onCollectionSelect?: (collection: Collection) => void;\r\n  translations?: {\r\n    categories?: string;\r\n    collections?: string;\r\n    sellers?: string;\r\n    products?: string;\r\n    searching?: string;\r\n    viewAllResults?: string;\r\n  };\r\n}\r\n\r\n// MobileNavigationDialog component props\r\nexport interface MobileNavigationDialogProps {\r\n  id?: string;\r\n  isOpen: boolean;\r\n  isLoggedIn: boolean;\r\n  user?: Profile;\r\n  profile?: Profile;\r\n  userDisplayName?: string;\r\n  initials?: string;\r\n  canSell?: boolean;\r\n  currentLanguage: string;\r\n  languages: Array<{\r\n    code: string;\r\n    name: string;\r\n    flag?: string;\r\n  }>;\r\n  categories?: CategoryWithChildren[];\r\n  onClose: () => void;\r\n  onSignOut: () => void;\r\n  onCategoryClick: (category: string, level?: number, path?: string[]) => void;\r\n  onLanguageChange: (lang: string) => void;\r\n  signingOut?: boolean;\r\n  searchFunction?: (query: string) => Promise<{ data: ProductWithImages[]; error: string | null }>;\r\n  unreadMessages?: number;\r\n  unreadNotifications?: number;\r\n  translations?: {\r\n    sellItems?: string;\r\n    myProfile?: string;\r\n    startSelling?: string;\r\n    settings?: string;\r\n    signOut?: string;\r\n    signingOut?: string;\r\n    signIn?: string;\r\n    signUp?: string;\r\n    browseCategories?: string;\r\n    whatLookingFor?: string;\r\n    browseAll?: string;\r\n    popularBrands?: string;\r\n    newToday?: string;\r\n    orders?: string;\r\n    favorites?: string;\r\n    categoryWomen?: string;\r\n    categoryMen?: string;\r\n    categoryKids?: string;\r\n    categoryUnisex?: string;\r\n    help?: string;\r\n    privacy?: string;\r\n    terms?: string;\r\n    returns?: string;\r\n    trustSafety?: string;\r\n    searchPlaceholder?: string;\r\n    quickActionsLabel?: string;\r\n    settingsLabel?: string;\r\n    supportLabel?: string;\r\n  };\r\n}\r\n\r\n// === Navigation State Types ===\r\n\r\n// Category navigation breadcrumb\r\nexport interface CategoryBreadcrumb {\r\n  name: string;\r\n  slug: string;\r\n}\r\n\r\n// Navigation state for hierarchical category browsing\r\nexport interface CategoryNavigationState {\r\n  categories: CategoryWithChildren[];\r\n  level: number;\r\n}\r\n\r\n// === Utility Functions Type Guards ===\r\n\r\nexport function isCategoryWithChildren(category: unknown): category is CategoryWithChildren {\r\n  return (\r\n    typeof category === 'object' &&\r\n    category !== null &&\r\n    'id' in category &&\r\n    'name' in category &&\r\n    'slug' in category\r\n  );\r\n}\r\n\r\nexport function isProductWithImages(product: unknown): product is ProductWithImages {\r\n  return (\r\n    typeof product === 'object' &&\r\n    product !== null &&\r\n    'id' in product &&\r\n    'title' in product &&\r\n    'price' in product &&\r\n    'images' in product &&\r\n    Array.isArray((product as any).images)\r\n  );\r\n}\r\n\r\n// === Re-exports from other type modules ===\r\n\r\n// Re-export commonly used types from the main types module\r\nexport type { SearchBarMode } from '../types/search';\r\nexport type { FilterState as SearchFilters } from '../types/filters';\r\nexport type { Product } from '../types/product';\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\search\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\tokens.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\types\\filters.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\types\\panels.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\types\\product.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\types\\search.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2145,2148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2145,2148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Search-related Types\r\n *\r\n * This file contains types related to search functionality,\r\n * including search bar modes, empty states, and feedback.\r\n */\r\n\r\n// Search bar mode types\r\nexport type SearchBarMode = 'power' | 'compact' | 'full';\r\n\r\n// Empty state content structure\r\nexport interface EmptyStateContent {\r\n  title: string;\r\n  subtitle: string;\r\n  icon: string;\r\n  showSuggestions: boolean;\r\n  actionText: string;\r\n}\r\n\r\n// Search feedback types\r\nexport interface FeedbackPrompt {\r\n  question: string;\r\n  context: string;\r\n}\r\n\r\nexport interface PerformanceIndicator {\r\n  text: string;\r\n  color: string;\r\n  icon: string;\r\n}\r\n\r\n// Search suggestion types\r\nexport interface SearchSuggestion {\r\n  query: string;\r\n  popularity?: number;\r\n  category?: string;\r\n}\r\n\r\nexport interface CategorySuggestion {\r\n  slug: string;\r\n  name: string;\r\n  icon: string;\r\n  itemCount?: number;\r\n}\r\n\r\nexport interface CollectionSuggestion {\r\n  key: string;\r\n  label: string;\r\n  emoji: string;\r\n  description?: string;\r\n}\r\n\r\n// Search results and analytics\r\nexport interface SearchContext {\r\n  query: string;\r\n  mode: SearchBarMode;\r\n  resultsCount: number;\r\n  loadTime?: number;\r\n  hasFilters?: boolean;\r\n  source?: string; // Where the search was initiated\r\n}\r\n\r\n// Search empty state props\r\nexport interface SearchEmptyStateProps {\r\n  mode: SearchBarMode;\r\n  searchQuery?: string;\r\n  totalProducts?: number;\r\n  suggestedCategories?: CategorySuggestion[];\r\n  suggestedCollections?: CollectionSuggestion[];\r\n  onCategorySelect?: (categorySlug: string) => void;\r\n  onCollectionSelect?: (collectionKey: string) => void;\r\n  onSearchSuggestion?: (query: string) => void;\r\n}\r\n\r\n// Search feedback props\r\nexport interface SearchFeedbackProps {\r\n  mode: SearchBarMode;\r\n  searchQuery: string;\r\n  resultsCount: number;\r\n  loadTime?: number;\r\n  hasFilters?: boolean;\r\n  onFeedback?: (helpful: boolean, reason?: string) => void;\r\n}\r\n\r\n// Search analytics events\r\nexport interface SearchAnalyticsEvent {\r\n  type: 'search_submitted' | 'suggestion_clicked' | 'feedback_given' | 'mode_switched';\r\n  mode: SearchBarMode;\r\n  query?: string;\r\n  metadata?: Record<string, any>;\r\n  timestamp: number;\r\n}\r\n\r\n// Search state management\r\nexport interface SearchState {\r\n  query: string;\r\n  mode: SearchBarMode;\r\n  isSearching: boolean;\r\n  hasResults: boolean;\r\n  resultsCount: number;\r\n  loadTime?: number;\r\n  error?: string;\r\n}","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\utils\\a11y.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":229,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6661,6664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6661,6664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Accessibility utilities for focus management, live regions, and keyboard navigation\r\n * Used across dialogs, modals, search dropdowns, and other interactive components\r\n */\r\n\r\n/**\r\n * Creates a focus trap for modal dialogs and dropdowns\r\n * Traps tab navigation within the specified element\r\n * \r\n * @param element - The element to trap focus within\r\n * @returns Cleanup function to remove the trap\r\n * \r\n * @example\r\n * ```ts\r\n * // In a Svelte component\r\n * let dialogElement: HTMLElement;\r\n * let cleanupTrap: (() => void) | null = null;\r\n * \r\n * function openDialog() {\r\n *   cleanupTrap = trapFocus(dialogElement);\r\n * }\r\n * \r\n * function closeDialog() {\r\n *   cleanupTrap?.();\r\n * }\r\n * ```\r\n */\r\nexport function trapFocus(element: HTMLElement): () => void {\r\n  const focusableElements = element.querySelectorAll(\r\n    'a[href], button, textarea, input[type=\"text\"], input[type=\"radio\"], input[type=\"checkbox\"], select, [tabindex]:not([tabindex=\"-1\"])'\r\n  );\r\n  \r\n  const firstFocusable = focusableElements[0] as HTMLElement;\r\n  const lastFocusable = focusableElements[focusableElements.length - 1] as HTMLElement;\r\n  \r\n  function handleTabKey(event: KeyboardEvent) {\r\n    if (event.key !== 'Tab') return;\r\n    \r\n    if (event.shiftKey) {\r\n      // Shift + Tab (backwards)\r\n      if (document.activeElement === firstFocusable) {\r\n        lastFocusable.focus();\r\n        event.preventDefault();\r\n      }\r\n    } else {\r\n      // Tab (forwards)\r\n      if (document.activeElement === lastFocusable) {\r\n        firstFocusable.focus();\r\n        event.preventDefault();\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Focus first element immediately\r\n  firstFocusable?.focus();\r\n  \r\n  // Add event listener\r\n  document.addEventListener('keydown', handleTabKey);\r\n  \r\n  // Return cleanup function\r\n  return () => {\r\n    document.removeEventListener('keydown', handleTabKey);\r\n  };\r\n}\r\n\r\n/**\r\n * Returns focus to a previously focused element\r\n * Used when closing dialogs, dropdowns, or other overlays\r\n * \r\n * @param previousElement - Element that should regain focus\r\n * \r\n * @example\r\n * ```ts\r\n * // Store reference when opening modal\r\n * const previouslyFocused = document.activeElement as HTMLElement;\r\n * \r\n * // Return focus when closing\r\n * returnFocus(previouslyFocused);\r\n * ```\r\n */\r\nexport function returnFocus(previousElement: HTMLElement | null): void {\r\n  if (previousElement && typeof previousElement.focus === 'function') {\r\n    // Use setTimeout to ensure modal is completely closed first\r\n    setTimeout(() => {\r\n      previousElement.focus();\r\n    }, 10);\r\n  }\r\n}\r\n\r\n/**\r\n * Announces content to screen readers using a live region\r\n * Useful for dynamic content changes, search results, form validation\r\n * \r\n * @param message - Message to announce\r\n * @param priority - 'polite' (default) or 'assertive' for urgency\r\n * \r\n * @example\r\n * ```ts\r\n * // Announce search results\r\n * announceToScreenReader('5 products found', 'polite');\r\n * \r\n * // Announce errors assertively\r\n * announceToScreenReader('Form submission failed', 'assertive');\r\n * ```\r\n */\r\nexport function announceToScreenReader(message: string, priority: 'polite' | 'assertive' = 'polite'): void {\r\n  const liveRegion = document.createElement('div');\r\n  liveRegion.setAttribute('aria-live', priority);\r\n  liveRegion.setAttribute('aria-atomic', 'true');\r\n  liveRegion.className = 'sr-only';\r\n  liveRegion.style.position = 'absolute';\r\n  liveRegion.style.left = '-10000px';\r\n  liveRegion.style.width = '1px';\r\n  liveRegion.style.height = '1px';\r\n  liveRegion.style.overflow = 'hidden';\r\n  \r\n  document.body.appendChild(liveRegion);\r\n  \r\n  // Set message after a brief delay to ensure screen readers pick it up\r\n  setTimeout(() => {\r\n    liveRegion.textContent = message;\r\n  }, 10);\r\n  \r\n  // Clean up after announcement\r\n  setTimeout(() => {\r\n    document.body.removeChild(liveRegion);\r\n  }, 1000);\r\n}\r\n\r\n/**\r\n * Generates a unique ID for accessibility relationships\r\n * Used for aria-describedby, aria-labelledby, aria-controls, etc.\r\n * \r\n * @param prefix - Prefix for the ID (e.g., 'search', 'dialog', 'error')\r\n * @returns Unique ID string\r\n * \r\n * @example\r\n * ```ts\r\n * const searchId = generateA11yId('search'); // 'search-a11y-1234'\r\n * const errorId = generateA11yId('error');   // 'error-a11y-5678'\r\n * ```\r\n */\r\nexport function generateA11yId(prefix: string): string {\r\n  return `${prefix}-a11y-${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\n/**\r\n * Checks if an element is visible to screen readers and users\r\n * Useful for determining if focus management should apply\r\n * \r\n * @param element - Element to check\r\n * @returns Whether element is visible\r\n */\r\nexport function isElementVisible(element: HTMLElement): boolean {\r\n  return !!(\r\n    element.offsetWidth ||\r\n    element.offsetHeight ||\r\n    element.getClientRects().length\r\n  );\r\n}\r\n\r\n/**\r\n * Manages scroll locking for modal dialogs and overlays\r\n * Prevents background scrolling while maintaining scroll position\r\n * \r\n * @param lock - Whether to lock or unlock scroll\r\n * \r\n * @example\r\n * ```ts\r\n * // Lock scroll when opening modal\r\n * lockScroll(true);\r\n * \r\n * // Unlock scroll when closing modal\r\n * lockScroll(false);\r\n * ```\r\n */\r\nlet originalOverflow = '';\r\nlet originalPaddingRight = '';\r\n\r\nexport function lockScroll(lock: boolean): void {\r\n  const body = document.body;\r\n  \r\n  if (lock) {\r\n    // Calculate scrollbar width to prevent layout shift\r\n    const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;\r\n    \r\n    // Store original values\r\n    originalOverflow = body.style.overflow;\r\n    originalPaddingRight = body.style.paddingRight;\r\n    \r\n    // Apply lock\r\n    body.style.overflow = 'hidden';\r\n    if (scrollbarWidth > 0) {\r\n      body.style.paddingRight = `${scrollbarWidth}px`;\r\n    }\r\n  } else {\r\n    // Restore original values\r\n    body.style.overflow = originalOverflow;\r\n    body.style.paddingRight = originalPaddingRight;\r\n  }\r\n}\r\n\r\n/**\r\n * Keyboard navigation handler for listbox/menu patterns\r\n * Handles Arrow keys, Home, End, Enter, Escape\r\n * \r\n * @param event - Keyboard event\r\n * @param options - Navigation options\r\n * @returns Whether the event was handled\r\n * \r\n * @example\r\n * ```ts\r\n * function handleKeyDown(event: KeyboardEvent) {\r\n *   const handled = handleKeyboardNavigation(event, {\r\n *     items: menuItems,\r\n *     activeIndex: currentIndex,\r\n *     onMove: (newIndex) => setCurrentIndex(newIndex),\r\n *     onSelect: (index) => selectItem(index),\r\n *     onEscape: () => closeMenu()\r\n *   });\r\n *   \r\n *   if (handled) {\r\n *     event.preventDefault();\r\n *   }\r\n * }\r\n * ```\r\n */\r\nexport interface KeyboardNavigationOptions {\r\n  items: any[];\r\n  activeIndex: number;\r\n  onMove: (newIndex: number) => void;\r\n  onSelect: (index: number) => void;\r\n  onEscape?: () => void;\r\n  loop?: boolean; // Whether to loop from last to first item\r\n}\r\n\r\nexport function handleKeyboardNavigation(\r\n  event: KeyboardEvent,\r\n  options: KeyboardNavigationOptions\r\n): boolean {\r\n  const { items, activeIndex, onMove, onSelect, onEscape, loop = true } = options;\r\n  \r\n  switch (event.key) {\r\n    case 'ArrowDown':\r\n      if (activeIndex < items.length - 1) {\r\n        onMove(activeIndex + 1);\r\n      } else if (loop) {\r\n        onMove(0);\r\n      }\r\n      return true;\r\n      \r\n    case 'ArrowUp':\r\n      if (activeIndex > 0) {\r\n        onMove(activeIndex - 1);\r\n      } else if (loop) {\r\n        onMove(items.length - 1);\r\n      }\r\n      return true;\r\n      \r\n    case 'Home':\r\n      onMove(0);\r\n      return true;\r\n      \r\n    case 'End':\r\n      onMove(items.length - 1);\r\n      return true;\r\n      \r\n    case 'Enter':\r\n    case ' ':\r\n      onSelect(activeIndex);\r\n      return true;\r\n      \r\n    case 'Escape':\r\n      onEscape?.();\r\n      return true;\r\n      \r\n    default:\r\n      return false;\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\utils\\cn.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\utils\\form-a11y.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4200,4203],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4200,4203],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":179,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4865,4868],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4865,4868],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Form accessibility utilities for labels, error states, and ARIA relationships\r\n * Used in Input, Select, SearchBar, and other form components\r\n */\r\n\r\nimport { generateA11yId } from './a11y.js';\r\n\r\n/**\r\n * Configuration for form field accessibility\r\n */\r\nexport interface FormFieldA11yConfig {\r\n  /** Field identifier (used for ID generation) */\r\n  fieldId?: string;\r\n  /** Label text (required for accessibility) */\r\n  label?: string;\r\n  /** Whether label should be visually hidden but accessible to screen readers */\r\n  labelVisuallyHidden?: boolean;\r\n  /** Helper text to describe the field */\r\n  helperText?: string;\r\n  /** Error message to display when field is invalid */\r\n  errorMessage?: string;\r\n  /** Whether the field is required */\r\n  required?: boolean;\r\n  /** Whether the field is currently invalid */\r\n  invalid?: boolean;\r\n}\r\n\r\n/**\r\n * Generated accessibility attributes for a form field\r\n */\r\nexport interface FormFieldA11yAttributes {\r\n  /** ID for the input element */\r\n  inputId: string;\r\n  /** ID for the label element */\r\n  labelId: string;\r\n  /** ID for the helper text element (if present) */\r\n  helperTextId?: string;\r\n  /** ID for the error message element (if present) */\r\n  errorId?: string;\r\n  /** Space-separated list of IDs that describe the input */\r\n  ariaDescribedBy?: string;\r\n  /** Whether the input is marked as invalid */\r\n  ariaInvalid?: boolean;\r\n  /** Whether the input is required */\r\n  ariaRequired?: boolean;\r\n}\r\n\r\n/**\r\n * Generates all accessibility attributes needed for a form field\r\n * Handles label relationships, error states, helper text, and required fields\r\n * \r\n * @param config - Form field configuration\r\n * @returns Accessibility attributes to apply to form elements\r\n * \r\n * @example\r\n * ```svelte\r\n * <script lang=\"ts\">\r\n *   import { generateFormFieldA11y } from '@repo/ui/utils/form-a11y';\r\n *   \r\n *   let { \r\n *     value = $bindable(), \r\n *     label, \r\n *     helperText, \r\n *     errorMessage, \r\n *     required = false,\r\n *     invalid = false \r\n *   } = $props();\r\n *   \r\n *   const a11y = generateFormFieldA11y({\r\n *     label,\r\n *     helperText,\r\n *     errorMessage,\r\n *     required,\r\n *     invalid\r\n *   });\r\n * </script>\r\n * \r\n * <label for={a11y.inputId} class:sr-only={labelVisuallyHidden}>\r\n *   {label}\r\n *   {#if required}<span aria-label=\"required\">*</span>{/if}\r\n * </label>\r\n * \r\n * <input\r\n *   id={a11y.inputId}\r\n *   bind:value\r\n *   aria-describedby={a11y.ariaDescribedBy}\r\n *   aria-invalid={a11y.ariaInvalid}\r\n *   aria-required={a11y.ariaRequired}\r\n * />\r\n * \r\n * {#if helperText}\r\n *   <div id={a11y.helperTextId} class=\"text-sm text-gray-600\">\r\n *     {helperText}\r\n *   </div>\r\n * {/if}\r\n * \r\n * {#if invalid && errorMessage}\r\n *   <div id={a11y.errorId} class=\"text-sm text-red-600\" role=\"alert\">\r\n *     {errorMessage}\r\n *   </div>\r\n * {/if}\r\n * ```\r\n */\r\nexport function generateFormFieldA11y(config: FormFieldA11yConfig): FormFieldA11yAttributes {\r\n  const baseId = config.fieldId || generateA11yId('field');\r\n  \r\n  const attributes: FormFieldA11yAttributes = {\r\n    inputId: baseId,\r\n    labelId: `${baseId}-label`\r\n  };\r\n  \r\n  const describedByIds: string[] = [];\r\n  \r\n  // Add helper text ID if present\r\n  if (config.helperText) {\r\n    attributes.helperTextId = `${baseId}-helper`;\r\n    describedByIds.push(attributes.helperTextId);\r\n  }\r\n  \r\n  // Add error ID if field is invalid and has error message\r\n  if (config.invalid && config.errorMessage) {\r\n    attributes.errorId = `${baseId}-error`;\r\n    describedByIds.push(attributes.errorId);\r\n  }\r\n  \r\n  // Set aria-describedby if there are describing elements\r\n  if (describedByIds.length > 0) {\r\n    attributes.ariaDescribedBy = describedByIds.join(' ');\r\n  }\r\n  \r\n  // Set validation attributes\r\n  if (config.invalid) {\r\n    attributes.ariaInvalid = true;\r\n  }\r\n  \r\n  if (config.required) {\r\n    attributes.ariaRequired = true;\r\n  }\r\n  \r\n  return attributes;\r\n}\r\n\r\n/**\r\n * Validation state management for forms\r\n * Helps manage field validation states and error messages\r\n */\r\nexport interface FieldValidation {\r\n  isValid: boolean;\r\n  errorMessage?: string;\r\n  touched?: boolean;\r\n}\r\n\r\nexport type FormValidation<T extends Record<string, any>> = {\r\n  [K in keyof T]: FieldValidation;\r\n};\r\n\r\n/**\r\n * Creates a validation helper for form fields\r\n * \r\n * @param initialFields - Initial field names to track\r\n * @returns Validation state manager\r\n * \r\n * @example\r\n * ```ts\r\n * const validation = createFormValidation(['email', 'password']);\r\n * \r\n * // Set field as invalid\r\n * validation.setFieldError('email', 'Please enter a valid email address');\r\n * \r\n * // Mark field as touched\r\n * validation.setFieldTouched('email', true);\r\n * \r\n * // Check if form is valid\r\n * if (validation.isFormValid()) {\r\n *   // Submit form\r\n * }\r\n * ```\r\n */\r\nexport function createFormValidation<T extends Record<string, any>>(\r\n  initialFields: (keyof T)[]\r\n): {\r\n  fields: FormValidation<T>;\r\n  setFieldError: (field: keyof T, message: string) => void;\r\n  clearFieldError: (field: keyof T) => void;\r\n  setFieldTouched: (field: keyof T, touched: boolean) => void;\r\n  isFormValid: () => boolean;\r\n  getFieldProps: (field: keyof T) => { invalid: boolean; errorMessage?: string };\r\n} {\r\n  const fields = {} as FormValidation<T>;\r\n  \r\n  // Initialize fields\r\n  for (const field of initialFields) {\r\n    fields[field] = {\r\n      isValid: true,\r\n      touched: false\r\n    };\r\n  }\r\n  \r\n  return {\r\n    fields,\r\n    \r\n    setFieldError(field: keyof T, message: string) {\r\n      fields[field] = {\r\n        ...fields[field],\r\n        isValid: false,\r\n        errorMessage: message\r\n      };\r\n    },\r\n    \r\n    clearFieldError(field: keyof T) {\r\n      fields[field] = {\r\n        ...fields[field],\r\n        isValid: true,\r\n        errorMessage: undefined\r\n      };\r\n    },\r\n    \r\n    setFieldTouched(field: keyof T, touched: boolean) {\r\n      fields[field] = {\r\n        ...fields[field],\r\n        touched\r\n      };\r\n    },\r\n    \r\n    isFormValid(): boolean {\r\n      return Object.values(fields).every(field => field.isValid);\r\n    },\r\n    \r\n    getFieldProps(field: keyof T) {\r\n      const fieldState = fields[field];\r\n      return {\r\n        invalid: !fieldState.isValid && (fieldState.touched ?? false),\r\n        errorMessage: fieldState.errorMessage\r\n      };\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Common ARIA live region for form validation announcements\r\n * Use this to announce validation errors or success messages\r\n * \r\n * @param message - Message to announce\r\n * @param type - Type of announcement ('error', 'success', 'info')\r\n * \r\n * @example\r\n * ```ts\r\n * // Announce form errors\r\n * announceFormMessage('Please fix the errors below', 'error');\r\n * \r\n * // Announce successful submission\r\n * announceFormMessage('Form submitted successfully', 'success');\r\n * ```\r\n */\r\nexport function announceFormMessage(\r\n  message: string, \r\n  type: 'error' | 'success' | 'info' = 'info'\r\n): void {\r\n  // Use assertive for errors, polite for others\r\n  const priority = type === 'error' ? 'assertive' : 'polite';\r\n  \r\n  // Import announceToScreenReader dynamically to avoid circular imports\r\n  const announce = async () => {\r\n    const { announceToScreenReader } = await import('./a11y.js');\r\n    announceToScreenReader(message, priority);\r\n  };\r\n  \r\n  announce();\r\n}\r\n\r\n/**\r\n * Input validation patterns and messages\r\n */\r\nexport const ValidationPatterns = {\r\n  email: {\r\n    pattern: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/,\r\n    message: 'Please enter a valid email address'\r\n  },\r\n  \r\n  password: {\r\n    pattern: /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)[a-zA-Z\\d@$!%*?&]{8,}$/,\r\n    message: 'Password must be at least 8 characters with uppercase, lowercase, and number'\r\n  },\r\n  \r\n  phone: {\r\n    // Optional +, optional parens around country code, flexible separators\r\n    pattern: /^\\+?\\(?\\+?\\d{2,3}\\)?[-\\s.]?\\d{3,4}[-\\s.]?\\d{3,6}$/,\r\n    message: 'Please enter a valid phone number'\r\n  },\r\n  \r\n  required: {\r\n    pattern: /\\S+/,\r\n    message: 'This field is required'\r\n  }\r\n} as const;\r\n\r\n/**\r\n * Validates a field value against common patterns\r\n * \r\n * @param value - Value to validate\r\n * @param rules - Validation rules to apply\r\n * @returns Validation result\r\n * \r\n * @example\r\n * ```ts\r\n * const emailResult = validateField(emailValue, ['required', 'email']);\r\n * if (!emailResult.isValid) {\r\n *   \r\n * }\r\n * ```\r\n */\r\nexport function validateField(\r\n  value: string,\r\n  rules: (keyof typeof ValidationPatterns)[]\r\n): { isValid: boolean; errorMessage?: string } {\r\n  const trimmedValue = value?.trim() || '';\r\n  \r\n  for (const rule of rules) {\r\n    const validator = ValidationPatterns[rule];\r\n    if (!validator.pattern.test(trimmedValue)) {\r\n      return {\r\n        isValid: false,\r\n        errorMessage: validator.message\r\n      };\r\n    }\r\n  }\r\n  \r\n  return { isValid: true };\r\n}","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\utils\\form-validation.svelte.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\utils\\format.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\utils\\imagePreloader.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\utils\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\utils\\lazyLoad.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\utils\\log.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[298,301],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[298,301],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Lightweight Logging Utility\r\n *\r\n * Provides simple logging functionality without external dependencies.\r\n * Designed to work in any environment (browser, server, tests).\r\n */\r\n\r\nexport type LogLevel = 'debug' | 'info' | 'warn' | 'error';\r\n\r\nexport interface LogContext {\r\n  [key: string]: any;\r\n}\r\n\r\nexport interface Logger {\r\n  debug(message: string, context?: LogContext): void;\r\n  info(message: string, context?: LogContext): void;\r\n  warn(message: string, context?: LogContext): void;\r\n  error(message: string, context?: LogContext): void;\r\n}\r\n\r\nclass SimpleLogger implements Logger {\r\n  constructor(\r\n    private prefix: string,\r\n    private minLevel: LogLevel = 'info'\r\n  ) {}\r\n\r\n  private shouldLog(level: LogLevel): boolean {\r\n    const levels: Record<LogLevel, number> = {\r\n      debug: 0,\r\n      info: 1,\r\n      warn: 2,\r\n      error: 3\r\n    };\r\n\r\n    return levels[level] >= levels[this.minLevel];\r\n  }\r\n\r\n  private formatMessage(level: LogLevel, message: string, context?: LogContext): string {\r\n    const timestamp = new Date().toISOString();\r\n    const prefix = this.prefix ? `[${this.prefix}]` : '';\r\n    const contextStr = context ? ` ${JSON.stringify(context)}` : '';\r\n\r\n    return `${timestamp} ${level.toUpperCase()} ${prefix} ${message}${contextStr}`;\r\n  }\r\n\r\n  debug(message: string, context?: LogContext): void {\r\n    if (!this.shouldLog('debug')) return;\r\n\r\n    if (typeof console !== 'undefined' && console.debug) {\r\n      console.debug(this.formatMessage('debug', message, context));\r\n    }\r\n  }\r\n\r\n  info(message: string, context?: LogContext): void {\r\n    if (!this.shouldLog('info')) return;\r\n\r\n    if (typeof console !== 'undefined' && console.info) {\r\n      console.info(this.formatMessage('info', message, context));\r\n    }\r\n  }\r\n\r\n  warn(message: string, context?: LogContext): void {\r\n    if (!this.shouldLog('warn')) return;\r\n\r\n    if (typeof console !== 'undefined' && console.warn) {\r\n      const formattedMessage = this.formatMessage('warn', message);\r\n      console.warn(formattedMessage, context || '');\r\n    }\r\n  }\r\n\r\n  error(message: string, context?: LogContext): void {\r\n    if (!this.shouldLog('error')) return;\r\n\r\n    if (typeof console !== 'undefined' && console.error) {\r\n      const formattedMessage = this.formatMessage('error', message);\r\n      console.error(formattedMessage, context || '');\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Create a logger instance with optional prefix\r\n */\r\nexport function createLogger(prefix?: string, minLevel: LogLevel = 'info'): Logger {\r\n  return new SimpleLogger(prefix || '', minLevel);\r\n}\r\n\r\n/**\r\n * Default logger for general use\r\n */\r\nexport const logger = createLogger('UI');\r\n\r\n/**\r\n * No-op logger for testing or when logging should be disabled\r\n */\r\nexport const noopLogger: Logger = {\r\n  debug: () => {},\r\n  info: () => {},\r\n  warn: () => {},\r\n  error: () => {}\r\n};\r\n\r\n/**\r\n * Get appropriate logger based on environment\r\n */\r\nexport function getLogger(prefix?: string): Logger {\r\n  // In test environments, use noop logger to avoid console spam\r\n  if (typeof process !== 'undefined' && process.env?.NODE_ENV === 'test') {\r\n    return noopLogger;\r\n  }\r\n\r\n  // In development, enable debug logging\r\n  const isDev = typeof process !== 'undefined' && process.env?.NODE_ENV === 'development';\r\n  const minLevel: LogLevel = isDev ? 'debug' : 'info';\r\n\r\n  return createLogger(prefix, minLevel);\r\n}","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\utils\\navigation.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1577,1580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1577,1580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2990,2993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2990,2993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Product } from '../types/product';\r\n\r\nexport interface Seller {\r\n  username: string;\r\n  id?: string;\r\n}\r\n\r\nexport interface Collection {\r\n  slug: string;\r\n  id?: string;\r\n}\r\n\r\nexport interface Brand {\r\n  slug: string;\r\n  name: string;\r\n}\r\n\r\n/**\r\n * Get URL for a product page\r\n * Follows the pattern: /product/{seller_username}/{product_slug}\r\n */\r\nexport function getProductUrl(product: Product): string {\r\n  const sellerUsername = product.sellerName || 'unknown';\r\n  const productSlug = product.slug || 'item';\r\n  return `/product/${sellerUsername}/${productSlug}`;\r\n}\r\n\r\n/**\r\n * Get URL for a collection page\r\n * Follows the pattern: /collection/{collection_slug}\r\n */\r\nexport function getCollectionUrl(collection: Collection): string {\r\n  return `/collection/${collection.slug}`;\r\n}\r\n\r\n/**\r\n * Get URL for a seller profile page\r\n * Follows the pattern: /sellers/{seller_username}\r\n */\r\nexport function getSellerUrl(seller: Seller): string {\r\n  return `/sellers/${seller.username}`;\r\n}\r\n\r\n/**\r\n * Get URL for a brand page\r\n * Follows the pattern: /brands/{brand_slug}\r\n */\r\nexport function getBrandUrl(brand: Brand): string {\r\n  return `/brands/${brand.slug}`;\r\n}\r\n\r\n/**\r\n * Get URL for a category page\r\n * Follows the pattern: /category/{...segments}\r\n */\r\nexport function getCategoryUrl(segments: string[]): string {\r\n  const path = segments.filter(Boolean).join('/');\r\n  return `/category/${path}`;\r\n}\r\n\r\n/**\r\n * Get URL for search results\r\n * Supports query and filter parameters\r\n */\r\nexport function getSearchUrl(query?: string, filters?: Record<string, any>): string {\r\n  const params = new URLSearchParams();\r\n\r\n  if (query) {\r\n    params.set('q', query);\r\n  }\r\n\r\n  if (filters) {\r\n    Object.entries(filters).forEach(([key, value]) => {\r\n      if (value !== null && value !== undefined) {\r\n        params.set(key, String(value));\r\n      }\r\n    });\r\n  }\r\n\r\n  const queryString = params.toString();\r\n  return `/search${queryString ? `?${queryString}` : ''}`;\r\n}\r\n\r\n/**\r\n * Get URL for dashboard with optional section\r\n * Follows the pattern: /dashboard/{section?}\r\n */\r\nexport function getDashboardUrl(section?: string): string {\r\n  return section ? `/dashboard/${section}` : '/dashboard';\r\n}\r\n\r\n/**\r\n * Get URL for profile page\r\n * Follows the pattern: /profile/{profile_id}\r\n */\r\nexport function getProfileUrl(profileId: string): string {\r\n  return `/profile/${profileId}`;\r\n}\r\n\r\n/**\r\n * Utility for handling product card clicks with analytics\r\n * Returns URL for navigation - parent component handles actual navigation\r\n */\r\nexport function handleProductClick(product: Product, _source?: string): string {\r\n  // Future: Add analytics tracking here\r\n  // analytics.track('product_clicked', { product_id: product.id, source });\r\n\r\n  return getProductUrl(product);\r\n}\r\n\r\n/**\r\n * Utility for handling search result clicks with analytics\r\n * Returns URL for navigation - parent component handles actual navigation\r\n */\r\nexport function handleSearchResultClick(result: any, _query?: string, _position?: number): string | undefined {\r\n  // Future: Add analytics tracking here\r\n  // analytics.track('search_result_clicked', {\r\n  //   result_id: result.id,\r\n  //   query,\r\n  //   position\r\n  // });\r\n\r\n  if (result.type === 'product') {\r\n    return getProductUrl(result);\r\n  } else if (result.type === 'collection') {\r\n    return getCollectionUrl(result);\r\n  } else if (result.type === 'seller') {\r\n    return getSellerUrl(result);\r\n  }\r\n\r\n  // Fallback - return the result's URL if available\r\n  return result.url;\r\n}\r\n\r\n/**\r\n * Get clean URL for sharing or copying\r\n * Removes tracking parameters and normalizes the URL\r\n */\r\nexport function getCleanUrl(path: string, baseUrl?: string): string {\r\n  const url = new URL(path, baseUrl || (typeof window !== 'undefined' ? window.location.origin : 'https://example.com'));\r\n\r\n  // Remove common tracking parameters\r\n  const trackingParams = ['utm_source', 'utm_medium', 'utm_campaign', 'fbclid', 'gclid'];\r\n  trackingParams.forEach(param => url.searchParams.delete(param));\r\n\r\n  return url.toString();\r\n}","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\utils\\performance.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4677,4680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4677,4680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4687,4690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4687,4690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5032,5035],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5032,5035],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5042,5045],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5042,5045],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":233,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6912,6915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6912,6915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":252,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":252,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":261,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7826,7829],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7826,7829],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":270,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":270,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":280,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8387,8390],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8387,8390],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":291,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":291,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":321,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":321,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":520,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":520,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16086,16089],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16086,16089],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":532,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":532,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Performance utilities for Core Web Vitals optimization\r\n * Focus: LCP, CLS, INP improvements for mobile-first product pages\r\n */\r\n\r\n// Image optimization helpers\r\nexport interface ResponsiveImageOptions {\r\n  src: string;\r\n  alt: string;\r\n  sizes?: string;\r\n  priority?: boolean;\r\n  aspectRatio?: string;\r\n  placeholder?: 'blur' | 'empty';\r\n  blurDataURL?: string;\r\n}\r\n\r\n/**\r\n * Generate responsive image attributes with AVIF/WebP support\r\n */\r\nexport function generateResponsiveImage(options: ResponsiveImageOptions) {\r\n  const { src, alt, sizes = '100vw', priority = false, aspectRatio } = options;\r\n  \r\n  // Generate different sizes for responsive images\r\n  const widths = [320, 640, 768, 1024, 1280, 1920];\r\n  \r\n  // Create srcset with modern formats\r\n  const createSrcSet = (format: 'webp' | 'avif' | 'jpg') => {\r\n    return widths\r\n      .map(width => {\r\n        const url = transformImageUrl(src, { width, format });\r\n        return `${url} ${width}w`;\r\n      })\r\n      .join(', ');\r\n  };\r\n\r\n  return {\r\n    src: transformImageUrl(src, { width: 768, format: 'jpg' }), // Fallback\r\n    srcSet: createSrcSet('jpg'),\r\n    alt,\r\n    sizes,\r\n    loading: priority ? 'eager' : 'lazy',\r\n    decoding: priority ? 'sync' : 'async',\r\n    ...(aspectRatio && { style: `aspect-ratio: ${aspectRatio}` }),\r\n    // Add data attributes for intersection observer\r\n    'data-src': src,\r\n    'data-sizes': sizes\r\n  };\r\n}\r\n\r\n/**\r\n * Transform image URL for different formats and sizes\r\n */\r\nfunction transformImageUrl(src: string, options: { width?: number; format?: string } = {}) {\r\n  // This would integrate with your image CDN (Cloudinary, ImageKit, etc.)\r\n  // For now, return original URL - implement based on your CDN\r\n  const { width, format } = options;\r\n  \r\n  // Example for CDNs that support query parameters\r\n  if (src.includes('supabase.co') || src.includes('cloudinary.com') || src.includes('imagekit.io')) {\r\n    const params = new URLSearchParams();\r\n    if (width) params.set('width', width.toString());\r\n    if (format && format !== 'jpg') params.set('format', format);\r\n\r\n    const hasParams = params.toString();\r\n    return hasParams ? `${src}?${params.toString()}` : src;\r\n  }\r\n  \r\n  return src;\r\n}\r\n\r\n/**\r\n * Generate Low Quality Image Placeholder (LQIP) data URL\r\n */\r\nexport function generateBlurPlaceholder(_src: string): string {\r\n  // Generate a small, blurred version as data URL\r\n  // This would typically be done server-side or at build time\r\n  return 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIwIiBoZWlnaHQ9IjMyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImdyYWRpZW50IiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj48c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojZjNmNGY2O3N0b3Atb3BhY2l0eToxIiAvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6I2U1ZTdlYjtzdG9wLW9wYWNpdHk6MSIgLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyYWRpZW50KSIgLz48L3N2Zz4=';\r\n}\r\n\r\n/**\r\n * Intersection Observer for lazy loading components\r\n */\r\nexport function createIntersectionObserver(\r\n  callback: IntersectionObserverCallback,\r\n  options: IntersectionObserverInit = {}\r\n): IntersectionObserver {\r\n  const defaultOptions: IntersectionObserverInit = {\r\n    rootMargin: '50px 0px',\r\n    threshold: 0.1,\r\n    ...options\r\n  };\r\n\r\n  return new IntersectionObserver(callback, defaultOptions);\r\n}\r\n\r\n/**\r\n * Preconnect to critical domains for faster resource loading\r\n */\r\nexport function preconnectDomains(domains: string[]) {\r\n  domains.forEach(domain => {\r\n    if (!document.querySelector(`link[href=\"${domain}\"]`)) {\r\n      const link = document.createElement('link');\r\n      link.rel = 'preconnect';\r\n      link.href = domain;\r\n      link.crossOrigin = 'anonymous';\r\n      document.head.appendChild(link);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Critical resource hints for product pages\r\n */\r\nexport function addProductPageResourceHints() {\r\n  // Add preconnect for common CDNs and APIs\r\n  preconnectDomains([\r\n    'https://fonts.googleapis.com',\r\n    'https://fonts.gstatic.com',\r\n    // Add your image CDN domains here\r\n  ]);\r\n\r\n  // Preload critical CSS if not already loaded\r\n  if (!document.querySelector('link[rel=\"preload\"][as=\"style\"]')) {\r\n    const criticalCSS = document.createElement('link');\r\n    criticalCSS.rel = 'preload';\r\n    criticalCSS.as = 'style';\r\n    criticalCSS.href = '/app.css'; // Adjust path as needed\r\n    criticalCSS.addEventListener('load', function() {\r\n      this.rel = 'stylesheet';\r\n    });\r\n    document.head.appendChild(criticalCSS);\r\n  }\r\n}\r\n\r\n/**\r\n * Optimize INP by debouncing rapid interactions\r\n */\r\nexport function debounce<T extends (...args: any[]) => any>(\r\n  func: T,\r\n  wait: number\r\n): (...args: Parameters<T>) => void {\r\n  let timeout: NodeJS.Timeout;\r\n  \r\n  return (...args: Parameters<T>) => {\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(() => func(...args), wait);\r\n  };\r\n}\r\n\r\n/**\r\n * Throttle function for scroll/resize events\r\n */\r\nexport function throttle<T extends (...args: any[]) => any>(\r\n  func: T,\r\n  limit: number\r\n): (...args: Parameters<T>) => void {\r\n  let inThrottle: boolean;\r\n  \r\n  return (...args: Parameters<T>) => {\r\n    if (!inThrottle) {\r\n      func(...args);\r\n      inThrottle = true;\r\n      setTimeout(() => inThrottle = false, limit);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Prevent layout shifts by reserving space for dynamic content\r\n */\r\nexport function reserveSpace(element: HTMLElement, dimensions: { width?: number; height?: number }) {\r\n  const { width, height } = dimensions;\r\n  \r\n  if (width) {\r\n    element.style.minWidth = `${width}px`;\r\n  }\r\n  \r\n  if (height) {\r\n    element.style.minHeight = `${height}px`;\r\n  }\r\n  \r\n  // Add a data attribute to track reserved space\r\n  element.setAttribute('data-space-reserved', 'true');\r\n}\r\n\r\n/**\r\n * Enhanced Core Web Vitals monitoring with image performance tracking\r\n */\r\nexport interface WebVitalMetrics {\r\n  lcp?: number;\r\n  fid?: number;\r\n  cls?: number;\r\n  fcp?: number;\r\n  ttfb?: number;\r\n  imageLoadTime?: number;\r\n  imageCount?: number;\r\n  failedImages?: number;\r\n  lcpImageUrl?: string;\r\n}\r\n\r\nexport interface ImagePerformanceData {\r\n  url: string;\r\n  loadTime: number;\r\n  naturalWidth: number;\r\n  naturalHeight: number;\r\n  isLCP: boolean;\r\n  failed: boolean;\r\n  timestamp: number;\r\n}\r\n\r\nclass WebVitalsTracker {\r\n  private metrics: WebVitalMetrics = {};\r\n  private imageMetrics: ImagePerformanceData[] = [];\r\n  private observers: PerformanceObserver[] = [];\r\n\r\n  constructor() {\r\n    if (typeof window !== 'undefined') {\r\n      this.initTracking();\r\n    }\r\n  }\r\n\r\n  private initTracking() {\r\n    this.trackLCP();\r\n    this.trackFID();\r\n    this.trackCLS();\r\n    this.trackImages();\r\n  }\r\n\r\n  private trackLCP() {\r\n    try {\r\n      const observer = new PerformanceObserver((list) => {\r\n        const entries = list.getEntries();\r\n        const lastEntry = entries[entries.length - 1] as any;\r\n        \r\n        if (lastEntry) {\r\n          this.metrics.lcp = lastEntry.renderTime || lastEntry.loadTime;\r\n          \r\n          // Check if LCP is an image and track it\r\n          if (lastEntry.element && lastEntry.element.tagName === 'IMG') {\r\n            this.metrics.lcpImageUrl = lastEntry.element.src;\r\n            this.markImageAsLCP(lastEntry.element.src);\r\n          }\r\n          \r\n          if (this.metrics.lcp !== undefined) {\r\n            this.reportMetric('lcp', this.metrics.lcp);\r\n          }\r\n        }\r\n      });\r\n      \r\n      observer.observe({ entryTypes: ['largest-contentful-paint'] });\r\n      this.observers.push(observer);\r\n    } catch (e) {\r\n      console.debug('LCP tracking not supported');\r\n    }\r\n  }\r\n\r\n  private trackFID() {\r\n    try {\r\n      const observer = new PerformanceObserver((list) => {\r\n        const entries = list.getEntries();\r\n        entries.forEach((entry: any) => {\r\n          const fid = entry.processingStart - entry.startTime;\r\n          this.metrics.fid = fid;\r\n          this.reportMetric('fid', fid);\r\n        });\r\n      });\r\n      \r\n      observer.observe({ entryTypes: ['first-input'] });\r\n      this.observers.push(observer);\r\n    } catch (e) {\r\n      console.debug('FID tracking not supported');\r\n    }\r\n  }\r\n\r\n  private trackCLS() {\r\n    try {\r\n      let clsScore = 0;\r\n      const observer = new PerformanceObserver((list) => {\r\n        const entries = list.getEntries();\r\n        entries.forEach((entry: any) => {\r\n          if (!entry.hadRecentInput) {\r\n            clsScore += entry.value;\r\n            this.metrics.cls = clsScore;\r\n            this.reportMetric('cls', clsScore);\r\n          }\r\n        });\r\n      });\r\n      \r\n      observer.observe({ entryTypes: ['layout-shift'] });\r\n      this.observers.push(observer);\r\n    } catch (e) {\r\n      console.debug('CLS tracking not supported');\r\n    }\r\n  }\r\n\r\n  private trackImages() {\r\n    try {\r\n      const observer = new PerformanceObserver((list) => {\r\n        const entries = list.getEntries();\r\n        entries.forEach((entry) => {\r\n          const isImage = entry.name.match(/\\.(jpg|jpeg|png|gif|webp|avif|svg)$/i) ||\r\n                         entry.name.includes('image') ||\r\n                         entry.name.includes('cdn');\r\n          \r\n          if (isImage) {\r\n            this.trackImageLoad({\r\n              url: entry.name,\r\n              loadTime: entry.duration,\r\n              naturalWidth: 0,\r\n              naturalHeight: 0,\r\n              isLCP: false,\r\n              failed: entry.duration === 0,\r\n              timestamp: entry.startTime\r\n            });\r\n          }\r\n        });\r\n      });\r\n      \r\n      observer.observe({ entryTypes: ['resource'] });\r\n      this.observers.push(observer);\r\n    } catch (e) {\r\n      console.debug('Resource timing not supported');\r\n    }\r\n  }\r\n\r\n  public trackImageLoad(data: ImagePerformanceData) {\r\n    this.imageMetrics.push(data);\r\n    \r\n    this.metrics.imageCount = (this.metrics.imageCount || 0) + 1;\r\n    if (data.failed) {\r\n      this.metrics.failedImages = (this.metrics.failedImages || 0) + 1;\r\n    }\r\n    \r\n    // Calculate average image load time\r\n    const validImages = this.imageMetrics.filter(img => !img.failed && img.loadTime > 0);\r\n    if (validImages.length > 0) {\r\n      this.metrics.imageLoadTime = validImages.reduce((acc, img) => acc + img.loadTime, 0) / validImages.length;\r\n    }\r\n  }\r\n\r\n  public markImageAsLCP(imageUrl: string) {\r\n    const image = this.imageMetrics.find(img => img.url === imageUrl);\r\n    if (image) {\r\n      image.isLCP = true;\r\n    }\r\n  }\r\n\r\n  private reportMetric(name: string, value: number) {\r\n    // Report to analytics (modify for your analytics setup)\r\n    if (typeof gtag !== 'undefined') {\r\n      gtag('event', 'web_vitals', {\r\n        event_category: 'Performance',\r\n        event_label: name,\r\n        value: Math.round(value)\r\n      });\r\n    }\r\n\r\n    // Development logging\r\n    if (process.env.NODE_ENV === 'development') {\r\n      const status = this.getMetricStatus(name, value);\r\n      console.debug(`[WebVitals] ${name}: ${Math.round(value)} (${status})`);\r\n    }\r\n  }\r\n\r\n  private getMetricStatus(name: string, value: number): string {\r\n    switch (name) {\r\n      case 'lcp':\r\n        return value <= PERFORMANCE_CONSTANTS.LCP_GOOD ? 'Good' : \r\n               value <= PERFORMANCE_CONSTANTS.LCP_NEEDS_IMPROVEMENT ? 'Needs Improvement' : 'Poor';\r\n      case 'fid':\r\n        return value <= PERFORMANCE_CONSTANTS.FID_GOOD ? 'Good' : \r\n               value <= PERFORMANCE_CONSTANTS.FID_NEEDS_IMPROVEMENT ? 'Needs Improvement' : 'Poor';\r\n      case 'cls':\r\n        return value <= PERFORMANCE_CONSTANTS.CLS_GOOD ? 'Good' : \r\n               value <= PERFORMANCE_CONSTANTS.CLS_NEEDS_IMPROVEMENT ? 'Needs Improvement' : 'Poor';\r\n      default:\r\n        return 'Unknown';\r\n    }\r\n  }\r\n\r\n  public getMetrics(): WebVitalMetrics & { images: ImagePerformanceData[] } {\r\n    return {\r\n      ...this.metrics,\r\n      images: this.imageMetrics\r\n    };\r\n  }\r\n\r\n  public getPerformanceReport() {\r\n    const recommendations: string[] = [];\r\n    \r\n    // Add recommendations based on metrics\r\n    if (this.metrics.lcp && this.metrics.lcp > PERFORMANCE_CONSTANTS.LCP_GOOD) {\r\n      recommendations.push('Consider preloading critical images or optimizing LCP element');\r\n    }\r\n    \r\n    if (this.metrics.cls && this.metrics.cls > PERFORMANCE_CONSTANTS.CLS_GOOD) {\r\n      recommendations.push('Add explicit dimensions to images to prevent layout shift');\r\n    }\r\n    \r\n    const failureRate = this.metrics.failedImages && this.metrics.imageCount \r\n      ? (this.metrics.failedImages / this.metrics.imageCount) * 100 \r\n      : 0;\r\n    \r\n    if (failureRate > 5) {\r\n      recommendations.push('High image failure rate - check image URLs and CDN');\r\n    }\r\n\r\n    return {\r\n      coreWebVitals: {\r\n        lcp: this.metrics.lcp ? `${Math.round(this.metrics.lcp)}ms` : 'Not measured',\r\n        fid: this.metrics.fid ? `${Math.round(this.metrics.fid)}ms` : 'Not measured',\r\n        cls: this.metrics.cls ? this.metrics.cls.toFixed(3) : 'Not measured'\r\n      },\r\n      imagePerformance: {\r\n        totalImages: this.metrics.imageCount || 0,\r\n        failedImages: this.metrics.failedImages || 0,\r\n        averageLoadTime: this.metrics.imageLoadTime ? `${Math.round(this.metrics.imageLoadTime)}ms` : 'Not measured',\r\n        lcpImage: this.metrics.lcpImageUrl || 'Not detected'\r\n      },\r\n      recommendations\r\n    };\r\n  }\r\n\r\n  public destroy() {\r\n    this.observers.forEach(observer => observer.disconnect());\r\n    this.observers = [];\r\n  }\r\n}\r\n\r\n// Global tracker instance\r\nlet webVitalsTracker: WebVitalsTracker;\r\n\r\nexport function getWebVitalsTracker(): WebVitalsTracker {\r\n  if (!webVitalsTracker && typeof window !== 'undefined') {\r\n    webVitalsTracker = new WebVitalsTracker();\r\n  }\r\n  return webVitalsTracker;\r\n}\r\n\r\n// Legacy function for backward compatibility\r\nexport function measureWebVitals() {\r\n  return getWebVitalsTracker();\r\n}\r\n\r\n// Utility functions for manual image tracking\r\nexport function trackImageLoadStart(_imageUrl: string): number {\r\n  return performance.now();\r\n}\r\n\r\nexport function trackImageLoadEnd(imageUrl: string, startTime: number, image?: HTMLImageElement) {\r\n  const loadTime = performance.now() - startTime;\r\n  const tracker = getWebVitalsTracker();\r\n  \r\n  tracker.trackImageLoad({\r\n    url: imageUrl,\r\n    loadTime,\r\n    naturalWidth: image?.naturalWidth || 0,\r\n    naturalHeight: image?.naturalHeight || 0,\r\n    isLCP: false,\r\n    failed: false,\r\n    timestamp: startTime\r\n  });\r\n}\r\n\r\nexport function trackImageError(imageUrl: string, startTime: number) {\r\n  const loadTime = performance.now() - startTime;\r\n  const tracker = getWebVitalsTracker();\r\n  \r\n  tracker.trackImageLoad({\r\n    url: imageUrl,\r\n    loadTime,\r\n    naturalWidth: 0,\r\n    naturalHeight: 0,\r\n    isLCP: false,\r\n    failed: true,\r\n    timestamp: startTime\r\n  });\r\n}\r\n\r\n// Performance budget validation\r\nexport function validatePerformanceBudget(): {\r\n  budget: Record<string, number>;\r\n  current: Record<string, number | string>;\r\n  violations: string[];\r\n} {\r\n  const tracker = getWebVitalsTracker();\r\n  const metrics = tracker.getMetrics();\r\n  \r\n  const budget = {\r\n    lcp: PERFORMANCE_CONSTANTS.LCP_GOOD,\r\n    fid: PERFORMANCE_CONSTANTS.FID_GOOD,\r\n    cls: PERFORMANCE_CONSTANTS.CLS_GOOD,\r\n    imageLoadTime: 1000,\r\n    imageFailureRate: 5\r\n  };\r\n  \r\n  const current = {\r\n    lcp: metrics.lcp || 0,\r\n    fid: metrics.fid || 0,\r\n    cls: metrics.cls || 0,\r\n    imageLoadTime: metrics.imageLoadTime || 0,\r\n    imageFailureRate: metrics.failedImages && metrics.imageCount \r\n      ? (metrics.failedImages / metrics.imageCount) * 100 \r\n      : 0\r\n  };\r\n  \r\n  const violations: string[] = [];\r\n  Object.keys(budget).forEach(key => {\r\n    const budgetValue = budget[key as keyof typeof budget];\r\n    const currentValue = current[key as keyof typeof current];\r\n    if (typeof currentValue === 'number' && currentValue > budgetValue) {\r\n      violations.push(`${key}: ${currentValue} > ${budgetValue}`);\r\n    }\r\n  });\r\n  \r\n  return { budget, current, violations };\r\n}\r\n\r\ndeclare global {\r\n  function gtag(command: string, targetId: string, config?: any): void;\r\n}\r\n\r\n/**\r\n * Code splitting helper for dynamic imports\r\n */\r\nexport async function loadComponent<T>(\r\n  importFn: () => Promise<T>,\r\n  fallback?: () => void\r\n): Promise<T | null> {\r\n  try {\r\n    return await importFn();\r\n  } catch (error) {\r\n    \r\n    fallback?.();\r\n    return null;\r\n  }\r\n}\r\n\r\n// Export commonly used performance constants\r\nexport const PERFORMANCE_CONSTANTS = {\r\n  // Core Web Vitals thresholds (in ms)\r\n  LCP_GOOD: 2500,\r\n  LCP_NEEDS_IMPROVEMENT: 4000,\r\n  FID_GOOD: 100,\r\n  FID_NEEDS_IMPROVEMENT: 300,\r\n  CLS_GOOD: 0.1,\r\n  CLS_NEEDS_IMPROVEMENT: 0.25,\r\n  \r\n  // Touch target sizes (from design tokens)\r\n  TOUCH_TARGET_PRIMARY: 44,\r\n  TOUCH_TARGET_STANDARD: 36,\r\n  TOUCH_TARGET_COMPACT: 32,\r\n  TOUCH_TARGET_ICON: 40,\r\n  \r\n  // Debounce/throttle timings\r\n  SCROLL_THROTTLE: 16, // 60fps\r\n  RESIZE_DEBOUNCE: 150,\r\n  INPUT_DEBOUNCE: 300,\r\n  \r\n  // Image optimization\r\n  IMAGE_SIZES: [320, 640, 768, 1024, 1280, 1920] as const,\r\n  LAZY_LOAD_MARGIN: '50px 0px',\r\n  IMAGE_QUALITY_DEFAULT: 85,\r\n  IMAGE_QUALITY_THUMBNAIL: 75,\r\n  IMAGE_QUALITY_LQIP: 20,\r\n  \r\n  // Performance budgets\r\n  IMAGE_LOAD_TIME_BUDGET: 1000, // ms\r\n  IMAGE_FAILURE_RATE_BUDGET: 5, // percentage\r\n  TOTAL_IMAGES_PER_PAGE_BUDGET: 20,\r\n};","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\utils\\runtime.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3976,3979],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3976,3979],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4279,4282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4279,4282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4470,4473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4470,4473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":213,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4640,4643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4640,4643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Framework-Agnostic Runtime Utilities\r\n *\r\n * Provides runtime detection and environment utilities without\r\n * depending on SvelteKit's $app/environment or other framework-specific APIs.\r\n */\r\n\r\n/**\r\n * Detect if running in browser environment\r\n */\r\nexport const isBrowser = (() => {\r\n  try {\r\n    return typeof window !== 'undefined' &&\r\n           typeof document !== 'undefined' &&\r\n           typeof navigator !== 'undefined';\r\n  } catch {\r\n    return false;\r\n  }\r\n})();\r\n\r\n/**\r\n * Detect if running in server environment\r\n */\r\nexport const isServer = !isBrowser;\r\n\r\n/**\r\n * Get current timestamp - works in both browser and server\r\n */\r\nexport function now(): number {\r\n  return Date.now();\r\n}\r\n\r\n/**\r\n * Safe window access with fallback\r\n */\r\nexport function getWindow(): Window | null {\r\n  return isBrowser ? window : null;\r\n}\r\n\r\n/**\r\n * Safe document access with fallback\r\n */\r\nexport function getDocument(): Document | null {\r\n  return isBrowser ? document : null;\r\n}\r\n\r\n/**\r\n * Safe navigator access with fallback\r\n */\r\nexport function getNavigator(): Navigator | null {\r\n  return isBrowser ? navigator : null;\r\n}\r\n\r\n/**\r\n * Safe localStorage access with fallback\r\n */\r\nexport function getLocalStorage(): Storage | null {\r\n  try {\r\n    return isBrowser && window.localStorage ? window.localStorage : null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Safe sessionStorage access with fallback\r\n */\r\nexport function getSessionStorage(): Storage | null {\r\n  try {\r\n    return isBrowser && window.sessionStorage ? window.sessionStorage : null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Detect if running in development mode\r\n * Uses common environment indicators\r\n */\r\nexport function isDev(): boolean {\r\n  if (!isBrowser) {\r\n    // Server-side detection\r\n    return typeof process !== 'undefined' &&\r\n           (process.env?.NODE_ENV === 'development' ||\r\n            process.env?.NODE_ENV === 'dev');\r\n  }\r\n\r\n  // Browser-side detection\r\n  const hostname = window.location?.hostname;\r\n  return hostname === 'localhost' ||\r\n         hostname === '127.0.0.1' ||\r\n         hostname?.endsWith('.local') ||\r\n         hostname?.startsWith('192.168.') ||\r\n         hostname?.startsWith('10.') ||\r\n         (hostname?.startsWith('172.') &&\r\n          parseInt(hostname.split('.')[1]) >= 16 &&\r\n          parseInt(hostname.split('.')[1]) <= 31);\r\n}\r\n\r\n/**\r\n * Detect if running in production mode\r\n */\r\nexport function isProd(): boolean {\r\n  if (!isBrowser) {\r\n    return typeof process !== 'undefined' &&\r\n           (process.env?.NODE_ENV === 'production' ||\r\n            process.env?.NODE_ENV === 'prod');\r\n  }\r\n\r\n  return !isDev();\r\n}\r\n\r\n/**\r\n * Get current URL safely\r\n */\r\nexport function getCurrentUrl(): string | null {\r\n  try {\r\n    return isBrowser ? window.location.href : null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get user agent safely\r\n */\r\nexport function getUserAgent(): string | null {\r\n  try {\r\n    return isBrowser ? navigator.userAgent : null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Detect mobile device\r\n */\r\nexport function isMobile(): boolean {\r\n  if (!isBrowser) return false;\r\n\r\n  try {\r\n    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Detect touch device\r\n */\r\nexport function isTouchDevice(): boolean {\r\n  if (!isBrowser) return false;\r\n\r\n  try {\r\n    return 'ontouchstart' in window ||\r\n           navigator.maxTouchPoints > 0;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Get viewport dimensions safely\r\n */\r\nexport function getViewportSize(): { width: number; height: number } | null {\r\n  if (!isBrowser) return null;\r\n\r\n  try {\r\n    return {\r\n      width: window.innerWidth,\r\n      height: window.innerHeight\r\n    };\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Safe setTimeout that works in all environments\r\n */\r\nexport function safeSetTimeout(callback: () => void, delay: number): any {\r\n  if (typeof setTimeout !== 'undefined') {\r\n    return setTimeout(callback, delay);\r\n  }\r\n\r\n  // Fallback for environments without setTimeout\r\n  return null;\r\n}\r\n\r\n/**\r\n * Safe setInterval that works in all environments\r\n */\r\nexport function safeSetInterval(callback: () => void, delay: number): any {\r\n  if (typeof setInterval !== 'undefined') {\r\n    return setInterval(callback, delay);\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Safe clearTimeout\r\n */\r\nexport function safeClearTimeout(id: any): void {\r\n  if (typeof clearTimeout !== 'undefined' && id) {\r\n    clearTimeout(id);\r\n  }\r\n}\r\n\r\n/**\r\n * Safe clearInterval\r\n */\r\nexport function safeClearInterval(id: any): void {\r\n  if (typeof clearInterval !== 'undefined' && id) {\r\n    clearInterval(id);\r\n  }\r\n}\r\n\r\n/**\r\n * Check if a specific API is available\r\n */\r\nexport function hasAPI(apiName: string): boolean {\r\n  if (!isBrowser) return false;\r\n\r\n  try {\r\n    return apiName in window && window[apiName as keyof Window] != null;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Feature detection for common browser APIs\r\n */\r\nexport const features = {\r\n  intersectionObserver: isBrowser && 'IntersectionObserver' in window,\r\n  resizeObserver: isBrowser && 'ResizeObserver' in window,\r\n  mutationObserver: isBrowser && 'MutationObserver' in window,\r\n  webAnimations: isBrowser && 'animate' in document.createElement('div'),\r\n  cssCustomProperties: isBrowser && CSS?.supports?.('color', 'var(--test)'),\r\n  cssGrid: isBrowser && CSS?.supports?.('display', 'grid'),\r\n  webWorkers: isBrowser && 'Worker' in window,\r\n  serviceWorkers: isBrowser && 'serviceWorker' in navigator,\r\n  webgl: (() => {\r\n    if (!isBrowser) return false;\r\n    try {\r\n      const canvas = document.createElement('canvas');\r\n      return !!(canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));\r\n    } catch {\r\n      return false;\r\n    }\r\n  })(),\r\n  webrtc: isBrowser && 'RTCPeerConnection' in window,\r\n  geolocation: isBrowser && 'geolocation' in navigator,\r\n  clipboard: isBrowser && 'clipboard' in navigator,\r\n  share: isBrowser && 'share' in navigator,\r\n  wakeLock: isBrowser && 'wakeLock' in navigator,\r\n};\r\n\r\n/**\r\n * Runtime environment info\r\n */\r\nexport const runtime = {\r\n  isBrowser,\r\n  isServer,\r\n  isDev: isDev(),\r\n  isProd: isProd(),\r\n  isMobile: isMobile(),\r\n  isTouch: isTouchDevice(),\r\n  userAgent: getUserAgent(),\r\n  url: getCurrentUrl(),\r\n  viewport: getViewportSize(),\r\n  features,\r\n};","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\utils\\scrollLock.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\utils\\variants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\lib\\utils\\viewTracking.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[425,428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[425,428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[968,971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[968,971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1083,1086],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1083,1086],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-spread","severity":1,"message":"Use the spread operator instead of '.apply()'.","line":43,"column":34,"nodeType":"CallExpression","messageId":"preferSpread","endLine":43,"endColumn":56}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * View Tracking Utility\r\n *\r\n * Provides IntersectionObserver-based view tracking for components.\r\n * Decoupled from Supabase - uses callback pattern for analytics.\r\n */\r\n\r\nexport interface ViewTrackingOptions {\r\n  threshold?: number;\r\n  rootMargin?: string;\r\n  debounceMs?: number;\r\n}\r\n\r\nexport interface ViewTrackingData {\r\n  productId: string;\r\n  userId?: string;\r\n  sessionId?: string;\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface ViewTrackingConfig {\r\n  productId: string;\r\n  userId?: string;\r\n  onView?: (data: ViewTrackingData) => void;\r\n  options?: ViewTrackingOptions;\r\n}\r\n\r\n// Default configuration\r\nconst DEFAULT_OPTIONS: ViewTrackingOptions = {\r\n  threshold: 0.5, // Element must be 50% visible\r\n  rootMargin: '0px',\r\n  debounceMs: 1000 // Minimum time between view events\r\n};\r\n\r\n// Track viewed items to avoid duplicate events\r\nconst viewedItems = new Set<string>();\r\n\r\n// Simple debounce utility\r\nfunction debounce<T extends (...args: any[]) => void>(func: T, delay: number): T {\r\n  let timeoutId: ReturnType<typeof setTimeout>;\r\n  return ((...args: any[]) => {\r\n    clearTimeout(timeoutId);\r\n    timeoutId = setTimeout(() => func.apply(null, args), delay);\r\n  }) as T;\r\n}\r\n\r\n/**\r\n * Svelte action for tracking when elements come into view\r\n */\r\nexport function trackView(node: Element, config: ViewTrackingConfig) {\r\n  const options = { ...DEFAULT_OPTIONS, ...config.options };\r\n\r\n  // Create debounced view handler\r\n  const handleView = debounce((data: ViewTrackingData) => {\r\n    const viewKey = `${data.productId}-${data.userId || 'anonymous'}`;\r\n\r\n    // Skip if already viewed recently\r\n    if (viewedItems.has(viewKey)) {\r\n      return;\r\n    }\r\n\r\n    // Mark as viewed\r\n    viewedItems.add(viewKey);\r\n\r\n    // Clear from set after a longer period to allow re-tracking\r\n    setTimeout(() => {\r\n      viewedItems.delete(viewKey);\r\n    }, 300000); // 5 minutes\r\n\r\n    // Trigger callback\r\n    config.onView?.(data);\r\n  }, options.debounceMs || DEFAULT_OPTIONS.debounceMs!);\r\n\r\n  // Intersection observer callback\r\n  const handleIntersection = (entries: IntersectionObserverEntry[]) => {\r\n    entries.forEach(entry => {\r\n      if (entry.isIntersecting) {\r\n        const viewData: ViewTrackingData = {\r\n          productId: config.productId,\r\n          userId: config.userId,\r\n          sessionId: generateSessionId(),\r\n          metadata: {\r\n            timestamp: Date.now(),\r\n            intersectionRatio: entry.intersectionRatio,\r\n            boundingRect: {\r\n              width: entry.boundingClientRect.width,\r\n              height: entry.boundingClientRect.height,\r\n              top: entry.boundingClientRect.top,\r\n              left: entry.boundingClientRect.left\r\n            },\r\n            viewport: {\r\n              width: window.innerWidth,\r\n              height: window.innerHeight\r\n            }\r\n          }\r\n        };\r\n\r\n        handleView(viewData);\r\n      }\r\n    });\r\n  };\r\n\r\n  // Create intersection observer\r\n  const observer = new IntersectionObserver(handleIntersection, {\r\n    threshold: options.threshold,\r\n    rootMargin: options.rootMargin\r\n  });\r\n\r\n  // Start observing\r\n  observer.observe(node);\r\n\r\n  // Return cleanup function\r\n  return {\r\n    destroy() {\r\n      observer.disconnect();\r\n    },\r\n\r\n    update(newConfig: ViewTrackingConfig) {\r\n      // Update config - observer will use new config on next intersection\r\n      Object.assign(config, newConfig);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Generate a simple session ID for tracking\r\n */\r\nfunction generateSessionId(): string {\r\n  if (typeof window !== 'undefined' && window.sessionStorage) {\r\n    let sessionId = window.sessionStorage.getItem('view-tracking-session');\r\n    if (!sessionId) {\r\n      sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n      window.sessionStorage.setItem('view-tracking-session', sessionId);\r\n    }\r\n    return sessionId;\r\n  }\r\n\r\n  // Fallback for non-browser environments\r\n  return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\n/**\r\n * Manual view tracking function (for cases where IntersectionObserver isn't suitable)\r\n */\r\nexport function trackViewManually(data: ViewTrackingData, onView?: (data: ViewTrackingData) => void) {\r\n  const viewKey = `${data.productId}-${data.userId || 'anonymous'}`;\r\n\r\n  if (viewedItems.has(viewKey)) {\r\n    return;\r\n  }\r\n\r\n  viewedItems.add(viewKey);\r\n  setTimeout(() => viewedItems.delete(viewKey), 300000);\r\n\r\n  onView?.(data);\r\n}\r\n\r\n/**\r\n * Clear all tracked views (useful for testing or session resets)\r\n */\r\nexport function clearViewTracking() {\r\n  viewedItems.clear();\r\n\r\n  if (typeof window !== 'undefined' && window.sessionStorage) {\r\n    window.sessionStorage.removeItem('view-tracking-session');\r\n  }\r\n}\r\n\r\n/**\r\n * Get current view tracking statistics\r\n */\r\nexport function getViewTrackingStats() {\r\n  return {\r\n    totalViewed: viewedItems.size,\r\n    sessionId: generateSessionId()\r\n  };\r\n}","usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\src\\test-setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\svelte.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"K:\\driplo-turbo-1\\packages\\ui\\vitest.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]